{"_filedata":{"slug":"give-your-ac-unit-a-voice-with-nexmo-vapi-and-sensibo-dr"},"title":"Give Your AC Unit a Voice with Nexmo VAPI and Sensibo","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/12/E_Air-Conditioner_1200x600.jpg","author":301,"published":true,"published_at":"2019-12-16T17:14:36","tags":[119,655,1659,511,1550,203],"body":"<h1>Give Your Air Conditioner a Voice with Nexmo and Ruby on Rails</h1>\n<h2>Introduction</h2>\n<p>We are surrounded daily by devices that cool and heat our homes, refrigerate our food, illuminate our rooms, and more. Wouldn&#8217;t it be nice to be able to speak to them? With the <a href=\"https://developer.nexmo.com/voice/voice-api/overview\">Nexmo Voice API</a>, you can give your Internet-connected home devices a phone number and a voice. Why would you want to do this? While most smart devices come with mobile apps and websites, they are not always as accessible for people of differing physical abilities. A phone call still remains one of the most accessible tools available to us.</p>\n<p>In this tutorial, we are going to provide a phone number and a voice to our Sensibo powered air conditioner unit. Sensibo connects legacy air conditioner units to the Internet. It is not feasible for many people to replace their entire unit without a smart unit, and for those people, Sensibo provides an alternative. We will be building a Ruby on Rails application, so some basic knowledge of Ruby and Rails is helpful, but not necessary. If you prefer, you can also clone a fully working version of this application from <a href=\"https://github.com/Nexmo/nexmo-vapi-sensibo-integration\">GitHub</a>.</p>\n<h2>Prerequisities</h2>\n<p>This application requires you to have the following:</p>\n<ul>\n<li><a href=\"https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&amp;utm_medium=github&amp;utm_campaign=https://github.com/Nexmo/nexmo-vapi-sensibo-integration\">Nexmo Account</a></li>\n<li><a href=\"https://home.sensibo.com/me/api\">Sensibo API Account</a></li>\n<li><a href=\"https://ngrok.io\">ngrok</a></li>\n</ul>\n<p>You will need your API credentials from both Nexmo and Sensibo. You will also need an externally accessible URL for Nexmo to communicate with. During development, ngrok is a great resource and has a free tier available. The <a href=\"https://developer.nexmo.com/concepts/guides/testing-with-ngrok\">Nexmo Developer Portal</a> has information on how to set up ngrok with your Nexmo-powered application.</p>\n<h2>API Credentials</h2>\n<h3>Sensibo API Credentials</h3>\n<p>Once you create an account within the Sensibo developer portal, you will have the option to create a Sensibo application. You must provide an application name. It can be whatever you would like, but for the purpose of this tutorial we will call ours <code>nexmo_sensibo_app</code>. When you click the <code>Add API Key</code> button after providing your name, you will be given an API Key. We will add that to our application further on.</p>\n<p>In addition to your Sensibo API key, you also need the name of your Sensibo device. You can acquire that from your <a href=\"https://home.sensibo.com\">device homepage</a>. Your current air conditioner state is displayed in a gray box. In the right-hand bottom corner of the box is an ellipsis icon. Upon clicking the ellipsis, you will see a menu item called <code>Advanced</code>, which opens a submenu that has an item called <code>Advanced Info</code>. When you click on <code>Advanced Info</code>, a dialog box will open that contains your air conditioner device&#8217;s UID. Save that UID somewhere, and we will add it to our application along with the API key later on.</p>\n<h3>Nexmo API Credentials</h3>\n<p>It is free to create a Nexmo account on the <a href=\"https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&amp;utm_medium=github&amp;utm_campaign=https://github.com/Nexmo/nexmo-vapi-sensibo-integration\">Nexmo Dashboard</a>. Once you create your Nexmo account, you will have access to your Nexmo API key and API secret. Take note of those for use in our application. We also need to create a Nexmo Voice application and link it to a Nexmo provisioned phone number. This is the number we will call when we want to interact with our air conditioner.</p>\n<p>To purchase a Nexmo provisioned phone number, click on the <code>Numbers</code> dropdown on the left-hand side of the dashboard and then click on the <code>Buy Numbers</code> link. You will be shown the following options:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2019/12/buy_number_dashboard.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2019/12/buy_number_dashboard.png\" alt=\"buy_number_dashboard\" width=\"1826\" height=\"352\" class=\"alignnone size-full wp-image-30944\" /></a></p>\n<p>Once you click search, you will then be shown a list of possible numbers. Go ahead and pick any of them and purchase them. Now you have successfully rented a Nexmo phone number. At this point, you need to create a Nexmo Voice application and link it to your new phone number. When you click on the <code>Voice</code> dropdown on the left-hand side of the dashboard and then click on the <code>Create an Application</code> link you will be prompted with the menu to create a new application:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2019/12/new_voice_application_dashboard.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2019/12/new_voice_application_dashboard.png\" alt=\"new_voice_application_dashboard\" width=\"2937\" height=\"2500\" class=\"alignnone size-full wp-image-30945\" /></a></p>\n<p>We need to give our application a name. You can name it whatever you like, but for this tutorial, we will call it <code>sensibo-integration</code>. Our Voice application has multiple possible capabilities, but for our purposes, we only need to enable <code>Voice</code> capability. You will see a place to provide your webhook URLs for <code>event</code> and <code>answer</code> endpoints. We will provide these later on and also explain what they are. For now, this is where you must have an externally accessible URL for the API to communicate with your application, and a tool like <a href=\"https://ngrok.io\">ngrok</a> during development is a good resource.</p>\n<p>Once you have finished filling out the options, you can click on <code>Generate new application</code>, and your Voice application will be created. At this point, we need to link our new application with our Nexmo number. We do that by selecting our application from the list of our applications (there should only be one right now). Once you click on your application, you will see options to edit its settings:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2019/12/link_application_to_number_dashboard.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2019/12/link_application_to_number_dashboard.png\" alt=\"link_application_to_number_dashboard\" width=\"3360\" height=\"1762\" class=\"alignnone size-full wp-image-30946\" /></a></p>\n<p>Near the bottom half of the menu is a section called <code>Linked numbers</code>. You will see your Nexmo provisioned phone number in the table and a button called <code>Link</code> in the far right side column. All you need to do is click on it and you are done. Your Nexmo provisioned phone number and your Nexmo Voice application are now linked.</p>\n<p>We are now ready to create our application.</p>\n<h2>Building the application</h2>\n<p>We will create our new application by running <code>rails new nexmo-sensibo-voice --skip-active-record</code> from the command line. In this tutorial, we are not persisting the data, so we include the <code>--skip-active-record</code> flag in our new application to not create a database. However, if you are planning to persist the data, you can ignore that flag.</p>\n<p>With our new application created, we need to create our Model, View, Controller, and Routes. Before all that, though, let&#8217;s add our credentials to our application.</p>\n<h3>Environment Variables</h3>\n<p>We will be using environment variables to store our credentials. You could also use Rails Credentials if you prefer. However, if you do choose to use Rails Credentials, you must update any further references to the credentials in the examples to follow from <code>ENV[...]</code> to <code>Rails.application.credentials.nexmo[...]</code>. As an evergreen reminder, do not store your credentials in any public version control. You can use a gem like <a href=\"https://rubygems.org/gems/dotenv-rails/\">dotenv-rails</a> to manage your environment variables and add the <code>.env</code> file to your <code>.gitignore</code> list.</p>\n<p>Open up your <code>.env</code> file and add the following variable names:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab881258979227\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nNEXMO_API_KEY=\nNEXMO_API_SECRET=\nNEXMO_NUMBER=\nNEXMO_APPLICATION_ID=\nNEXMO_PRIVATE_KEY=\nSENSIBO_APP_NAME=nexmo_sensibo_app\nSENSIBO_API_KEY=\nSENSIBO_API_URL=https://home.sensibo.com/api/v2/pods\nSENSIBO_ID=\nBASE_URL=\nSECRET_PASSKEY=\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab881258979227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab881258979227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab881258979227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab881258979227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab881258979227-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab881258979227-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab881258979227-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab881258979227-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab881258979227-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab881258979227-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab881258979227-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab881258979227-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab881258979227-1\"><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab881258979227-2\"><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab881258979227-3\"><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab881258979227-4\"><span class=\"crayon-v\">NEXMO_APPLICATION_ID</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab881258979227-5\"><span class=\"crayon-v\">NEXMO_PRIVATE_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab881258979227-6\"><span class=\"crayon-v\">SENSIBO_APP_NAME</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">nexmo_sensibo_app</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab881258979227-7\"><span class=\"crayon-v\">SENSIBO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab881258979227-8\"><span class=\"crayon-v\">SENSIBO_API_URL</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//home.sensibo.com/api/v2/pods</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab881258979227-9\"><span class=\"crayon-v\">SENSIBO_ID</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab881258979227-10\"><span class=\"crayon-v\">BASE_URL</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab881258979227-11\"><span class=\"crayon-v\">SECRET_PASSKEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab881258979227-12\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Let&#8217;s walk through each section of those environment variables together.</p>\n<p>The Nexmo grouping is all of your pertinent Nexmo API information. This is where you provide your Nexmo API key and secret, along with your Voice application&#8217;s ID and the path to your private key file that was automatically downloaded to your computer when you generated your new application.</p>\n<p>The Sensibo grouping is all of your pertinent Sensibo API information. Your Sensibo app name is the one we created our application with, <code>nexmo_sensibo_app</code>, and your API key is the key that your account dashboard provided you. The <code>SENSIBO_API_URL</code> is the endpoint to access the Sensibo API, and your <code>SENSIBO_ID</code> is the UID of your actual Sensibo device.</p>\n<p>The final two variable names are specific to this application. The first one is the externally accessible URL that you are utilizing to make your application available for communication with Nexmo. For example, this might be your ngrok URL. The latter variable name, <code>SECRET_PASSKEY</code> is the method by which we will authenticate ourselves to our application. The value for that is any 6 integers you wish.</p>\n<p>With our credentials properly available to our application, we can move on and create the routes of our application.</p>\n<h3>Defining Routes</h3>\n<p>Our application will be constructed as a series of voice prompts for the user to navigate. Each voice prompt will lead to another endpoint, which will act upon the data the user provided. As such, we will create the following <code>routes.rb</code> file:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab886163007729\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nRails.application.routes.draw do\n  post '/webhooks/event', to: 'unit#event'\n  post '/webhooks/answer', to: 'unit#answer'\n  post '/authenticate', to: 'unit#authenticate'\n  post '/menu-choice', to: 'unit#menu'\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab886163007729-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab886163007729-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab886163007729-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab886163007729-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab886163007729-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab886163007729-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab886163007729-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab886163007729-1\"><span class=\"crayon-v\">Rails</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">application</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">draw </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab886163007729-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/webhooks/event'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#event'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab886163007729-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/webhooks/answer'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#answer'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab886163007729-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/authenticate'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#authenticate'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab886163007729-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/menu-choice'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#menu'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab886163007729-6\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab886163007729-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>We have created four <code>POST</code> routes, each one connected to another step in the user journey through the application. These routes are pointing to not yet created <code>UnitController</code> methods, so let&#8217;s go ahead and create those methods.</p>\n<h3>Controller Methods</h3>\n<p>Once we have created a file called <code>unit_controller.rb</code> in <code>/app/controllers/</code> we can open it up and start creating our <code>UnitController</code>. The methods defined below will be referencing an <code>AcUnit</code> Model and class methods defined therein. We will create the <code>AcUnit</code> model and its accompanying methods in the next section.</p>\n<p>First, we create a method to handle the initial answer of the phone call by the air conditioner. All of our methods will be using <a href=\"https://developer.nexmo.com/voice/voice-api/ncco-reference\">Nexmo Call Control Objects (NCCOs)</a>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab888871943201\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef answer\n  render json:\n  [\n    { \n      :action =&gt; 'talk', \n      :text =&gt; welcome_text,\n      :bargeIn =&gt; true\n    },\n    {\n      :action =&gt; 'input',\n      :eventUrl =&gt; [\"#{ENV['BASE_URL']}/authenticate\"],\n      :submitOnHash =&gt; true,\n      :maxDigits =&gt; 6,\n    }\n  ].to_json\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab888871943201-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab888871943201-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">answer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">welcome_text</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">bargeIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">eventUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"#{ENV['BASE_URL']}/authenticate\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">submitOnHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">maxDigits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">to_json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab888871943201-16\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab888871943201-17\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>Let&#8217;s also create the method that holds the welcome text referenced in the <code>:text</code> parameter:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab889230214195\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nprivate\ndef welcome_text\n  &lt;&lt;~HEREDOC\n  Hi! This is your air conditioner. \n  Please authenticate before continuing by entering your passkey. \n  When you are done please enter the hash key.\n  HEREDOC\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab889230214195-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab889230214195-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab889230214195-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab889230214195-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab889230214195-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab889230214195-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab889230214195-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab889230214195-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab889230214195-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab889230214195-1\"><span class=\"crayon-m\">private</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab889230214195-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-v\">welcome_text</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab889230214195-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab889230214195-4\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Hi</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">air </span><span class=\"crayon-v\">conditioner</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab889230214195-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Please </span><span class=\"crayon-e\">authenticate </span><span class=\"crayon-e\">before </span><span class=\"crayon-e\">continuing </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">entering </span><span class=\"crayon-e\">your </span><span class=\"crayon-v\">passkey</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab889230214195-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">When </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">done </span><span class=\"crayon-e\">please </span><span class=\"crayon-e\">enter </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab889230214195-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab889230214195-8\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab889230214195-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>The initial NCCO in <code>#answer</code> provides two actions, a <code>talk</code> and an <code>input</code>. The talk action speaks the <code>welcome_text</code>, while also letting a user &#8220;barge in&#8221; in the midst of the speech with their passkey and not wait for its completion. The input action defines the next step in the <code>eventUrl</code> and lets the user submit their passkey with the hash key, and it also limits the size of the input to 6 digits.</p>\n<p>The second method we will create is an <code>#event</code> method that simply prints out the event data received back from the API into our Rails log output:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab88a906476351\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef event\n  puts params\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88a906476351-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88a906476351-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88a906476351-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88a906476351-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88a906476351-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">event</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88a906476351-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">puts </span><span class=\"crayon-e\">params</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88a906476351-3\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88a906476351-4\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Our next method is one that will handle the authentication with the user&#8217;s passkey. It will either continue the user on or end the call:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab88c680585949\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef authenticate\n  if params['dtmf'] == ENV['SECRET_PASSKEY']\n    render json:\n    [\n      {\n        :action =&gt; 'talk',\n        :text =&gt; AcUnit.menu_options_text,\n        :bargeIn =&gt; true\n      },\n      {\n        :action =&gt; 'input',\n        :eventUrl =&gt; [\"#{ENV['BASE_URL']}/menu-choice\"],\n        :submitOnHash =&gt; true,\n        :maxDigits =&gt; 1,\n      }\n    ]\n  else\n    render json:\n    {\n      :action =&gt; 'talk',\n      :text =&gt; 'Sorry your passkey did not match. Please call back and try again.'\n    }\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88c680585949-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">authenticate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dtmf'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SECRET_PASSKEY'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">menu_options_text</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">bargeIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">eventUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"#{ENV['BASE_URL']}/menu-choice\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">submitOnHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">maxDigits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Sorry your passkey did not match. Please call back and try again.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88c680585949-24\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88c680585949-25\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>The authentication check is a simple equality check between the passkey provided in the params and the passkey provided in the environment variable you defined earlier. If it is true, the <code>AcUnit</code> model class method <code>#menu_options_text</code> is invoked as part of the <code>talk</code> action, along with another <code>input</code> prompt pointing to <code>/menu-choice</code> in the <code>eventUrl</code> parameter. If it is false, then the user is asked to call back and try again, and the call is terminated.</p>\n<p>The <code>#menu</code> method we will define will be where we process the user choice for what to do with the air conditioner. In this walkthrough, we have defined the ability to get the current unit status, turn it on, or to turn it off. The <a href=\"https://sensibo.github.io/\">Sensibo API documentation</a> contains other possible endpoints to implement as well.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab88d761316035\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef menu\n  case params['dtmf']\n  when '1'\n    response = AcUnit.get_status\n    render json:\n    [\n      {\n        :action =&gt; 'talk',\n        :text =&gt; AcUnit.ac_info_text(response)\n      }\n    ]\n  when '2'\n    response = AcUnit.update_status(true)\n    if response['status'] == 'success'\n      render json:\n      [\n        {\n          :action =&gt; 'talk',\n          :text =&gt; 'I am now on. Have a cool day!'\n        }\n      ]\n    else\n      render json:\n      [\n        {\n          :action =&gt; 'talk',\n          :text =&gt; 'Oops. Something went wrong. Please call back and try again.'\n        }\n      ]\n    end\n  when '3'\n    response = AcUnit.update_status(false)\n    if response['status'] == 'success'\n      render json:\n      [\n        {\n          :action =&gt; 'talk',\n          :text =&gt; 'I am now off. Have a warm day!'\n        }\n      ]\n    else\n      render json:\n      [\n        {\n          :action =&gt; 'talk',\n          :text =&gt; 'Oops. Something went wrong. Please call back and try again.'\n        }\n      ]\n    end\n  else\n    render json: \n    [\n      {\n        :action =&gt; 'talk', \n        :text =&gt; \"You entered an incorrect choice of #{params['dtmf']}. Expected 1, 2 or 3. Please try again.\"\n      },\n      {\n        :action =&gt; 'connect',\n        :eventUrl =&gt; \"#{ENV['BASE_URL']}/authenticate\"\n      }\n    ]\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88d761316035-64\">64</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">menu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dtmf'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_status</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-5\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ac_info_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'success'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'I am now on. Have a cool day!'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Oops. Something went wrong. Please call back and try again.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'success'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'I am now off. Have a warm day!'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Oops. Something went wrong. Please call back and try again.'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-50\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-52\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-54\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-55\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"You entered an incorrect choice of #{params['dtmf']}. Expected 1, 2 or 3. Please try again.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-57\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-58\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'connect'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-59\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">eventUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"#{ENV['BASE_URL']}/authenticate\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-60\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-61\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-62\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88d761316035-63\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88d761316035-64\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<p>Now that we have created our Controller methods, we can turn to creating our <code>AcUnit</code> model and defining its methods.</p>\n<h3>Defining the Model</h3>\n<p>To create our model, let&#8217;s first create the file that we will be working in. Create a new file called <code>sensibo.rb</code> in <code>/app/models/</code> and in it define an empty class:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab88f059684762\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nclass Sensibo\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88f059684762-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab88f059684762-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab88f059684762-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88f059684762-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sensibo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab88f059684762-2\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab88f059684762-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>We will need the ability to manipulate JSON and make HTTPS calls in the model so let&#8217;s include those in the model as well, as such above the class definition add:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab890077924585\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nrequire 'net/https'\nrequire 'json'\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab890077924585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab890077924585-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab890077924585-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab890077924585-1\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'net/https'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab890077924585-2\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'json'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab890077924585-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>When we instantiate an instance of our <code>Sensibo</code> class (i.e. our <code>AcUnit</code> in the Controller) we need to provide it with the API key and the device ID. Therefore, we will create an <code>#initialize</code> method that accepts both an <code>api_key</code> and <code>id</code> as arguments. We will also include these in an <code>attr_reader</code>, as we are not setting them only reading them:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab891884628603\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nclass Sensibo\n  attr_reader :api_key, _id\n  def initialize(api_key, id)\n    @api_key = api_key\n    @id = id\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab891884628603-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab891884628603-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab891884628603-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab891884628603-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab891884628603-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab891884628603-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab891884628603-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab891884628603-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab891884628603-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sensibo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab891884628603-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">attr_reader</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_id</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab891884628603-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">initialize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab891884628603-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">api</span><span class=\"crayon-sy\">_</span>key</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab891884628603-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab891884628603-6\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab891884628603-7\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab891884628603-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>At this point, we are ready to build the model methods we already invoked in the Controller. The first one is <code>#get_status</code>, which will fetch the latest data from the Sensibo unit. We will get that data making a <code>GET</code> request:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab893283420194\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef get_status\n  begin\n      uri = URI(\"#{ENV['SENSIBO_API_URL']}/#{self.id}?fields=*&amp;apiKey=#{self.api_key}\")\n      http = Net::HTTP.new(uri.host, uri.port)\n      http.use_ssl = true\n      req = Net::HTTP::Get.new(uri, {'Content-Type' =&gt; 'application/json'})\n      res = http.request(req)\n      data = JSON.parse(res.body)\n  rescue =&gt; e\n      puts \"failed #{e}\"\n  end\n  data\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab893283420194-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab893283420194-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab893283420194-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab893283420194-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab893283420194-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab893283420194-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab893283420194-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab893283420194-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab893283420194-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab893283420194-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab893283420194-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab893283420194-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab893283420194-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab893283420194-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab893283420194-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab893283420194-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">begin</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab893283420194-3\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URI</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"#{ENV['SENSIBO_API_URL']}/#{self.id}?fields=*&amp;apiKey=#{self.api_key}\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab893283420194-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab893283420194-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">use_ssl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab893283420194-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Get</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab893283420194-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab893283420194-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab893283420194-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rescue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">e</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab893283420194-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"failed #{e}\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab893283420194-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab893283420194-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab893283420194-13\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab893283420194-14\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>Next, we will create a method to update the status of the air conditioner, which will take in an argument of <code>state</code> and create a <code>PATCH</code> request. In the case we are building for the argument is either <code>true</code> for on or <code>false</code> for off. However, you can extend the functionality as you see fit in accordance with the endpoints the Sensibo API exposes.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab894359144349\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef update_status(state)\n  begin\n    uri = URI(\"#{ENV['SENSIBO_API_URL']}/#{self.id}/acStates/on?apiKey=#{self.api_key}\")\n    http = Net::HTTP.new(uri.host, uri.port)\n    http.use_ssl = true\n    req = Net::HTTP::Patch.new(uri, {'Content-Type' =&gt; 'application/json'})\n    req.body = {\"newValue\" =&gt; state}.to_json\n    res = http.request(req)\n    data = JSON.parse(res.body)\n  rescue =&gt; e\n    puts \"failed #{e}\"\n  end\n  data\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab894359144349-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab894359144349-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab894359144349-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab894359144349-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab894359144349-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab894359144349-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab894359144349-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab894359144349-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">update_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab894359144349-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">begin</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-3\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URI</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"#{ENV['SENSIBO_API_URL']}/#{self.id}/acStates/on?apiKey=#{self.api_key}\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab894359144349-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">use_ssl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab894359144349-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Patch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"newValue\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">to_json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab894359144349-8\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab894359144349-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rescue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">e</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"failed #{e}\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab894359144349-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab894359144349-14\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab894359144349-15\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>Lastly, we will create two methods that will build the text output we wish to play for the user in the application. The first one will be the output of the current AC status, while the last one will be the output of the menu options:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab895236519507\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef ac_info_text(data)\n  &lt;&lt;~HEREDOC\n  You requested the current info on your AC unit located at:\n  #{data['result']['location']['address'][0]} in #{data['result']['location']['address'][1]}, #{data['result']['location']['address'][2]}.\n\n  The AC unit is currently #{data['result']['acState']['on'] == 'true' ? 'on' : 'off'} and is \n  #{data['result']['connectionStatus']['isAlive'] == 'true' ? 'connected' : 'disconnected'}.\n  It's target temperature is set to #{data['result']['acState']['targetTemperature']}.\n  HEREDOC\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab895236519507-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab895236519507-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab895236519507-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab895236519507-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab895236519507-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab895236519507-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab895236519507-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab895236519507-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab895236519507-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab895236519507-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab895236519507-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab895236519507-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">ac_info_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab895236519507-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab895236519507-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">You </span><span class=\"crayon-e\">requested </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">current </span><span class=\"crayon-e\">info </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">AC </span><span class=\"crayon-e\">unit </span><span class=\"crayon-e\">located </span><span class=\"crayon-v\">at</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab895236519507-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-p\">#{data['result']['location']['address'][0]} in #{data['result']['location']['address'][1]}, #{data['result']['location']['address'][2]}.</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab895236519507-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab895236519507-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">The</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AC</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unit</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currently</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#{data['result']['acState']['on'] == 'true' ? 'on' : 'off'} and is </span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab895236519507-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-p\">#{data['result']['connectionStatus']['isAlive'] == 'true' ? 'connected' : 'disconnected'}.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab895236519507-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">It</span><span class=\"crayon-s\">'s target temperature is set to #{data['</span><span class=\"crayon-i\">result</span><span class=\"crayon-s\">']['</span><span class=\"crayon-i\">acState</span><span class=\"crayon-s\">']['</span><span class=\"crayon-i\">targetTemperature</span>'<span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab895236519507-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab895236519507-10\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab895236519507-11\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3ab897990755548\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef menu_options_text\n  &lt;&lt;~HEREDOC\n  Thank you for authenticating. \n  Please choose from the following options: \n  Press 1 and the hash key for my current status\n  Press 2 and the hash key to turn me on\n  Press 3 and the hash key to turn me off\n  Or hang up at anytime to end this call\n  HEREDOC\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab897990755548-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab897990755548-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab897990755548-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab897990755548-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab897990755548-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab897990755548-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab897990755548-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab897990755548-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab897990755548-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3ab897990755548-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3ab897990755548-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab897990755548-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-v\">menu_options_text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab897990755548-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab897990755548-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Thank </span><span class=\"crayon-e\">you </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">authenticating</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab897990755548-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Please </span><span class=\"crayon-e\">choose </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">following </span><span class=\"crayon-v\">options</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab897990755548-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">Press</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my </span><span class=\"crayon-e\">current </span><span class=\"crayon-e\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab897990755548-6\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-i\">Press</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turn </span><span class=\"crayon-e\">me </span><span class=\"crayon-e\">on</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab897990755548-7\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-i\">Press</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turn </span><span class=\"crayon-e\">me </span><span class=\"crayon-e\">off</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab897990755548-8\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">Or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hang </span><span class=\"crayon-e\">up </span><span class=\"crayon-e\">at </span><span class=\"crayon-e\">anytime </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">call</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab897990755548-9\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3ab897990755548-10\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3ab897990755548-11\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>With the creation of these last two model class methods, we have wrapped up all of our coding for the application. We are ready to run it!</p>\n<h2>Running the Application</h2>\n<p>Now that we have built our application, we can go ahead and use it. When we are running this in our development environment, we need to make sure we have both an external URL available and our Rails server running. If you are using ngrok for your external URL, make sure you have updated your API endpoints in the Nexmo dashboard and your <code>BASE_URL</code> environment variable to point to the correct ngrok URL. When you are using the free tier of ngrok, your ngrok URL changes each time you restart it. To start your Rails server locally, you simply need to run <code>rails s</code> from the command line.</p>\n<p>At this point, you can call your Nexmo provisioned phone number and start interacting with your air conditioner by phone!</p>\n"}