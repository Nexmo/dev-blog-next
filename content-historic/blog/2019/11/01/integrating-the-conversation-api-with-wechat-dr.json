{"_filedata":{"slug":"integrating-the-conversation-api-with-wechat-dr"},"title":"Integrating the Conversation API with WeChat","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/10/E_WeChat-Conversation-API_1200x600-1.png","author":355,"published":true,"published_at":"2019-11-01T17:53:00","tags":[1623,571,793,1622,757],"body":"<p>In this blog post, we’ll show you how to use the Conversation API to establish an external communication channel with your application and demonstrate how to do so using WeChat.</p>\n<p>We will use WeChat’s public API and connect it to the Conversation API to enable two-way messaging between a WeChat client and a Nexmo client, using <strong>custom events</strong>.</p>\n<p>Please refer to this <a href=\"https://github.com/nexmo-community/conversation-api-wechat-integration\">GitHub repository</a> for our reference integration.</p>\n<h2>Concept</h2>\n<p>We will be using <a href=\"https://developer.nexmo.com/conversation/code-snippets/event/create-custom-event\">custom events</a> to simulate WeChat messages and build a middleware server to interact with WeChat’s public API.</p>\n<p>When a client wishes to send a message using WeChat, it will create a custom event of type ‘custom:message:wechat’ with direction outbound. In turn, our middleware server will pick up that event <a href=\"https://developer.nexmo.com/application/code-snippets/update-application\">using RTC events</a> and translate it into an HTTP request to WeChat’s API, notifying in a message.</p>\n<p>In the case of an inbound message (A WeChat client to a Nexmo client), our middleware server will implement WeChat’s messaging webhook and get notified by WeChat on the new message. The server will create a ‘custom:message:wechat’ event with direction inbound and dispatch it. The client will pick up that event and display it as a WeChat message.</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2019/10/wechat1.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2019/10/wechat1.png\" alt=\"architecture\" width=\"879\" height=\"414\" class=\"alignnone size-full wp-image-30627\" /></a></p>\n<h2>Prerequisites</h2>\n<h3>WeChat</h3>\n<p><strong>WeChat</strong> is a Chinese multi-purpose messaging, social media, and mobile payment app developed by Tencent. It has a user base of over one billion people, making it impossible to ignore as a leading messaging channel. One can relate WeChat in China with Facebook in the United States.</p>\n<p>WeChat provides an API that lets developers send and receive messages. In this post, a WeChat account will be used alongside WeChat’s sandbox. Please note that this is to simplify the setup with WeChat.</p>\n<p>You can follow this step-by-step guide to set up your WeChat API. This step-by-step is assuming that you’re already running our sample integration server.</p>\n<ol>\n<li>Register your sandbox account from this <a href=\"http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login\">link</a></li>\n<li>Run your server. In this example, we will use ngrok</li>\n<li>Use your ngrok address to fill up the webhook information. Our server endpoint will be <code>https://[$NGROK_ADDRESS].com/weChatEvent</code> <em>Replace [$NGROK_ADDRESS] with your ngrok address</em></li>\n<li>Fill any token</li>\n<li>Click the submit button, and wait until WeChat verifies your webhook</li>\n<li>You are now ready to receive incoming messages! </li>\n</ol>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2019/10/wechat2.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2019/10/wechat2.png\" alt=\"wechat screenshot\" width=\"1600\" height=\"998\" class=\"alignnone size-full wp-image-30628\" /></a></p>\n<p>To start sending messages from WeChat to our server, you need to add the official account to your WeChat. To do so, you will need to:</p>\n<ol>\n<li>Go to your <a href=\"http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login\">sandbox account</a></li>\n<li>Scroll down to ‘Test number QR code’</li>\n<li>Scan the QR code using your WeChat</li>\n<li>Start chatting! </li>\n</ol>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2019/10/wechat3.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2019/10/wechat3.png\" alt=\"screen shot wechat\" width=\"1600\" height=\"442\" class=\"alignnone size-full wp-image-30629\" /></a></p>\n<p>You should now be able to send messages from your WeChat client to our WeChat account and receive them on your running instance of our server on the <code>/weChatEvent</code> route.</p>\n<h3>Conversation API</h3>\n<p>The Conversation API is a low-level API that allows you to create various objects such as Users, Members, and Conversations. Conversations are the fundamental concept the API revolves around. Conversations are containers of communications exchanged between two or more Users which could be a single interaction or the history of all interactions between them.</p>\n<p>To read more about the API you can visit our <a href=\"https://developer.nexmo.com/conversation/overview\">documentation</a>. You will need:</p>\n<ol>\n<li>An application</li>\n<li>A conversation </li>\n<li>Access to your API key and secret</li>\n</ol>\n<h2>Setup</h2>\n<p>The example.env file contains all the required parameters to get the integration up and running. We will use a hard-coded conversation id to simplify this example, however, that is not mandatory.</p>\n<p>Please follow the instructions given in the README file, and refer to the <a href=\"https://ngrok.com/docs\">ngrok documentation</a> as an example for a service that will expose your integration.</p>\n<p>After setting up all the required parameters, simply run the code by using ‘npm start’.</p>\n<h3>Sending and Receiving a WeChat Message</h3>\n<p>To send an <strong>outbound</strong> message (from a <strong>Nexmo client</strong> to a <strong>WeChat client</strong>) we will need to create the following custom event:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd55cc8b441952271\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n{\n    \"type\":\"custom:wechat:message\",\n    \"body\":{\n        \"to\":\"we_chat_client_id\",\n        \"from\":\"we_chat_integration_id\",\n        \"content\":\"Hello from Nexmo!\",\n        \"direction\":\"outbound\"\n    }\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc8b441952271-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc8b441952271-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc8b441952271-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"custom:wechat:message\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc8b441952271-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"body\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc8b441952271-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"to\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_client_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc8b441952271-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"from\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_integration_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc8b441952271-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Hello from Nexmo!\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc8b441952271-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"direction\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"outbound\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc8b441952271-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc8b441952271-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc8b441952271-10\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>For an <strong>inbound</strong> message (from a <strong>WeChat client</strong> to a <strong>Nexmo client</strong>) we will need to create the same event but reverse its direction.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd55cc90666820281\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n{\n    \"type\":\"custom:wechat:message\",\n    \"body\":{\n        \"to\":\"we_chat_integration_id\",\n        \"from\":\"we_chat_client_id\",\n        \"content\":\"Hello from WeChat!\",\n        \"direction\":\"outbound\"\n    }\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc90666820281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc90666820281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc90666820281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc90666820281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc90666820281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc90666820281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc90666820281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc90666820281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc90666820281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc90666820281-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc90666820281-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc90666820281-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"custom:wechat:message\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc90666820281-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"body\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc90666820281-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"to\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_integration_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc90666820281-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"from\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_client_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc90666820281-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Hello from WeChat!\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc90666820281-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"direction\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"outbound\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc90666820281-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc90666820281-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc90666820281-10\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Please take a look at the following snippet that shows how to dispatch a WeChat event:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd55cc91515538733\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst dispatchWeChatEvent = (wechat, direction = 'inbound') =&gt; {\n  var options = {\n    uri: `https://api.nexmo.com/beta/conversations/${conversationId}/events`,\n    method: 'POST',\n    headers: {\n      Authorization: 'Bearer ' + jwt,\n      Accept: 'application/json',\n      'Content-Type': 'application/json'\n    },\n    json: {\n      type: 'custom:wechat:message',\n      body: {\n        to: wechat.getTo(),\n        from: wechat.getFrom(),\n        content: wechat.getContent(),\n        direction\n      }\n    }\n  };\n\n  request(options, (error, response, body) =&gt; {\n    if (!error &amp;&amp; response.statusCode == 200) {\n      console.log('successfully sent WeChat message'); \n    }\n  });\n};\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd55cc91515538733-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd55cc91515538733-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dispatchWeChatEvent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">direction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'inbound'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//api.nexmo.com/beta/conversations/${conversationId}/events`,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Authorization</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Bearer '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Accept</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'custom:wechat:message'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getFrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">direction</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">statusCode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'successfully sent WeChat message'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd55cc91515538733-26\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd55cc91515538733-27\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>Our Nexmo client, in turn, will receive the custom event and parse it as a WeChat message.</p>\n<p>The following video demonstrates the flow we&#8217;ve just implemented; notice how WeChat could be replaced by a different platform.</p>\n<div style=\"width: 640px;\" class=\"wp-video\"><!--[if lt IE 9]><script>document.createElement('video');</script><![endif]-->\n<video class=\"wp-video-shortcode\" id=\"video-30624-1\" width=\"640\" height=\"400\" loop=\"1\" autoplay=\"1\" preload=\"metadata\" controls=\"controls\"><source type=\"video/mp4\" src=\"https://www.nexmo.com/wp-content/uploads/2019/10/blogvideo-1.mp4?_=1\" /><a href=\"https://www.nexmo.com/wp-content/uploads/2019/10/blogvideo-1.mp4\">https://www.nexmo.com/wp-content/uploads/2019/10/blogvideo-1.mp4</a></video></div>\n<h2>Recap</h2>\n<p>We have learned in the previous sections how to integrate WeChat with your application using our Conversation API. However, WeChat is just an example of what you can integrate with the Conversation API; it could have been a different messaging channel, such as WhatsApp, or even a different communication channel, such as Email.</p>\n<p>The flexibility that the Conversation API brings with its custom events allows you to integrate a wide variety of communication channels.</p>\n<p>For a completed version of this tutorial, you can find it at on <a href=\"https://github.com/nexmo-community/conversation-api-wechat-integration\">GitHub</a></p>\n<p>If you want to learn more about what you can do with our APIs, please visit <a href=\"https://www.nexmo.com/blog/category/developer\">Nexmo.com</a> for more!</p>\n"}