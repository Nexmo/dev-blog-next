{"_filedata":{"slug":"register-to-chat-with-typeform-dr"},"title":"Register to Chat with Typeform","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/11/TW_Typeform_1200x675.png","author":310,"published":true,"published_at":"2019-11-20T13:46:48","tags":[1628,1623,1636,793,1336],"body":"<p>In this article, you&#8217;ll learn how to set up <a href=\"https://www.typeform.com/\">Typeform</a> and capture data from a webhook in the <a href=\"https://nodejs.org/en/\">Node.js</a> framework <a href=\"https://expressjs.com/\">Express.js</a>. You&#8217;ll use <a href=\"http://www.passportjs.org/\">Passport.js</a> to authenticate a user, use <a href=\"https://github.com/Nexmo/nexmo-node/tree/beta\">Nexmo&#8217;s Node.js Server SDK</a> to register a user, and generate a JWT to use with <a href=\"https://developer.nexmo.com/client-sdk/overview\">Nexmo&#8217;s JavaScript Client SDK</a>.</p>\n<p>You&#8217;ll be starting from a pre-built chat application built using <a href=\"https://developer.nexmo.com/client-sdk/overview\">Nexmo&#8217;s JavaScript Client SDK</a> and <a href=\"https://getbootstrap.com/\">Bootstrap</a>.</p>\n<p>This tutorial starts from the <a href=\"https://github.com/nexmo-community/nexmo-chat-typeform-magiclinks\">master</a> branch and ends at the <a href=\"https://github.com/nexmo-community/nexmo-chat-typeform-magiclinks/tree/tutorial-finish\">tutorial-finish</a> branch. You can skip to the end by checking out <code>tutorial-finish</code> and following the <a href=\"https://github.com/lukeocodes/nexmo-chat-typeform-magiclinks/blob/tutorial-finish/README.md\">README</a> to get up and running quickly.</p>\n<h2>Prerequisites</h2>\n<h3>Node &amp; NPM</h3>\n<p>To follow this guide, you&#8217;ll need Node.js and NPM installed. This guide uses Node.js 13.1 and NPM 6.12. Check you have stable or long-term support versions of Node.js installed, at least.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd13826879085\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnode --version\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd13826879085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd13826879085-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd13826879085-1\"><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd13826879085-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd16609681817\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm --version\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd16609681817-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd16609681817-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd16609681817-1\"><span class=\"crayon-v\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd16609681817-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>If you don&#8217;t have Node.js or NPM, or you have older versions, head over to <a href=\"https://nodejs.org/en/\">nodejs.org and install the correct version</a> if you don&#8217;t have it.</p>\n<h3>Nexmo Account</h3>\n<p><a href=\"https://dashboard.nexmo.com/sign-up\">Sign up for a free Nexmo account</a>.</p>\n<h3>Nexmo CLI</h3>\n<p>To set up your application, you&#8217;ll need to install the <a href=\"https://github.com/Nexmo/nexmo-cli/tree/beta\">Nexmo CLI</a>. Install it using NPM in terminal.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd17082290169\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install -g nexmo-cli@beta\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd17082290169-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd17082290169-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd17082290169-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cli</span><span class=\"crayon-sy\">@</span><span class=\"crayon-i\">beta</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd17082290169-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Now, configure the CLI using your API key and secret, found on your <a href=\"https://dashboard.nexmo.com/\">Nexmo account dashboard</a>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd19258451381\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo setup &lt;your_api_key&gt; &lt;your_api_secret&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd19258451381-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd19258451381-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd19258451381-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">setup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your_api_key</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your_api_secret</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd19258451381-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h3>MongoDB</h3>\n<p>We&#8217;ll be storing information in MongoDB. If you don&#8217;t have MongoDB installed, follow the correct <a href=\"https://docs.mongodb.com/manual/administration/install-community/\">MongoDB Community Edition installation guide</a> for your system.</p>\n<h3>Ngrok</h3>\n<p>Because you&#8217;ll be receiving information from a 3rd party, you&#8217;ll need to expose the application running on your local machine, but in a safe way. Ngrok is a safe way to use a single command for an instant, secure URL that allows you to access your local machine, even through a NAT or firewall.</p>\n<p><a href=\"https://ngrok.com/\">Sign up and configure ngrok</a> by following the instructions on their site.</p>\n<h3>Typeform</h3>\n<p>You&#8217;ll use Typeform to capture input from users, so <a href=\"https://admin.typeform.com/signup\">sign-up now for a free Typeform account</a>.</p>\n<h3>Email SMTP Provider</h3>\n<p>You&#8217;ll be sending emails. You&#8217;ll need the hostname, port, a login and a password for an SMTP provider.</p>\n<p>You can use <a href=\"https://support.google.com/a/answer/176600?hl=en\">Google Mail to send email from an app</a>.</p>\n<h3>Git (optional)</h3>\n<p>You can use git to clone the demo application from GitHub.</p>\n<blockquote><p>\n  If you&#8217;re not comfortable with git, this guide also contains instructions on downloading the project as a ZIP file.\n</p></blockquote>\n<p>Follow this <a href=\"https://git-scm.com/book/en/v2/Getting-Started-Installing-Git\">guide to install git</a></p>\n<h2>Starting Out</h2>\n<p>The application you&#8217;re starting with is a chat application built using Bootstrap and the <a href=\"https://developer.nexmo.com/client-sdk/overview\">Nexmo JavaScript Client SDK</a>. It&#8217;s configurable through editing static files, but launched using <a href=\"https://expressjs.com/\">Express.js</a>, a lightweight Node.js based http server.</p>\n<h3>Basic Installation</h3>\n<p>Clone the demo application straight from GitHub.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd1a594938297\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ngit clone https://github.com/nexmo-community/nexmo-chat-typeform-magiclinks.git\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd1a594938297-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd1a594938297-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd1a594938297-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/nexmo-community/nexmo-chat-typeform-magiclinks.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd1a594938297-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Or, for those not comfortable with git commands, you can <a href=\"https://github.com/nexmo-community/nexmo-chat-typeform-magiclinks/archive/master.zip\">download the demo application as a zip file</a> and unpack it locally.</p>\n<p>Once cloned or unpacked, change into the new demo application directory.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd1b614886432\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ncd nexmo-chat-typeform-magiclinks\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd1b614886432-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd1b614886432-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd1b614886432-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">chat</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">typeform</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">magiclinks</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd1b614886432-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Install the npm dependencies.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd1c888055994\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd1c888055994-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd1c888055994-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd1c888055994-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd1c888055994-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Installed alongside Node.js is a package called <code>nodemon</code>, that will automatically reload your server if you edit any files.</p>\n<p>Start the application the standard way.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd1d537192644\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm start\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd1d537192644-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd1d537192644-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd1d537192644-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-i\">start</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd1d537192644-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Start the application, but with nodemon instead.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd1e253143057\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm run dev\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd1e253143057-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd1e253143057-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd1e253143057-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">run </span><span class=\"crayon-i\">dev</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd1e253143057-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<blockquote><p>\n  <strong><em>Tip:</em></strong> If you&#8217;re running the application with <code>nodemon</code> for the rest of this tutorial, whenever I suggest restarting the application you won&#8217;t need to do that because <code>nodemon</code> does it for you. However, if you need to reauthenticate with the application, you will still need to do that, as the session information is stored in memory and not configured to use any other storage.\n</p></blockquote>\n<p>Whichever way you choose to run the application, once it&#8217;s running you can try it out in your favourite browser, which should be able to find it running locally: <a href=\"http://0.0.0.0:3000\">http://0.0.0.0:3000/</a>.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/local_url.png\" alt=\"Chat running locally\" /></p>\n<p>As the application is unconfigured, you&#8217;ll see a very plain empty chat application that you cannot submit messages too. In the real world with error handling, you might show the user a connection error.</p>\n<p>But, if you check the browser console now, you&#8217;ll just see a Nexmo API error for a missing token. This means the application tried to connect but didn&#8217;t provide a user token permitting access the API.</p>\n<p>Test ngrok is configured properly, by running ngrok in a separate tab or window to <code>npm</code>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd20943958178\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nngrok http 3000\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd20943958178-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd20943958178-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd20943958178-1\"><span class=\"crayon-e\">ngrok </span><span class=\"crayon-i\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd20943958178-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/ngrok_url.png\" alt=\"Chat running locally through ngrok\" /></p>\n<p>You need to run this <code>ngrok</code> command, and <code>npm</code> at the same time. This means you need two terminal windows or tabs available, both at the application directory.</p>\n<blockquote><p>\n  <strong><em>Tip:</em></strong> If you need to repeat any quests later, like submitting data from Typeform to the webhook, you can open up <a href=\"http://127.0.0.1:4040\">ngrok&#8217;s web interface at http://127.0.0.1:4040</a> while it&#8217;s running and <strong><em>Replay</em></strong> a request.\n</p></blockquote>\n<p>One thing to remember is that until you pay for ngrok, your URL will be different every time you start it. Remember this when configuring your Typeform webhook later on. If you stop ngrok, you will need to reconfigure Typeform with the new URL when you start it again.</p>\n<blockquote><p>\n  <strong><em>Tip:</em></strong> If you&#8217;re confident with using a tool like <a href=\"https://www.getpostman.com/\">Postman</a> or writing manual cURL requests, and once you have your first webhook request from Typeform, you could create a request to be able to repeat that request later.\n</p></blockquote>\n<h2>Get Chatting</h2>\n<p>In the prerequisites, you setup your CLI using your Nexmo API key and secret. Now, you can run CLI commands to create a Nexmo application, user, conversation, join the user to the conversation and generate a JWT so your user can chat.</p>\n<h3>Nexmo Configuration</h3>\n<p>You&#8217;ll need to use some of the IDs returned once you&#8217;ve ran some of the commands. Keep a note, by copying and pasting your application, conversation, and user IDs.</p>\n<h4>Create Nexmo Application</h4>\n<p>This command creates a new Nexmo application with RTC (real-time communication) capabilities. You won&#8217;t be capturing the events in your application, so you can provide an example web address for the event URL. The private key will be output to a file path of your choice.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd21473471293\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo app:create \"Nexmo RTC Chat\" --capabilities=rtc --rtc-event-url=http://example.com --keyfile=private.key\n# Application created: 4556dbae-bf...f6e33350d8\n# Credentials written to .nexmo-app\n# Private Key saved to: private.key\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd21473471293-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd21473471293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd21473471293-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd21473471293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd21473471293-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd21473471293-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Nexmo RTC Chat\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">capabilities</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">rtc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">rtc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">event</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//example.com --keyfile=private.key</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd21473471293-2\"><span class=\"crayon-p\"># Application created: 4556dbae-bf...f6e33350d8</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd21473471293-3\"><span class=\"crayon-p\"># Credentials written to .nexmo-app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd21473471293-4\"><span class=\"crayon-p\"># Private Key saved to: private.key</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd21473471293-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<blockquote><p>\n  <strong><em>Tip:</em></strong> Your application is also output to a config file (<code>.nexmo-app</code>) in the directory you ran this command. This means that some further commands from this directory will be relevative to this application, like creating users and conversations.\n</p></blockquote>\n<h4>Create Nexmo Conversation</h4>\n<p>With an application created, you can create a conversation. The conversation will be what your users join to send messages to and fro.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd22974877157\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo conversation:create display_name=\"Typeform Chatroom\"\n# Conversation created: CON-a57b0...11e57f56d\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd22974877157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd22974877157-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd22974877157-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd22974877157-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">conversation</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">create </span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Typeform Chatroom\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd22974877157-2\"><span class=\"crayon-p\"># Conversation created: CON-a57b0...11e57f56d</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd22974877157-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h4>Create Your User</h4>\n<p>Now, create a user. This will be the user you authenticate with. For the moment you just need a user name and display name.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd23515928457\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo user:create name=&lt;USER_NAME&gt; display_name=&lt;DISPLAY_NAME&gt;\n# User created: USR-6eaa4...e36b8a47f\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd23515928457-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd23515928457-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd23515928457-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd23515928457-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">create </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">USER_NAME</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">DISPLAY_NAME</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd23515928457-2\"><span class=\"crayon-p\"># User created: USR-6eaa4...e36b8a47f</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd23515928457-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h4>Add User To Conversation</h4>\n<p>With your conversation ID and user ID, run this command to join the conversation with your user.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd24088359398\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo member:add &lt;CONVERSATION_ID&gt; action=join channel='{\"type\":\"app\"}' user_id=&lt;USER_ID&gt;\n# Member added: MEM-df772...1ad7fa06\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd24088359398-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd24088359398-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd24088359398-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd24088359398-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">member</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">add</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">CONVERSATION_ID</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">join </span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'{\"type\":\"app\"}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">USER_ID</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd24088359398-2\"><span class=\"crayon-p\"># Member added: MEM-df772...1ad7fa06</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd24088359398-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h4>Generate User Token</h4>\n<p>Use this command to generate a user token in the form of a JWT, usable by the API but also by Nexmo&#8217;s JavaScript Client SDK. It will return a JWT for you to use which expires in 24 hours, <strong>or 86400 seconds</strong>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd25597737893\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo jwt:generate ./private.key sub=&lt;USER_NAME&gt; exp=$(($(date +%s)+86400)) acl='{\"paths\":{\"/*/users/**\":{},\"/*/conversations/**\":{},\"/*/sessions/**\":{},\"/*/devices/**\":{},\"/*/image/**\":{},\"/*/media/**\":{},\"/*/applications/**\":{},\"/*/push/**\":{},\"/*/knocking/**\":{}}}' application_id=&lt;APPLICATION_ID&gt;\n# eyJhbGciOi...XVCJ9.eyJpYXQiOjE1NzM5M...In0.qn7J6...efWBpemaCDC7HtqA\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd25597737893-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd25597737893-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd25597737893-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd25597737893-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">generate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-m\">private</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">sub</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">USER_NAME</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exp</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">86400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">acl</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'{\"paths\":{\"/*/users/**\":{},\"/*/conversations/**\":{},\"/*/sessions/**\":{},\"/*/devices/**\":{},\"/*/image/**\":{},\"/*/media/**\":{},\"/*/applications/**\":{},\"/*/push/**\":{},\"/*/knocking/**\":{}}}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">application_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">APPLICATION_ID</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd25597737893-2\"><span class=\"crayon-p\"># eyJhbGciOi...XVCJ9.eyJpYXQiOjE1NzM5M...In0.qn7J6...efWBpemaCDC7HtqA</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd25597737893-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<h4>Configure The Application</h4>\n<p>To configure your application, edit the <code>views/layout.hbs</code> file and find the JavaScript configuration around line 61.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd26932451426\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-mixed-highlight\" title=\"Contains Mixed Languages\"></span><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n    &lt;script&gt;\n      var userName = '';\n      var displayName = '';\n      var conversationId = '';\n      var clientToken = '';\n    &lt;/script&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd26932451426-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd26932451426-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd26932451426-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd26932451426-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd26932451426-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd26932451426-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd26932451426-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd26932451426-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd26932451426-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">userName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd26932451426-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">displayName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd26932451426-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">conversationId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd26932451426-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">clientToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd26932451426-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd26932451426-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Firstly, configure the application like this, but by the end of the guide you&#8217;ll be able to authenticate with a magic link and the clientside application with get your user token from your authorized session.</p>\n<p>Edit the config with the values you&#8217;ve generated in the commands above.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd27689781179\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-mixed-highlight\" title=\"Contains Mixed Languages\"></span><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n    &lt;script&gt;\n      var userName = 'luke.oliff@vonage.com';\n      var displayName = 'Luke Oliff';\n      var conversationId = 'CON-123...y6346';\n      var clientToken = 'eyJhbG9.eyJzdWIiO.Sfl5c';\n    &lt;/script&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd27689781179-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd27689781179-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd27689781179-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd27689781179-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd27689781179-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd27689781179-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd27689781179-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd27689781179-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd27689781179-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">userName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'luke.oliff@vonage.com'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd27689781179-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">displayName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Luke Oliff'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd27689781179-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">conversationId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'CON-123...y6346'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd27689781179-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">clientToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'eyJhbG9.eyJzdWIiO.Sfl5c'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd27689781179-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd27689781179-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Now, you can start the application again and start chatting&#8230; with yourself&#8230; because no one else can log in.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd28293808934\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm start\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd28293808934-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd28293808934-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd28293808934-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-i\">start</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd28293808934-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/working_chat.png\" alt=\"Running chat without errors\" /></p>\n<h2>Creating a Typeform</h2>\n<p>You can capture as much data as you like from your Typeform. But, for this guide, ensure you have a least an email field on the form.</p>\n<p>Once you have created your Typeform, click over to the <strong>Connect</strong> tab on your Typeform edit page and click on <strong>Webhooks</strong>.</p>\n<p>Click on <strong>Add a webhook</strong> and enter the URL as <code>https://&lt;your_url&gt;.ngrok.io/webhooks/magiclink</code>. Then click <strong>Save webhook</strong>.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/configure_typeform_webhook.png\" alt=\"Configure Typeform webhook\" /></p>\n<blockquote><p>\n  Once created, you can go back and add a secret to verify requests reaching your webhook are actually coming from Typeform.\n</p></blockquote>\n<p>If you complete your Typeform now and submit it while your application is running, the Typeform will receive a <code>404 Not Found</code> error and retry. <em>If a webhook request fails for any reason, Typeform will retry the request to your endpoint three times using a back-off mechanism after 5, 10, and 20 minutes.</em></p>\n<h2>Environment Variables</h2>\n<p>From here on in, you&#8217;re going to be configuring your application with credentials that not only might differ between environments but also that you won&#8217;t want to commit along with your source code.</p>\n<p><code>dotenv</code> was already a dependency of the starting project, so check out the <code>.env</code> file where it already contains the default port for the application. You&#8217;ll be coming back to this file soon to add more environment variables.</p>\n<h2>Add a Webhook</h2>\n<p>Now, to fix your potential <code>404 Not Found</code> error, add the webhook by creating a new file in the application called <code>routes/webhook.js</code>. In the new file, add the following code.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd29980317165\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar express = require('express');\nvar router = express.Router();\n\n/* POST webhook generates a magic link email to the provided email address */\nrouter.post('/magiclink', (req, res, next) =&gt; {\n  console.log(req.body);\n\n  // always return a response...\n  res.sendStatus(200);\n});\n\nmodule.exports = router;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd29980317165-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd29980317165-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd29980317165-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd29980317165-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd29980317165-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd29980317165-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd29980317165-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd29980317165-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd29980317165-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd29980317165-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd29980317165-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd29980317165-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd29980317165-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd29980317165-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'express'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd29980317165-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Router</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd29980317165-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd29980317165-4\"><span class=\"crayon-c\">/* POST webhook generates a magic link email to the provided email address */</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd29980317165-5\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/magiclink'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd29980317165-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd29980317165-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd29980317165-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// always return a response...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd29980317165-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd29980317165-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd29980317165-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd29980317165-12\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd29980317165-13\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Edit <code>app.js</code> and add in the webhook router.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd2b913005006\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n// ...\n\nvar indexRouter = require('./routes/index');\nvar webhookRouter = require('./routes/webhook');\n\n// ...\n\napp.use('/', indexRouter);\napp.use('/webhooks', webhookRouter);\n\n// ...\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2b913005006-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2b913005006-1\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2b913005006-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2b913005006-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indexRouter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./routes/index'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2b913005006-4\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">webhookRouter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./routes/webhook'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2b913005006-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2b913005006-6\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2b913005006-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2b913005006-8\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indexRouter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2b913005006-9\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/webhooks'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">webhookRouter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2b913005006-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2b913005006-11\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2b913005006-12\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>With npm and ngrok running you should now be able to complete your Typeform and receive a webhook request. The payload will contain data that looks like this and it will be output in the window where you started the application with npm.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd2c849759234\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n{\n    ...\n    \"form_response\": {\n        ...\n        \"answers\": [\n            {\n                \"type\": \"email\",\n                \"email\": \"email@example.com\",\n                \"field\": {\n                    \"type\": \"email\",\n                }\n            }\n        ]\n    }\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2c849759234-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"form_response\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"answers\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"email@example.com\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"field\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2c849759234-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2c849759234-16\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<h3>Capture the Answer</h3>\n<p>Before editing the webhook, configure some variables for the Typeform and question inside your environment file <code>.env</code>. For <code>FORM_FIELD_REF</code>, you&#8217;ll need to edit your Typeform question and find the <strong>Question reference</strong> inside your question settings. <code>FORM_URL</code> is the public URL to complete the form.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd2d384829337\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n# ... port etc\n\n# typeform config\nFORM_URL=https://username.typeform.com/to/123456\nFORM_FIELD_TYPE=email\nFORM_FIELD_REF=e8bafec6-5...ee-21bfe1254e81\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2d384829337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2d384829337-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2d384829337-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2d384829337-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2d384829337-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2d384829337-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2d384829337-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2d384829337-1\"><span class=\"crayon-p\"># ... port etc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2d384829337-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2d384829337-3\"><span class=\"crayon-p\"># typeform config</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2d384829337-4\"><span class=\"crayon-v\">FORM_URL</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//username.typeform.com/to/123456</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2d384829337-5\"><span class=\"crayon-v\">FORM_FIELD_TYPE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">email</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2d384829337-6\"><span class=\"crayon-v\">FORM_FIELD_REF</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">e8bafec6</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5...ee</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">21bfe1254e81</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2d384829337-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Now, going back to your webhook route at <code>routes/webhook.js</code> and edit it to include code that will extract the email address.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd2e976156064\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n//...\n\nrequire('dotenv').config();\n\n/* POST webhook generates a magic link email to the provided email address */\nrouter.post('/magiclink', (req, res, next) =&gt; {\n  // find answers from the typeform response\n  let { answers } = req.body.form_response;\n\n  const answer = answers\n    .find(answer =&gt; process.env.FORM_FIELD_TYPE === answer.type &amp;&amp; answer.field.ref === process.env.FORM_FIELD_REF);\n\n  // it'll probably be an email\n  const email = answer[process.env.FORM_FIELD_TYPE];\n\n  console.log(email);\n\n  // always return a response...\n  res.sendStatus(200);\n});\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2e976156064-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-1\"><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-3\"><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dotenv'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-5\"><span class=\"crayon-c\">/* POST webhook generates a magic link email to the provided email address */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-6\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/magiclink'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// find answers from the typeform response</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">answers</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form_response</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-9\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">answers</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FORM_FIELD_TYPE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">field</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ref</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FORM_FIELD_REF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// it'll probably be an email</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FORM_FIELD_TYPE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// always return a response...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2e976156064-20\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2e976156064-21\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>This code will find an answer of type <code>email</code> type with the matching <strong>Question reference</strong> (just in case you capture more than one email address in your form!) and finally returns the value of the answer. The type and reference were set in the <code>.env</code> file.</p>\n<p>The output of this will be the string submitted to the Typeform question.</p>\n<h2>Store Users</h2>\n<p>This tutorial will continue to assume you&#8217;re only capturing a single email field from Typeform and no further user information. It will store other derived information on the user as it is created.</p>\n<p>You&#8217;ll use <a href=\"https://mongoosejs.com\">Mongoose</a> for storing your users in the database. Mongoose provides a straight-forward, schema-based solution to model your application data. It includes built-in type casting, validation, query building, business logic hooks and more, out of the box.</p>\n<h3>Install Mongoose</h3>\n<p>To capture user creation and details, install <code>mongoose</code> to your project.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd2f706257231\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install mongoose\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd2f706257231-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd2f706257231-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd2f706257231-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">mongoose</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd2f706257231-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<h3>Configure MongoDB Connection</h3>\n<p>Configure the project so that Mongoose will be able to connect to the MongoDB database. This guide uses default <em>MacOS</em> values, which could differ from what you need, all depending on the development environment you&#8217;re using.</p>\n<p>Edit <code>.env</code> and add the following configuration.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd30202581984\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n# ... port and typeform etc\n\n# mongodb config\nMONGO_URL=mongodb://127.0.0.1:27017/your-database-name\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd30202581984-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd30202581984-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd30202581984-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd30202581984-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd30202581984-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd30202581984-1\"><span class=\"crayon-p\"># ... port and typeform etc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd30202581984-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd30202581984-3\"><span class=\"crayon-p\"># mongodb config</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd30202581984-4\"><span class=\"crayon-v\">MONGO_URL</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mongodb</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//127.0.0.1:27017/your-database-name</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd30202581984-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>You can decide <code>your-database-name</code> here, because it will create it if it doesn&#8217;t already exist.</p>\n<h3>Connect to MongoDB</h3>\n<p>Now, configure your application to connect to Mongoose when it is run by editing the <code>bin/www</code> file and placing this code at the end.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd31608820615\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n/**\n * Database config\n */\n\nconst mongoose = require('mongoose');\n\n// Set mongoose promises to global\nmongoose.Promise = global.Promise\n\n// Set up default mongoose connection\nmongoose.connect(process.env.MONGO_URL, { useNewUrlParser: true, useUnifiedTopology: true, useFindAndModify: false });\n\n// Get the default connection\nconst db = mongoose.connection;\n\n// Bind connection to error event (to get notification of connection errors)\ndb.on('error', onError); \n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd31608820615-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd31608820615-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-1\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-2\"><span class=\"crayon-c\"> * Database config</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-3\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongoose</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'mongoose'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-7\"><span class=\"crayon-c\">// Set mongoose promises to global</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-8\"><span class=\"crayon-v\">mongoose</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Promise</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">global</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Promise</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-9\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-10\"><span class=\"crayon-c\">// Set up default mongoose connection</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-11\"><span class=\"crayon-v\">mongoose</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MONGO_URL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">useNewUrlParser</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">useUnifiedTopology</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">useFindAndModify</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-13\"><span class=\"crayon-c\">// Get the default connection</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-14\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongoose</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">connection</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-16\"><span class=\"crayon-c\">// Bind connection to error event (to get notification of connection errors)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd31608820615-17\"><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'error'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">onError</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd31608820615-18\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<h3>User Schema and Model</h3>\n<p>Everything in Mongoose starts with a Schema. Each schema maps to a MongoDB collection and defines the shape of the documents within that collection. While MongoDB is Schema-less, Mongoose uses Schema&#8217;s to formalise the standard object before modification.</p>\n<p>Create a new file for the schema at <code>schemas/user.js</code> and add the following code.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd32452528359\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst mongoose = require('mongoose');\nconst Schema = mongoose.Schema;\n\nconst UserSchema = new Schema({\n  name: {\n    type: String,\n    required: true\n  },\n  display_name: {\n    type: String,\n    required: true\n  },\n  email: {\n    type: String,\n    required: true\n  },\n  user_id: {\n    type: String\n  },\n  member_id: {\n    type: String\n  }\n});\n\nmodule.exports = UserSchema;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd32452528359-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd32452528359-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongoose</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'mongoose'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Schema</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongoose</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Schema</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserSchema</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Schema</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">required</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">required</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">email</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">required</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">member_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-23\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-24\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd32452528359-25\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserSchema</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd32452528359-26\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>A model is what is used to create documents that you can use to create, edit, update and delete items on a MongoDB collection. Create a new file for the model at <code>models/user.js</code> and add the following code.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd33460569940\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst mongoose = require('mongoose');\nconst UserSchema = require('../schemas/user');\n\nconst User = mongoose.model('User', UserSchema);\n\nmodule.exports = User;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd33460569940-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd33460569940-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd33460569940-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd33460569940-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd33460569940-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd33460569940-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd33460569940-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd33460569940-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongoose</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'mongoose'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd33460569940-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserSchema</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../schemas/user'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd33460569940-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd33460569940-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongoose</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'User'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserSchema</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd33460569940-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd33460569940-6\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd33460569940-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Notice how the model includes the schema to return a <code>User</code> document.</p>\n<h3>Finding and Saving Users</h3>\n<p>In this instance, you&#8217;re going to use the email as your users string identifier, or username. Their email address will eventually also become their display name. You could choose to capture both of these things individually on your Typeform if you wished.</p>\n<p>Edit <code>routes/webhook.js</code> and add the following code to find users by their username and create them if they don&#8217;t already exist.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd34434223064\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n//...\nvar User = require('../models/user');\n\n/* POST webhook generates a magic link email to the provided email address */\nrouter.post('/magiclink', (req, res, next) =&gt; {\n  // ...\n\n  User.findOne({ name: email }, (err, user) =&gt; {\n    // error handling here\n\n    // if our user is new, save it and output it\n    if (null === user) {\n      user = new User({\n        name: email,\n        email: email,\n        display_name: email\n      });\n\n      user.save((err) =&gt; {\n        // error handling here\n\n        console.log(user);\n\n        res.sendStatus(200);\n      });\n\n    // otherwise, just output it\n    } else {\n      console.log(user);\n\n      res.sendStatus(200);\n    }\n  });\n});\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd34434223064-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd34434223064-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-1\"><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../models/user'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-4\"><span class=\"crayon-c\">/* POST webhook generates a magic link email to the provided email address */</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-5\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/magiclink'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findOne</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// error handling here</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// if our user is new, save it and output it</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">email</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">email</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// error handling here</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-23\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// otherwise, just output it</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-30\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd34434223064-34\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd34434223064-35\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>This code is going to attempt to find a user by their email address, creating one if one didn&#8217;t already exist. This doesn&#8217;t support updating an existing user. If they already existed, you could error. Later, we&#8217;ll generate a magic link to login, rather than give them an error.</p>\n<h2>Generate a Magic Link</h2>\n<p>Your webhook is going to email your user a magic link that can be used to authenticate them with the service.</p>\n<p>Install <code>jsonwebtoken</code> using npm.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd36268900263\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install jsonwebtoken\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd36268900263-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd36268900263-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd36268900263-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">jsonwebtoken</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd36268900263-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Edit <code>.env</code> to create a secret key that can be used for token generation.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd37109562865\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n# ... port etc\nSECRET=whatever-you-want-it-be-a-b-c-1-2-3\n\n# ... typeform and mongo etc\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd37109562865-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd37109562865-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd37109562865-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd37109562865-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd37109562865-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd37109562865-1\"><span class=\"crayon-p\"># ... port etc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd37109562865-2\"><span class=\"crayon-v\">SECRET</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">whatever</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">you</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">want</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">it</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">be</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd37109562865-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd37109562865-4\"><span class=\"crayon-p\"># ... typeform and mongo etc</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd37109562865-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>So, now edit <code>routes/webhook.js</code> to generate the magic link and output it to the server.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd38823382977\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n//...\n\nvar jwt = require('jsonwebtoken');\n\nvar createMagicLink = (req, payload) =&gt; {\n  var token = jwt.sign(payload, process.env.SECRET);\n\n  return `${req.protocol}://${req.get('host')}/auth?token=${token}`;\n}\n\n/* POST webhook generates a magic link email to the provided email address */\nrouter.post('/magiclink', (req, res, next) =&gt; {\n\n  // ...\n\n    // ...\n\n    if (null === user) {\n\n      // ...\n\n      user.save((err) =&gt; {\n        // ...\n\n        console.log(createMagicLink(req, user.toObject()));\n\n        res.sendStatus(200);\n      });\n\n    // otherwise, just output it\n    } else {\n      console.log(createMagicLink(req, user.toObject());\n\n      res.sendStatus(200);\n    }\n\n  // ...\n\n});\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd38823382977-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd38823382977-40\">40</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-1\"><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'jsonwebtoken'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">createMagicLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">payload</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sign</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">payload</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SECRET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//${req.get('host')}/auth?token=${token}`;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-11\"><span class=\"crayon-c\">/* POST webhook generates a magic link email to the provided email address */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-12\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/magiclink'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-13\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-19\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-24\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">createMagicLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-29\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// otherwise, just output it</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">createMagicLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-33\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-36\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-38\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd38823382977-39\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd38823382977-40\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>We&#8217;re adding a JWT to a magic link URL as a method for identifying the user when they try to access the site.</p>\n<blockquote><p>\n  It’s important to note that a JWT guarantees data ownership, not encryption. It&#8217;s a URL-safe way of representing claims by encoding them as JSON objects which can be digitally signed or encrypted. Digitally signing a JWT allows validation against modifications. Encryption, on the other hand, makes sure the content of the JWT is only readable by certain parties.\n</p></blockquote>\n<p>In this instance, the guide doesn&#8217;t use RSA or other asymmetric encryption, choosing only to sign the data instead using the JWT library&#8217;s default HMAC SHA256 synchronous signing.</p>\n<p>Using a JWT in this way verifies the magic link originated from your application, signed by your <code>SECRET</code> and cannot be modified.</p>\n<p>When you submit data to the webhook from Typeform now, the output should be a link to the application that looks like a much longer version of this:</p>\n<p><a href=\"https://your_url.ngrok.io/webhooks/auth?token=eyJhbCJ9.eyEflLxN.N9eq6b5o\">https://<your_url>.ngrok.io/webhooks/auth?token=eyJhbCJ9.eyEflLxN.N9eq6b5o</a></p>\n<p>Click the link for a 404 error. Let&#8217;s fix that.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/auth_url_404.png\" alt=\"Magic link 404s\" /></p>\n<h2>Authenticate with Passport.js</h2>\n<p><a href=\"http://www.passportjs.org/\">Passport.js</a> describes itself as unobtrusive authentication for Node.js. It is incredibly flexible and modular and can be unobtrusively dropped into an application like this.</p>\n<h3>Install Passport.js</h3>\n<p>Install <code>passport</code>, the <code>passport-jwt</code> strategy and <code>express-session</code> so it can be used for authentication and maintaining a session.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd39835663924\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install passport passport-jwt express-session\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd39835663924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd39835663924-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd39835663924-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">passport </span><span class=\"crayon-v\">passport</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">jwt </span><span class=\"crayon-v\">express</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">session</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd39835663924-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h3>Create an Authentication Endpoint</h3>\n<p>Create a new file named <code>routes/auth.js</code> with this source code.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd3a687146044\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar express = require('express');\nvar router = express.Router();\n\n/* GET authenticate user with magic link and direct to home */\nrouter.get('/', (req, res, next) =&gt; {\n  res.redirect(req.protocol + '://' + req.get('host') + '/');\n});\n\nmodule.exports = router;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3a687146044-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3a687146044-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'express'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3a687146044-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Router</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3a687146044-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3a687146044-4\"><span class=\"crayon-c\">/* GET authenticate user with magic link and direct to home */</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3a687146044-5\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3a687146044-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'://'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'host'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3a687146044-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3a687146044-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3a687146044-9\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3a687146044-10\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>This router is going to redirect you to the homepage. You&#8217;ll only reach this router, though, if you&#8217;re authorised by the JWT when you request the page.</p>\n<p>Edit <code>app.js</code> and add this code to add passport authentication to a new auth route.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd3b153927713\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n// ...\n\nvar indexRouter = require('./routes/index');\nvar webhookRouter = require('./routes/webhook');\nvar authRouter = require('./routes/auth');\n\n// ...\n\nvar User = require('./models/user');\nvar session = require('express-session');\nvar passport = require('passport');\nvar jwtStrategy = require('passport-jwt').Strategy;\nvar jwtExtractor = require('passport-jwt').ExtractJwt;\n\napp.use(session({ \n  secret: process.env.SECRET,\n  resave: true,\n  saveUninitialized: true\n}));\n\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.serializeUser((user, done) =&gt; {\n  done(null, user._id);\n});\n\npassport.deserializeUser((id, done) =&gt; {\n  User.findById(id, (err, user) =&gt; {\n    done(err, user);\n  });\n});\n\npassport.use(new jwtStrategy({ \n  jwtFromRequest: jwtExtractor.fromUrlQueryParameter('token'),\n  secretOrKey: process.env.SECRET\n}, (payload, done) =&gt; {\n  return done(null, payload);\n}))\n\napp.use('/', indexRouter);\napp.use('/webhooks', webhookRouter);\napp.use('/auth', passport.authenticate('jwt', { session: true }), authRouter);\n\n// ...\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3b153927713-46\">46</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-1\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indexRouter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./routes/index'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-4\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">webhookRouter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./routes/webhook'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">authRouter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./routes/auth'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-7\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-9\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./models/user'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-10\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">session</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'express-session'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-11\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passport</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'passport'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-12\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwtStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'passport-jwt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Strategy</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-13\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwtExtractor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'passport-jwt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ExtractJwt</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-15\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">secret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SECRET</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">resave</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">saveUninitialized</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-19\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-21\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">passport</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initialize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-22\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">passport</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-23\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-24\"><span class=\"crayon-v\">passport</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">serializeUser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-26\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-27\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-28\"><span class=\"crayon-v\">passport</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">deserializeUser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-32\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-33\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-34\"><span class=\"crayon-v\">passport</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jwtStrategy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-35\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">jwtFromRequest</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwtExtractor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromUrlQueryParameter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'token'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-36\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">secretOrKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">SECRET</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-37\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">payload</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-38\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">payload</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-39\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-40\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-41\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indexRouter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-42\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/webhooks'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">webhookRouter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-43\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/auth'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passport</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">authenticate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'jwt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">session</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">authRouter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-44\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3b153927713-45\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3b153927713-46\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<p>This code will authenticate any request to the <code>/auth</code> endpoint using the JWT extractor from <code>passport-jwt</code> strategy. It will try to validate the <code>token</code> from a query string parameter.</p>\n<p>Once authenticated, the application will create a session and the user data becomes available as <code>req.user</code>.</p>\n<p>To test this, edit <code>routes/index.js</code> and add this code before the <code>res.render()</code> line.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd3c812482451\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n  console.log(req.user);\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3c812482451-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3c812482451-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3c812482451-1\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3c812482451-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Now, restart the application and generate a magic link using your Typeform request. When you click on the link, you&#8217;re redirected back to the chat after authentication. But in your console, you&#8217;ll have output some user data that looks like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd3d302449260\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n{\n  _id: 5dd0215a03174a4d8b920952,\n  name: 'luke.oliff@vonage.com',\n  email: 'luke.oliff@vonage.com',\n  display_name: 'luke.oliff@vonage.com',\n  member_id: null,\n  user_id: null,\n  __v: 0\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3d302449260-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3d302449260-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3d302449260-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5dd0215a03174a4d8b920952</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3d302449260-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'luke.oliff@vonage.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3d302449260-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">email</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'luke.oliff@vonage.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3d302449260-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'luke.oliff@vonage.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3d302449260-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">member_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3d302449260-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3d302449260-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">__v</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3d302449260-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3d302449260-10\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/logged_in_looks_the_same.png\" alt=\"Logged in but nothing has changed\" /></p>\n<p>Make sure no one can access the chat, unless they&#8217;re authenticated, by editing the <code>routes/index.js</code> to look exactly like this.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd3e069303707\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar express = require('express');\nvar router = express.Router();\nrequire('dotenv').config();\n\nvar isAuthenticated = (req, res, next) =&gt; {\n  if(req.isAuthenticated()){\n    next();\n  } else{\n    res.redirect(process.env.FORM_URL);\n  }\n}\n\n/* GET home */\nrouter.get('/', isAuthenticated, (req, res, next) =&gt; {\n  res.render('index', { title: 'Nexmo Typeform Chat', user: req.user.display_name });\n});\n\nmodule.exports = router;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3e069303707-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'express'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Router</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-3\"><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dotenv'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">isAuthenticated</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isAuthenticated</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FORM_URL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-13\"><span class=\"crayon-c\">/* GET home */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-14\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">isAuthenticated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'index'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Nexmo Typeform Chat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">display</span><span class=\"crayon-sy\">_</span>name<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3e069303707-18\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3e069303707-19\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>Removing the console.log output you just added above; the chat will no longer log the current user data to console. Instead, the display name is added to the scope of the templates to render. This change will also redirect to the Typeform if they&#8217;re not logged in.</p>\n<p>Edit <code>views/layout.hbs</code> and output the display name. Find <code>username</code> and replace it with <code>{{user}}</code>, the surrounding code should end up looking like this.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd3f130024898\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n            &lt;ul class=\"nav flex-column\"&gt;\n              &lt;li class=\"nav-item\"&gt;\n                &lt;a class=\"nav-link active\" href=\"#\"&gt;\n                  &lt;span data-feather=\"home\"&gt;&lt;/span&gt;\n                  {{user}}\n                &lt;/a&gt;\n              &lt;/li&gt;\n            &lt;/ul&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd3f130024898-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3f130024898-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">ul </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"nav flex-column\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3f130024898-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"nav-item\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3f130024898-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"nav-link active\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"#\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3f130024898-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">feather</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"home\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3f130024898-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3f130024898-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3f130024898-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd3f130024898-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd3f130024898-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>When they&#8217;re logged in, let&#8217;s also show the members of chat (out of the database) on the page. Edit <code>routes/index.js</code> and wrap the <code>res.render</code> in the <code>User.find</code> which returns all the registered users.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd41399446829\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n// ...\nvar User = require('../models/user');\n\n// ...\n\n/* GET home */\nrouter.get('/', isAuthenticated, (req, res, next) =&gt; {\n  User.find((err, users) =&gt; {\n    res.render('index', { title: 'Nexmo Typeform Chat', members: users, user: req.user.display_name });\n  })\n});\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd41399446829-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd41399446829-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd41399446829-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd41399446829-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd41399446829-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd41399446829-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd41399446829-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd41399446829-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd41399446829-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd41399446829-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd41399446829-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd41399446829-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd41399446829-1\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd41399446829-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../models/user'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd41399446829-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd41399446829-4\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd41399446829-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd41399446829-6\"><span class=\"crayon-c\">/* GET home */</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd41399446829-7\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">isAuthenticated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd41399446829-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd41399446829-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'index'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Nexmo Typeform Chat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">members</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">display</span><span class=\"crayon-sy\">_</span>name<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd41399446829-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd41399446829-11\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd41399446829-12\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>Edit <code>views/layout.hbs</code> again and find this entire block:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd42137793602\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n              {{!-- {{#each members}} --}}\n              &lt;li class=\"nav-item\"&gt;\n                &lt;a class=\"nav-link text-muted\" href=\"#\"&gt;\n                  &lt;span data-feather=\"file-text\"&gt;&lt;/span&gt;\n                  other member\n                &lt;/a&gt;\n              &lt;/li&gt;\n              {{!-- {{/each}} --}}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd42137793602-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd42137793602-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd42137793602-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd42137793602-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd42137793602-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd42137793602-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd42137793602-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd42137793602-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd42137793602-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd42137793602-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-p\">#each members}} --}}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd42137793602-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"nav-item\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd42137793602-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"nav-link text-muted\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"#\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd42137793602-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">feather</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"file-text\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd42137793602-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">other</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">member</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd42137793602-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd42137793602-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd42137793602-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">each</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd42137793602-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Replace it with this functional code.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd43098101906\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n              {{#each members}}\n              &lt;li class=\"nav-item\"&gt;\n                &lt;a class=\"nav-link text-muted\" href=\"#\"&gt;\n                  &lt;span data-feather=\"file-text\"&gt;&lt;/span&gt;\n                  {{this.display_name}}\n                &lt;/a&gt;\n              &lt;/li&gt;\n              {{/each}}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd43098101906-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd43098101906-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd43098101906-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd43098101906-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd43098101906-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd43098101906-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd43098101906-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd43098101906-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd43098101906-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd43098101906-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-p\">#each members}}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd43098101906-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"nav-item\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd43098101906-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"nav-link text-muted\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"#\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd43098101906-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">span </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">feather</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"file-text\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">span</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd43098101906-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">display_name</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd43098101906-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd43098101906-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd43098101906-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">each</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd43098101906-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Restart the application and access it once again through your magic link. Now, you should see some user information on the page.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/logged_in_with_user_info.png\" alt=\"Logged in with user info\" /></p>\n<p>You&#8217;re still accessing chat on the using the hardcoded test data. It&#8217;s time to register your users to Nexmo and let them access the conversation, too.</p>\n<h2>Get Registered Users Chatting on Nexmo</h2>\n<p>At the moment you have users signing up but only using the chat through your hardcoded user information.</p>\n<h3>Install and Configure Nexmo Node</h3>\n<p>At this point, you&#8217;re going to start interacting with the Nexmo service from within your node application for the first time.</p>\n<p>Install <code>nexmo</code> now with this command.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd44102086540\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install nexmo@beta\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd44102086540-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd44102086540-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd44102086540-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">@</span><span class=\"crayon-i\">beta</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd44102086540-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Configure some variables for Nexmo inside your environment file <code>.env</code>. You&#8217;ll need the same API key and secret you used to configure <code>nexmo-cli</code> at the very start. You&#8217;ll also need the application ID and private key path from when you ran <code>nexmo app:create</code>, as well as the conversation ID from when you ran <code>nexmo conversation:create</code>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd45394380805\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n# ... app, typeform and mongodb etc\n\n# nexmo config\nNEXMO_API_KEY=&lt;your_api_key&gt;\nNEXMO_API_SECRET=&lt;your_api_secret&gt;\nNEXMO_APP_ID=4556dbae-bf...f6e33350d8\nNEXMO_PRIVATE_KEY_PATH=./private.key\nNEXMO_CONVERSATION_ID=CON-a57b0...11e57f56d\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd45394380805-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd45394380805-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd45394380805-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd45394380805-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd45394380805-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd45394380805-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd45394380805-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd45394380805-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd45394380805-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd45394380805-1\"><span class=\"crayon-p\"># ... app, typeform and mongodb etc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd45394380805-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd45394380805-3\"><span class=\"crayon-p\"># nexmo config</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd45394380805-4\"><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your_api_key</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd45394380805-5\"><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your_api_secret</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd45394380805-6\"><span class=\"crayon-v\">NEXMO_APP_ID</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4556dbae</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">f6e33350d8</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd45394380805-7\"><span class=\"crayon-v\">NEXMO_PRIVATE_KEY_PATH</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-m\">private</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">key</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd45394380805-8\"><span class=\"crayon-v\">NEXMO_CONVERSATION_ID</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">CON</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a57b0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">11e57f56d</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd45394380805-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Create a utility file at <code>util/nexmo.js</code> that is going to configure the <code>nexmo</code> library.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd46853610964\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst Nexmo = require('nexmo');\nrequire('dotenv').config();\n\nlet options = {};\n\nmodule.exports = new Nexmo({\n    apiKey: process.env.NEXMO_API_KEY,\n    apiSecret: process.env.NEXMO_API_SECRET,\n    applicationId: process.env.NEXMO_APP_ID,\n    privateKey: process.env.NEXMO_PRIVATE_KEY_PATH\n  }, options);\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd46853610964-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd46853610964-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd46853610964-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd46853610964-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd46853610964-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd46853610964-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd46853610964-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd46853610964-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd46853610964-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd46853610964-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd46853610964-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd46853610964-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd46853610964-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'nexmo'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd46853610964-2\"><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dotenv'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd46853610964-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd46853610964-4\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd46853610964-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd46853610964-6\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Nexmo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd46853610964-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd46853610964-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiSecret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd46853610964-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">applicationId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NEXMO_APP_ID</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd46853610964-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">privateKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NEXMO_PRIVATE_KEY</span><span class=\"crayon-sy\">_</span>PATH</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd46853610964-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd46853610964-12\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>Create Nexmo User</h3>\n<p>First thing is first, you need to create a Nexmo user in parallel to your local user when they sign up.</p>\n<p>Edit <code>routes/webhook.js</code> and completely replace the file with this code:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd47567459805\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar express = require('express');\nvar router = express.Router();\nvar jwt = require('jsonwebtoken');\nrequire('dotenv').config();\n\nvar User = require('../models/user');\nvar nexmo = require('../util/nexmo');\n\nvar createMagicLink = (req, payload) =&gt; {\n  var token = jwt.sign(payload, process.env.SECRET);\n\n  return `${req.protocol}://${req.get('host')}/auth?token=${token}`;\n}\n\n/* POST webhook generates a magic link email to the provided email address */\nrouter.post('/magiclink', (req, res, next) =&gt; {\n  // find answers from the typeform response\n  let { answers } = req.body.form_response;\n\n  const answer = answers\n    .find(answer =&gt; process.env.FORM_FIELD_TYPE === answer.type &amp;&amp; answer.field.ref === process.env.FORM_FIELD_REF);\n\n  // it'll probably be an email\n  const email = answer[process.env.FORM_FIELD_TYPE];\n\n  User.findOne({ name: email }, (err, user) =&gt; {\n    // error handling here\n\n    // if we can't find an existing user, prepare a new user document\n    if (null === user) {\n      user = new User({\n        name: email,\n        email: email,\n        display_name: email\n      });\n    }\n\n    if (null === user.user_id) {\n      nexmo.users.create(user.toObject(), (err, nexmoUser) =&gt; {\n        // error handling here\n\n        user.user_id = nexmoUser.id;\n\n        nexmo.conversations.members.create(process.env.NEXMO_CONVERSATION_ID, {\n          action: 'join',\n          user_id: nexmoUser.id,\n          channel: { type: 'app' }\n        }, (err, member) =&gt; {\n          // error handling here\n\n          user.member_id = member.id;\n\n          user.save((err) =&gt; {\n            // error handling here\n\n            console.log(createMagicLink(req, user.toObject()));\n\n            res.sendStatus(200);\n          });\n        });\n      });\n    } else {\n      console.log(createMagicLink(req, user.toObject()));\n\n      res.sendStatus(200);\n    }\n  });\n});\n\nmodule.exports = router;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd47567459805-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd47567459805-71\">71</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'express'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Router</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'jsonwebtoken'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-4\"><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dotenv'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-6\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../models/user'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-7\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../util/nexmo'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-9\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">createMagicLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">payload</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sign</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">payload</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SECRET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//${req.get('host')}/auth?token=${token}`;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-15\"><span class=\"crayon-c\">/* POST webhook generates a magic link email to the provided email address */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-16\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/magiclink'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// find answers from the typeform response</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">answers</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form_response</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-19\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">answers</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FORM_FIELD_TYPE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">field</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ref</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FORM_FIELD_REF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// it'll probably be an email</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FORM_FIELD_TYPE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-25\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findOne</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// error handling here</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-28\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// if we can't find an existing user, prepare a new user document</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">email</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">email</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-37\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmoUser</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// error handling here</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-41\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmoUser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-43\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conversations</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NEXMO_CONVERSATION_ID</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'join'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmoUser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'app'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">member</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// error handling here</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-50\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">member_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">member</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-52\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-54\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// error handling here</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-55\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">createMagicLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-57\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-58\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-59\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-60\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-61\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-62\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-63\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">createMagicLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-64\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-65\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-66\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-67\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-68\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-69\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd47567459805-70\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd47567459805-71\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<p>This new webhook code is going to check for a database user and create one where it&#8217;s new, just as it had before. But now, it will create a Nexmo user and connect the user to the conversation, updating their database record with the Nexmo user ID and a member ID.</p>\n<p>Restart the application and generate a new magic link for your user. Click it to authenticate. It will now see there is no Nexmo user, create one, add it to the conversation, and save it to the user record.</p>\n<p>When redirected to the chat application, you&#8217;ll now see that your created user has joined the conversation. You&#8217;re still chatting as your hardcoded user, though.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/new_user_joins_conversation.png\" alt=\"New user joins the conversation\" /></p>\n<h3>Generate a Token for the Client SDK</h3>\n<p>Your users can sign up, login and even join the conversation. But right now, they&#8217;ll only chat using hardcoded user data. It&#8217;s time to fix that and allow them to talk as themselves.</p>\n<p>Open <code>routes/index.js</code> and create a new route <code>/jwt</code>, because primarily you&#8217;ll expose a new JWT specifically for the Nexmo service, usable by the Client SDK.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd48606985227\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n// ...\nvar nexmo = require('../util/nexmo');\n\n/* GET home */\n// ...\n\n/* GET user data and jwt */\nrouter.get('/jwt', isAuthenticated, (req, res, next) =&gt; {\n  const aclPaths = {\n    \"paths\": {\n      \"/*/users/**\": {},\n      \"/*/conversations/**\": {},\n      \"/*/sessions/**\": {},\n      \"/*/devices/**\": {},\n      \"/*/image/**\": {},\n      \"/*/media/**\": {},\n      \"/*/applications/**\": {},\n      \"/*/push/**\": {},\n      \"/*/knocking/**\": {}\n    }\n  };\n\n  const expires_at = new Date();\n  expires_at.setDate(expires_at.getDate() + 1);\n\n  const jwt = nexmo.generateJwt({\n    application_id: process.env.NEXMO_APP_ID,\n    sub: req.user.name,\n    exp: Math.round(expires_at/1000),\n    acl: aclPaths\n  });\n\n  res.json({\n    user_id: req.user.user_id,\n    name: req.user.name,\n    member_id: req.user.member_id,\n    display_name: req.user.display_name,\n    client_token: jwt,\n    conversation_id: process.env.NEXMO_CONVERSATION_ID,\n    expires_at: expires_at\n  });\n})\n\n// ...\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd48606985227-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd48606985227-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-1\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../util/nexmo'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-4\"><span class=\"crayon-c\">/* GET home */</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-5\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-7\"><span class=\"crayon-c\">/* GET user data and jwt */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-8\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/jwt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">isAuthenticated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">aclPaths</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"paths\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/users/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/conversations/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/sessions/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/devices/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/image/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/media/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/applications/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/push/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"/*/knocking/**\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires_at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">expires_at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setDate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expires_at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getDate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-25\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">generateJwt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">application_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NEXMO_APP_ID</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">sub</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">exp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expires_at</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">acl</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">aclPaths</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-32\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">member_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">member_id</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">display_name</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">client_token</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">conversation_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NEXMO_CONVERSATION_ID</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">expires_at</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">_</span>at</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-41\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-42\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-43\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd48606985227-44\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd48606985227-45\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<p>This new route uses the users existing session to provide data to the browser. The homepage provides this as HTML, but this new endpoint returns JSON.</p>\n<p>Restart the application, follow the magic link and then browse to <code>https://&lt;your_url&gt;.ngrok.io/jwt</code>. You&#8217;ll see information based on your current user, including a <code>client_token</code> to use in the Client SDK.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/jwt_endpoint_shares_user_token.png\" alt=\"JWT endpoint shares client token\" /></p>\n<h3>Remove the Hardcoded Configuration</h3>\n<p>It is time to stop hardcoding config inside the application. Edit the <code>views/layout.hbs</code> file, finding the configuration you added inside the <code>&lt;script&gt;</code> tags. It looked something like this.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd4f843041082\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-mixed-highlight\" title=\"Contains Mixed Languages\"></span><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n    &lt;script&gt;\n      var userName = 'luke.oliff@vonage.com';\n      var displayName = 'Luke Oliff';\n      var conversationId = 'CON-123...y6346';\n      var clientToken = 'eyJhbG9.eyJzdWIiO.Sfl5c';\n    &lt;/script&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd4f843041082-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd4f843041082-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd4f843041082-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd4f843041082-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd4f843041082-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd4f843041082-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd4f843041082-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd4f843041082-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd4f843041082-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">userName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'luke.oliff@vonage.com'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd4f843041082-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">displayName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Luke Oliff'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd4f843041082-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">conversationId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'CON-123...y6346'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd4f843041082-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">clientToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'eyJhbG9.eyJzdWIiO.Sfl5c'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd4f843041082-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd4f843041082-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Delete the script tags and their contents, totally.</p>\n<p>If you want to see what it&#8217;s done to your app, restart and authenticate to find that it&#8217;s almost back to the very beginning, with broken chat. At least you&#8217;re still logged in!</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/logged_in_broken_chat_again.png\" alt=\"Logged in with broken chat\" /></p>\n<h3>Request User Client Token</h3>\n<p>You can access the user&#8217;s client token from a URL as JSON data. So, edit <code>public/javascripts/chat.js</code> and change the <code>authenticateUser</code> method so that it fetches this data, to use it when connecting to the conversation.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd51171920743\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n  // ...\n\n  authenticateUser() {\n    var req = new XMLHttpRequest();\n    req.responseType = 'json';\n    req.open('GET', '/jwt', true);\n\n    var obj = this;\n    req.onload  = function() {\n       obj.joinConversation(req.response);\n    };\n\n    req.send(null);\n  }\n\n  // ...\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd51171920743-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd51171920743-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-1\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">authenticateUser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">XMLHttpRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">responseType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/jwt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">obj</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">onload</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">joinConversation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd51171920743-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd51171920743-17\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>Restart the application, authenticate and enjoy a quick game of spot the difference!</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/logged_in_with_nexmo_user.png\" alt=\"Logged in with Nexmo user\" /></p>\n<p>You see, now you&#8217;re logged in as a different user. Messages from other users are formatted differently. So when you join in the conversation, it&#8217;ll look like this.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/chatting_with_myself.png\" alt=\"Chatting with myself\" /></p>\n<h2>Send the Magic Link by Email</h2>\n<p>You&#8217;ve got a magic link, but it is still output in the console. It is time to send that by email instead.</p>\n<h3>Install and Configure an SMTP Library</h3>\n<p>Install <code>nodemailer</code> now with this command.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd52423632569\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install nodemailer\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd52423632569-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd52423632569-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd52423632569-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">nodemailer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd52423632569-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Configure some variables for the <code>nodemailer</code> library inside your environment file <code>.env</code>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd53968829126\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n# ... app, typeform, mongodb, nexmo etc\n\n# smtp config\nSMTP_HOST=\nSMTP_PORT=\nSMTP_AUTH_USER=\nSMTP_AUTH_PASS=\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd53968829126-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd53968829126-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd53968829126-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd53968829126-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd53968829126-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd53968829126-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd53968829126-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd53968829126-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd53968829126-1\"><span class=\"crayon-p\"># ... app, typeform, mongodb, nexmo etc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd53968829126-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd53968829126-3\"><span class=\"crayon-p\"># smtp config</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd53968829126-4\"><span class=\"crayon-v\">SMTP_HOST</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd53968829126-5\"><span class=\"crayon-v\">SMTP_PORT</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd53968829126-6\"><span class=\"crayon-v\">SMTP_AUTH_USER</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd53968829126-7\"><span class=\"crayon-v\">SMTP_AUTH_PASS</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd53968829126-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>If you&#8217;re using Google or other well known mail host with 2-Step Verification turned on, you&#8217;ll probably need to <a href=\"https://support.google.com/accounts/answer/185833?hl=en\">setup an application password</a>. It will let you authenticate from the application without a need for 2-Step Verification.</p>\n<p>Create a new utility file that will configure <code>nodemailer</code> at <code>util/mailer.js</code> with this code:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd54881172145\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst mailer = require('nodemailer');\nrequire('dotenv').config();\n\nlet options = {\n  host: process.env.SMTP_HOST,\n  port: process.env.SMTP_PORT,\n  secure: true,\n  auth: {\n      user: process.env.SMTP_AUTH_USER,\n      pass: process.env.SMTP_AUTH_PASS\n  }\n};\n\nmodule.exports = mailer.createTransport(options);\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd54881172145-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd54881172145-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd54881172145-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd54881172145-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd54881172145-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd54881172145-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd54881172145-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd54881172145-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mailer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'nodemailer'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd54881172145-2\"><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dotenv'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd54881172145-4\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SMTP_HOST</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd54881172145-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SMTP_PORT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">secure</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd54881172145-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">auth</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SMTP_AUTH_USER</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd54881172145-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">pass</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SMTP_AUTH</span><span class=\"crayon-sy\">_</span>PASS</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd54881172145-12\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-13\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd54881172145-14\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mailer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createTransport</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd54881172145-15\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>Send Magic Links by Email</h3>\n<p>The final edit of <code>routes/webhook.js</code> will be to add the <code>sendEmail</code> function and use it to replace the <code>console.log</code> commands completely.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd3acd55114840994\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n// ...\n\nvar mailer = require('../util/mailer');\n\n// ...\n\nvar sendEmail = (magicLink, email) =&gt; {\n  var mailOptions = {\n      to: email,\n      subject: 'Magic Link',\n      text: 'Click to login: ' + magicLink,\n      html: `&lt;a href=\"${magicLink}\"&gt;Click to Login&lt;/a&gt;`\n  };\n\n  mailer.sendMail(mailOptions);\n}\n\n/* POST webhook generates a magic link email to the provided email address */\nrouter.post('/magiclink', (req, res, next) =&gt; {\n\n  // ...\n\n    if (null === user.user_id) {\n\n      // ...\n\n        // ...\n\n          user.save((err) =&gt; {\n            // ...\n\n            sendEmail(createMagicLink(req, user.toObject()), user.email);\n\n            res.sendStatus(200);\n          });\n\n        // ...\n\n      // ...\n\n    } else {\n      sendEmail(createMagicLink(req, user.toObject()), user.email);\n\n      res.sendStatus(200);\n    }\n\n  // ...\n\n});\n\n// ...\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd3acd55114840994-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd3acd55114840994-52\">52</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-1\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mailer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../util/mailer'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-5\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-7\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sendEmail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">magicLink</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mailOptions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">subject</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Magic Link'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Click to login: '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">magicLink</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"${magicLink}\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Click </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">mailer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendMail</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mailOptions</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-18\"><span class=\"crayon-c\">/* POST webhook generates a magic link email to the provided email address */</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-19\"><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/magiclink'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-24\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-28\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">sendEmail</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">createMagicLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-33\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-36\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-38\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-40\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">sendEmail</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">createMagicLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-43\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-46\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-47\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-48\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-49\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-50\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd3acd55114840994-51\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd3acd55114840994-52\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<p>For the final type, restart the application and send a webhook request using Typeform data.</p>\n<p>With everything working as expected, you&#8217;ll receive an email to the address you submitted to Typeform with a magic link. Click the magic link to authenticate with the application and join the conversation.</p>\n<p>Time to invite some friends!</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2019/11/other_people_can_now_join_chat.png\" alt=\"Other people can now join chat\" /></p>\n<h2>That&#8217;s All Folks!</h2>\n<p>If you&#8217;re interested in how the UI for this tutorial was built, check out my latest post <a href=\"https://www.nexmo.com/blog/2019/12/18/create-a-simple-messaging-ui-with-bootstrap-dr\">Create a Simple Messaging UI with Bootstrap</a>.</p>\n<p>Also, here are some things to consider if you&#8217;re building this for real-world use:</p>\n<ul>\n<li>Use a separate form to handle authentication after a user has already registed. </li>\n<li>Capture a display name and user image inside your Typeform.</li>\n<li>Use a revokable opaque string instead of a JWT inside a magic link.</li>\n<li>Allow users to update their data once authenticated.</li>\n<li>Show all currently online in the side menu.</li>\n<li>Allow users to sign out.</li>\n<li>Allow users to delete messages.</li>\n<li>Allow users to share media.</li>\n<li>Expand shared URLs as previews.</li>\n</ul>\n<p>If you want to enable audio inside an existing chat application like this, you can check out my guide for <a href=\"https://www.nexmo.com/blog/2019/10/11/adding-voice-functionality-to-an-existing-chat-application-dr\">Adding Voice Functionality to an Existing Chat Application</a>.</p>\n<p>Thanks for reading and let me know what you think in the <a href=\"https://developer.nexmo.com/community/slack\">Community Slack</a> or in the comments section below 👇</p>\n"}