{"_filedata":{"slug":"give-your-ac-unit-a-voice-with-nexmo-vapi-and-sensibo-dr"},"title":"Give Your AC Unit a Voice with Nexmo VAPI and Sensibo","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/12/E_Air-Conditioner_1200x600.jpg","author":301,"published":true,"published_at":"2019-12-16T17:14:36","tags":[119,655,1659,511,1550,203],"body":"# Give Your Air Conditioner a Voice with Nexmo and Ruby on Rails\n\n## Introduction\n\nWe are surrounded daily by devices that cool and heat our homes, refrigerate our food, illuminate our rooms, and more. Wouldn’t it be nice to be able to speak to them? With the [Nexmo Voice API](https://developer.nexmo.com/voice/voice-api/overview), you can give your Internet-connected home devices a phone number and a voice. Why would you want to do this? While most smart devices come with mobile apps and websites, they are not always as accessible for people of differing physical abilities. A phone call still remains one of the most accessible tools available to us.\n\nIn this tutorial, we are going to provide a phone number and a voice to our Sensibo powered air conditioner unit. Sensibo connects legacy air conditioner units to the Internet. It is not feasible for many people to replace their entire unit without a smart unit, and for those people, Sensibo provides an alternative. We will be building a Ruby on Rails application, so some basic knowledge of Ruby and Rails is helpful, but not necessary. If you prefer, you can also clone a fully working version of this application from [GitHub](https://github.com/Nexmo/nexmo-vapi-sensibo-integration).\n\n## Prerequisities\n\nThis application requires you to have the following:\n\n*   [Nexmo Account](https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&utm_medium=github&utm_campaign=https://github.com/Nexmo/nexmo-vapi-sensibo-integration)\n*   [Sensibo API Account](https://home.sensibo.com/me/api)\n*   [ngrok](https://ngrok.io)\n\nYou will need your API credentials from both Nexmo and Sensibo. You will also need an externally accessible URL for Nexmo to communicate with. During development, ngrok is a great resource and has a free tier available. The [Nexmo Developer Portal](https://developer.nexmo.com/concepts/guides/testing-with-ngrok) has information on how to set up ngrok with your Nexmo-powered application.\n\n## API Credentials\n\n### Sensibo API Credentials\n\nOnce you create an account within the Sensibo developer portal, you will have the option to create a Sensibo application. You must provide an application name. It can be whatever you would like, but for the purpose of this tutorial we will call ours `nexmo_sensibo_app`. When you click the `Add API Key` button after providing your name, you will be given an API Key. We will add that to our application further on.\n\nIn addition to your Sensibo API key, you also need the name of your Sensibo device. You can acquire that from your [device homepage](https://home.sensibo.com). Your current air conditioner state is displayed in a gray box. In the right-hand bottom corner of the box is an ellipsis icon. Upon clicking the ellipsis, you will see a menu item called `Advanced`, which opens a submenu that has an item called `Advanced Info`. When you click on `Advanced Info`, a dialog box will open that contains your air conditioner device’s UID. Save that UID somewhere, and we will add it to our application along with the API key later on.\n\n### Nexmo API Credentials\n\nIt is free to create a Nexmo account on the [Nexmo Dashboard](https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&utm_medium=github&utm_campaign=https://github.com/Nexmo/nexmo-vapi-sensibo-integration). Once you create your Nexmo account, you will have access to your Nexmo API key and API secret. Take note of those for use in our application. We also need to create a Nexmo Voice application and link it to a Nexmo provisioned phone number. This is the number we will call when we want to interact with our air conditioner.\n\nTo purchase a Nexmo provisioned phone number, click on the `Numbers` dropdown on the left-hand side of the dashboard and then click on the `Buy Numbers` link. You will be shown the following options:\n\n[![buy_number_dashboard](https://www.nexmo.com/wp-content/uploads/2019/12/buy_number_dashboard.png)](https://www.nexmo.com/wp-content/uploads/2019/12/buy_number_dashboard.png)\n\nOnce you click search, you will then be shown a list of possible numbers. Go ahead and pick any of them and purchase them. Now you have successfully rented a Nexmo phone number. At this point, you need to create a Nexmo Voice application and link it to your new phone number. When you click on the `Voice` dropdown on the left-hand side of the dashboard and then click on the `Create an Application` link you will be prompted with the menu to create a new application:\n\n[![new_voice_application_dashboard](https://www.nexmo.com/wp-content/uploads/2019/12/new_voice_application_dashboard.png)](https://www.nexmo.com/wp-content/uploads/2019/12/new_voice_application_dashboard.png)\n\nWe need to give our application a name. You can name it whatever you like, but for this tutorial, we will call it `sensibo-integration`. Our Voice application has multiple possible capabilities, but for our purposes, we only need to enable `Voice` capability. You will see a place to provide your webhook URLs for `event` and `answer` endpoints. We will provide these later on and also explain what they are. For now, this is where you must have an externally accessible URL for the API to communicate with your application, and a tool like [ngrok](https://ngrok.io) during development is a good resource.\n\nOnce you have finished filling out the options, you can click on `Generate new application`, and your Voice application will be created. At this point, we need to link our new application with our Nexmo number. We do that by selecting our application from the list of our applications (there should only be one right now). Once you click on your application, you will see options to edit its settings:\n\n[![link_application_to_number_dashboard](https://www.nexmo.com/wp-content/uploads/2019/12/link_application_to_number_dashboard.png)](https://www.nexmo.com/wp-content/uploads/2019/12/link_application_to_number_dashboard.png)\n\nNear the bottom half of the menu is a section called `Linked numbers`. You will see your Nexmo provisioned phone number in the table and a button called `Link` in the far right side column. All you need to do is click on it and you are done. Your Nexmo provisioned phone number and your Nexmo Voice application are now linked.\n\nWe are now ready to create our application.\n\n## Building the application\n\nWe will create our new application by running `rails new nexmo-sensibo-voice --skip-active-record` from the command line. In this tutorial, we are not persisting the data, so we include the `--skip-active-record` flag in our new application to not create a database. However, if you are planning to persist the data, you can ignore that flag.\n\nWith our new application created, we need to create our Model, View, Controller, and Routes. Before all that, though, let’s add our credentials to our application.\n\n### Environment Variables\n\nWe will be using environment variables to store our credentials. You could also use Rails Credentials if you prefer. However, if you do choose to use Rails Credentials, you must update any further references to the credentials in the examples to follow from `ENV[...]` to `Rails.application.credentials.nexmo[...]`. As an evergreen reminder, do not store your credentials in any public version control. You can use a gem like [dotenv-rails](https://rubygems.org/gems/dotenv-rails/) to manage your environment variables and add the `.env` file to your `.gitignore` list.\n\nOpen up your `.env` file and add the following variable names:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_API_KEY= NEXMO_API_SECRET= NEXMO_NUMBER= NEXMO_APPLICATION_ID= NEXMO_PRIVATE_KEY= SENSIBO_APP_NAME=nexmo_sensibo_app SENSIBO_API_KEY= SENSIBO_API_URL=https://home.sensibo.com/api/v2/pods SENSIBO_ID= BASE_URL= SECRET_PASSKEY=</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d2572372412-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d2572372412-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d2572372412-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d2572372412-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d2572372412-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d2572372412-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d2572372412-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d2572372412-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d2572372412-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d2572372412-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d2572372412-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d2572372412-12\">12</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d2572372412-1\"><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d2572372412-2\"><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d2572372412-3\"><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d2572372412-4\"><span class=\"crayon-v\">NEXMO_APPLICATION_ID</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d2572372412-5\"><span class=\"crayon-v\">NEXMO_PRIVATE_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d2572372412-6\"><span class=\"crayon-v\">SENSIBO_APP_NAME</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">nexmo_sensibo_app</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d2572372412-7\"><span class=\"crayon-v\">SENSIBO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d2572372412-8\"><span class=\"crayon-v\">SENSIBO_API_URL</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//home.sensibo.com/api/v2/pods</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d2572372412-9\"><span class=\"crayon-v\">SENSIBO_ID</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d2572372412-10\"><span class=\"crayon-v\">BASE_URL</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d2572372412-11\"><span class=\"crayon-v\">SECRET_PASSKEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d2572372412-12\">&nbsp;</div></div></td></tr></tbody></table>\n\nLet’s walk through each section of those environment variables together.\n\nThe Nexmo grouping is all of your pertinent Nexmo API information. This is where you provide your Nexmo API key and secret, along with your Voice application’s ID and the path to your private key file that was automatically downloaded to your computer when you generated your new application.\n\nThe Sensibo grouping is all of your pertinent Sensibo API information. Your Sensibo app name is the one we created our application with, `nexmo_sensibo_app`, and your API key is the key that your account dashboard provided you. The `SENSIBO_API_URL` is the endpoint to access the Sensibo API, and your `SENSIBO_ID` is the UID of your actual Sensibo device.\n\nThe final two variable names are specific to this application. The first one is the externally accessible URL that you are utilizing to make your application available for communication with Nexmo. For example, this might be your ngrok URL. The latter variable name, `SECRET_PASSKEY` is the method by which we will authenticate ourselves to our application. The value for that is any 6 integers you wish.\n\nWith our credentials properly available to our application, we can move on and create the routes of our application.\n\n### Defining Routes\n\nOur application will be constructed as a series of voice prompts for the user to navigate. Each voice prompt will lead to another endpoint, which will act upon the data the user provided. As such, we will create the following `routes.rb` file:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">Rails.application.routes.draw do post '/webhooks/event', to: 'unit#event' post '/webhooks/answer', to: 'unit#answer' post '/authenticate', to: 'unit#authenticate' post '/menu-choice', to: 'unit#menu' end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d7445188202-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d7445188202-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d7445188202-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d7445188202-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d7445188202-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d7445188202-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d7445188202-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d7445188202-1\"><span class=\"crayon-v\">Rails</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">application</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">draw </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d7445188202-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/webhooks/event'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#event'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d7445188202-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/webhooks/answer'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#answer'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d7445188202-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/authenticate'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#authenticate'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d7445188202-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/menu-choice'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'unit#menu'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d7445188202-6\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d7445188202-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe have created four `POST` routes, each one connected to another step in the user journey through the application. These routes are pointing to not yet created `UnitController` methods, so let’s go ahead and create those methods.\n\n### Controller Methods\n\nOnce we have created a file called `unit_controller.rb` in `/app/controllers/` we can open it up and start creating our `UnitController`. The methods defined below will be referencing an `AcUnit` Model and class methods defined therein. We will create the `AcUnit` model and its accompanying methods in the next section.\n\nFirst, we create a method to handle the initial answer of the phone call by the air conditioner. All of our methods will be using [Nexmo Call Control Objects (NCCOs)](https://developer.nexmo.com/voice/voice-api/ncco-reference):\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def answer render json: [ { :action =&gt; 'talk', :text =&gt; welcome_text, :bargeIn =&gt; true }, { :action =&gt; 'input', :eventUrl =&gt; [\"#{ENV['BASE_URL']}/authenticate\"], :submitOnHash =&gt; true, :maxDigits =&gt; 6, } ].to_json end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063d9543270123-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063d9543270123-17\">17</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">answer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">welcome_text</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">bargeIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">eventUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"#{ENV['BASE_URL']}/authenticate\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">submitOnHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">maxDigits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">to_json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063d9543270123-16\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063d9543270123-17\">&nbsp;</div></div></td></tr></tbody></table>\n\nLet’s also create the method that holds the welcome text referenced in the `:text` parameter:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">private def welcome_text &lt;&lt;~HEREDOC Hi! This is your air conditioner. Please authenticate before continuing by entering your passkey. When you are done please enter the hash key. HEREDOC end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063da282126460-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063da282126460-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063da282126460-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063da282126460-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063da282126460-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063da282126460-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063da282126460-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063da282126460-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063da282126460-9\">9</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063da282126460-1\"><span class=\"crayon-m\">private</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063da282126460-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-v\">welcome_text</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063da282126460-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063da282126460-4\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Hi</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">air </span><span class=\"crayon-v\">conditioner</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063da282126460-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Please </span><span class=\"crayon-e\">authenticate </span><span class=\"crayon-e\">before </span><span class=\"crayon-e\">continuing </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">entering </span><span class=\"crayon-e\">your </span><span class=\"crayon-v\">passkey</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063da282126460-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">When </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">done </span><span class=\"crayon-e\">please </span><span class=\"crayon-e\">enter </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063da282126460-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063da282126460-8\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063da282126460-9\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe initial NCCO in `#answer` provides two actions, a `talk` and an `input`. The talk action speaks the `welcome_text`, while also letting a user “barge in” in the midst of the speech with their passkey and not wait for its completion. The input action defines the next step in the `eventUrl` and lets the user submit their passkey with the hash key, and it also limits the size of the input to 6 digits.\n\nThe second method we will create is an `#event` method that simply prints out the event data received back from the API into our Rails log output:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def event puts params end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063db822425343-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063db822425343-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063db822425343-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063db822425343-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063db822425343-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">event</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063db822425343-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">puts </span><span class=\"crayon-e\">params</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063db822425343-3\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063db822425343-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nOur next method is one that will handle the authentication with the user’s passkey. It will either continue the user on or end the call:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def authenticate if params['dtmf'] == ENV['SECRET_PASSKEY'] render json: [ { :action =&gt; 'talk', :text =&gt; AcUnit.menu_options_text, :bargeIn =&gt; true }, { :action =&gt; 'input', :eventUrl =&gt; [\"#{ENV['BASE_URL']}/menu-choice\"], :submitOnHash =&gt; true, :maxDigits =&gt; 1, } ] else render json: { :action =&gt; 'talk', :text =&gt; 'Sorry your passkey did not match. Please call back and try again.' } end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063dc963735169-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063dc963735169-25\">25</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">authenticate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dtmf'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SECRET_PASSKEY'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">menu_options_text</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">bargeIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">eventUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"#{ENV['BASE_URL']}/menu-choice\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">submitOnHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">maxDigits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Sorry your passkey did not match. Please call back and try again.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063dc963735169-24\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063dc963735169-25\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe authentication check is a simple equality check between the passkey provided in the params and the passkey provided in the environment variable you defined earlier. If it is true, the `AcUnit` model class method `#menu_options_text` is invoked as part of the `talk` action, along with another `input` prompt pointing to `/menu-choice` in the `eventUrl` parameter. If it is false, then the user is asked to call back and try again, and the call is terminated.\n\nThe `#menu` method we will define will be where we process the user choice for what to do with the air conditioner. In this walkthrough, we have defined the ability to get the current unit status, turn it on, or to turn it off. The [Sensibo API documentation](https://sensibo.github.io/) contains other possible endpoints to implement as well.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def menu case params['dtmf'] when '1' response = AcUnit.get_status render json: [ { :action =&gt; 'talk', :text =&gt; AcUnit.ac_info_text(response) } ] when '2' response = AcUnit.update_status(true) if response['status'] == 'success' render json: [ { :action =&gt; 'talk', :text =&gt; 'I am now on. Have a cool day!' } ] else render json: [ { :action =&gt; 'talk', :text =&gt; 'Oops. Something went wrong. Please call back and try again.' } ] end when '3' response = AcUnit.update_status(false) if response['status'] == 'success' render json: [ { :action =&gt; 'talk', :text =&gt; 'I am now off. Have a warm day!' } ] else render json: [ { :action =&gt; 'talk', :text =&gt; 'Oops. Something went wrong. Please call back and try again.' } ] end else render json: [ { :action =&gt; 'talk', :text =&gt; \"You entered an incorrect choice of #{params['dtmf']}. Expected 1, 2 or 3. Please try again.\" }, { :action =&gt; 'connect', :eventUrl =&gt; \"#{ENV['BASE_URL']}/authenticate\" } ] end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063de490816432-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063de490816432-64\">64</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">menu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dtmf'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_status</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-5\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ac_info_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'success'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'I am now on. Have a cool day!'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Oops. Something went wrong. Please call back and try again.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AcUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'success'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'I am now off. Have a warm day!'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Oops. Something went wrong. Please call back and try again.'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-50\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">render </span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-52\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-54\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-55\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"You entered an incorrect choice of #{params['dtmf']}. Expected 1, 2 or 3. Please try again.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-57\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-58\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'connect'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-59\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">eventUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"#{ENV['BASE_URL']}/authenticate\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-60\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-61\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-62\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063de490816432-63\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063de490816432-64\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow that we have created our Controller methods, we can turn to creating our `AcUnit` model and defining its methods.\n\n### Defining the Model\n\nTo create our model, let’s first create the file that we will be working in. Create a new file called `sensibo.rb` in `/app/models/` and in it define an empty class:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">class Sensibo end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063df122436065-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063df122436065-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063df122436065-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063df122436065-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sensibo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063df122436065-2\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063df122436065-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe will need the ability to manipulate JSON and make HTTPS calls in the model so let’s include those in the model as well, as such above the class definition add:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">require 'net/https' require 'json'</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e0616355272-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e0616355272-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e0616355272-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e0616355272-1\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'net/https'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e0616355272-2\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'json'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e0616355272-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nWhen we instantiate an instance of our `Sensibo` class (i.e. our `AcUnit` in the Controller) we need to provide it with the API key and the device ID. Therefore, we will create an `#initialize` method that accepts both an `api_key` and `id` as arguments. We will also include these in an `attr_reader`, as we are not setting them only reading them:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">class Sensibo attr_reader :api_key, _id def initialize(api_key, id) @api_key = api_key @id = id end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e2938681015-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e2938681015-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e2938681015-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e2938681015-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e2938681015-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e2938681015-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e2938681015-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e2938681015-8\">8</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e2938681015-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sensibo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e2938681015-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">attr_reader</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_id</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e2938681015-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">initialize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e2938681015-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">api</span><span class=\"crayon-sy\">_</span>key</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e2938681015-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e2938681015-6\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e2938681015-7\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e2938681015-8\">&nbsp;</div></div></td></tr></tbody></table>\n\nAt this point, we are ready to build the model methods we already invoked in the Controller. The first one is `#get_status`, which will fetch the latest data from the Sensibo unit. We will get that data making a `GET` request:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def get_status begin uri = URI(\"#{ENV['SENSIBO_API_URL']}/#{self.id}?fields=*&amp;apiKey=#{self.api_key}\") http = Net::HTTP.new(uri.host, uri.port) http.use_ssl = true req = Net::HTTP::Get.new(uri, {'Content-Type' =&gt; 'application/json'}) res = http.request(req) data = JSON.parse(res.body) rescue =&gt; e puts \"failed #{e}\" end data end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e3019214160-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e3019214160-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e3019214160-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e3019214160-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e3019214160-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e3019214160-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e3019214160-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e3019214160-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e3019214160-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e3019214160-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e3019214160-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e3019214160-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e3019214160-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e3019214160-14\">14</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e3019214160-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e3019214160-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">begin</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e3019214160-3\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URI</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"#{ENV['SENSIBO_API_URL']}/#{self.id}?fields=*&amp;apiKey=#{self.api_key}\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e3019214160-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e3019214160-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">use_ssl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e3019214160-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Get</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e3019214160-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e3019214160-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e3019214160-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rescue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">e</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e3019214160-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"failed #{e}\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e3019214160-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e3019214160-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e3019214160-13\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e3019214160-14\">&nbsp;</div></div></td></tr></tbody></table>\n\nNext, we will create a method to update the status of the air conditioner, which will take in an argument of `state` and create a `PATCH` request. In the case we are building for the argument is either `true` for on or `false` for off. However, you can extend the functionality as you see fit in accordance with the endpoints the Sensibo API exposes.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def update_status(state) begin uri = URI(\"#{ENV['SENSIBO_API_URL']}/#{self.id}/acStates/on?apiKey=#{self.api_key}\") http = Net::HTTP.new(uri.host, uri.port) http.use_ssl = true req = Net::HTTP::Patch.new(uri, {'Content-Type' =&gt; 'application/json'}) req.body = {\"newValue\" =&gt; state}.to_json res = http.request(req) data = JSON.parse(res.body) rescue =&gt; e puts \"failed #{e}\" end data end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e4586541279-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e4586541279-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e4586541279-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e4586541279-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e4586541279-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e4586541279-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e4586541279-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e4586541279-15\">15</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">update_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e4586541279-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">begin</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-3\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URI</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"#{ENV['SENSIBO_API_URL']}/#{self.id}/acStates/on?apiKey=#{self.api_key}\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e4586541279-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">use_ssl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e4586541279-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Net</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Patch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uri</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"newValue\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">to_json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e4586541279-8\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e4586541279-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rescue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">e</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"failed #{e}\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e4586541279-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e4586541279-14\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e4586541279-15\">&nbsp;</div></div></td></tr></tbody></table>\n\nLastly, we will create two methods that will build the text output we wish to play for the user in the application. The first one will be the output of the current AC status, while the last one will be the output of the menu options:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def ac_info_text(data) &lt;&lt;~HEREDOC You requested the current info on your AC unit located at: #{data['result']['location']['address'][0]} in #{data['result']['location']['address'][1]}, #{data['result']['location']['address'][2]}. The AC unit is currently #{data['result']['acState']['on'] == 'true' ? 'on' : 'off'} and is #{data['result']['connectionStatus']['isAlive'] == 'true' ? 'connected' : 'disconnected'}. It's target temperature is set to #{data['result']['acState']['targetTemperature']}. HEREDOC end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e5012449363-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e5012449363-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e5012449363-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e5012449363-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e5012449363-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e5012449363-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e5012449363-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e5012449363-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e5012449363-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e5012449363-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e5012449363-11\">11</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e5012449363-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">ac_info_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e5012449363-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e5012449363-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">You </span><span class=\"crayon-e\">requested </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">current </span><span class=\"crayon-e\">info </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">AC </span><span class=\"crayon-e\">unit </span><span class=\"crayon-e\">located </span><span class=\"crayon-v\">at</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e5012449363-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-p\">#{data['result']['location']['address'][0]} in #{data['result']['location']['address'][1]}, #{data['result']['location']['address'][2]}.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e5012449363-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e5012449363-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">The</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AC</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unit</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currently</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#{data['result']['acState']['on'] == 'true' ? 'on' : 'off'} and is</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e5012449363-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-p\">#{data['result']['connectionStatus']['isAlive'] == 'true' ? 'connected' : 'disconnected'}.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e5012449363-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">It</span><span class=\"crayon-s\">'s target temperature is set to #{data['</span><span class=\"crayon-i\">result</span><span class=\"crayon-s\">']['</span><span class=\"crayon-i\">acState</span><span class=\"crayon-s\">']['</span><span class=\"crayon-i\">targetTemperature</span>'<span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e5012449363-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e5012449363-10\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e5012449363-11\">&nbsp;</div></div></td></tr></tbody></table>\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def menu_options_text &lt;&lt;~HEREDOC Thank you for authenticating. Please choose from the following options: Press 1 and the hash key for my current status Press 2 and the hash key to turn me on Press 3 and the hash key to turn me off Or hang up at anytime to end this call HEREDOC end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e7448607200-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e7448607200-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e7448607200-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e7448607200-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e7448607200-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e7448607200-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e7448607200-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e7448607200-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e7448607200-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e063e7448607200-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e063e7448607200-11\">11</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e7448607200-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-v\">menu_options_text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e7448607200-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e7448607200-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Thank </span><span class=\"crayon-e\">you </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">authenticating</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e7448607200-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Please </span><span class=\"crayon-e\">choose </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">following </span><span class=\"crayon-v\">options</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e7448607200-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">Press</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my </span><span class=\"crayon-e\">current </span><span class=\"crayon-e\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e7448607200-6\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-i\">Press</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turn </span><span class=\"crayon-e\">me </span><span class=\"crayon-e\">on</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e7448607200-7\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-i\">Press</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">hash </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turn </span><span class=\"crayon-e\">me </span><span class=\"crayon-e\">off</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e7448607200-8\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">Or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hang </span><span class=\"crayon-e\">up </span><span class=\"crayon-e\">at </span><span class=\"crayon-e\">anytime </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">call</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e7448607200-9\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e063e7448607200-10\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e063e7448607200-11\">&nbsp;</div></div></td></tr></tbody></table>\n\nWith the creation of these last two model class methods, we have wrapped up all of our coding for the application. We are ready to run it!\n\n## Running the Application\n\nNow that we have built our application, we can go ahead and use it. When we are running this in our development environment, we need to make sure we have both an external URL available and our Rails server running. If you are using ngrok for your external URL, make sure you have updated your API endpoints in the Nexmo dashboard and your `BASE_URL` environment variable to point to the correct ngrok URL. When you are using the free tier of ngrok, your ngrok URL changes each time you restart it. To start your Rails server locally, you simply need to run `rails s` from the command line.\n\nAt this point, you can call your Nexmo provisioned phone number and start interacting with your air conditioner by phone!"}