{"_filedata":{"slug":"is-it-the-weekend-yet-build-a-web-scraping-app-with-sms-to-find-out-dr"},"title":"Scrape the Web for Updates and Send SMS Alerts with Ruby","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/Dev_Web-Scraping-App_1200x600.png","author":301,"published":true,"published_at":"2020-03-27T17:55:30","tags":[360,375,432,92,455],"body":"We have all been there. You wake up and it is a new day, and you just need to know the answer to the most burning question. Is it the weekend yet? Your week has been so busy with professional and personal responsibilities. All you want to do is take a couple of days to sit back and relax.\n\nTo answer the question you could, of course, open up your calendar app on your phone or ask your favorite personal digital home assistant. But, why do those things when you could build yourself an app that sends you a text message instead?\n\nWe are going to create a Ruby on Rails application that does the following:\n\n*   Allows for both new subscribers and for the ability to unsubscribe from the list\n*   Scrapes the answer to our question from [isittheweekend.com](http://isittheweekend.com)\n*   Sends the answer from our scraped data daily to all the subscribed recipients\n\nTo wrap it all together, we will also be creating a Rake task that will run all these tasks at once, and designating its execution once every 24 hours.\n\nIf you prefer, you can also find a fully working version of this application on [GitHub](https://github.com/nexmo-community/ruby-sms-weekend-checker).\n\nLetâ€™s get started!\n\n## Prerequisites\n\n*   [Ruby on Rails](https://rubyonrails.org/)\n*   [Nexmo Account](https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&utm_medium=github&utm_campaign=ruby-sms-weekend-checker)\n*   [ngrok](https://ngrok.io)\n\n## Generate the Rails Application\n\nThe first thing we need to do is to create our new Rails application. From your command line execute the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">$ rails new weekend-checker-app --database=postgresql</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b05688918670-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b05688918670-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b05688918670-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weekend</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">checker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">database</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">postgresql</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b05688918670-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis creates the necessary file structure for our Rails application and sets the default database to PostgreSQL.\n\nOnce that is done, `cd` into the directory that was created. Before we install our dependencies, we will add the additional gems our application will use.\n\nOpen up the code in your preferred code editor and navigate to the `Gemfile`. Inside the `Gemfile` add the following gems:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">gem 'nexmo' gem 'watir' gem 'webdrivers', '~&gt; 4.0' gem 'whenever', require: false gem 'dotenv-rails'</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b08175634008-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b08175634008-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b08175634008-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b08175634008-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b08175634008-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b08175634008-6\">6</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b08175634008-1\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nexmo'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b08175634008-2\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'watir'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b08175634008-3\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'webdrivers'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'~&gt; 4.0'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b08175634008-4\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'whenever'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">require</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b08175634008-5\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dotenv-rails'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b08175634008-6\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe are using the `nexmo` gem to send the SMS updates, the `watir` and `webdrivers` gems to make the HTTP request to a site with dynamic JavaScript content, the `whenever` gem to schedule the Rake task, and the `dotenv-rails` gem to manage the environment variables.\n\nAfter you have saved the `Gemfile`, you are ready to run `bundle install` from the command line.\n\nThe next step is creating our database schema and models.\n\n## Create the Database Schema and Models\n\nNow that our Rails application is created and has its dependencies installed, the next task is to create the correct database schema to house the data we will need to operate our application. We need to store the following types of information:\n\n*   Recipients: _The list of subscribers with their phone numbers_\n*   DiffStorage: _Copies of the website data to compare against to determine if there was a change_\n\nWe will use the Rails generator tool to create the migration files and then subsequently edit each one.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">$ rails generate model Recipient number:string subscribed:boolean $ rails generate model DiffStorage website_data:text</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0a428750130-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0a428750130-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0a428750130-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0a428750130-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-e\">Recipient </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">boolean</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0a428750130-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-e\">DiffStorage </span><span class=\"crayon-v\">website_data</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">text</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0a428750130-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nThose commands will create both model files in `app/models` and migration files in `db/migrate`. Before committing those changes to your application, once the generator actions are done, inspect the files created in both directories to make sure they are correct.\n\nSpecifically, in the migration files, you want to ensure that each migration includes `t.timestamps`, which adds a `created_at` and `updated_at` column to the table. You should also see the `number` and `subscribed` columns in the `Recipient` migration file, with types set to `string` and `boolean`, respectively. Similarly, you should see a column in the `DiffStorage` migration file for `website_data` with the type set to `text`.\n\nThe model files inside `app/models` should be empty besides the class declarations and their inheritance from `ApplicationRecord`.\n\nWhen it looks satisfactory, it is time to run `rake db:migrate` from the command line. The command will output the results to your console, and if you inspect the `db/schema.rb` file you will be able to see the schema you created initialized inside the application.\n\nLastly, we also need to create `Messenger` and `Scraper` models, but we do not need a migration for them. To do so, we run the Rails generator again and append a `--migration=false` flag to it:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">$ rails generate model Messenger --migration=false $ rails generate model Scraper --migration=false</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0b457793117-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0b457793117-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0b457793117-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0b457793117-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-v\">Messenger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">migration</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0b457793117-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-v\">Scraper</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">migration</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0b457793117-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow has come the time to define the logic inside the models.\n\n## Defining the Models\n\nAs mentioned above, we have four models that are responsible for unique areas of the application:\n\n*   `DiffStorage`: _Checks for any differences in the website data_\n*   `Recipient`: _Manages adding and removing subscribers_\n*   `Messenger`: _Manages the sending of SMS messages_\n*   `Scraper`: _Responsible for scraping the website for data_\n\n### Defining the DiffStorage Model\n\nThe `DiffStorage` model will contain two class models. One will contain the URL that we are scraping. The second will check for any changes since the last time the website was scraped and invoke the next steps in the application when the conditions are met.\n\nFirst, letâ€™s define the URL in its own method so that we create a single place where it exists and can be easily modified if we choose to do so later:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def self.url 'http://isittheweekend.com' end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0d232340633-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0d232340633-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0d232340633-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0d232340633-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0d232340633-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">url</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0d232340633-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">'http://isittheweekend.com'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0d232340633-3\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0d232340633-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nNext, the bulk of this model will live inside the `#check_last_record` class method:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def self.check_last_record today_answer = Scraper.call(self.url) if DiffStorage.any? yesterday_answer = DiffStorage.last else yesterday_answer = '' end Messenger.send_update_message(Recipient.all, yesterday_answer, today_answer) end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0e170806318-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0e170806318-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0e170806318-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0e170806318-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0e170806318-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0e170806318-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0e170806318-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0e170806318-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0e170806318-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0e170806318-10\">10</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0e170806318-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_last_record</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0e170806318-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">today_answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0e170806318-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0e170806318-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">yesterday_answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">last</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0e170806318-5\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0e170806318-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">yesterday_answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0e170806318-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0e170806318-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Messenger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_update_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">all</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yesterday_answer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today_answer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0e170806318-9\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0e170806318-10\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe above method first calls the method in the `Scraper` class that will begin the website scraping to obtain the most recent snapshot and assigns that data to `today_answer`. It then wraps the next step inside an `if` statement asking if there are any records in `DiffStorage`. If there are previous records stored there, then the method grabs the most recent one and assigns it to `yesterday_answer`. If there were no previous records then an empty string is assigned to `yesterday_answer`. Lastly, it sends the recipients and the two variables to the `Messenger` model to process for sending the message.\n\n### Defining the Scraper Model\n\nThe `Scraper` model will be responsible for doing the work of gathering the data from [isittheweekend.com](http://isittheweekend.com) to determine if it is indeed the weekend or not. The model will have four class methods and we will define each one here:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">require 'nokogiri' require 'webdrivers/chromedriver' require 'watir' class Scraper &lt; ApplicationRecord def self.call(url) self.get_url(url) end def self.get_url(url) doc = HTTParty.get(url) browser = Watir::Browser.new :chrome, headless: true browser.goto(url) parsed_page ||= Nokogiri::HTML.parse(browser.html) answer = parsed_page.css('h1#isit').text self.check_text(answer) end def self.check_text(data) if data == '' || data == nil puts \"There was no text received from the web scrape.\" exit else puts \"There was data in the text received from the web scrape.\" self.store_text(data) end end def self.store_text(text) record = DiffStorage.new record.website_data = text if record.save puts \"Record Updated Successfully\" end return record end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b0f284692203-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b0f284692203-38\">38</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-1\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nokogiri'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-2\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'webdrivers/chromedriver'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-3\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'watir'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Scraper</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplicationRecord</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-6\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-9\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTParty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">browser</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Watir</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Browser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">chrome</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headless</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">browser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">goto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">parsed_page</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nokogiri</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTML</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">browser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_page</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'h1#isit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-16\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-21\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"There was no text received from the web scrape.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">exit</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-23\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"There was data in the text received from the web scrape.\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">store_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-28\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">store_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">record</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-31\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">record</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">website_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-32\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">record</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-33\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Record Updated Successfully\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">record</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-36\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b0f284692203-37\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b0f284692203-38\">&nbsp;</div></div></td></tr></tbody></table>\n\nEach action within the act of scraping is defined into its own small method so as to keep our concerns separated. The `#call` method is the point of entry for the class. This is what gets invoked by other methods outside of itself. The `#get_url` method makes the HTTP request by simulating a Chome browser request using the `Watir` library and parses it with `Nokogiri`. The `#check_text` method checks if any data was obtained. The `#store_text` method saves that data to the database.\n\n### Defining the Messenger Model\n\nWithin the `Messenger` model will be all the code responsible for sending the daily SMS update to the subscribers. We will create a method that will send the message, a method that composes the weekend response text, a method that puts the whole message together, and a method that manages a confirmation message if a subscriber sends a removal request.\n\nFirst, the method to send the update message:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def self.send_update_message(recipients, yesterday, today) @client = Nexmo::Client.new( api_key: ENV['NEXMO_API_KEY'], api_secret: ENV['NEXMO_API_SECRET'] ) puts \"Sending Message to Each Recipient\" recipients.each do |recipient| if recipient.subscribed == true client.sms.send( from: ENV['FROM_NUMBER'], to: recipient.number, text: self.weekend_message(yesterday, today) ) puts \"Sent message to #{recipient.number}\" end end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b11301930917-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b11301930917-18\">18</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_update_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">recipients</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yesterday</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXMO_API_KEY'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">api_secret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXMO_API_SECRET'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sending Message to Each Recipient\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">recipients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'FROM_NUMBER'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weekend_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">yesterday</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sent message to #{recipient.number}\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b11301930917-17\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b11301930917-18\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe value for the `text` parameter above refers to a class method called `#weekend_message`. This method will compose the string for the weekend update by checking if today is the same as yesterday or not:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def self.weekend_message(yesterday, today) if today == yesterday response = \"Today is the same as yesterday, and the answer is #{today}.\" elsif today =! yesterday response = \"Today is not the same as yesterday, the answer for today is #{today}.\" else response = 'Today and yesterday are both neither affirmative or positive. Are we in an alternative dimension of time and space?' end self.compose_message(response) end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b12262219588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b12262219588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b12262219588-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b12262219588-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b12262219588-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b12262219588-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b12262219588-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b12262219588-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b12262219588-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b12262219588-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b12262219588-11\">11</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b12262219588-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weekend_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">yesterday</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b12262219588-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">yesterday</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b12262219588-3\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Today is the same as yesterday, and the answer is #{today}.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b12262219588-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">elsif </span><span class=\"crayon-v\">today</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">yesterday</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b12262219588-5\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Today is not the same as yesterday, the answer for today is #{today}.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b12262219588-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b12262219588-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Today and yesterday are both neither affirmative or positive. Are we in an alternative dimension of time and space?'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b12262219588-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b12262219588-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">compose_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b12262219588-10\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b12262219588-11\">&nbsp;</div></div></td></tr></tbody></table>\n\nNext, the method containing the `HEREDOC` string with the body of the message:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def self.compose_message(response) &lt;&lt;~HEREDOC Hello! It is a new day, but is it a weekend day? #{response} To be removed from the list please respond with \"1\". HEREDOC end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b13975941475-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b13975941475-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b13975941475-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b13975941475-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b13975941475-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b13975941475-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b13975941475-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b13975941475-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b13975941475-9\">9</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b13975941475-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">compose_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b13975941475-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b13975941475-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Hello</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b13975941475-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">It </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">day</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">but</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekend</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">day</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b13975941475-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-p\">#{response}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b13975941475-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">To</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-e\">removed </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">please </span><span class=\"crayon-e\">respond </span><span class=\"crayon-i\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b13975941475-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b13975941475-8\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b13975941475-9\">&nbsp;</div></div></td></tr></tbody></table>\n\nFinally, the method to send a removal confirmation message:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def self.send_removal_message(to) @client.sms.send( from: ENV['FROM_NUMBER'], to: to, text: 'You have been successfully removed.' ) end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b14712891690-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b14712891690-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b14712891690-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b14712891690-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b14712891690-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b14712891690-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b14712891690-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b14712891690-8\">8</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b14712891690-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_removal_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">to</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b14712891690-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b14712891690-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'FROM_NUMBER'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b14712891690-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b14712891690-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'You have been successfully removed.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b14712891690-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b14712891690-7\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b14712891690-8\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe last model we need to define before we continue to the next step is the `Recipient` model.\n\n### Defining the Recipient Model\n\nThis model does not contain any of its class methods. The only addition we will make to this model is adding two validations to the data for recipients. These validations will act as a safeguard when adding new phone numbers to the database. We will check that a) a number is indeed being provided in the data and b) the number is not a duplicate of an already existing record. To do these validations we add two lines under the class definition:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">class Recipient &lt; ApplicationRecord validates :number, presence: true validates :number, uniqueness: true end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b15197612011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b15197612011-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b15197612011-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b15197612011-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b15197612011-5\">5</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b15197612011-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplicationRecord</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b15197612011-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">validates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">presence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b15197612011-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">validates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uniqueness</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b15197612011-4\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b15197612011-5\">&nbsp;</div></div></td></tr></tbody></table>\n\n## Create the Controller and Routes\n\nWe are getting close to finishing the construction of our app! The next step is defining the controller actions that will dictate the flow of the application. First, letâ€™s generate the controller using the Rails generator from the command line:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">$ rails generate controller WeekendChecker</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b17795856031-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b17795856031-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b17795856031-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">controller </span><span class=\"crayon-i\">WeekendChecker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b17795856031-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis will create a new empty controller file in `app/controllers` called `weekend_checker_controller.rb` and complementary view files in `app/views/weekend_checker`. We will add an index view shortly. At this point, weâ€™ll focus on the controller.\n\nThe controller needs three actions to correspond to three routes: `#index`, `#create` and `#event`. The `#index` route will be the default and only view for our website. That will be the place where individuals can subscribe to the list. The `#create` route will be where new numbers get processed. Finally, the `#event` route will be where the application receives webhook data from the SMS API, including removal requests, and processes them.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">class WeekendCheckerController &lt; ApplicationController def index end def create @recipient = Recipient.new(recipient_params) if @recipient.save flash[:notice] = \"Phone number saved successfully.\" else flash[:alert] = \"Form did not save. Please fix and try again.\" end redirect_to '/' end def event if params[:text] == '1' recipient = Recipient.find_by(number: params[:msisdn]) if recipient if recipient.update(subscribed: false) Messenger.send_removal_message(params[:msisdn]) end end end puts params head :no_content end private def recipient_params params.permit(:number, :subscribed) end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b18386500916-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b18386500916-36\">36</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WeekendCheckerController</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplicationController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-4\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-i\">create</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">recipient_params</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-9\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">flash</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">notice</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Phone number saved successfully.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">flash</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">alert</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Form did not save. Please fix and try again.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">redirect</span><span class=\"crayon-sy\">_</span>to<span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">event</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-17\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_by</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recipient</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-20\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Messenger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_removal_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">puts </span><span class=\"crayon-e\">params</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-27\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">no_content</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-28\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-29\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">private</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">recipient_params</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-33\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">permit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-34\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b18386500916-35\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b18386500916-36\">&nbsp;</div></div></td></tr></tbody></table>\n\nThese three controller actions need three corresponding routes defined in `config/routes.rb`:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">Rails.application.routes.draw do get '/', to: 'weekend_checker#index' get '/webhooks/event', to: 'weekend_checker#event' post '/recipient/new', to: 'weekend_checker#create' end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b19523745020-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b19523745020-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b19523745020-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b19523745020-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b19523745020-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b19523745020-6\">6</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b19523745020-1\"><span class=\"crayon-v\">Rails</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">application</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">draw </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b19523745020-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'weekend_checker#index'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b19523745020-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/webhooks/event'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'weekend_checker#event'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b19523745020-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/recipient/new'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'weekend_checker#create'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b19523745020-5\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b19523745020-6\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe penultimate item for our application code setup is creating a basic view for the `/` route.\n\n### Defining the View\n\nIn order to subscribe to the SMS list, we will create a view accessible at the top-level of the URL that will contain a sign-up form.\n\nInside the `app/views/weekend_checker` folder add an `index.html.erb` file. It will contain the following code:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;h2&gt;Is It The Weekend? Get a Daily Text to Find Out!&lt;/h2&gt; &lt;p&gt; This is a free service that will analyze &lt;a href=\"http://isittheweekend.com\"&gt;isittheweekend.com&lt;/a&gt; and check for any updates once a day. If there is an update it will send you a text message at the number you provide. &lt;/p&gt; &lt;p&gt; To remove yourself from the SMS list, reply to the text message you receive with the number \"1\". &lt;/p&gt; &lt;p&gt; SMS messages are sent using the &lt;a href=\"https://developer.nexmo.com\"&gt;Nexmo SMS API&lt;/a&gt;. &lt;/p&gt; &lt;% flash.each do |type, msg| %&gt; &lt;div&gt; &lt;%= msg %&gt; &lt;/div&gt; &lt;% end %&gt; &lt;%= form_with model: @recipient, url: \"/recipient/new\" do |f| %&gt; &lt;%= f.telephone_field :number, :placeholder =&gt; '12122222222' %&gt; &lt;%= f.hidden_field :subscribed, value: true %&gt; &lt;%= f.submit \"Add Number\" %&gt; &lt;% end %&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1a386887915-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1a386887915-23\">23</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">h2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-st\">Is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">It </span><span class=\"crayon-e\">The </span><span class=\"crayon-v\">Weekend</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Get</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Daily </span><span class=\"crayon-e\">Text </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Find </span><span class=\"crayon-v\">Out</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h2</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-3\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-e\">service </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">will </span><span class=\"crayon-v\">analyze</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://isittheweekend.com\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">isittheweekend</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">any </span><span class=\"crayon-e\">updates </span><span class=\"crayon-i\">once</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">day</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">If</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">there </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">update </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">will </span><span class=\"crayon-e\">send </span><span class=\"crayon-i\">you</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">text </span><span class=\"crayon-e\">message </span><span class=\"crayon-e\">at </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">provide</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-6\"><span class=\"crayon-st\">To</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">remove </span><span class=\"crayon-e\">yourself </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">SMS </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reply </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">text </span><span class=\"crayon-e\">message </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">receive </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-9\"><span class=\"crayon-e\">SMS </span><span class=\"crayon-e\">messages </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">using </span><span class=\"crayon-v\">the</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://developer.nexmo.com\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-e\">SMS </span><span class=\"crayon-v\">API</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-10\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-12\"><span class=\"crayon-ta\">&lt;%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-16\"><span class=\"crayon-ta\">&lt;%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-18\"><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">_</span>with<span class=\"crayon-h\"> </span><span class=\"crayon-v\">model</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">@recipient</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/recipient/new\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">telephone_field</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">placeholder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'12122222222'</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hidden_field</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">true</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">submit</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Add Number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1a386887915-22\"><span class=\"crayon-ta\">&lt;%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1a386887915-23\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe final coding task we have to do is to set up our new Rake task that will run all this code and configure the `whenever` gem to execute the Rake task once a day.\n\n## Create the Rake Task and Schedule It\n\nOnce again, we will use a Rails generator from the command line to create the file for our Rake task. From the command line run the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">$ rails generate task scraper check_site_update</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1b319580540-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1b319580540-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1b319580540-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">scraper </span><span class=\"crayon-v\">check_site</span><span class=\"crayon-sy\">_</span>update</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1b319580540-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe above task will create a file in `lib/tasks` called `scraper.rake`. When we open it inside our code editor it will look like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">namespace :scraper do desc \"TODO\" task :check_site_update =&gt; :environment do end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1c097370954-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1c097370954-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1c097370954-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1c097370954-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1c097370954-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1c097370954-6\">6</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1c097370954-1\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">scraper </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1c097370954-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">desc</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TODO\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1c097370954-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">check_site_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">environment </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1c097370954-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1c097370954-5\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1c097370954-6\">&nbsp;</div></div></td></tr></tbody></table>\n\nLetâ€™s redefine the `desc` with a short string of what this task will do: `desc \"Check Website for Any Updates\"`. Next, inside the `task` block add the `DiffStorage#check_last_record` class method, which is the entry point for all the work we created previously:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">namespace :scraper do desc \"Check Website for Any Updates\" task :check_site_update =&gt; :environment do DiffStorage.check_last_record end end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1e948276293-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1e948276293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1e948276293-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1e948276293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1e948276293-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1e948276293-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1e948276293-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1e948276293-1\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">scraper </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1e948276293-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">desc</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Check Website for Any Updates\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1e948276293-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">check_site_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">environment </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1e948276293-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_last_record</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1e948276293-5\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1e948276293-6\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1e948276293-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow that our Rake task is defined, we lastly need to initialize the `whenever` gem and let it know that we want this task run once a day. To do that, first, we run the initializer command for the gem from the command line:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">$ bundle exec wheneverize .</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b1f150678606-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b1f150678606-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b1f150678606-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bundle </span><span class=\"crayon-e\">exec </span><span class=\"crayon-i\">wheneverize</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b1f150678606-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe above command creates a `schedule.rb` file inside the `config/` folder. Add the following code to that file to run the `scraper:check_site_update` task daily:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">every 1.day do rake \"scraper:check_site_update\" end</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b20723782890-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b20723782890-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b20723782890-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b20723782890-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b20723782890-1\"><span class=\"crayon-i\">every</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.day</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b20723782890-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">rake</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"scraper:check_site_update\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b20723782890-3\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b20723782890-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow that the schedule is created, we need to update the crontab file on our machine to know about this new job. We do that by running `bundle exec whenever --update-crontab` from the command line. Once that is done, the task is fully initialized and configured to run once a day on our machine.\n\nThe code for our application is all set. The only thing that is missing now is creating our Nexmo account, obtaining our Nexmo API credentials and provisioning a virtual phone number to send the daily text messages with. Once we have this information we will add it to our application as environment variables.\n\n## Nexmo API Credentials and Phone Number\n\nTo create an account navigate to the [Nexmo Dashboard](https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&utm_medium=github&utm_campaign=weekend-checker-sms-app) and complete the registration steps. Once you have finished registering, you will enter your Dashboard, which will look similar to this:\n\n![](dashboard_screenshot.png)\n\nIf you have not done so previously, create a `.env` file in the top-level directory of your application and add your `NEXMO_API_KEY` and `NEXMO_API_SECRET` to it. The values for those are found at the top of the dashboard page under the `Your API credentials` header.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_API_KEY= NEXMO_API_SECRET=</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b21474206120-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b21474206120-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b21474206120-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b21474206120-1\"><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b21474206120-2\"><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b21474206120-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe next task we need to do inside the dashboard is to provision a phone number. After you click on the `Numbers` link on the sidebar navigation, a drop-down menu will appear. Once you select the `Buy numbers` option and then click the `Search` button you will see a list of possible numbers to acquire:\n\n![](buy_numbers.png)\n\nWhen searching for numbers by feature, country, and type, it is recommended to select the country that your users will be based in, `SMS` for features and `Mobile` for type.\n\nAfter clicking the orange `Buy` button for the number you wish to purchase, you can add that number to your `.env` file as a new variable called `FROM_NUMBER`:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_API_KEY= NEXMO_API_SECRET= FROM_NUMBER=</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b22808358451-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b22808358451-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b22808358451-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b22808358451-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b22808358451-1\"><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b22808358451-2\"><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b22808358451-3\"><span class=\"crayon-v\">FROM_NUMBER</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b22808358451-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe last item we need to do inside our dashboard is to provide an externally accessible URL as the event webhook for the phone number. For development purposes, [ngrok](https://ngrok.io) is a good tool to use, and you can follow [this guide](https://developer.nexmo.com/concepts/guides/testing-with-ngrok) on how to get up and running with it.\n\nFrom the dashboard `Numbers` sidebar navigation drop-down, once you select `Your numbers` you will see your newly provisioned phone number in a list presentation. After clicking on the gear icon to manage its properties, a settings dialog menu will be shown to you:\n\n![](number_settings.png)\n\nIn the above screenshot example, you would replace the `Inbound Webhook URL` text field with your own URL ending with `/webhooks/event`.\n\nThatâ€™s it! Our code is all finalized and our Nexmo credentials are all set. At this point, you face a choice for running your application. You can either run it locally or you could deploy it to an external hosting provider, like Heroku. In the final step, we will discuss how to run it locally.\n\nIf you are interested in deploying it for a more long-term solution, you can visit the [GitHub repository](https://github.com/nexmo-community/weekend-checker-sms-app) and click on the `Deploy to Heroku` button at the top of the README to start that process.\n\n## Running the Application\n\nWe are now ready to run our brand new application! In order to run it locally, the Rails event webhook needs to be accessible to the outside world outside of your local environment. For example, if you are using ngrok after following [this guide](https://developer.nexmo.com/concepts/guides/testing-with-ngrok) then both the Rails application and ngrok need to be running simultaneously.\n\nTo start the Rails application execute the following from your command line:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">$ bundle exec rails server</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1808b23368816553-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1808b23368816553-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1808b23368816553-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bundle </span><span class=\"crayon-e\">exec </span><span class=\"crayon-e\">rails </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1808b23368816553-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen you can navigate in your browser of choice to `localhost:3000`. You will see the sign-up form you created. Go ahead and fill it out with your phone number and submit it. Now, once the Rake task is run, you should expect to receive an SMS letting you know if it is the weekend and whether today is different than yesterday!\n\n## Next Steps\n\nThe application we built while whimsical demonstrates the potential for leveraging web scraping and SMS to create an application that delivers updates to subscribers. There are countless potential use cases for an application like this. Whether you are interested in replicating this exact scenario or in porting the code for your own use case, there is, even more, to explore on this topic.\n\nFor further exploration of other SMS possibilities check out the following resources:\n\n*   [Send SMS Reminders of Google Calendar Events with Zapier](https://www.nexmo.com/blog/2020/03/04/how-to-send-sms-reminders-of-google-calendar-events-with-zapier-dr)\n*   [Create an Interactive Scavenger Hunt with Nexmoâ€™s SMS and Voice API](https://www.nexmo.com/blog/2019/08/14/how-to-create-an-interactive-scavenger-hunt-with-nexmos-sms-and-voice-api-dr)\n*   [Shipping Notifications on WordPress WooCommerce with SMS](https://www.nexmo.com/blog/2020/01/11/shipping-notifications-on-wordpress-woocommerce-with-nexmo-sms-dr)"}