{"_filedata":{"slug":"serverless-python-with-aws-lambda-dr"},"title":"Serverless Python With AWS Lambda","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/E_AWS-Lambda_1200x600-1.png","author":340,"published":true,"published_at":"2020-03-20T13:00:43","tags":[499,416,161,410,1216,455],"body":"Using Python in serverless environments can be more automated than what I shared in my previous [post using PHP and Bref](https://www.nexmo.com/blog/2020/03/02/aws-lambda-with-php-using-bref-and-serverless-framework-dr). At AWS, there are already pre-existing environments making initial deployment easier without using additional tools. However, using tools like the Serverless framework still carries value.\n\nThis example will create an [AWS Lambda](https://aws.amazon.com/lambda/) Function for Python using [Serverless](https://serverless.com). Then, we will add an API Gateway to make it available using an HTTP client or browser of your choosing.\n\n## Prerequisites\n\nHere are things you will need to follow all examples:\n\n*   [Node.js](https://nodejs.org/en/) for installing Serverless\n*   [Serverless](https://serverless.com) to make creating and managing environments easier\n*   [AWS account](https://aws.amazon.com/) and [access keys](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html) for a user with access to [AWS S3](https://docs.aws.amazon.com/s3/) as well as [AWS Lambda](https://docs.aws.amazon.com/lambda/latest/dg/welcome.html)\n\n## AWS Console Approach\n\nFor basic function creation, the AWS Console can be used to navigate to the Lambda management area and click `Create Function` in the upper right. Following that, you will name and select the environment desired.\n\n![aws_console_name_function](https://www.nexmo.com/wp-content/uploads/2020/03/aws_console_name_function.png \"AWS Console Lambda Python Function Creation\")\n\n## Serverless Framework\n\nThough the AWS Console can perform the essential tasks of creating a function, we will use the [Serverless Framework](https://serverless.com) going forward, which is a “complete solution for building and operating serverless applications.” By using the Serverless framework, we gain scripts to automate any potential repetition of the process, as well as some starter code for immediate validation. Thus, our first step is to get this framework installed on the development system you’re using. We recommend installing it globally, to allow usage from anywhere via CLI.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm install -g serverless</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7277b930904369-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7277b930904369-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7277b930904369-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">serverless</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7277b930904369-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n### AWS Credentials\n\nWith Serverless installed, ensure you’ve also set up the AWS credentials needed for Serverless to interact with the various AWS services (S3, Lambda, and potentially EC2 or databases as required). In this example, we will only be using S3 and Lambda. You can read more about this at [serverless.com](https://serverless.com/framework/docs/providers/aws/guide/credentials/#using-aws-access-keys).\n\n### Create Base\n\nServerless will guide you through a few prompts to help it create a beginning structure. To do so, call Serverless from within the project directory via CLI.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">serverless</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7277f576048141-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7277f576048141-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7277f576048141-1\"><span class=\"crayon-i\">serverless</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7277f576048141-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n#### Follow Prompts\n\nServerless will begin walking you through creating a new project, the type of project you want to create (Node.js, Python, or Other), a name for this project, and whether you would like to activate added Serverless services (requiring a Serverless account). Once completed, the base structure will generate.\n\n![aws_lambda_python_project_creation](https://www.nexmo.com/wp-content/uploads/2020/03/aws_lambda_python_project_creation.png \"AWS Lambda Python Project Creation With Serveless\")\n\n#### Example YML File\n\nAs an example, below is a beginning `serverless.yml` file created by the process:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">service: app provider: name: aws runtime: python3.8 functions: hello: handler: handler.hello</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a72780051374519-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a72780051374519-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a72780051374519-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a72780051374519-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a72780051374519-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a72780051374519-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a72780051374519-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a72780051374519-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a72780051374519-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a72780051374519-10\">10</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a72780051374519-1\"><span class=\"crayon-v\">service</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a72780051374519-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a72780051374519-3\"><span class=\"crayon-v\">provider</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a72780051374519-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aws</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a72780051374519-5\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">runtime</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a72780051374519-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a72780051374519-7\"><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a72780051374519-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">hello</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a72780051374519-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">handler</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">hello</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a72780051374519-10\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the file, observe the name of the service, which you can alter to fit the desired naming conventions of your functions. By default, it will carry the name you specified during project creation.\n\nFollowing this, we can see the provider information for AWS Lambda with the Python runtime.\n\nThen, there is the section outlining the details of the function. Included is the initial handler for testing both as a function or HTTP (which requires an added step shown later).\n\n## Deploying to AWS Lambda\n\nFor either Function or HTTP use cases, the default `serverless` project provides enough of a skeleton to deploy straight to AWS Lambda and test using Serverless. Leveraging the AWS credentials configuration added prior, Serverless will deploy straight to Lambda using the contents of `serverless.yml` as criteria.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">serverless deploy</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a72782161278576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a72782161278576-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a72782161278576-1\"><span class=\"crayon-e\">serverless </span><span class=\"crayon-i\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a72782161278576-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n**IMPORTANT:** The example application, as-is, does not carry any authentication or verification. Anyone with access to the URL provided after deployment can access it. Doing so could cause unexpected charges to your accounts. Therefore, please secure the app if you intend to leave it active.\n\n## Testing the Function\n\nIn the case of a function, there are two ways to test. One way is to use the AWS Console, while the second is using Serverless via CLI from the system used to deploy.\n\n### AWS Console\n\nIn the AWS Console, select the Lambda item from the list of Compute services.\n\n![aws_console_compute_lambda](https://www.nexmo.com/wp-content/uploads/2020/03/aws_console_compute_lambda.png \"AWS Console-Lambda Dashboard\")\n\nOn the Lambda dashboard, you can select the function created and create a new test by clicking `Configure test events`. Alternatively, you can click the `Test` button to receive the same prompt.\n\n![lambda_function_create_test](https://www.nexmo.com/wp-content/uploads/2020/03/lambda_function_create_test.png \"Lambda Create Test\")\n\nFor a test of the skeleton created, add a name and slightly alter the JSON in the body.\n\n![configure_test_events](https://www.nexmo.com/wp-content/uploads/2020/03/configure_test_events.png \"Configure Test Events\")\n\nUpon clicking the `Create` button at the bottom of the dialog, you can then click the `Test` button to execute the test. Running should result in a green dialog area you can expand to show the results.\n\n![lambda_test_results](https://www.nexmo.com/wp-content/uploads/2020/03/lambda_test_results.png \"Lambda Test Results\")\n\n### Serverless Function Execution\n\nAs stated above, you can also use the Serverless CLI to test the function by using the following command from within the local application root:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">serverless invoke -f function --data='{\"name\": \"Adam\"}'</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a72783435955743-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a72783435955743-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a72783435955743-1\"><span class=\"crayon-e\">serverless </span><span class=\"crayon-v\">invoke</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'{\"name\": \"Adam\"}'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a72783435955743-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nExample result:  \n![serverless_lambda_function_execution](https://www.nexmo.com/wp-content/uploads/2020/03/serverless_lambda_function_execution.png \"Serverless Lambda Function Execution\")\n\n### Testing An HTTP Function\n\nYou can also test as an HTTP function. However, doing this will require the addition of an API Gateway trigger in the AWS Lambda Console. The trigger could have been specified in the `serverless.yml` as well, but for this basic example, it is good for you to know how to do it manually.\n\nFrom within the Lambda function properties page, click `Add Trigger` in the Designer area. In the following prompt, select `API Gateway` from the list.\n\n![aws_console_add_trigger](https://www.nexmo.com/wp-content/uploads/2020/03/aws_console_add_trigger.png \"Add an API Gateway Trigger\")\n\nNext, define the trigger to `Create a new API` and select `HTTP API` before clicking the `Add` button.\n\n![aws_console_define_trigger](https://www.nexmo.com/wp-content/uploads/2020/03/aws_console_define_trigger.png \"Define the API Gateway Trigger\")\n\nAfter adding the API Gateway Trigger, it is now possible to request the URL provided by the trigger using an HTTP client or a standard browser.\n\n![browser_api_gateway_launch](https://www.nexmo.com/wp-content/uploads/2020/03/browser_api_gateway_launch.png \"Request the Function in a Browser\")\n\n## What Next\n\nWith an AWS Lambda function created, you can continue adding more code and creating more robust Python apps leveraging the serverless technologies available today. Watch for future posts showing how to build useful functions to leverage Vonage APIs and services using AWS Lambda."}