{"_filedata":{"slug":"integrating-the-conversation-api-with-wechat-dr"},"title":"Integrating the Conversation API with WeChat","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/10/E_WeChat-Conversation-API_1200x600-1.png","author":355,"published":true,"published_at":"2019-11-01T17:53:00","tags":[1623,571,793,1622,757],"body":"In this blog post, we’ll show you how to use the Conversation API to establish an external communication channel with your application and demonstrate how to do so using WeChat.\n\nWe will use WeChat’s public API and connect it to the Conversation API to enable two-way messaging between a WeChat client and a Nexmo client, using **custom events**.\n\nPlease refer to this [GitHub repository](https://github.com/nexmo-community/conversation-api-wechat-integration) for our reference integration.\n\n## Concept\n\nWe will be using [custom events](https://developer.nexmo.com/conversation/code-snippets/event/create-custom-event) to simulate WeChat messages and build a middleware server to interact with WeChat’s public API.\n\nWhen a client wishes to send a message using WeChat, it will create a custom event of type ‘custom:message:wechat’ with direction outbound. In turn, our middleware server will pick up that event [using RTC events](https://developer.nexmo.com/application/code-snippets/update-application) and translate it into an HTTP request to WeChat’s API, notifying in a message.\n\nIn the case of an inbound message (A WeChat client to a Nexmo client), our middleware server will implement WeChat’s messaging webhook and get notified by WeChat on the new message. The server will create a ‘custom:message:wechat’ event with direction inbound and dispatch it. The client will pick up that event and display it as a WeChat message.\n\n[![architecture](https://www.nexmo.com/wp-content/uploads/2019/10/wechat1.png)](https://www.nexmo.com/wp-content/uploads/2019/10/wechat1.png)\n\n## Prerequisites\n\n### WeChat\n\n**WeChat** is a Chinese multi-purpose messaging, social media, and mobile payment app developed by Tencent. It has a user base of over one billion people, making it impossible to ignore as a leading messaging channel. One can relate WeChat in China with Facebook in the United States.\n\nWeChat provides an API that lets developers send and receive messages. In this post, a WeChat account will be used alongside WeChat’s sandbox. Please note that this is to simplify the setup with WeChat.\n\nYou can follow this step-by-step guide to set up your WeChat API. This step-by-step is assuming that you’re already running our sample integration server.\n\n1.  Register your sandbox account from this [link](http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login)\n2.  Run your server. In this example, we will use ngrok\n3.  Use your ngrok address to fill up the webhook information. Our server endpoint will be `https://[$NGROK_ADDRESS].com/weChatEvent` _Replace \\[$NGROK\\_ADDRESS\\] with your ngrok address_\n4.  Fill any token\n5.  Click the submit button, and wait until WeChat verifies your webhook\n6.  You are now ready to receive incoming messages!\n\n[![wechat screenshot](https://www.nexmo.com/wp-content/uploads/2019/10/wechat2.png)](https://www.nexmo.com/wp-content/uploads/2019/10/wechat2.png)\n\nTo start sending messages from WeChat to our server, you need to add the official account to your WeChat. To do so, you will need to:\n\n1.  Go to your [sandbox account](http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login)\n2.  Scroll down to ‘Test number QR code’\n3.  Scan the QR code using your WeChat\n4.  Start chatting!\n\n[![screen shot wechat](https://www.nexmo.com/wp-content/uploads/2019/10/wechat3.png)](https://www.nexmo.com/wp-content/uploads/2019/10/wechat3.png)\n\nYou should now be able to send messages from your WeChat client to our WeChat account and receive them on your running instance of our server on the `/weChatEvent` route.\n\n### Conversation API\n\nThe Conversation API is a low-level API that allows you to create various objects such as Users, Members, and Conversations. Conversations are the fundamental concept the API revolves around. Conversations are containers of communications exchanged between two or more Users which could be a single interaction or the history of all interactions between them.\n\nTo read more about the API you can visit our [documentation](https://developer.nexmo.com/conversation/overview). You will need:\n\n1.  An application\n2.  A conversation\n3.  Access to your API key and secret\n\n## Setup\n\nThe example.env file contains all the required parameters to get the integration up and running. We will use a hard-coded conversation id to simplify this example, however, that is not mandatory.\n\nPlease follow the instructions given in the README file, and refer to the [ngrok documentation](https://ngrok.com/docs) as an example for a service that will expose your integration.\n\nAfter setting up all the required parameters, simply run the code by using ‘npm start’.\n\n### Sending and Receiving a WeChat Message\n\nTo send an **outbound** message (from a **Nexmo client** to a **WeChat client**) we will need to create the following custom event:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">{ \"type\":\"custom:wechat:message\", \"body\":{ \"to\":\"we_chat_client_id\", \"from\":\"we_chat_integration_id\", \"content\":\"Hello from Nexmo!\", \"direction\":\"outbound\" } }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0560279714240-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0560279714240-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0560279714240-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0560279714240-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0560279714240-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0560279714240-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0560279714240-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0560279714240-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0560279714240-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0560279714240-10\">10</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0560279714240-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0560279714240-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"custom:wechat:message\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0560279714240-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"body\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0560279714240-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"to\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_client_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0560279714240-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"from\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_integration_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0560279714240-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Hello from Nexmo!\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0560279714240-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"direction\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"outbound\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0560279714240-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0560279714240-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0560279714240-10\">&nbsp;</div></div></td></tr></tbody></table>\n\nFor an **inbound** message (from a **WeChat client** to a **Nexmo client**) we will need to create the same event but reverse its direction.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">{ \"type\":\"custom:wechat:message\", \"body\":{ \"to\":\"we_chat_integration_id\", \"from\":\"we_chat_client_id\", \"content\":\"Hello from WeChat!\", \"direction\":\"outbound\" } }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0563526786056-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0563526786056-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0563526786056-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0563526786056-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0563526786056-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0563526786056-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0563526786056-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0563526786056-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0563526786056-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0563526786056-10\">10</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0563526786056-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0563526786056-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"custom:wechat:message\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0563526786056-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"body\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0563526786056-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"to\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_integration_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0563526786056-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"from\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"we_chat_client_id\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0563526786056-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Hello from WeChat!\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0563526786056-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"direction\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"outbound\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0563526786056-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0563526786056-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0563526786056-10\">&nbsp;</div></div></td></tr></tbody></table>\n\nPlease take a look at the following snippet that shows how to dispatch a WeChat event:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const dispatchWeChatEvent = (wechat, direction = 'inbound') =&gt; { var options = { uri: `https://api.nexmo.com/beta/conversations/${conversationId}/events`, method: 'POST', headers: { Authorization: 'Bearer ' + jwt, Accept: 'application/json', 'Content-Type': 'application/json' }, json: { type: 'custom:wechat:message', body: { to: wechat.getTo(), from: wechat.getFrom(), content: wechat.getContent(), direction } } }; request(options, (error, response, body) =&gt; { if (!error &amp;&amp; response.statusCode == 200) { console.log('successfully sent WeChat message'); } }); };</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1ff0564151991450-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1ff0564151991450-27\">27</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dispatchWeChatEvent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">direction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'inbound'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//api.nexmo.com/beta/conversations/${conversationId}/events`,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Authorization</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Bearer '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Accept</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/json'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'custom:wechat:message'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getFrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wechat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">direction</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">statusCode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'successfully sent WeChat message'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1ff0564151991450-26\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1ff0564151991450-27\">&nbsp;</div></div></td></tr></tbody></table>\n\nOur Nexmo client, in turn, will receive the custom event and parse it as a WeChat message.\n\nThe following video demonstrates the flow we’ve just implemented; notice how WeChat could be replaced by a different platform.\n\n[https://www.nexmo.com/wp-content/uploads/2019/10/blogvideo-1.mp4](https://www.nexmo.com/wp-content/uploads/2019/10/blogvideo-1.mp4)\n\n## Recap\n\nWe have learned in the previous sections how to integrate WeChat with your application using our Conversation API. However, WeChat is just an example of what you can integrate with the Conversation API; it could have been a different messaging channel, such as WhatsApp, or even a different communication channel, such as Email.\n\nThe flexibility that the Conversation API brings with its custom events allows you to integrate a wide variety of communication channels.\n\nFor a completed version of this tutorial, you can find it at on [GitHub](https://github.com/nexmo-community/conversation-api-wechat-integration)\n\nIf you want to learn more about what you can do with our APIs, please visit [Nexmo.com](https://www.nexmo.com/blog/category/developer) for more!"}