{"_filedata":{"slug":"dockerize-python-queue-manager-project-for-easy-deployment-dr"},"title":"Dockerize Python Queue Manager Project for Easy Deployment","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/02/E_Python-Queue-Manager_1200x600.png","author":357,"published":true,"published_at":"2020-02-07T18:33:00","tags":[1678,410,92],"body":"Last month, I showed you how to build an [SMS-based queue management application with Python and Flask](https://www.nexmo.com/blog/2020/01/03/use-python-and-flask-to-manage-queues-via-sms-dr). That application was great for showing a basic example of using the [Nexmo SMS API](https://developer.nexmo.com/messaging/sms/overview), but it was really only good for prototyping and doing local development. In this post, I’ll walk through a few steps you can take to make that application more production ready, with the end result being a [Dockerized](https://www.docker.com/) version of the application that you can deploy straight to [Heroku](https://www.heroku.com/).\n\nAlong the way, we’ll talk a little bit about:\n\n*   Best practices for managing secrets\n*   Containers and why they are useful\n*   Working with an application server that can handle production traffic\n\n## Prerequisites\n\n*   [Docker](https://www.docker.com/)\n*   A [Heroku](https://www.heroku.com/) account\n*   The [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli)\n*   A [Nexmo account](https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&utm_medium=github&utm_campaign=https://github.com/nexmo-community/docker-queue-manager) with a phone number enabled for SMS\n*   [ngrok](https://ngrok.com/) (for testing locally)\n\n## Choose a starting point\n\nIf you followed along with my [first post](https://www.nexmo.com/blog/2020/01/03/use-python-and-flask-to-manage-queues-via-sms-dr) on building a queue management app, all you need to get started with this one is to cover all the prequisites listed above. If you’re just joining, you can clone the finished app from before:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">git clone https://github.com/nexmo-community/sms-queue-notify.git</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf28f674342727-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf28f674342727-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf28f674342727-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/nexmo-community/sms-queue-notify.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf28f674342727-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nYou can also start with the [finished, Dockerized version](https://github.com/nexmo-community/docker-queue-manager) of the project:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">git clone https://github.com/nexmo-community/docker-queue-manager.git</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf293184327836-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf293184327836-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf293184327836-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/nexmo-community/docker-queue-manager.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf293184327836-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nMany of the setup steps and build commands in this post will still need to be done, but you won’t have to make any changes to the code.\n\nWherever you’re starting, make sure you’re currently in your project directory:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">cd sms-queue-notify</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf294910090792-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf294910090792-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf294910090792-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">sms</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">queue</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">notify</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf294910090792-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nor\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">cd docker-queue-manager</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf295553895288-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf295553895288-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf295553895288-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">queue</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">manager</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf295553895288-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n## Manage secrets\n\nPreviously, I had you place your Nexmo key, secret, and phone number directly at the top of `main.py`. While this worked for demonstrating a simple app without a lot of moving pieces, in general you would want to make sure your credentials are seperate from your code. So the first modification we’ll make to `main.py` is to read our secrets directly from environment variables. Change the following lines:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_KEY = &lt;Your Nexmo Key&gt; NEXMO_SECRET = &lt;Your Nexmo Secret&gt; NEXMO_NUMBER = &lt;Your Nexmo Number&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf296704770683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf296704770683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf296704770683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf296704770683-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf296704770683-1\"><span class=\"crayon-v\">NEXMO_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-v\">Key</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf296704770683-2\"><span class=\"crayon-v\">NEXMO_SECRET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-v\">Secret</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf296704770683-3\"><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-v\">Number</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf296704770683-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nto:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_KEY = os.environ['NEXMO_KEY'] NEXMO_SECRET = os.environ['NEXMO_SECRET'] NEXMO_NUMBER = os.environ['NEXMO_NUMBER']</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf297155759777-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf297155759777-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf297155759777-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf297155759777-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf297155759777-1\"><span class=\"crayon-v\">NEXMO_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXMO_KEY'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf297155759777-2\"><span class=\"crayon-v\">NEXMO_SECRET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXMO_SECRET'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf297155759777-3\"><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXMO_NUMBER'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf297155759777-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nNext, you’ll want to make sure you don’t accidentally publish your secrets anywhere public. If you don’t already have one, create a `.gitignore` file and make sure you have `.env` listed. While you’re at it, create a `.dockerignore` file with the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">.env .git</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf299492344459-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf299492344459-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf299492344459-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf299492344459-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">env</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf299492344459-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">git</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf299492344459-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow you can create a new file named `.env` to hold your sensitive information. The contents of the file should be:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_KEY=&lt;Your Nexmo Key&gt; NEXMO_SECRET=&lt;Your Nexmo Secret&gt; NEXMO_NUMBER=&lt;Your Nexmo Number&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29a404371817-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29a404371817-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29a404371817-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29a404371817-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29a404371817-1\"><span class=\"crayon-v\">NEXMO_KEY</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-v\">Key</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29a404371817-2\"><span class=\"crayon-v\">NEXMO_SECRET</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-v\">Secret</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29a404371817-3\"><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-v\">Number</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29a404371817-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nNote that formatting is important here. There are no spaces around the equal signs, and unlike when you had these values in `main.py`, they should not be enclosed in quotes.\n\nIf you wanted to test your app now, you could run the following in the terminal to set environment variables based on the `.env` file:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">set -o allexport source .env set +o allexport</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29b410472630-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29b410472630-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29b410472630-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29b410472630-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29b410472630-1\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">allexport</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29b410472630-2\"><span class=\"crayon-i\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">env</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29b410472630-3\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">allexport</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29b410472630-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe’ll be using Docker to test the changes to our app, which can read from the `.env` file directly.\n\n## Configuration changes\n\nAt the very end of `main.py`, you’ll see the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">if __name__ == '__main__': app.run(debug=True, threaded=True)</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29c116435660-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29c116435660-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29c116435660-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29c116435660-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29c116435660-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">debug</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threaded</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29c116435660-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis configuration, with `debug=True`, is great for testing the application, as it allows changes to made without having to restart the server every time. This debug mode is only meant for development purposes, and should not be used in production.\n\nThe other piece of configuration, `threaded=True`, relates to server-sent events, which require threading to work properly. As you’ll learn shortly, we’ll be handling requests with a separate application server, so we can remove this bit of configuration as well. The updated `main.py` should look like:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">if __name__ == '__main__': app.run()</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29d212041505-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29d212041505-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29d212041505-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29d212041505-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29d212041505-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29d212041505-3\">&nbsp;</div></div></td></tr></tbody></table>\n\n## Create a Dockerfile\n\nTo make our project easy to deploy, we’re going to package everything up into a Docker container. Containers are a lightweight way to make sure your application has all the resources it needs to run, including the correct operating system and dependencies. Bundling our application as a container makes it possible to deploy across a variety of platforms without having to worry about what other processes, configuration, and software already exists.\n\nDocker builds container images using something called a Dockerfile, which lists line-by-line the steps that are needed to create the environment your app will run in. It’s a recipe that tells Docker how to replicate the setup you know is needed for your application to run correctly. Each line of the Dockerfile creates a layer, and when you rebuild a Docker image only the layers that have changes will be rebuilt. This means you want to start with the most general setup at the top (OS and required packages) and work towards more specific requirements.\n\nFor our application, let’s start with a new file named `Dockerfile` that contains the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">FROM python:3.6-slim-buster COPY requirements.txt requirements.txt RUN pip install -r requirements.txt</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29f598520074-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29f598520074-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29f598520074-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29f598520074-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf29f598520074-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf29f598520074-6\">6</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29f598520074-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3.6</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slim</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">buster</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29f598520074-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29f598520074-3\"><span class=\"crayon-e\">COPY </span><span class=\"crayon-v\">requirements</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">requirements</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29f598520074-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf29f598520074-5\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requirements</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf29f598520074-6\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis tells Docker to start with a base image that includes a lightweight version of the [Debian Buster](https://www.debian.org/releases/buster/) OS as well as Python version 3.6. This is a standard base image that is available from [Docker Hub](https://hub.docker.com/), a public registry of container images.\n\nThe next two lines of the Dockerfile ensure that the required dependencies for our application (Flask, Flask-SQLAlchemy, and the Nexmo SDK) are installed. Unless changes to `requirements.txt` are made or a different base image is used, these steps will only need to be done once. Subsequent builds (for things like changes to the code) can use these already existing layers.\n\n## Production application server\n\nFlask has a built-in web server for testing purposes, which is what we used in the previous post. This server is not intented for production use—it’s meant primarily to handle one request at a time, and it won’t scale to handle the traffic expected of a production application.\n\nIn production, you want to make sure you have a dedicated web server _and_ a separate application server that handles communication with your Python application. Two common choices for these are [Nginx](https://www.nginx.com/) and [Gunicorn](https://gunicorn.org/). As we are planning to deploy to Heroku, which provides a web server for you, we’ll only need to include Gunicorn (as well as [gevent](http://www.gevent.org/) to handle threading). Add the following to your Dockerfile:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">RUN pip install gunicorn gevent</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a0797428019-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a0797428019-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a0797428019-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">gunicorn </span><span class=\"crayon-i\">gevent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a0797428019-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n## Database setup\n\nIf you recall from the [first post](https://www.nexmo.com/blog/2020/01/03/use-python-and-flask-to-manage-queues-via-sms-dr), we created our database using some Python commands directly at the command line. This doesn’t work so well when you’re deploying your app in a container, as you don’t want to be doing manual steps to set up your environment. To help keep things automated, create a new `create_db.py` file that looks like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">from main import db db.create_all()</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a1380235722-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a1380235722-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a1380235722-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a1380235722-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">main </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">db</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a1380235722-2\"><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a1380235722-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nThat was easy! Now we can finish up our `Dockerfile` with the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">COPY . /app WORKDIR /app CMD python create_db.py &amp;&amp; gunicorn -k gevent -b 0.0.0.0:$PORT main:app</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a2940344114-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a2940344114-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a2940344114-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a2940344114-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a2940344114-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a2940344114-6\">6</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a2940344114-1\"><span class=\"crayon-i\">COPY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a2940344114-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a2940344114-3\"><span class=\"crayon-v\">WORKDIR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a2940344114-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a2940344114-5\"><span class=\"crayon-e\">CMD </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">create_db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gunicorn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gevent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">PORT </span><span class=\"crayon-v\">main</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a2940344114-6\">&nbsp;</div></div></td></tr></tbody></table>\n\nThese last steps copy the contents of you project directory to a folder named `/app` in the container, which is then set as the working directory. The last line tells the container what commands to run when it is started up: first create the database, and when that is done kick off a gunicorn server to run our app. The `$PORT` environment variable is set by Heroku when the container runs.\n\n## Test locally with Docker\n\nNow that the Dockerfile is complete, it’s easy to test that everything is working locally. First, be sure that Docker is running on your computer. Then run the following in your project directory to build a Docker image, using `--tag` to set an easy-to-reference name:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">docker build --tag queue_app .</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a3682428049-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a3682428049-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a3682428049-1\"><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">build</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">tag </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">_</span>app<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a3682428049-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nIf that builds successfully, you can now run the container:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">docker run -d -p 5000:5000 --env-file .env -e PORT=5000 queue_app</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a4772911342-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a4772911342-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a4772911342-1\"><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">env</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">_</span>app</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a4772911342-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nNotice that we are loading our secrets from the `.env` file and setting the `PORT` environment variable ourselves.\n\nOnce you container is running, you should be able to open a browser, go to `localhost:5000`, and see your app!\n\nThere’s still one more step if you want to fully test your app. In the previous post you set up ngrok to make your application accessible via the web. You’ll need to do this again if you want to test sending an SMS message to the app. Open a new terminal window and run the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">ngrok http 5000</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a5835506893-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a5835506893-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a5835506893-1\"><span class=\"crayon-e\">ngrok </span><span class=\"crayon-i\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a5835506893-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen make sure to go to the Nexmo dashboard and copy the forwarding URL into your number’s settings in the `Inbound Webhook URL` field, like so: `https://<your ngrok ID>.ngrok.io/webhooks/inbound-sms` (see [previous post](https://www.nexmo.com/blog/2020/01/03/use-python-and-flask-to-manage-queues-via-sms-dr) for details).\n\nNow you should be able to interact with your application via text just like before! Only now, if you stop your container and restart, you’ll find the database will be completely reset.\n\n## Postgres database\n\nIn our development version of the app, we used a [SQLite](https://www.sqlite.org/) database to store information about who was waiting in the queue. SQLite created the database as a file in the project directory, which made setup straightforward. In a container-based setup this doesn’t work, as the container’s file system won’t persist if the container needs to be restarted. It also makes it tough to scale the app across multiple containers, as there’s no shared datasource.\n\nLuckily, we used [Flask-SQLAlchemy](https://flask-sqlalchemy.palletsprojects.com/en/2.x/) to abstract the database specifics from our code, so swapping our SQLite for a Heroku-provided [Postgres](https://www.postgresql.org/) database is incredibly simple. The Postgres database sits outside the container, so it will persist even when the container is restarted and can be accessed by multiple containers.\n\nWhen Heroku creates a Postgres database, the database url is stored in the `DATABASE_URL` environment variable. The only change we need to make to our code to switch from SQLite to the Heroku Postgres database is replacing this line in `main.py`:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">db_path = \"sqlite:///queue.db\"</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a7032960631-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a7032960631-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a7032960631-1\"><span class=\"crayon-v\">db_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sqlite:///queue.db\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a7032960631-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nwith this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">db_path = os.environ['DATABASE_URL']</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2a9013727131-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2a9013727131-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2a9013727131-1\"><span class=\"crayon-v\">db_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'DATABASE_URL'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2a9013727131-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen we need to update the line of our `Dockerfile` that says:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">RUN pip install gunicorn gevent</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2aa089181577-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2aa089181577-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2aa089181577-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">gunicorn </span><span class=\"crayon-i\">gevent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2aa089181577-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nto say:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">RUN pip install gunicorn gevent psycopg2-binary</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2ab798053508-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2ab798053508-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2ab798053508-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">gunicorn </span><span class=\"crayon-e\">gevent </span><span class=\"crayon-v\">psycopg2</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">binary</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2ab798053508-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe psycopg2 package is a Postgres database adapter specifically made for Python.\n\nThe final step is to create a Postgres database on Heroku, which requires you to first log in to the Heroku CLI and create a Heroku application:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">heroku login heroku create &lt;your application name&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2ac772654117-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2ac772654117-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2ac772654117-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2ac772654117-1\"><span class=\"crayon-e\">heroku </span><span class=\"crayon-e\">login</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2ac772654117-2\"><span class=\"crayon-e\">heroku </span><span class=\"crayon-v\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">application </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2ac772654117-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nNext, create the database, being sure to include your application name:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">heroku addons:create heroku-postgresql:hobby-dev -a &lt;your application name&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2ae683710581-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2ae683710581-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2ae683710581-1\"><span class=\"crayon-e\">heroku </span><span class=\"crayon-v\">addons</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">create </span><span class=\"crayon-v\">heroku</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">postgresql</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">hobby</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">application </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2ae683710581-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n## Deploy your container to Heroku\n\nWith your application and database initialized on Heroku, there are only a few more steps necessary to get your Dockerized app deployed. First, you’ll want to set your Nexmo credentials as Heroku Config Vars, which is done on the Heroku dashboard under “Settings”:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/02/heroku-config-vars.png)](https://www.nexmo.com/wp-content/uploads/2020/02/heroku-config-vars.png)\n\nNext, you’ll want to rebuild your Docker container to make sure you pick up recent changes:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">docker build --tag queue_app .</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2af642401059-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2af642401059-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2af642401059-1\"><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">build</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">tag </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">_</span>app<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2af642401059-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen you’ll need to log in to the Heroku container registry:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">heroku container:login</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2b0386498938-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2b0386498938-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2b0386498938-1\"><span class=\"crayon-e\">heroku </span><span class=\"crayon-v\">container</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">login</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2b0386498938-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nAnd finally, you’ll push and release your container to Heroku:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">heroku container:push web -a &lt;your application name&gt; heroku container:release web -a &lt;your application name&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2b1611344531-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdf2b1611344531-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdf2b1611344531-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2b1611344531-1\"><span class=\"crayon-e\">heroku </span><span class=\"crayon-v\">container</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">push </span><span class=\"crayon-v\">web</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">application </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdf2b1611344531-2\"><span class=\"crayon-e\">heroku </span><span class=\"crayon-v\">container</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">release </span><span class=\"crayon-v\">web</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">application </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdf2b1611344531-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nThat’s it! Well, almost. Launch your application from your Heroku dashboard to make sure it’s working, then go to your Nexmo dashboard and update your number’s `Inbound Webhook URL` field to look like this: `https://<your application name>.herokuapp.com/webhooks/inbound-sms`.\n\nYou’ve done it! With the power of containerization, you now have a production-ready application that is easily scalable and replicable.\n\nIf you run into any issues or have questions, reach out to us on our [Community Slack](https://developer.nexmo.com/community/slack). Thanks for reading!"}