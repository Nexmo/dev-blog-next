{"_filedata":{"slug":"sentiment-analysis-with-opentok-and-azure-face-api-dr"},"title":"I See What You&#8217;re Saying: Sentiment Analysis With OpenTok and Azure Face API","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/01/E_Sentiment-Analysis_OpenTok_1200x600.jpg","author":353,"published":true,"published_at":"2020-01-27T22:27:30","tags":[360,1671,1435,1376,1429],"body":"You know that person. It could be your significant other, a child, a co-worker, or a friend. The person that says one thing, but you can tell by their face, they mean something completely different. You probably just pictured them in your head. Maybe you remember the exact conversation. Perhaps it went like this:\n\n> **You:** Okay?\n> \n> **Them:** Fine.\n\n_Spoiler Alert:_ It wasn’t fine.\n\nWouldn’t it be great if you could know the sentiment behind what they were saying? With OpenTok and Azure’s Face API you can!\n\nIn this tutorial, we will build a multi-party video conference that allows us to analyze the sentiment of each participant based on their facial expression. Then we’ll display that sentiment as an emoji over their video.\n\n## Prerequisites\n\nBefore getting started, you’ll need a few things:\n\n*   A TokBox Account — [create one for free](https://tokbox.com/account) if you haven’t already\n*   A free Azure Account with [Face API Cognitive Service](https://azure.microsoft.com/en-us/services/cognitive-services/face/)\n*   Optional: [Ngrok](https://ngrok.com/) for test deployment\n\n> Want to skip to the end? You can find all the source code for this tutorial on [GitHub](https://github.com/opentok-community/video-azure-sentiment).\n\n## Getting Started\n\nWe’ll use JavaScript to do the heavy lifting, so let’s get the HTML & CSS out of the way.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">mkdir video-sentiment cd video-sentiment</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b11960983102-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b11960983102-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b11960983102-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b11960983102-1\"><span class=\"crayon-e\">mkdir </span><span class=\"crayon-v\">video</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">sentiment</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b11960983102-2\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">video</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sentiment</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b11960983102-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the root of the video-sentiment folder, create an `index.html` file and copy the following to it.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;title&gt;OpenTok Sentiment Analysis&lt;/title&gt; &lt;link href=\"https://emoji-css.afeld.me/emoji.css\" rel=\"stylesheet\" type=\"text/css\" /&gt; &lt;link href=\"css/app.css\" rel=\"stylesheet\" type=\"text/css\" /&gt; &lt;a href=\"https://static.opentok.com/v2/js/opentok.min.js\"&gt;https://static.opentok.com/v2/js/opentok.min.js&lt;/a&gt; &lt;!-- Polyfill for fetch API so that we can fetch the sessionId and token in IE11 --&gt; &lt;a href=\"https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js\"&gt;https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js&lt;/a&gt; &lt;a href=\"https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js\"&gt;https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js&lt;/a&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=\"videos\"&gt; &lt;div id=\"subscriber\"&gt;&lt;/div&gt; &lt;div id=\"publisher\"&gt;&lt;/div&gt; &lt;/div&gt; &lt;!-- Footer will go here --&gt; &lt;a href=\"http://js/config.js\"&gt;http://js/config.js&lt;/a&gt; &lt;a href=\"http://js/app.js\"&gt;http://js/app.js&lt;/a&gt; &lt;/body&gt; &lt;/html&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b14673899409-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b14673899409-28\">28</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">DOCTYPE </span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">OpenTok </span><span class=\"crayon-e\">Sentiment </span><span class=\"crayon-v\">Analysis</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://emoji-css.afeld.me/emoji.css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text/css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"css/app.css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text/css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://static.opentok.com/v2/js/opentok.min.js\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//static.opentok.com/v2/js/opentok.min.js&lt;/a&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Polyfill </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fetch </span><span class=\"crayon-e\">API </span><span class=\"crayon-e\">so </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">we </span><span class=\"crayon-e\">can </span><span class=\"crayon-e\">fetch </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">sessionId </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">token </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IE11</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js&lt;/a&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js&lt;/a&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"videos\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"subscriber\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"publisher\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Footer </span><span class=\"crayon-e\">will </span><span class=\"crayon-e\">go </span><span class=\"crayon-v\">here</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-23\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://js/config.js\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//js/config.js&lt;/a&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://js/app.js\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//js/app.js&lt;/a&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b14673899409-27\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b14673899409-28\">&nbsp;</div></div></td></tr></tbody></table>\n\nNext, create a `css` directory and add an `app.css` file to it. Copy the CSS below into that file.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">body, html { height: 100%; background-color: black; margin: 0; padding: 0; font-family: Arial, Helvetica, sans-serif; } #videos { width: 100%; height: 50%; margin-left: auto; margin-right: auto; } #subscriber { width: 100%; height: 100%; } #publisher { position: absolute; bottom: 50px; right: 0px; z-index: 100; } .OT_subscriber { width: 300px !important; height: 200px !important; float: left; margin: 5px !important; } .OT_widget-container { padding: 6px 0 0 6px !important; background-color: #70B7FD !important; } #publisher .OT_widget-container { padding: 6px 0 0 6px !important; background-color: hotpink !important; } .sentiment { position: absolute; z-index: 9000; height: 100px; width: 100px; font-size: 48px; } footer { position: absolute; left: 0; right: 0; bottom: 0; height: 30px; padding: 10px; background-color: gray; } button { font-size: 16px; padding: 5px 10px; display: inline; } ul { float: right; display: inline; list-style: none; padding: 5px 10px; margin: 0; } li { display: inline; background-color: lightgrey; padding: 10px; display: none; } li.used { display: inline; }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b24575176826-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b24575176826-87\">87</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-1\"><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-2\"><span class=\"crayon-e\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">black</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">margin</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">family</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Arial</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Helvetica</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sans</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">serif</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-9\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-10\"><span class=\"crayon-p\">#videos {</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">margin</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">left</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">auto</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">margin</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">auto</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-17\"><span class=\"crayon-p\">#subscriber {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-22\"><span class=\"crayon-p\">#publisher {</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">position</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">absolute</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">bottom</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">z</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-28\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-29\"><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">OT</span><span class=\"crayon-sy\">_</span>subscriber<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300px</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">important</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200px</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">important</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">float</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">margin</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5px</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">important</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-34\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-35\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-36\"><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">OT_widget</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">container</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6px</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6px</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">important</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-38\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#70B7FD !important;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-39\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-40\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-41\"><span class=\"crayon-p\">#publisher .OT_widget-container {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-42\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6px</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6px</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">important</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-43\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hotpink</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">important</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-44\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-45\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-46\"><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sentiment</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-47\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">position</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">absolute</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-48\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">z</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-49\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-50\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-51\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">48px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-52\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-53\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-54\"><span class=\"crayon-e\">footer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-55\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">position</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">absolute</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-56\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">left</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-57\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-58\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">bottom</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-59\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-60\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-61\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gray</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-62\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-63\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-64\"><span class=\"crayon-e\">button</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-65\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-66\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5px</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-67\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">display</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inline</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-68\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-69\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-70\"><span class=\"crayon-e\">ul</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-71\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">float</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-72\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">display</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inline</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-73\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-74\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5px</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-75\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">margin</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-76\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-77\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-78\"><span class=\"crayon-e\">li</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-79\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">display</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inline</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-80\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lightgrey</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-81\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-82\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">display</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-83\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-84\"><span class=\"crayon-v\">li</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">used</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-85\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">display</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inline</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b24575176826-86\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b24575176826-87\">&nbsp;</div></div></td></tr></tbody></table>\n\n## Let’s Get Configured\n\nGreat! Now we can make that pretty HTML & CSS do something. Create a `js` folder and add a `config.js` file.\n\nThe `config.js` file contains configuration parameters that we’ll get from our TokBox and Azure accounts. Copy the following into the `config.js` file.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// Replace these values with those generated in your TokBox and Azure Accounts const OPENTOK_API_KEY = ''; const OPENTOK_SESSION_ID = ''; const OPENTOK_TOKEN = ''; const AZURE_FACE_API_SUBSCRIPTION_KEY = ''; const AZURE_FACE_API_ENDPOINT = '';</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b27710707246-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b27710707246-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b27710707246-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b27710707246-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b27710707246-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b27710707246-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b27710707246-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b27710707246-1\"><span class=\"crayon-c\">// Replace these values with those generated in your TokBox and Azure Accounts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b27710707246-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPENTOK_API_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b27710707246-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPENTOK_SESSION_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b27710707246-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPENTOK_TOKEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b27710707246-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AZURE_FACE_API_SUBSCRIPTION_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b27710707246-6\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AZURE_FACE_API_ENDPOINT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b27710707246-7\">&nbsp;</div></div></td></tr></tbody></table>\n\n### OpenTok Settings\n\nWe’ll get the `OPENTOK_API_KEY`, `OPENTOK_SESSION_ID` and `OPENTOK_TOKEN` variables from our TokBox Account.\n\nIn your TokBox Account, click the ‘Projects’ menu and ‘Create New Project.\\` Then click the ‘Create Custom Project’ button. Give your new project a name and press the ‘Create’ button. You can leave the preferred codec as ‘VP8’.\n\n![Screenshot of the \"project created\" dialog within a TokBox account.](https://www.nexmo.com/wp-content/uploads/2020/01/tb-project-created.png)\n\nYou can then copy your API Key and paste it as the value for the `OPENTOK_API_KEY` setting.\n\nNext, click on “View Project”. At the bottom of the project detail page, you’ll find the Project Tools where you can create a Session ID and Token. Choose “Routed” for your session’s media mode and press the “Create Session ID” button. Then, copy the generated Session ID and paste it as the value of the `OPENTOK_SESSION_ID` setting.\n\nFinally, paste the generated session ID into the Session ID field of the Generate Token form and press the “Generate Token” button. Copy the generated Token as the value of the `OPENTOK_TOKEN` setting.\n\n![Project Tools area of a specific project in a TokBox account.](https://www.nexmo.com/wp-content/uploads/2020/01/tb-project-tools.png)\n\n### Azure Face API Settings\n\nLog into your Azure account and create a new Face API Cognitive Service. Once created, click on the service and go to the “Quick start” blade. There you’ll find your `Key` and `Endpoint`. Copy these two values to the `AZURE_FACE_API_SUBSCRIPTION_KEY` and `AZURE_FACE_API_ENDPOINT` settings, respectively.\n\n![Screenshot of the Quick start blade within Azure for the Face API service.](https://www.nexmo.com/wp-content/uploads/2020/01/azure-face-quickstart.png)\n\n## I Feel Seen\n\nWith our configuration ready, let’s add some JavaScript to connect to an OpenTok session. Add an `app.js` file to the js folder and copy the following to it.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">var opentok_api_key; var opentok_session_id; var opentok_token; var azure_face_api_subscription_key; var azure_face_api_endpoint; // See the config.js file. if (OPENTOK_API_KEY &amp;&amp; OPENTOK_SESSION_ID &amp;&amp; OPENTOK_TOKEN &amp;&amp; AZURE_FACE_API_SUBSCRIPTION_KEY &amp;&amp; AZURE_FACE_API_ENDPOINT) { opentok_api_key = OPENTOK_API_KEY; opentok_session_id = OPENTOK_SESSION_ID; opentok_token = OPENTOK_TOKEN; azure_face_api_subscription_key = AZURE_FACE_API_SUBSCRIPTION_KEY; azure_face_api_endpoint = AZURE_FACE_API_ENDPOINT; initializeSession(); } else { alert('Failed to get configuration variables. Make sure you have updated the config.js file.'); } // Handling all of our errors here by logging them to the console function handleError(error) { if (error) { console.log(error.message); } } function dataURItoBlob(dataURI) { // convert base64/URLEncoded data component to raw binary data held in a string var byteString; if (dataURI.split(\",\")[0].indexOf(\"base64\") &gt;= 0) byteString = atob(dataURI.split(\",\")[1]); else byteString = unescape(dataURI.split(\",\")[1]); // separate out the mime component var mimeString = dataURI .split(\",\")[0] .split(\":\")[1] .split(\";\")[0]; // write the bytes of the string to a typed array var ia = new Uint8Array(byteString.length); for (var i = 0; i &lt; byteString.length; i++) { ia[i] = byteString.charCodeAt(i); } return new Blob([ia], { type: mimeString }); } var streams = []; var emotions = [];</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b29310485665-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b29310485665-60\">60</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opentok_api_key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opentok_session_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opentok_token</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-4\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">azure_face_api_subscription_key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">azure_face_api_endpoint</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-7\"><span class=\"crayon-c\">// See the config.js file.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-8\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">OPENTOK_API_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">OPENTOK_SESSION_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">OPENTOK_TOKEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">AZURE_FACE_API_SUBSCRIPTION_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">AZURE_FACE_API_ENDPOINT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-13\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">opentok_api_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPENTOK_API_KEY</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">opentok_session_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPENTOK_SESSION_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">opentok_token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPENTOK_TOKEN</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">azure_face_api_subscription_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AZURE_FACE_API_SUBSCRIPTION_KEY</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">azure_face_api_endpoint</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AZURE_FACE_API_ENDPOINT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-19\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">initializeSession</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-22\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-23\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">alert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Failed to get configuration variables. Make sure you have updated the config.js file.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-25\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-27\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-28\"><span class=\"crayon-c\">// Handling all of our errors here by logging them to the console</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-29\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handleError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-33\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-34\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-35\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dataURItoBlob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataURI</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-36\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// convert base64/URLEncoded data component to raw binary data held in a string</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">byteString</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-38\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataURI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"base64\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">byteString</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">atob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataURI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-40\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">byteString</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unescape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataURI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-41\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-42\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// separate out the mime component</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-43\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimeString</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dataURI</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\";\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-47\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-48\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// write the bytes of the string to a typed array</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-49\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ia</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Uint8Array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">byteString</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-50\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">byteString</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ia</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">byteString</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">charCodeAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-52\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-53\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-54\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ia</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mimeString</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-55\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-56\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-57\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">streams</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-58\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">emotions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b29310485665-59\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b29310485665-60\">&nbsp;</div></div></td></tr></tbody></table>\n\nFour things are going on here:\n\n1.  We load variables based on those we specified in the `config.js` file\n2.  We create a `handleError` method that we’ll use throughout when an error occurs\n3.  We add a `dataURItoBlob` method that we’ll use to convert a base64/URLEncoded image to a blob for sending to Azure Face API\n4.  We added two arrays named `streams` and `emotions`\n\nThe `streams` array will hold all active participant streams so we can access them to capture images to send to the Azure Face API.\n\nThe `emotions` array will hold strings that represent any emotions returned by Azure Face API. This will be used to display a legend of emojis to the user dynamically.\n\n### Initializing the OpenTok Session\n\nAdd the `initializeSession` method below to the bottom of the `app.js` file.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">function initializeSession() { var session = OT.initSession(opentok_api_key, opentok_session_id); // Subscribe to a newly created streams and add // them to our collection of active streams. session.on(\"streamCreated\", function (event) { streams.push(event.stream); session.subscribe( event.stream, \"subscriber\", { insertMode: \"append\" }, handleError ); }); // Remove streams from our array when they are destroyed. session.on(\"streamDestroyed\", function (event) { streams = streams.filter(f =&gt; f.id !== event.stream.id); }); // Create a publisher var publisher = OT.initPublisher( \"publisher\", { insertMode: \"append\" }, handleError ); // Connect to the session session.connect(opentok_token, function (error) { // If the connection is successful, initialize a publisher and publish to the session if (error) { handleError(error); } else { session.publish(publisher, handleError); } }); }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b2b144080571-42\">42</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">initializeSession</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">session</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OT</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initSession</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opentok_api_key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opentok_session_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Subscribe to a newly created streams and add</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// them to our collection of active streams.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"streamCreated\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">streams</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">subscribe</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"subscriber\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">insertMode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"append\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">handleError</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Remove streams from our array when they are destroyed.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"streamDestroyed\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">streams</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">streams</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Create a publisher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">publisher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OT</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initPublisher</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"publisher\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">insertMode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"append\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">handleError</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Connect to the session</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opentok_token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// If the connection is successful, initialize a publisher and publish to the session</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">handleError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">publisher</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handleError</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-40\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b2b144080571-41\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b2b144080571-42\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe `initializeSession` method initializes our OpenTok client with the session we specified with the Session ID. It then adds event handlers for the `streamCreated` and `streamDestroyed` events to manage adding and removing streams from our `streams` array. Finally, it connects to the session using the Token we set in our `config.js` file.\n\nYou can now open the `index.html` in Chrome or Firefox. When you load the page, you may need to allow the browser to access your webcam and microphone. After that, you should see a video stream of yourself (or whatever your webcam is looking at) displaying on the page.\n\nIf that worked, mute your audio then open another tab (keeping the original open) and load the same file. You should now be able to see a second video.\n\n> **Troubleshooting tip:** If there’s no video showing up on the page, open the “console” tab in your browser tools (command+option+i on Mac, CTRL+i on Windows) and check for errors. The most likely issue is that your OpenTok API key, session ID, or token is not set up properly. Since you hardcoded your credentials, it’s also possible that your token has expired.\n\n## I Know That Look\n\nNow we can see and hear participants, but what is their face telling us that their mouth isn’t? Let’s add a button that allows us to analyze each participant.\n\nIn the `index.html` file, replace the comment that says `<!-- Footer will go here -->` with the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;footer&gt; &lt;button id=\"analyze\" type=\"button\" onclick=\"processImages();\"&gt;Analyze&lt;/button&gt; &lt;ul&gt; &lt;li name=\"em-angry\"&gt;&lt;i class=\"em em-angry\"&gt;&lt;/i&gt; Angry&lt;/li&gt; &lt;li name=\"em-frowning\"&gt;&lt;i class=\"em em-frowning\"&gt;&lt;/i&gt; Contempt&lt;/li&gt; &lt;li name=\"em-face_vomiting\"&gt;&lt;i class=\"em em-face_vomiting\"&gt;&lt;/i&gt; Disgust&lt;/li&gt; &lt;li name=\"em-fearful\"&gt;&lt;i class=\"em em-fearful\"&gt;&lt;/i&gt; Fear&lt;/li&gt; &lt;li name=\"em-grin\"&gt;&lt;i class=\"em em-grin\"&gt;&lt;/i&gt; Happiness&lt;/li&gt; &lt;li name=\"em-neutral_face\"&gt;&lt;i class=\"em em-neutral_face\"&gt;&lt;/i&gt; Neutral&lt;/li&gt; &lt;li name=\"em-cry\"&gt;&lt;i class=\"em em-cry\"&gt;&lt;/i&gt; Sadness&lt;/li&gt; &lt;li name=\"em-astonished\"&gt;&lt;i class=\"em em-astonished\"&gt;&lt;/i&gt; Surprise&lt;/li&gt; &lt;/ul&gt; &lt;/footer&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b31540822329-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b31540822329-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b31540822329-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b31540822329-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b31540822329-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b31540822329-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b31540822329-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b31540822329-15\">15</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">footer</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b31540822329-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">button </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"analyze\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"button\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">onclick</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"processImages();\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">Analyze</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">button</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b31540822329-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-angry\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-angry\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Angry</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b31540822329-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-frowning\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-frowning\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Contempt</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-face_vomiting\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-face_vomiting\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Disgust</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b31540822329-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-fearful\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-fearful\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Fear</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-grin\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-grin\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Happiness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b31540822329-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-neutral_face\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-neutral_face\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Neutral</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-cry\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-cry\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Sadness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b31540822329-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em-astonished\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"em em-astonished\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Surprise</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b31540822329-14\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">footer</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b31540822329-15\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis adds a footer at the bottom of the page with an “Analyze” button and an unordered list that we’ll use as a legend between emojis and sentiments.\n\nNow let’s add the JavaScript to handle our sentiment analysis. Add the following to the bottom of the `app.js` file.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">function assignEmoji(emojiClass, index) { var widgets = document.getElementsByClassName('OT_widget-container'); emotions.push(emojiClass); var sentimentDiv = document.createElement(\"div\"); sentimentDiv.classList.add(\"sentiment\"); sentimentDiv.classList.add(\"em\"); sentimentDiv.classList.add(emojiClass); widgets[index].appendChild(sentimentDiv); const legendEl = document.getElementsByName(emojiClass); legendEl[0].classList.add('used'); } function processEmotion(faces, index) { // for each face identified in the result for (i = 0; i memo[1] &amp;gt; value ? memo : [key, value] ); let emojiClass = 'em-neutral_face'; switch (maxEmotion[0]) { case 'angry': emojiClass = 'em-angry'; break; case 'contempt': emojiClass = 'em-frowning'; break; case 'disgust': emojiClass = 'em-face_vomiting'; break; case 'fear': emojiClass = 'em-fearful'; break; case 'happiness': emojiClass = 'em-grin'; break; case 'sadness': emojiClass = 'em-cry'; break; case 'surprise': emojiClass = 'em-astonished'; break; default: break; } assignEmoji(emojiClass, index); } } // Gets a &lt;video&gt; element and draws it to a new // canvas object. Then creates a jpeg blob from that // canvas and sends to Azure Face API to get emotion // data. function sendToAzure(video, index) { // Get the stream object associated with this // &lt;video&gt; element. var stream = streams[index]; var canvas = document.createElement(\"canvas\"); canvas.height = stream.videoDimensions.height; canvas.width = stream.videoDimensions.width; var ctx = canvas.getContext(\"2d\"); ctx.drawImage(video, 0, 0, canvas.width, canvas.height); var dataURL = canvas.toDataURL(\"image/jpeg\", 0.8); var blob = dataURItoBlob(dataURL); var fd = new FormData(document.forms[0]); fd.append(\"canvasImage\", blob); // Perform the REST API call. var uriBase = `${azure_face_api_endpoint}/face/v1.0/detect`; // Request parameters. var params = 'returnFaceId=true&amp;amp;returnFaceLandmarks=false&amp;amp;returnFaceAttributes=emotion'; const xhr = new XMLHttpRequest(); xhr.open('POST', `${uriBase}?${params}`); xhr.responseType = 'json'; xhr.setRequestHeader('Content-Type', 'application/octet-stream'); xhr.setRequestHeader(\"Ocp-Apim-Subscription-Key\", azure_face_api_subscription_key); xhr.send(blob); xhr.onload = () =&amp;gt; { if (xhr.status == 200) { processEmotion(xhr.response, index); } else { var errorString = `(${xhr.status}) ${xhr.statusText}`; alert(errorString); } } } // Reset emojis and loop through all &lt;video&gt; elements and call // sendToAzure function processImages() { emotions = []; var sentiments = document.getElementsByClassName('sentiment'); var usedListItems = document.getElementsByClassName('used'); var videos = document.getElementsByTagName('video'); // Remove any existing sentiment &amp;amp; emotion objects if (sentiments.length &amp;gt; 0) { for (s = 0; s 0) { for (l = 0; l &amp;lt; usedListItems.length; l++) { usedListItems[l].classList.remove(&amp;#039;used&amp;#039;); } } for (v = 0; v &amp;lt; (videos.length - 1); v++) { sendToAzure(videos[v], v); } }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be0b32793224159-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be0b32793224159-118\">118</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assignEmoji</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">widgets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementsByClassName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'OT_widget-container'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">emotions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentimentDiv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createElement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">sentimentDiv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">classList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sentiment\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">sentimentDiv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">classList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"em\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">sentimentDiv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">classList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-9\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">widgets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">appendChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentimentDiv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">legendEl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementsByName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">legendEl</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">classList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'used'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-16\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">processEmotion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">faces</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// for each face identified in the result</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">memo</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">gt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-neutral_face'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">maxEmotion</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'angry'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-angry'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'contempt'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-frowning'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'disgust'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-face_vomiting'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'fear'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-fearful'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'happiness'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-grin'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sadness'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-cry'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'surprise'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'em-astonished'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">default</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">assignEmoji</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">emojiClass</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-49\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-50\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-51\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-52\"><span class=\"crayon-c\">// Gets a &lt;video&gt; element and draws it to a new</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-53\"><span class=\"crayon-c\">// canvas object. Then creates a jpeg blob from that</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-54\"><span class=\"crayon-c\">// canvas and sends to Azure Face API to get emotion</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-55\"><span class=\"crayon-c\">// data.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-56\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sendToAzure</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">video</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-57\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Get the stream object associated with this</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-58\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// &lt;video&gt; element.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-59\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">streams</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-60\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-61\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">canvas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createElement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"canvas\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-62\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">canvas</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">height</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">videoDimensions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-63\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">canvas</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">width</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">videoDimensions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-64\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-65\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ctx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">canvas</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getContext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"2d\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-66\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ctx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">drawImage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">video</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">canvas</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">canvas</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-67\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-68\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataURL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">canvas</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toDataURL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"image/jpeg\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-69\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blob</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dataURItoBlob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataURL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-70\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FormData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">forms</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-71\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"canvasImage\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blob</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-72\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-73\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Perform the REST API call.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-74\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uriBase</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">azure_face_api_endpoint</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">face</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">v1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">detect</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-75\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-76\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Request parameters.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-77\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'returnFaceId=true&amp;amp;returnFaceLandmarks=false&amp;amp;returnFaceAttributes=emotion'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-78\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-79\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xhr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">XMLHttpRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-80\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">uriBase</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-81\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">responseType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-82\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setRequestHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'application/octet-stream'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-83\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setRequestHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Ocp-Apim-Subscription-Key\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">azure_face_api_subscription_key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-84\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-85\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blob</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-86\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-87\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">onload</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=&amp;</span><span class=\"crayon-v\">gt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-88\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-89\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-90\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">processEmotion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-91\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-92\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">errorString</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">xhr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">statusText</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-93\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">alert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">errorString</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-94\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-95\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-96\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-97\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-98\"><span class=\"crayon-c\">// Reset emojis and loop through all &lt;video&gt; elements and call</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-99\"><span class=\"crayon-c\">// sendToAzure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-100\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">processImages</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-101\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">emotions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-102\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentiments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementsByClassName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'sentiment'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-103\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usedListItems</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementsByClassName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'used'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-104\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">videos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementsByTagName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'video'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-105\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-106\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// Remove any existing sentiment &amp;amp; emotion objects</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-107\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentiments</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">gt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-108\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-109\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">lt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usedListItems</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-110\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">usedListItems</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">classList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-p\">#039;used&amp;#039;);</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-111\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-112\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-113\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-114\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">lt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">videos</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-115\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">sendToAzure</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">videos</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-116\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be0b32793224159-117\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be0b32793224159-118\">&nbsp;</div></div></td></tr></tbody></table>\n\nLet's review what this code does.\n\nThe `assignEmoji` method takes in a CSS class associated with the emotion for a specific video stream and the index of that stream in our UI. It does the following:\n\n1.  Adds the provided class to our `emotions` array\n2.  Adds a div over the appropriate video panel with the class for the emoji to display\n3.  Adds a `used` class to the `li` in our footer for that emoji so that it will display in the legend\n\nThe `processEmotion` method receives the payload of face data from the Azure Face API and identifies the emotion with the highest ranking. It then calls `assignEmoji` with the appropriate CSS class for that emotion and the index of the video it is processing.\n\nThe `sendToAzure` method receives an HTML video element and the index of that video object on our page. It gets the stream associated with that video element and then creates an HTML canvas in the same dimensions as the stream. Next, it draws a capture of the stream to the new canvas and sends an XMLHttpRequest to the Azure Face API with the image it created. The Azure Face API will return a JSON object that we will then send to the `processEmotion` method.\n\nLastly, the `processImages` method clears any existing emojis from the UI and gets all HTML video tags in the DOM and sends them to the `sendToAzure` method to be processed. This method is called by our \"Analyze\" button in the footer.\n\n## What Are You Really Thinking?\n\nNow when we open the `index.html` page in our browsers we can press the \"Analyze\" button to see what emotion Azure's Face API has identified. There are a few limitations at the moment. For instance, if Azure Face API recognizes two faces in the frame it will return data for both, but our code currently only adds an emoji for the first.\n\nAlso, I'm not certain, but it may not work for teenagers. I made my teenage daughter test it dozens of times but it only returned \"disgust\" and \"contempt\" as the emotions. Maybe this wasn't such a good idea. Maybe it's better to not know what they really think. 😂\n\n![Four video frames of Michael showing different sentiments returned from Azure's Face API](https://www.nexmo.com/wp-content/uploads/2020/01/sentiment.png)\n\n## Further Reading\n\nWant to learn more about using sentiment analysis with Nexmo? Check out the following blog posts:\n\n*   [Sentiment Analysis API Comparison](https://www.nexmo.com/blog/2019/10/17/sentiment-api-analysis-comparison-dr)\n*   [Sentiment Analysis using IBM Watson Tone Analyzer in PHP](https://www.nexmo.com/blog/2020/01/13/sentiment-analysis-using-ibm-watson-tone-analyzer-in-php-dr)\n*   [Adding Sentiment Analysis to SMS with IBM Watson](https://www.nexmo.com/blog/2019/04/04/adding-sentiment-analysis-to-sms-ibm-watson-dr)"}