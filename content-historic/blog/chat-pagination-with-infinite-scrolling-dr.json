{"_filedata":{"slug":"chat-pagination-with-infinite-scrolling-dr"},"title":"Chat Pagination with Infinite Scrolling","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/02/E_Infinite-Scrolling_1200x600.png","author":310,"published":true,"published_at":"2020-02-03T15:53:58","tags":[1628,1623],"body":"Following on from the previous post [Create a Simple Messaging UI with Bootstrap](https://www.nexmo.com/blog/2019/12/18/create-a-simple-messaging-ui-with-bootstrap-dr), this article will show you how to load older messages from the conversation using the Nexmo Conversation Client SDK, which is now delivered paginated from the Conversation API.\n\n## Prerequisites\n\n### Node & NPM\n\nTo get started, you’re going to need Node and NPM installed. This guide uses Node 8 and NPM 6. Check they’re installed and up-to-date.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">node --version npm --version</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff6d674641468-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff6d674641468-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff6d674641468-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff6d674641468-1\"><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff6d674641468-2\"><span class=\"crayon-v\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">version</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff6d674641468-3\">&nbsp;</div></div></td></tr></tbody></table>\n\n> Both Node and NPM need to be installed and at the correct version. Go to nodejs.org and install the correct version if you don’t have it.\n\n### Nexmo CLI\n\nTo set up your application, you’ll need to install the Nexmo CLI. Install it using NPM in the terminal.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm install -g nexmo-cli@beta</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff70011327582-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff70011327582-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff70011327582-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cli</span><span class=\"crayon-sy\">@</span><span class=\"crayon-i\">beta</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff70011327582-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n[Sign up for a free Nexmo account](https://dashboard.nexmo.com/sign-up) and set up the Nexmo CLI with the API key and secret found on the dashboard.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">nexmo setup &lt;your_api_key&gt; &lt;your_api_secret&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff72716501285-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff72716501285-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff72716501285-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">setup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your_api_key</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">your_api_secret</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff72716501285-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n### Git (Optional)\n\nYou can use git to clone the [demo application](https://github.com/nexmo-community/infinite-scrolling-pagination) from GitHub.\n\n> For those uncomfortable with git commands, don’t worry, I’ve you covered. This guide contains instructions on downloading the project as a ZIP file.\n\nFollow this [guide to install git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git).\n\n## Getting Started\n\nBased on the finished app from the last tutorial, there is a new starting demo application. Clone and install it by following these steps.\n\n### Get the Demo App\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">git clone https://github.com/nexmo-community/infinite-scrolling-pagination.git</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff73843627250-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff73843627250-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff73843627250-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/nexmo-community/infinite-scrolling-pagination.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff73843627250-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nFor those not comfortable with git commands, you can [download the demo application as a zip file](https://github.com/nexmo-community/infinite-scrolling-pagination/archive/master.zip) and unpack it locally.\n\nOnce cloned or unpacked, change into the new demo application directory.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">cd infinite-scrolling-pagination</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff74240736713-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff74240736713-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff74240736713-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">infinite</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">scrolling</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">pagination</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff74240736713-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nInstall the npm dependencies.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm install</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff75117325844-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff75117325844-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff75117325844-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff75117325844-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nConfigure the application port using an environment file. Copy the example file:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">cp .env.example .env</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff77594508890-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff77594508890-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff77594508890-1\"><span class=\"crayon-i\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">example</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">env</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff77594508890-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow, edit the environment file `.env` and set the port to 3000 (or whichever port you require).\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\"># app config PORT=3000</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff78336337910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff78336337910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff78336337910-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff78336337910-1\"><span class=\"crayon-p\"># app config</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff78336337910-2\"><span class=\"crayon-v\">PORT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3000</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff78336337910-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nAmong other packages installed by your last command, there is a package called `nodemon`, that allows you to reload your application if you edit any files automatically.\n\nTo start the application in the standard way, run:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm start</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff79488819294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff79488819294-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff79488819294-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-i\">start</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff79488819294-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nTo start the application, but with nodemon instead, run:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm run dev</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7a061814391-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff7a061814391-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7a061814391-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">run </span><span class=\"crayon-i\">dev</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff7a061814391-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n> **_Tip:_** If you’re running the application with `nodemon` for the remainder of this tutorial, whenever I suggest restarting the application, you won’t need to do that because `nodemon` does it for you. However, if you need to reauthenticate with the application, you will still need to do that, as the session information is stored in memory and not configured to use any other storage.\n\n### Configure The Demo App\n\nTo connect to Nexmo, and send or receive messages from the service, you need to configure the demo application.\n\n#### Create a Nexmo Application\n\nFirstly, create a Nexmo Application with RTC (real-time communication) capabilities. The event URL will be a live log of events happening on the Nexmo service, like users joining/leaving, sending messages, enabling audio (if you felt like enabling it).\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">nexmo app:create \"Nexmo RTC Chat\" --capabilities=rtc --rtc-event-url=http://example.com --keyfile=private.key # Application created: 4556dbae-bf...f6e33350d8 # Credentials written to .nexmo-app # Private Key saved to: private.key</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7b248351980-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff7b248351980-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7b248351980-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff7b248351980-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7b248351980-5\">5</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7b248351980-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Nexmo RTC Chat\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">capabilities</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">rtc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">rtc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">event</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//example.com --keyfile=private.key</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff7b248351980-2\"><span class=\"crayon-p\"># Application created: 4556dbae-bf...f6e33350d8</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7b248351980-3\"><span class=\"crayon-p\"># Credentials written to .nexmo-app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff7b248351980-4\"><span class=\"crayon-p\"># Private Key saved to: private.key</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7b248351980-5\">&nbsp;</div></div></td></tr></tbody></table>\n\n#### Create a Nexmo Conversation\n\nSecondly, create a Nexmo Conversation, which acts like a chatroom. Or, a container for messages and events.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">nexmo conversation:create display_name=\"Infinite Scrolling\" # Conversation created: CON-a57b0...11e57f56d</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7d585134453-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff7d585134453-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7d585134453-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7d585134453-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">conversation</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">create </span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Infinite Scrolling\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff7d585134453-2\"><span class=\"crayon-p\"># Conversation created: CON-a57b0...11e57f56d</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7d585134453-3\">&nbsp;</div></div></td></tr></tbody></table>\n\n#### Create Your User\n\nNow, create a user for yourself.\n\n> **_Note:_** In this demo, you won’t chat between two users. Other guides show you how to create conversations between multiple users. This guide focusses on styling your message UI in a simple, yet appealing, way.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">nexmo user:create name=&lt;USER_NAME&gt; display_name=&lt;DISPLAY_NAME&gt; # User created: USR-6eaa4...e36b8a47f</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7e584689648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff7e584689648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7e584689648-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7e584689648-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">create </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">USER_NAME</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">display_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">DISPLAY_NAME</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff7e584689648-2\"><span class=\"crayon-p\"># User created: USR-6eaa4...e36b8a47f</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7e584689648-3\">&nbsp;</div></div></td></tr></tbody></table>\n\n#### Add the User to a Conversation\n\nNext, add your new user to the conversation. A user can be a member of an application, but they still need to join the conversation.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">nexmo member:add &lt;CONVERSATION_ID&gt; action=join channel='{\"type\":\"app\"}' user_id=&lt;USER_ID&gt; # Member added: MEM-df772...1ad7fa06</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7f238750108-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff7f238750108-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff7f238750108-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7f238750108-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">member</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">add</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">CONVERSATION_ID</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">join </span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'{\"type\":\"app\"}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">USER_ID</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff7f238750108-2\"><span class=\"crayon-p\"># Member added: MEM-df772...1ad7fa06</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff7f238750108-3\">&nbsp;</div></div></td></tr></tbody></table>\n\n#### Generate a User Token\n\nLastly, generate your new user a token. This token represents the user when accessing the application. This access token identifies them, so anyone using it will be assumed to be the correct user.\n\nIn practice, you’ll configure the application with this token. In production, these should be guarded, kept secret and very carefully exposed to the client application, if at all.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">nexmo jwt:generate ./private.key sub=&lt;USER_NAME&gt; exp=$(($(date +%s)+86400)) acl='{\"paths\":{\"/*/users/**\":{},\"/*/conversations/**\":{},\"/*/sessions/**\":{},\"/*/devices/**\":{},\"/*/image/**\":{},\"/*/media/**\":{},\"/*/applications/**\":{},\"/*/push/**\":{},\"/*/knocking/**\":{}}}' application_id=&lt;APPLICATION_ID&gt; # eyJhbGciOi...XVCJ9.eyJpYXQiOjE1NzM5M...In0.qn7J6...efWBpemaCDC7HtqA</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff80062948482-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff80062948482-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff80062948482-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff80062948482-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">generate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-m\">private</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">sub</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">USER_NAME</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exp</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">86400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">acl</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'{\"paths\":{\"/*/users/**\":{},\"/*/conversations/**\":{},\"/*/sessions/**\":{},\"/*/devices/**\":{},\"/*/image/**\":{},\"/*/media/**\":{},\"/*/applications/**\":{},\"/*/push/**\":{},\"/*/knocking/**\":{}}}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">application_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">APPLICATION_ID</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff80062948482-2\"><span class=\"crayon-p\"># eyJhbGciOi...XVCJ9.eyJpYXQiOjE1NzM5M...In0.qn7J6...efWBpemaCDC7HtqA</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff80062948482-3\">&nbsp;</div></div></td></tr></tbody></table>\n\n#### Configure the Application\n\nHaving generated all the parts you’ll need, edit the `views/layout.hbs` file and find the JavaScript shown here.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;script&gt; var userName = ''; var displayName = ''; var conversationId = ''; var clientToken = ''; &lt;/script&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff82755825881-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff82755825881-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff82755825881-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff82755825881-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff82755825881-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff82755825881-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff82755825881-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff82755825881-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff82755825881-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">userName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff82755825881-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">displayName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff82755825881-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">conversationId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff82755825881-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">clientToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff82755825881-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff82755825881-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nEdit the config with the values you’ve generated in the commands above.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;script&gt; var userName = 'luke'; // &lt;USER_NAME&gt; var displayName = 'Luke Oliff'; // &lt;DISPLAY_NAME&gt; var conversationId = 'CON-123...y6346'; // &lt;CONVERSATION_ID&gt; var clientToken = 'eyJhbG9.eyJzdWIiO.Sfl5c'; // this will be much much longer &lt;/script&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff83678907160-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff83678907160-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff83678907160-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff83678907160-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff83678907160-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff83678907160-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff83678907160-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff83678907160-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff83678907160-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">userName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'luke'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// &lt;USER_NAME&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff83678907160-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">displayName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Luke Oliff'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// &lt;DISPLAY_NAME&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff83678907160-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">conversationId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'CON-123...y6346'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// &lt;CONVERSATION_ID&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff83678907160-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">clientToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'eyJhbG9.eyJzdWIiO.Sfl5c'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// this will be much much longer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff83678907160-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff83678907160-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow configured, start the application and access it using the [default application URL](http://localhost:3000).\n\n> **_Note:_** This is only a demo and you should not be hard coding credentials into any application, especially one that exposes them to the client.\n\n![Nexmo Chat Simple Messaging UI](https://www.nexmo.com/wp-content/uploads/2020/02/nexmo-chat-simple-messaging-ui.png)\n\n#### Prepare a Message History\n\nBecause you need more messages to scroll through, create some message history by sending multiple messages to the client. The default page size is 20 items, so create more than 20 messages. I recommend creating 60 test messages so you can load 2 whole pages of history.\n\n## Adding Pagination to the App\n\nThe default settings for the application only returns 20 items from the conversation’s past events. Now, it’s time to add pagination to the application so users can load older events.\n\n### What Is Pagination?\n\nPagination, or paging, is how an application divides the content into multiple pages. When implemented in an APIs design, it allows for the delivery of manageable collections of results, that can usually be navigated programmatically. SDKs like the Nexmo Conversation Client SDK are no different, often extending the APIs pagination functionality into friendly methods that make pagination more straightforward.\n\n### The User Experience\n\nSome applications offer links like ‘next’ or ‘previous’, or page numbers. But that isn’t what you’ll implement here. As the messages in a chat channel are a continuous stream of conversation, this app will allow users to just keep scrolling through historical messages. This is done using a concept known as infinite scrolling. As you scroll through older messages and get to the end, the app will request the next page of history and slot them in. In older channels with a lot of history, this will give the feeling of being able to scroll forever or infinite scrolling.\n\n## The Code\n\nNow, you’re going to write some code. Here, you’ll make changes to detect the scroll position of your message list, and load more messages when you reach the oldest message. The oldest message will be shown at the very top of the window.\n\n### Scrolling to the Top\n\nTo detect when you scroll to the top, you need to add a new event. Edit the `public/javascripts/chat.js` file and add the following code under the `setupUserEvents()` method.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... setupUserEvents() { // ... this.messageFeed.addEventListener(\"scroll\", () =&gt; { alert('scrolling!'); } } // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff84073379577-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff84073379577-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff84073379577-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff84073379577-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff84073379577-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff84073379577-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff84073379577-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff84073379577-15\">15</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff84073379577-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff84073379577-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">setupUserEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff84073379577-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff84073379577-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addEventListener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"scroll\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff84073379577-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">alert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'scrolling!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff84073379577-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-13\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff84073379577-14\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff84073379577-15\">&nbsp;</div></div></td></tr></tbody></table>\n\nYou can test this in the browser, where you’ll quickly discover why it’s not very helpful. This code adds an event listener to the `messageFeed` element, meaning that every time you try to scroll it triggers a pop-up. Not what you want!\n\nSo, change it slightly. Add the following code above the `setupUserEvents()` method and modify your new event listener as shown.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... isFeedAtTop() { return 0 === this.messageFeed.scrollTop; } setupUserEvents() { // ... this.messageFeed.addEventListener(\"scroll\", () =&gt; { if (this.isFeedAtTop()) { alert('scrolling!'); } } } // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff85288262720-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff85288262720-21\">21</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">isFeedAtTop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollTop</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">setupUserEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addEventListener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"scroll\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isFeedAtTop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">alert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'scrolling!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-19\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff85288262720-20\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff85288262720-21\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis new change creates a new method that detects where the scroll position of the `messageFeed` is at `0`, zero, or the very start at the top of the message history. More useful! Now, you know when someone reaches the oldest message at the top of the message list.\n\n![Nexmo Chat Alert When Scrolling to the Top](https://www.nexmo.com/wp-content/uploads/2020/04/nexmo-chat-alert-scrolling-to-top.png)\n\n### Who Are You\n\nTo attribute new messages to a user when they’re loaded from the conversation history, you should store. Editing the `public/javascripts/chat.js` file, add the following line after the line `this.conversation = conversation;`.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... setupConversationEvents(conversation, user) { // ... this.user = user; // ... } // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff86821562421-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff86821562421-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff86821562421-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff86821562421-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff86821562421-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff86821562421-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff86821562421-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff86821562421-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff86821562421-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff86821562421-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff86821562421-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff86821562421-12\">12</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff86821562421-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff86821562421-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff86821562421-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff86821562421-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff86821562421-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">setupConversationEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff86821562421-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff86821562421-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff86821562421-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff86821562421-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff86821562421-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff86821562421-11\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff86821562421-12\">&nbsp;</div></div></td></tr></tbody></table>\n\n### Store the Page Context\n\nTo load more messages from the message history, you need to know what page was last loaded. To do this, still editing the `public/javascripts/chat.js` file, change the existing `showConversationHistory` as shown below to store the most recent event page on the application.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... showConversationHistory(conversation, user) { // ... .then((eventsPage) =&gt; { this.lastPage = eventsPage; var eventsHistory = \"\"; // ... } // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff87086331604-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff87086331604-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff87086331604-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff87086331604-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff87086331604-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff87086331604-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff87086331604-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff87086331604-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff87086331604-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff87086331604-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff87086331604-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff87086331604-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff87086331604-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff87086331604-14\">14</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff87086331604-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff87086331604-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff87086331604-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff87086331604-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff87086331604-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">showConversationHistory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff87086331604-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff87086331604-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">then</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff87086331604-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lastPage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff87086331604-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsHistory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff87086331604-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff87086331604-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff87086331604-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff87086331604-13\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff87086331604-14\">&nbsp;</div></div></td></tr></tbody></table>\n\nIf it’s not clear how the `showConversationHistory` method should look after the change, here is the entire method with the change applied.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... showConversationHistory(conversation, user) { conversation .getEvents({ page_size: 20, order: 'desc' }) .then((eventsPage) =&gt; { this.lastPage = eventsPage; var eventsHistory = \"\"; eventsPage.items.forEach((value, key) =&gt; { if (conversation.members.get(value.from)) { switch (value.type) { case 'text': eventsHistory = this.senderMessage(user, conversation.members.get(value.from), value) + eventsHistory; break; case 'member:joined': eventsHistory = this.memberJoined(conversation.members.get(value.from), value) + eventsHistory; break; } } }); this.messageFeed.innerHTML = eventsHistory + this.messageFeed.innerHTML; this.scrollFeedToBottom(); }) .catch(this.errorLogger); } // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff89227659559-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff89227659559-33\">33</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">showConversationHistory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">conversation</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page_size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">order</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'desc'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">then</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lastPage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsHistory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">eventsHistory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">senderMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsHistory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'member:joined'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">eventsHistory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memberJoined</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsHistory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-24\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsHistory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scrollFeedToBottom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">catch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">errorLogger</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff89227659559-32\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff89227659559-33\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe idea of this method is to store the [`EventsPage`](https://developer.nexmo.com/sdk/stitch/javascript/EventsPage.html) returned from calling [`getEvents`](https://developer.nexmo.com/sdk/stitch/javascript/Conversation.html#getEvents__anchor), so that the app can use it again later on.\n\nWith this change in place, the application is now aware of the most recent page.\n\n### Avoid Unnecessary Requests\n\nOne method on the `EventsPage` object is [`hasNext`](https://developer.nexmo.com/sdk/stitch/javascript/EventsPage.html#hasNext__anchor), which returns true if there are more events to load.\n\nWith the `hasNext` method, edit the scrolling event you added earlier to add `this.lastPage.hasNext()` to the condition around our `alert`.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... setupUserEvents() { // ... this.messageFeed.addEventListener(\"scroll\", () =&gt; { if (this.isFeedAtTop() &amp;&amp; this.lastPage.hasNext()) { alert('scrolling!'); } } } // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8a457504050-17\">17</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">setupUserEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addEventListener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"scroll\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isFeedAtTop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lastPage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hasNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">alert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'scrolling!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8a457504050-16\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8a457504050-17\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow, you’ll only get an alert if there is another page of events to load.\n\n### Load the Next Page\n\nTo load the next page, replace the `alert` in your event listener with the code shown below:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... this.lastPage .getNext() .then((eventsPage) =&gt; { this.lastPage = eventsPage; var moreEvents = \"\"; eventsPage.items.forEach((value, key) =&gt; { if (this.conversation.members.get(value.from)) { switch (value.type) { case 'text': moreEvents = this.senderMessage(this.user, this.conversation.members.get(value.from), value) + moreEvents; break; case 'member:joined': moreEvents = this.memberJoined(this.conversation.members.get(value.from), value) + moreEvents; break; } } }); this.messageFeed.innerHTML = moreEvents + this.messageFeed.innerHTML; }) .catch(this.errorLogger); // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8b602745782-29\">29</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">lastPage</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">then</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lastPage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">senderMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'member:joined'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memberJoined</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-23\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">catch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">errorLogger</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-27\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8b602745782-28\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8b602745782-29\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis code uses `this.lastPage` that was stored on the application earlier in the article, and requests `getNext` which returns a new [`EventsPage`](https://developer.nexmo.com/sdk/stitch/javascript/EventsPage.html).\n\nThe rest of the code seen here overwrites `this.LastPage` with the latest page, and performs near-enough the same function of the `showConversationHistory` method that renders historical messages when the page is loaded, adding them to the top of the `messageFeed`.\n\n### Fix the Scroll Position\n\nWith infinite scrolling in place, you’ll notice that new messages get added to the top, but you’re still looking at the top of the `messageFeed`, losing the position of where you were in the channel’s message history. To fix this, you’re going to reuse the `scrollTo` method already found inside the `public/javascripts/chat.js` file.\n\nPreviously, `scrollTo` was used to scroll to the bottom of the messages, which is achieved by any number larger than the height of the `messageFeed`. This team, you need to scroll to a specific point on the `messageFeed`.\n\nIf the position was when the application loaded new messages was `0` at the top, then it would make sense to scroll to the difference between the height before and after the `messageFeed` was updated.\n\nInside the condition that checks scroll position and `hasNext`, but before the `the.lastPage.getNext()` code is ran, add the code to store the `scrollHeight`, as shown here:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... if (this.isFeedAtTop() &amp;&amp; this.lastPage.hasNext()) { this.scrollHeight = this.messageFeed.scrollHeight; // ... // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8c655169468-9\">9</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8c655169468-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8c655169468-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8c655169468-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8c655169468-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isFeedAtTop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lastPage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hasNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8c655169468-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8c655169468-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8c655169468-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8c655169468-8\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8c655169468-9\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow, in this same function, after the line that updates the `messageFeed.innerHTML` with `moreEvents`, add this line too:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... // ... this.scrollTo(this.messageFeed.scrollHeight-this.scrollHeight); // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8e245787362-8\">8</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8e245787362-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8e245787362-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8e245787362-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8e245787362-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8e245787362-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8e245787362-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scrollTo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-o\">-</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8e245787362-7\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8e245787362-8\">&nbsp;</div></div></td></tr></tbody></table>\n\nIf it’s not clear how the `\"scroll\"` event listener should look after the change, here is the code in its entirety:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// public/javascripts/chat.js // ... // ... this.messageFeed.addEventListener(\"scroll\", () =&gt; { if (this.isFeedAtTop() &amp;&amp; this.lastPage.hasNext()) { this.scrollHeight = this.messageFeed.scrollHeight; this.lastPage .getNext() .then((eventsPage) =&gt; { this.lastPage = eventsPage; var moreEvents = \"\"; eventsPage.items.forEach((value, key) =&gt; { if (this.conversation.members.get(value.from)) { switch (value.type) { case 'text': moreEvents = this.senderMessage(this.user, this.conversation.members.get(value.from), value) + moreEvents; break; case 'member:joined': moreEvents = this.memberJoined(this.conversation.members.get(value.from), value) + moreEvents; break; } } }); this.messageFeed.innerHTML = moreEvents + this.messageFeed.innerHTML; this.scrollTo(this.messageFeed.scrollHeight-this.scrollHeight); }) .catch(this.errorLogger); } }); // ...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1bdff8f946779738-39\">39</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-1\"><span class=\"crayon-c\">// public/javascripts/chat.js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-3\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addEventListener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"scroll\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isFeedAtTop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lastPage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hasNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">lastPage</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">then</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lastPage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">eventsPage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">senderMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'member:joined'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memberJoined</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conversation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">members</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-29\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">moreEvents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scrollTo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messageFeed</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-o\">-</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scrollHeight</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">catch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">errorLogger</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-37\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1bdff8f946779738-38\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1bdff8f946779738-39\">&nbsp;</div></div></td></tr></tbody></table>\n\nWith any luck, when you try it out, you’ll discover messages will seemingly load above your scroll position, allowing you to scroll ‘to infinity’, or the top.\n\n![Nexmo Chat Infinite Scrolling to the Top](https://www.nexmo.com/wp-content/uploads/2020/02/nexmo-chat-infinite-scrolling-to-the-top.png)\n\n## The End\n\nThis article followed on from the previous post [Create a Simple Messaging UI with Bootstrap](https://www.nexmo.com/blog/2019/12/18/create-a-simple-messaging-ui-with-bootstrap-dr), showing you how to load older messages as you scroll through the message history.\n\nDon’t forget, if you have any questions, feedback, advice, or ideas you’d like to share with the broader community, then please feel free to jump on our [Community Slack](https://developer.nexmo.com/community/slack) workspace or pop a reply below 👇."}