{"_filedata":{"slug":"real-time-sms-demo-with-react-node-and-google-translate-dr"},"title":"Real-time SMS Demo with React, Node, and Google Translate","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/E_SMS-Translations_1200x600.png","author":295,"published":true,"published_at":"2020-03-11T13:02:01","tags":[1701,793,92,616],"body":"Last year I worked with the [Google Translate API](https://www.nexmo.com/blog/2019/10/24/extending-nexmo-google-cloud-translation-api-dr) to translate SMS messages. After showing the rest of the team, they wanted a demo they could show off to other developers at conferences we attended. Based on that, I set out to create a frontend with React that could display the translations in real-time.\n\n## Building the WebSocket\n\n### What’s a WebSocket?\n\nFor this demo, I decided that using a WebSocket would be a great solution. If you haven’t used a WebSocket before, it’s a protocol that allows a client and server to communicate in real-time. WebSockets are bi-directional, meaning the client and server can both send and receive messages. When you first connect to a WebSocket, the connection is made by upgrading an HTTP protocol to the WebSocket protocol and is kept alive as long as it goes uninterrupted. Once established, it provides a continuous stream of content. Exactly what we need to receive incoming, translated SMS messages.\n\n### Create the WebSocket Server in Node\n\nAs an initial step to creating the WebSockets, the server requires a path to allow for client connections. Starting with the original server file from my [previous post](https://github.com/nexmo-community/sms-google-translate-js), we can make a few minor changes to create the WebSocket server and the events and listeners required by the client.\n\nUsing the [`ws`](https://github.com/websockets/ws) package on NPM, we can quickly create what we need to get this working.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm install ws</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da1781573486-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da1781573486-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da1781573486-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">ws</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da1781573486-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nOnce installed, include the package in your server file, and create the WebSocket server. `WS` allows a `path` option to set the route the client uses to connect.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const express = require('express'); const WebSocket = require('ws'); const app = express(); const server = http.createServer(app); const wss = new WebSocket.Server({ server, path: \"/socket\" });</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da5558340855-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da5558340855-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da5558340855-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da5558340855-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da5558340855-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da5558340855-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da5558340855-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da5558340855-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'express'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da5558340855-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WebSocket</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'ws'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da5558340855-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da5558340855-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">express</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da5558340855-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da5558340855-6\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WebSocket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Server</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/socket\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da5558340855-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nWith this bit of code, the client now has a place to connect to the WebSocket route `/socket`. With the server ready to go, you need to now listen for a `connection` event. When the client connects, the server uses the following to set up the other listeners we need:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">wss.on('connection', (ws) =&gt; { ws.isAlive = true; ws.translateTo = 'en'; ws.on('pong', () =&gt; { ws.isAlive = true; }); ws.on('message', (message) =&gt; { translateTo = message; }); });</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da6268794807-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da6268794807-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da6268794807-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da6268794807-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da6268794807-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da6268794807-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da6268794807-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da6268794807-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da6268794807-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da6268794807-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da6268794807-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da6268794807-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da6268794807-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da6268794807-14\">14</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da6268794807-1\"><span class=\"crayon-v\">wss</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'connection'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da6268794807-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da6268794807-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translateTo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'en'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da6268794807-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da6268794807-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'pong'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da6268794807-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da6268794807-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da6268794807-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da6268794807-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da6268794807-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">translateTo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da6268794807-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da6268794807-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da6268794807-13\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da6268794807-14\">&nbsp;</div></div></td></tr></tbody></table>\n\nThere are two main points to call out:\n\n1.  On connection, we set the property `isAlive` to `true`, and listen for the `pong` event. This event is for the server to check and maintain a connection with the client. The server sends a `ping` and responds with `pong` to verify it’s still a live connection.\n    \n2.  Here I set up `translateTo` as a property to store. `translateTo` is set through each client using a dropdown. When someone using our booth demo app selects a different language, that action sets this to translate the SMS texts into the requested language.\n    \n\n### Keeping the Connection Alive\n\nOne essential item to be concerned with is checking for clients that disconnect. It’s possible that during the disconnection process, the server may not be aware, and problems may occur. With a good friend `setInterval()`, we can check if our clients are still there and reconnect them if needed.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">setInterval(() =&gt; { wss.clients.forEach((ws) =&gt; { if (!ws.isAlive) return ws.terminate(); ws.isAlive = false; ws.ping(null, false, true); }); }, 10000);</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da7563244796-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da7563244796-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da7563244796-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da7563244796-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da7563244796-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da7563244796-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da7563244796-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da7563244796-8\">8</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da7563244796-1\"><span class=\"crayon-e\">setInterval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da7563244796-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">wss</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da7563244796-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">terminate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da7563244796-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da7563244796-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da7563244796-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da7563244796-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da7563244796-8\">&nbsp;</div></div></td></tr></tbody></table>\n\n### Sending Messages to the Client\n\nNow that the WebSocket is connected and monitored, we can handle the inbound messages from Nexmo, the translation, and the response to the client. The method `handleRoute` needs to be updated from its original state to add the response for each client.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const handleRoute = (req, res) =&gt; { let params = req.body; if (req.method === \"GET\") { params = req.query } if (!params.to || !params.msisdn) { res.status(400).send({ 'error': 'This is not a valid inbound SMS message!' }); } else { wss.clients.forEach(async (client) =&gt; { let translation = await translateText(params, client.translateTo); let response = { from: obfuscateNumber(req.body.msisdn), translation: translation.translatedText, originalLanguage: translation.detectedSourceLanguage, originalMessage: params.text, translatedTo: client.translateTo } client.send(JSON.stringify(response)); }); res.status(200).end(); } };</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73da9117660081-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73da9117660081-29\">29</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handleRoute</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"GET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">query</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'error'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'This is not a valid inbound SMS message!'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">wss</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">translation</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">translateText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translateTo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">obfuscateNumber</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">translation</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">translation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translatedText</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">originalLanguage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">translation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">detectedSourceLanguage</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">originalMessage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">translatedTo</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">translateTo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stringify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-24\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-27\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73da9117660081-28\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73da9117660081-29\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe `wss.clients.forEach` method iterates through each connection, and sends off the SMS parameters from Nexmo to the Google Translate API. Once the translation comes back, we can decide what data the front-end should have, and pass it back as a string as I’ve done here with `client.send(JSON.stringify(response))`.\n\nTo recap what has happened here: Each client connects to the WebSocket server by calling the `/socket` route and establishing a connection. An SMS message goes from the sender’s phone to Nexmo, which then calls the `/inboundSMS` route. The app passes the text message to Google Translate API for each connected client, and then finally sends it back to the client UI.\n\n![Diagram of WebSocket Flow](https://www.nexmo.com/wp-content/uploads/2020/03/flow-diagram.png \"Diagram of WebSocket Flow\")\n\nNext, let’s build the UI parts to display it on the screen.\n\n## WebSockets with React\n\nWith the WebSocket server running, we can move on to the display of the messages on screen. Since I enjoy using [React](https://reactjs.org/), and more importantly, [React Hooks](https://reactjs.org/docs/hooks-intro.html), I set out to locate something to help with connecting to WebSockets. Sure enough, I found one that fit my exact need.\n\nThe demo app UI is built with [`create-react-app`](https://github.com/facebook/create-react-app), and I used the [Grommet](https://v2.grommet.io/) framework. These topics are out of scope for this post, but you can grab my [source code](https://github.com/nexmo-community/sms-translation-demo-app) and follow along.\n\n### Connecting to the WebSocket\n\nThe first step here is to establish a connection and begin two-way communication. The module I found is [`react-use-websocket`](https://github.com/robtaussig/react-use-websocket), and it made setting this up super simple.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm install react-use-websocket</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daa436620367-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daa436620367-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daa436620367-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">react</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">use</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">websocket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daa436620367-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThere are tons of these React hook libraries out there that help you create some impressive functionality in a short amount of time. In this instance, importing the module and setting up a couple of items for the configuration is all it took to get a connection.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">import useWebSocket from 'react-use-websocket'; const App = () =&gt; { const STATIC_OPTIONS = useMemo(() =&gt; ({ shouldReconnect: (closeEvent) =&gt; true, }), []); const protocolPrefix = window.location.protocol === 'https:' ? 'wss:' : 'ws:'; let { host } = window.location; const [sendMessage, lastMessage, readyState] = useWebSocket(`${protocolPrefix}//${host}/socket`, STATIC_OPTIONS); //... }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dab836177143-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dab836177143-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dab836177143-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dab836177143-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dab836177143-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dab836177143-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dab836177143-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dab836177143-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dab836177143-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dab836177143-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dab836177143-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dab836177143-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dab836177143-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dab836177143-14\">14</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dab836177143-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">useWebSocket </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'react-use-websocket'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dab836177143-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dab836177143-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dab836177143-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">STATIC_OPTIONS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">useMemo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dab836177143-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">shouldReconnect</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">closeEvent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dab836177143-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dab836177143-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dab836177143-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">protocolPrefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'wss:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ws:'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dab836177143-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dab836177143-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sendMessage</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">readyState</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">useWebSocket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">protocolPrefix</span><span class=\"crayon-sy\">}</span><span class=\"crayon-c\">//${host}/socket`, STATIC_OPTIONS);</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dab836177143-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dab836177143-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dab836177143-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dab836177143-14\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the component, we import the `useWebSocket` method to pass the WebSocket URL and the object `STATIC_OPTIONS` as the second argument. The `useWebSocket` method is a custom hook that returns the `sendMessage` method, `lastMessage` object from the server (which is our translated messages), and the `readyState` which is an integer to give us the status of the connection.\n\n### Receiving Incoming Messages\n\nOnce `react-use-websocket` makes the connection to the server, we can now start listening for messages from the `lastMessage` property. When receiving incoming messages from the server, they populate here and update the component. If your server has multiple message types, you discern that information here. Since we only have one, it’s an easier implementation.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const [messageHistory, setMessageHistory] = useState([]); useEffect(() =&gt; { if (lastMessage !== null) { setMessageHistory(prev =&gt; prev.concat(lastMessage)) } }, [lastMessage]); return ( &lt;Main&gt; {messageHistory.map((message, idx) =&gt; { let msg = JSON.parse(message.data); return ( &lt;Box&gt; &lt;Text&gt;From: {msg.from}&lt;/Text&gt; &lt;Heading level={2}&gt;{msg.translation}&lt;/Heading&gt; &lt;/Box&gt; ) })} &lt;/Main&gt; )</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dac799279102-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dac799279102-22\">22</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">messageHistory</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">setMessageHistory</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">useState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-3\"><span class=\"crayon-e\">useEffect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">setMessageHistory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prev</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">concat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-9\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Main</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">messageHistory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Box</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Text</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">From</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Text</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Heading </span><span class=\"crayon-v\">level</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translation</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Heading</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Box</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Main</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dac799279102-21\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dac799279102-22\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe built-in hook `useEffect` runs every time the state is updated. When `lastMessage` is not null, it adds the new message to the end of the previous message state array, and the UI updates using the `map` function to render all of the messages. It is in the `messageHistory` where all of the JSON strings we passed from the server are stored. The main functionality of our WebSocket is complete, but I still want to add a few more items.\n\n### Sending Messages to the Server\n\nSince this is a translation demo, having more than one language is an excellent way to show the power of the Google Translate API in conjunction with Nexmo SMS messages. I created a dropdown with languages to pick. This dropdown is where bi-directional communication happens with the server, and the app sends the selected language from the client.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const languages = [ { label: \"English\", value: \"en\"}, { label: \"French\", value: \"fr\"}, { label: \"German\", value: \"de\"}, { label: \"Spanish\", value: \"es\"} ]; &lt;Select labelKey=\"label\" onChange={({ option }) =&gt; { sendMessage(option.value) setTranslateValue(option.label) }} options={languages} value={translateValue} valueKey=\"value\" /&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73dae162504989-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73dae162504989-18\">18</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">languages</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"English\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"en\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"French\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"fr\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"German\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"de\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Spanish\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"es\"</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-6\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Select</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-9\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">labelKey</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"label\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">onChange</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">option</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">sendMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">setTranslateValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">options</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">languages</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">translateValue</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">valueKey</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"value\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73dae162504989-17\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73dae162504989-18\">&nbsp;</div></div></td></tr></tbody></table>\n\nHere, the `sendMessage` function from `react-use-websocket` is how we can send information back to our server and consume it. This process is where the event handler we set up comes in handy from earlier. It is this dropdown that determines what language the Google Translate API translates the message into and displays on the screen.\n\n### Connection Status Display\n\nSince this is a demo in a conference environment, I thought having a connectivity indicator would be a good idea. As long as the front-end remains connected to the WebSocket, the light displays green.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const CONNECTION_STATUS_CONNECTING = 0; const CONNECTION_STATUS_OPEN = 1; const CONNECTION_STATUS_CLOSING = 2; function Status({ status }) { switch (status) { case CONNECTION_STATUS_OPEN: return &lt;&gt;Connected&lt;div className=\"led green\"&gt;&lt;/div&gt;&lt;/&gt;; case CONNECTION_STATUS_CONNECTING: return &lt;&gt;Connecting&lt;div className=\"led yellow\"&gt;&lt;/div&gt;&lt;/&gt;; case CONNECTION_STATUS_CLOSING: return &lt;&gt;Closing&lt;div className=\"led yellow\"&gt;&lt;/div&gt;&lt;/&gt;; default: return &lt;&gt;Disconnected&lt;div className=\"led grey\"&gt;&lt;/div&gt;&lt;/&gt;;; } } //.... &lt;Status status={readyState} /&gt; //...</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73daf345792493-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73daf345792493-21\">21</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CONNECTING</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_OPEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CLOSING</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-5\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_OPEN</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Connected</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led green\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CONNECTING</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Connecting</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led yellow\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CLOSING</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Closing</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led yellow\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">default</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Disconnected</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led grey\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-18\"><span class=\"crayon-c\">//....</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-19\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Status </span><span class=\"crayon-v\">status</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">readyState</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73daf345792493-20\"><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73daf345792493-21\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe `Status` component uses the `readyState` to switch between the various statuses and indicates that to the user. If it turns red, you know something is wrong with the WebSocket server, and you should check into it.\n\nOnce everything is up and running, it looks something like this:\n\n![Animation of Working Demo App](https://www.nexmo.com/wp-content/uploads/2020/03/using_translation_app.gif \"Animation of Working Demo App\")\n\n## Try It Out\n\nThe [demo application code](https://github.com/nexmo-community/sms-translation-demo-app) is on our community GitHub organization, and you can try it out for yourself as well. I’ve created a README that should help you get through the setup and run it locally on your server or deploy it to Heroku. I’ve also provided a Dockerfile, if you’d prefer to go that route. Let me know what you think of it, and if you have any trouble, feel free to reach out and submit an issue on the repo."}