{"_filedata":{"slug":"deploying-an-aws-lambda-function-for-nexmo-voice-callbacks-with-php-dr"},"title":"Deploying an AWS Lambda Function for Vonage Voice Callbacks With PHP","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/E_Vonage-Voice-Callbacks_1200x600.png","author":340,"published":true,"published_at":"2020-04-02T12:12:27","tags":[499,416,161],"body":"<p>Deploying a complete and web-accessible application to AWS Lambda presents a unique set of requirements and hurdles. Among these are execution and permissions settings. In this post, I&#8217;ll build upon a few previous posts, bringing them together as a practical example.</p>\n<p>This post uses a sample callback application from <a href=\"https://www.nexmo.com/blog/2020/02/14/aws-transcribe-with-nexmo-voice-using-php-dr\">&#8220;AWS Transcribe with Nexmo Voice Using PHP&#8221;</a>. It also leverages <a href=\"https://www.nexmo.com/blog/2020/03/16/aws-lambda-with-php-using-bref-and-serverless-framework-dr\">&#8220;AWS Lambda with PHP Using Bref and Serverless Framework&#8221;</a>. I also apply the permissions model shown in <a href=\"https://www.nexmo.com/blog/2020/03/25/how-permissions-work-in-aws-lambda-dr\">&#8220;How Permissions Work In AWS Lambda&#8221;</a> for <a href=\"https://aws.amazon.com/s3/\">AWS S3</a> and <a href=\"https://aws.amazon.com/transcribe/\">Amazon Transcribe</a>. Together these pieces allow you to create your own <a href=\"https://aws.amazon.com/lambda/\">AWS Lambda</a> function, creating a transcription microservice to be used in your applications.</p>\n<p>Note: You won&#8217;t need to go through the three posts mentioned above to follow along with this one. I thoroughly cover everything you need to know below.</p>\n<h3>Prerequisites</h3>\n<p>In this example the following are needed:</p>\n<ul>\n<li>PHP installed locally (version 7.3 preferred)</li>\n<li><a href=\"https://getcomposer.org/doc/00-intro.md#globally\">Composer installed globally</a></li>\n<li>A local clone of the <a href=\"https://github.com/nexmo-community/voice-aws-speechtotext-php\">nexmo-community/voice-aws-speechtotext-php</a> repo on Github</li>\n<li><a href=\"https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&amp;utm_medium=github&amp;utm_campaign=https%3A%2F%2Fgithub.com%2Fnexmo-community%2Fvoice-aws-speechtotext-php\">Nexmo account</a></li>\n<li><a href=\"https://github.com/Nexmo/nexmo-cli\">Nexmo CLI tool</a></li>\n<li><a href=\"https://aws.amazon.com/\">AWS account</a></li>\n<li><a href=\"https://serverless.com/framework/docs/getting-started/\">Serverless Framework</a> installed globally. (more on this later)</li>\n</ul>\n<h3>AWS Setup</h3>\n<p>You&#8217;ll need an AWS account, as well as <a href=\"https://aws.amazon.com/iam/\">IAM credentials</a> associated with a user who has sufficient privileges. That permission ensures Serverless can create the Lambda function and assign permissions as needed.</p>\n<h4>Create an S3 Bucket</h4>\n<p>Create an S3 Bucket to store the voice recording MP3 files retrieved from Nexmo. Amazon Transcribe can then easily access the files for transcription later.</p>\n<p>After creating it, make sure to check the box beside the bucket name. A panel opens from the right, so you can click the button &#8220;Copy Bucket ARN&#8221; and save it for later usage.</p>\n<h4>Creating an IAM User</h4>\n<p>Select the IAM Management Console from the Services panel:</p>\n<p><img src=\"/wp-content/uploads/2020/02/select_iam_management.png\" alt=\"Select IAM Management Console\" title=\"Select IAM Management Console\" /></p>\n<p>From the IAM Management Console, add a new IAM user by clicking the blue Add User button:</p>\n<p><img src=\"/wp-content/uploads/2020/02/aws_new_iam_user.png\" alt=\"AWS new IAM user\" title=\"Add a new IAM user\" /></p>\n<p>Below is a JSON snippet to assign the permissions needed for the new user.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a77850599271\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"VisualEditor0\",\n            \"Effect\": \"Allow\",\n            \"Action\": \"*\",\n            \"Resource\": \"*\"\n        }\n    ]\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a77850599271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a77850599271-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a77850599271-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a77850599271-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a77850599271-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a77850599271-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a77850599271-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a77850599271-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a77850599271-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a77850599271-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a77850599271-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a77850599271-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a77850599271-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a77850599271-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"Version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2012-10-17\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a77850599271-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"Statement\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a77850599271-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a77850599271-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"Sid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"VisualEditor0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a77850599271-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"Effect\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Allow\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a77850599271-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"Action\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a77850599271-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"Resource\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a77850599271-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a77850599271-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a77850599271-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a77850599271-12\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<h3>Serverless Framework</h3>\n<p>The <a href=\"https://bref.sh/\">Bref</a> tool leverages the <a href=\"https://serverless.com\">Serverless Framework</a> foundation, which is a &#8220;complete solution for building and operating serverless applications.&#8221; Thus, our first step is to get this framework installed on the development system you&#8217;re using. I recommend installing it globally, to allow usage from anywhere via CLI.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a7a371682165\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install -g serverless\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7a371682165-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7a371682165-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7a371682165-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">serverless</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7a371682165-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h4>AWS Credentials</h4>\n<p>With Serverless installed, ensure you&#8217;ve also set up the AWS credentials above as an admin, for Serverless to interact with the various AWS services. You can read more about this at <a href=\"https://serverless.com/framework/docs/providers/aws/guide/credentials/#using-aws-access-keys\">serverless.com</a> and <a href=\"https://bref.sh/docs/installation/aws-keys.html\">bref.sh</a> so that we won&#8217;t go into the details here.</p>\n<h3>Application Preparation</h3>\n<p>Next, we prepare the application using Composer to retrieve dependencies. A small edit is required in the code to work correctly with the Lambda URLs.</p>\n<h4>Composer</h4>\n<p>Preparing the application takes a couple of steps before doing the Composer install. We need to require Bref to perform the Serverless functionalities. Type the following in your terminal after navigating to the project directory containing the code.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a7b141222562\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ncomposer install\ncomposer require bref/bref\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7b141222562-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7b141222562-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7b141222562-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7b141222562-1\"><span class=\"crayon-e\">composer </span><span class=\"crayon-e\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7b141222562-2\"><span class=\"crayon-e\">composer </span><span class=\"crayon-e\">require </span><span class=\"crayon-v\">bref</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">bref</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7b141222562-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The first command installs the dependencies of the application. Then, the second command adds Bref along with dependencies needed for it. Alternatively, you could edit the <code>composer.json</code> file to require Bref and only run the <code>install</code> command.</p>\n<h4>Bref Init</h4>\n<p>Typically, for a new application, you would command Bref to <code>init</code>, and create <code>serverless.yml</code> and <code>index.php</code>. However, in this case, you should simply create a file named <code>serverless.yml</code> in the root directory as follows:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a7c125965695\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nservice: app\n\nprovider:\n    name: aws\n    region: us-east-1\n    runtime: provided\n    iamRoleStatements:\n        - Effect: Allow\n          Action:\n              - s3:PutObject\n              - s3:GetObject\n              - s3:DeleteObject\n          Resource: 'arn:aws:s3:::{{bucket-name}}/*'\n        - Effect: Allow\n          Action: transcribe:*\n          Resource: '*'\n\nplugins:\n    - ./vendor/bref/bref\n\nfunctions:\n    api:\n        handler: index.php\n        description: ''\n        timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds)\n        layers:\n            - ${bref:layer.php-73-fpm}\n        events:\n            -   http: 'ANY /'\n            -   http: 'ANY /{proxy+}'\n\n# Exclude files from deployment\npackage:\n    exclude:\n        - 'node_modules/**'\n        - 'tests/**'\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7c125965695-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-1\"><span class=\"crayon-v\">service</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-3\"><span class=\"crayon-v\">provider</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aws</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-5\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">region</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">us</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">east</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">runtime</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">provided</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-7\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">iamRoleStatements</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Effect</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Allow</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-9\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Action</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s3</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">PutObject</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s3</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">GetObject</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s3</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">DeleteObject</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-13\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Resource</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'arn:aws:s3:::{{bucket-name}}/*'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Effect</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Allow</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-15\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Action</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transcribe</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Resource</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-18\"><span class=\"crayon-v\">plugins</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vendor</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bref</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">bref</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-21\"><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">api</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">handler</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-24\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">description</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># in seconds (API Gateway has a timeout of 29 seconds)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">layers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">bref</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">layer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">73</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fpm</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">events</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ANY /'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ANY /{proxy+}'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-32\"><span class=\"crayon-p\"># Exclude files from deployment</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-33\"><span class=\"crayon-t\">package</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">exclude</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'node_modules/**'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7c125965695-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tests/**'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7c125965695-37\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>Note: You should update the AWS region and replace {{bucket-name}} to match your needs.</p>\n<p>Also, notice that <code>iamRoleStatements</code> is setting permissions for the Lambda to use AWS S3 as well as Amazon Transcribe. See the post <a href=\"https://www.nexmo.com/blog/2020/03/25/how-permissions-work-in-aws-lambda-dr\">&#8220;How Permissions Work in AWS Lambda&#8221;</a>, mentioned above, for more details.</p>\n<h4>Environment Variables</h4>\n<p>As a part of the preparation, rename the <code>.env.default</code> file to become <code>.env</code>, and update as needed to suit your AWS and Nexmo account information. Though you can safely ignore <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>, because those are automatically added to the environment by Lambda.</p>\n<p>You will also not be able to populate the <code>NEXMO_APPLICATION_PRIVATE_KEY_PATH</code> and <code>NEXMO_APPLICATION_ID</code> values until AFTER you deploy to Lambda, causing the need to deploy to Lambda twice. The first time to provide you with the URLs needed to create the Nexmo Application. Then, the second deployment contains an updated <code>.env</code> file with the Nexmo values. That&#8217;s all covered later.</p>\n<h4>Event URLs</h4>\n<p>Because of the difference in how Lambda handles the URI, you will also need to edit the <code>index.php</code> file in the application. Specifically, you will need to alter the <code>eventUrl</code> on lines 33 and 47. The end result will look like the following, respectively:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a7e427663658\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n// Line 33\n'https://'.$uri-&gt;getHost().'/dev/webhooks/fetch'\n// Line 47\n'https://'.$uri-&gt;getHost().'/dev/webhooks/transcribe'\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7e427663658-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7e427663658-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7e427663658-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7e427663658-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7e427663658-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7e427663658-1\"><span class=\"crayon-c\">// Line 33</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7e427663658-2\"><span class=\"crayon-s\">'https://'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">uri</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getHost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'/dev/webhooks/fetch'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7e427663658-3\"><span class=\"crayon-c\">// Line 47</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7e427663658-4\"><span class=\"crayon-s\">'https://'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">uri</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getHost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'/dev/webhooks/transcribe'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7e427663658-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The update is caused by the <code>$request</code> not showing with <code>https</code>, and Lambda also includes the environment in the API Gateway URLs.</p>\n<h3>Deploying</h3>\n<p>Will all the steps above completed, you are now ready to deploy the application to Lambda using Serverless. In your terminal, issue the following command:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a7f948924239\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nserverless deploy\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a7f948924239-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a7f948924239-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a7f948924239-1\"><span class=\"crayon-e\">serverless </span><span class=\"crayon-i\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a7f948924239-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>After deployment, you receive the URL needed to access the application via the API Gateway. Make a note of the URL for the next step.</p>\n<h3>Nexmo Setup</h3>\n<p>Unfortunately, in the case of deploying AWS Lambda applications, you did not know the URL until after deployment. However, you still need to create the Application at Nexmo to gain the <code>NEXMO_APPLICATION_PRIVATE_KEY_PATH</code> and <code>NEXMO_APPLICATION_ID</code> for the application to function.</p>\n<p>Using the Nexmo CLI, installed as a prerequisite, enter the following command:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a80186422033\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo app:create &lt;name&gt; &lt;answer_url&gt;/webhooks/answer &lt;event_url&gt;/webhooks/event\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a80186422033-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a80186422033-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a80186422033-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">answer_url</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">webhooks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">event_url</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">webhooks</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">event</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a80186422033-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>As an example, the command might look like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a82119267113\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo app:create MyTranscripeApp https://asdrferwef.execute-api.us-east-1.amazonaws.com/dev/webhooks/answer https://asdrferwef.execute-api.us-east-1.amazonaws.com/dev/webhooks/event\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a82119267113-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a82119267113-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a82119267113-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">create </span><span class=\"crayon-e\">MyTranscripeApp </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//asdrferwef.execute-api.us-east-1.amazonaws.com/dev/webhooks/answer https://asdrferwef.execute-api.us-east-1.amazonaws.com/dev/webhooks/event</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a82119267113-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The response from the command provides the <code>Application ID</code> and the <code>Private Key</code>, to be used in the following steps.</p>\n<h4>Update Private Key</h4>\n<p>Rename the file <code>private.key.default</code> to <code>private.key</code> and save the <code>Private Key</code> into the file.</p>\n<h4>Update .env</h4>\n<p>Update the <code>.env</code> file with the values for <code>NEXMO_APPLICATION_PRIVATE_KEY_PATH</code> and <code>NEXMO_APPLICATION_ID</code>. It will look something like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a83739260041\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nNEXMO_APPLICATION_PRIVATE_KEY_PATH=./private.key\nNEXMO_APPLICATION_ID=2735sd6ed1asd-29cf4-4858f-bd90sd-7135a8cf122bas\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a83739260041-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a83739260041-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a83739260041-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a83739260041-1\"><span class=\"crayon-v\">NEXMO_APPLICATION_PRIVATE_KEY_PATH</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-m\">private</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">key</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a83739260041-2\"><span class=\"crayon-v\">NEXMO_APPLICATION_ID</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2735sd6ed1asd</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">29cf4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4858f</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bd90sd</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7135a8cf122bas</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a83739260041-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h4>Number Association</h4>\n<p>The last step to prepare Nexmo is to associate the rented Nexmo number with the newly created application. Use the following command for this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a84575485366\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo link:app &lt;number&gt; &lt;app_id&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a84575485366-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a84575485366-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a84575485366-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">link</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">app_id</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a84575485366-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Make sure to update the variables above with your Nexmo number and the <code>app_id</code> given with the Application creation. Ensure you prepend the country code, to prevent failure. Here is an example:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a85504381445\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnexmo link:app +15558675309 2735sd6ed1asd-29cf4-4858f-bd90sd-7135a8cf122bas\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a85504381445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a85504381445-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a85504381445-1\"><span class=\"crayon-e\">nexmo </span><span class=\"crayon-v\">link</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">15558675309</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2735sd6ed1asd</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">29cf4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4858f</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bd90sd</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7135a8cf122bas</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a85504381445-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h4>More Details</h4>\n<p>Creating the Nexmo application, and associating the number, instructs Nexmo to make callbacks when events happen, and you want those callbacks to point to the newly created app.</p>\n<p>The Event URL is for when an event changes the status of a call, while the Answer URL is requested for any inbound calls to retrieve an NCCO object (<a href=\"https://developer.nexmo.com/voice/voice-api/ncco-reference\">Nexmo Call Control Object</a>).</p>\n<p>Now we are finished with the Nexmo setup. Time to redeploy to Lambda with the following command:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb90a86222360146\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nserverless deploy\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb90a86222360146-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb90a86222360146-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb90a86222360146-1\"><span class=\"crayon-e\">serverless </span><span class=\"crayon-i\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb90a86222360146-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>After a couple of minutes, the updated application will be redeployed to Lambda. Though the contents of the application will have changed, the URL remains constant.</p>\n<h3>Testing</h3>\n<p>Now it is time to make a test call to your Nexmo number. After calling, the automated voice should say, &#8220;Please leave a message after the tone, then press #&#8221;. unless you changed that message in <code>index.php</code>. Then, after you leave a short voice message and hit <code>#</code>, the automated voice should say, &#8220;Thank you for your message. Goodbye.&#8221;</p>\n<p>To confirm everything worked as expected, you should be able to see the MP3 file in the S3 bucket you specified. There should also be a transcription job running at Amazon Transcribe. All of that is accessible through the AWS Console.</p>\n<p>Congrats! You&#8217;ve built your first Lambda!</p>\n<h3>Next Steps</h3>\n<p>There are many possible next steps, depending on your needs. One possible solution may be to create an AWS Cloudwatch event to be alerted when a Transcribe job is &#8220;Complete&#8221;. The event could call another Lambda function to email the transcription, or add the transcription to a database. Bottom line is, you now have a text version of the voice message left by a caller. If you have any questions, or run into troubles, you can reach out to <a href=\"https://twitter.com/vonagedev\">@VonageDev</a> on Twitter or inquire in the <a href=\"http://nexmo-community.slack.com\">Vonage Developer Community</a> Slack team.</p>\n<p>Good luck.</p>\n"}