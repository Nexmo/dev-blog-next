{"_filedata":{"slug":"adaptive-library-logging-with-microsoft-extensions-logging-dr"},"title":"Adaptive Library Logging with Microsoft.Extensions.Logging","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/02/E_Love-the-Log_1200x600.png","author":349,"published":true,"published_at":"2020-02-10T13:47:01","tags":[385,1676,1677],"body":"<h2>How I Learned to Stop Worrying and Love to Log</h2>\n<p>In my career, I&#8217;ve worked on a few different medium to large scale .NET projects. With each project I saw a different type of logger, and typically all of them used more than one logger!</p>\n<p>Usually, the story goes something like this: &#8220;In the early days we couldn&#8217;t decide which logger we wanted to use, so we built our own. Then we realized the way we&#8217;d implemented the logging was not the most efficient, so we switched over to X logger as the app scaled. We didn&#8217;t want to go back and remove the old logger because that would involve us touching every file in our solution, so we just removed it from the places where the old logger was causing problems, and from now on we&#8217;re just going to be using X logger for everything.&#8221;</p>\n<p>As I said, this is a surprisingly common problem—and one we can sidestep by abstracting the logger from the logging.</p>\n<h2>Logging In the Nexmo .NET Library</h2>\n<p>Recently I&#8217;ve been taking a look at Nexmo&#8217;s <a href=\"https://github.com/Nexmo/nexmo-dotnet\">.NET Server SDK</a> and have been cleaning some things up. Whilst doing this I noticed is that our logging framework <a href=\"https://github.com/damianh/LibLog\">LibLog</a> has been deprecated.</p>\n<p>This tool was great, as it abstracted the logger from the operation of logging. It allowed anyone developing against our SDK to bring their own logger. So long as your logger was supported, you could have the SDK&#8217;s logger piggyback on your logger of choice without any intervention (which realistically could be a pro or con depending on how you look at it).</p>\n<p>Because of LibLog&#8217;s deprecation, I was forced to look elsewhere for a logging tool to meet our needs. Fortunately, I didn&#8217;t need to look far.</p>\n<h2>Moving Forward With Microsoft.Extensions.Logging</h2>\n<p>The (relatively) new <a href=\"https://www.nuget.org/packages/Microsoft.Extensions.Logging/\">Microsoft.Extensions.Logging</a> package hit the nail on the head with functionality. With the extension package, you can simply install the NuGet package, along with whatever logging framework you&#8217;ve chosen to use, set up a factory, and create the logger.</p>\n<p>This suits our use case as we don&#8217;t necessarily want our logs to automatically piggyback onto and interleave into our users&#8217; logs—and at the same time we don&#8217;t want to dictate to our users exactly where, how, and with what framework the logs will be captured.</p>\n<p>So now with our next major version release, 5.0.0, you will be able to activate whatever level or category you want within the SDK dynamically by simply swapping out the Logger Factory in the SDK.</p>\n<h2>Building Loggers with Microsoft.Extensions.Logging</h2>\n<h3>Build the Log Provider</h3>\n<p>Two components underpin Microsoft.Extensions.Logging: ILoggerFactory and ILogger. The factory generates the loggers and the logger does the logging.</p>\n<p>These two components are used in the LogProvider class to allow us to create a fully dynamic, extensible logger for the library, allowing the developer to bring their own logger.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd05c17e474227354\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\npublic static class LogProvider\n{\n    private static IDictionary&lt;string, ILogger&gt; _loggers = new Dictionary&lt;string, ILogger&gt;();\n    private static ILoggerFactory _loggerFactory = new LoggerFactory();\n\n    public static void SetLogFactory(ILoggerFactory factory)\n    {\n        _loggerFactory?.Dispose();\n        _loggerFactory = factory;\n        _loggers.Clear();\n    }\n\n    public static ILogger GetLogger(string category)\n    {\n        if (!_loggers.ContainsKey(category))\n        {\n            _loggers[category] = _loggerFactory?.CreateLogger(category)?? NullLogger.Instance;\n        }\n        return _loggers[category];\n    }\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c17e474227354-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c17e474227354-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LogProvider</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IDictionary</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ILogger</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_loggers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dictionary</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ILogger</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ILoggerFactory </span><span class=\"crayon-v\">_loggerFactory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoggerFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SetLogFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">ILoggerFactory </span><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_loggerFactory</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Dispose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_loggerFactory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_loggers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ILogger </span><span class=\"crayon-e\">GetLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">category</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">_loggers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ContainsKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">category</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_loggers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">category</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_loggerFactory</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CreateLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">category</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NullLogger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_loggers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">category</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c17e474227354-21\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c17e474227354-22\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>In our model, we create a static class called LogProvider with two fields: _loggers, a dictionary containing the logger for each category, and _loggerFactory, which builds the loggers.</p>\n<p>There are also two methods: SetLogFactory, which disposes of the old LogFactory and sets the log factory to the new log factory passed in, and GetLogger, which checks the _loggers to see if that category&#8217;s logger has been created, and creates one if it hasn&#8217;t.</p>\n<h3>Using the Log Provider</h3>\n<p>Now on the onset of any method that we want to log from we simply have to call GetLogger with the appropriate category:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd05c182244161460\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar logger = Api.Logger.LogProvider.GetLogger(LOGGER_CATEGORY);\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c182244161460-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c182244161460-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c182244161460-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Api</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">LogProvider</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GetLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LOGGER_CATEGORY</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c182244161460-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h3>Logging</h3>\n<p>From here we simply need to use the logger as any other logger we&#8217;ve seen before. For example:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd05c183990163501\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nlogger.LogInformation(\"Available authentication: {0}\", string.Join(\",\", authCapabilities));\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c183990163501-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c183990163501-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c183990163501-1\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">LogInformation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Available authentication: {0}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">authCapabilities</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c183990163501-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>This will log as information the available authentication capabilities in whatever format you&#8217;ve provided to your logger.</p>\n<h2>Configuring adaptive loggers</h2>\n<p>Now that we&#8217;ve covered creating and utilizing the loggers, let&#8217;s look at actually configuring them to do what we&#8217;d like.</p>\n<h3>Select your log provider</h3>\n<p>One of the cool things about Microsoft.Extensions.Logging is that it&#8217;s agonistic to the log provider that you use. So long as the log provider implements the <code>ILogProvider</code> interface it can be whatever it likes. And from the perspective of the developer trying to leverage it, it&#8217;s even simpler. Most of the major third party log providers you&#8217;re likely to use (e.g. Log4Net, Serilog, NLog, etc.) have Extension packages that make adding the desired logger simple.</p>\n<h3>Logging to Console with Serilog</h3>\n<p>To demonstrate how we can build these loggers, let&#8217;s take the example of logging out the Console with Serilog. To do this you will create a need the following NuGet packages:</p>\n<ul>\n<li>Microsoft.Extensions.Logging</li>\n<li>Serilog.Extensions.Logging</li>\n<li>Serilog.Sinks.Console</li>\n</ul>\n<p>You will then do the following:</p>\n<ul>\n<li>Create a new LoggerFactory which will be what we use to create</li>\n<li>Create a new LoggerConfiguration which will set the Serilog configuration</li>\n<li>Call the AddSerilog function on the factory</li>\n<li>Create a logger of category &#8216;test&#8217;</li>\n<li>Log away</li>\n</ul>\n<p>Chained together this looks like:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd05c184619277977\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar log = new LoggerConfiguration()\n    .MinimumLevel.Debug()\n    .WriteTo.Console(outputTemplate: \"{Timestamp:HH:mm} [{Level}] ({Name:l}) {Message}\\n\")\n    .CreateLogger();\nvar factory = new LoggerFactory();\nfactory.AddSerilog(log);\nILogger logger = factory.CreateLogger(\"test\");\nlogger.LogInformation(\"Hello world\");\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c184619277977-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c184619277977-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c184619277977-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c184619277977-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c184619277977-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c184619277977-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c184619277977-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c184619277977-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c184619277977-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c184619277977-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoggerConfiguration</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c184619277977-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MinimumLevel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c184619277977-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">WriteTo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Console</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">outputTemplate</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"{Timestamp:HH:mm} [{Level}] ({Name:l}) {Message}\\n\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c184619277977-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CreateLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c184619277977-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">factory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoggerFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c184619277977-6\"><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AddSerilog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c184619277977-7\"><span class=\"crayon-e\">ILogger </span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CreateLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"test\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c184619277977-8\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">LogInformation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Hello world\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c184619277977-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Very clean and simple.</p>\n<p>Now to interact with the Nexmo SDK, instead of creating a logger after configuring the factory, simply set the LogFactory in the Log Provider to the log factory you created and added Serilog to, and you&#8217;ll see the logging come through from the SDK.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd05c186811494732\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar log = new LoggerConfiguration()\n    .MinimumLevel.Debug()\n    .WriteTo.Console(outputTemplate: \"{Timestamp:HH:mm} [{Level}] ({Name:l}) {Message}\\n\")\n    .CreateLogger();\nvar factory = new LoggerFactory();\nfactory.AddSerilog(log);\nLogProvider.SetLogFactory(factory);\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c186811494732-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c186811494732-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c186811494732-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c186811494732-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c186811494732-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c186811494732-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05c186811494732-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05c186811494732-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c186811494732-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoggerConfiguration</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c186811494732-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MinimumLevel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c186811494732-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">WriteTo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Console</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">outputTemplate</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"{Timestamp:HH:mm} [{Level}] ({Name:l}) {Message}\\n\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c186811494732-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CreateLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c186811494732-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">factory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LoggerFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c186811494732-6\"><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AddSerilog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05c186811494732-7\"><span class=\"crayon-v\">LogProvider</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SetLogFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05c186811494732-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Et Voila—our own highly configurable library logger.</p>\n<h2>Benefits</h2>\n<p>Microsoft.Extensions.Logging allows us to avoid the nightmare scenario of starting a project using one logger and needing to, for whatever reason, switch to another.</p>\n<p>If you want to use your logger you&#8217;re still free to, even while using the Logging Extensions. All you need to do is implement the ILogProvider interface with whatever logger you want to use and add it to the factory.</p>\n"}