{"_filedata":{"slug":"using-jwt-for-authentication-in-a-golang-application-dr"},"title":"Using JWT for Authentication in a Golang Application","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/E_JWT_Golang-Application_1200x600.jpg","author":366,"published":true,"published_at":"2020-03-13T13:00:25","tags":[23,1601,1710,1306],"body":"<p><a href=\"https://developer.nexmo.com/spotlight\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://www.nexmo.com/wp-content/uploads/2019/08/blog-spotlight-banner.png\" alt=\"blog spotlight banner \" width=\"810\" height=\"150\" class=\"alignnone size-full wp-image-29837\" /></a></p>\n<h2>Introduction</h2>\n<p>A JSON Web Token (JWT) is a compact and self-contained way for securely transmitting information between parties as a JSON object, and they are commonly used by developers in their APIs. JWTs are popular because:</p>\n<ol>\n<li>A JWT is stateless. That is, it does not need to be stored in a database (persistence layer), unlike opaque tokens. </li>\n<li>The signature of a JWT is never decoded once formed, thereby ensuring that the token is safe and secure.</li>\n<li>A JWT can be set to be invalid after a certain period of time. This helps minimize or totally eliminate any damage that can be done by a hacker, in the event that the token is hijacked.</li>\n</ol>\n<p>In this tutorial, I will demonstrate the creation, use, and invalidation of a JWT with a simple RESTful API using Golang and the Nexmo Messages API.</p>\n<h3>What Makes Up a JWT?</h3>\n<p>A JWT is comprised of three parts:</p>\n<ul>\n<li>Header: the type of token and the signing algorithm used.<br />\nThe type of token can be “JWT” while the Signing Algorithm can either be HMAC or SHA256.</li>\n<li>Payload: the second part of the token which contains the claims. These claims include application specific data(e.g, user id, username), token expiration time(exp), issuer(iss), subject(sub), and so on.</li>\n<li>Signature: the encoded header, encoded payload, and a secret you provide are used to create the signature.</li>\n</ul>\n<p>Let’s use a simple token to understand the above concepts.</p>\n<p>Token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdXRoX3V1aWQiOiIxZGQ5MDEwYy00MzI4LTRmZjMtYjllNi05NDRkODQ4ZTkzNzUiLCJhdXRob3JpemVkIjp0cnVlLCJ1c2VyX2lkIjo3fQ.Qy8l-9GUFsXQm4jqgswAYTAX9F4cngrl28WJVYNDwtM</p>\n<p>Don’t worry, the token is invalid, so it won’t work on any production application.</p>\n<p>You can navigate to <a href=\"https://jwt.io\">jwt.to</a> and test the token signature if it is verified or not. Use “HS512” as the algorithm. You will get the message “Signature Verified”:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image9.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image9.png\" alt=\"\" width=\"1211\" height=\"829\" class=\"alignnone size-full wp-image-31629\" /></a></p>\n<p>To make the signature, your application will need to provide a <strong>key</strong>. This key enables the signature to remain secure—even when the JWT is decoded the signature remains encrypted. It is highly recommended to always use a secret when creating a JWT.</p>\n<h3>Token Types</h3>\n<p>Since a JWT can be set to expire (be invalidated) after a particular period of time, two tokens will be considered in this application:</p>\n<ul>\n<li>Access Token: An access token is used for requests that require authentication. It is normally added in the header of the request. It is recommended that an access token have a short lifespan, say 15 minutes. Giving an access token a short time span can prevent any serious damage if a user’s token is tampered with, in the event that the token is hijacked. The hacker only has 15 minutes or less to carry out his operations before the token is invalidated.</li>\n<li>Refresh Token: A refresh token has a longer lifespan, usually 7 days. This token is used to generate new access and refresh tokens. In the event that the access token expires, new sets of access and refresh tokens are created when the refresh token route is hit (from our application).</li>\n</ul>\n<h3>Where to Store a JWT</h3>\n<p>For a production grade application, it is highly recommended to store JWTs in an <code>HttpOnly</code> cookie. To achieve this, while sending the cookie generated from the backend to the frontend (client), a <code>HttpOnly</code> flag is sent along the cookie, instructing the browser not to display the cookie through the client-side scripts. Doing this can prevent XSS (Cross Site Scripting) attacks.<br />\nJWT can also be stored in browser local storage or session storage. Storing a JWT this way can expose it to several attacks such as XSS mentioned above, so it is generally less secure when compared to using `HttpOnly cookie technique.</p>\n<h2>The Application</h2>\n<p>We will consider a simple <strong>todo</strong> restful API.</p>\n<p>Create a directory called <code>jwt-todo</code>, then initialize <code>go.mod</code> for dependency management. <code>go.mod</code> is initialized using:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad72772184399\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ngo mod init jwt-todo\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad72772184399-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad72772184399-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad72772184399-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">mod </span><span class=\"crayon-e\">init </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">todo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad72772184399-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Now, create a <code>main.go</code> file inside the root directory(<code>/jwt-todo</code>), and add this to it:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad75552347995\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\npackage main\n\nfunc main() {}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad75552347995-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad75552347995-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad75552347995-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad75552347995-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad75552347995-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad75552347995-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad75552347995-3\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad75552347995-4\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>We will use <a href=\"https://github.com/gin-gonic\">gin</a> for routing and handling HTTP requests. The Gin Framework helps to reduce boilerplate code and is very efficient in building scalable APIs.</p>\n<p>You can install gin, if you have not already, using:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad76450290042\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ngo get github.com/gin-gonic\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad76450290042-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad76450290042-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad76450290042-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gin</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">gonic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad76450290042-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Then update the <code>main.go</code> file:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad77503898925\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\npackage main\n\nImport (\n    \"github.com/gin-gonic/gin\"\n)\n\nvar (\n  router = gin.Default()\n)\n\nfunc main() {\n  router.POST(\"/login\", Login)\n  log.Fatal(router.Run(\":8080\"))\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad77503898925-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad77503898925-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-3\"><span class=\"crayon-e\">Import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad77503898925-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/gin-gonic/gin\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-5\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad77503898925-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-7\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad77503898925-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">Default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-9\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad77503898925-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-11\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad77503898925-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad77503898925-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad77503898925-15\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>In an ideal situation, the <code>/login</code> route takes a user’s credentials, checks them against some database, and  logs them in if the credentials are valid. But in this API, we will just use a sample user we will define in memory. Create a sample user in a struct. Add this to the <code>main.go</code> file:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad78831874555\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ntype User struct {\nID uint64            `json:\"id\"`\n    Username string `json:\"username\"`\n    Password string `json:\"password\"`\n}\n//A sample use\nvar user = User{\n    ID:             1,\n    Username: \"username\",\n    Password: \"password\",\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad78831874555-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad78831874555-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad78831874555-2\"><span class=\"crayon-e\">ID </span><span class=\"crayon-i\">uint64</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad78831874555-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">Username </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad78831874555-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">Password </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad78831874555-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad78831874555-6\"><span class=\"crayon-c\">//A sample use</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad78831874555-7\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad78831874555-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad78831874555-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Username</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad78831874555-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Password</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad78831874555-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad78831874555-12\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<h3>Login Request</h3>\n<p>When a user&#8217;s details have been verified, they are logged in and a JWT is generated on their behalf. We will achieve this in the <code>Login()</code> function defined below:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad7a468718551\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc Login(c *gin.Context) {\n  var u User\n  if err := c.ShouldBindJSON(&amp;u); err != nil {\n     c.JSON(http.StatusUnprocessableEntity, \"Invalid json provided\")\n     return\n  }\n  //compare the user from the request, with the one we defined:\n  if user.Username != u.Username || user.Password != u.Password {\n     c.JSON(http.StatusUnauthorized, \"Please provide valid login details\")\n     return\n  }\n  token, err := CreateToken(user.ID)\n  if err != nil {\n     c.JSON(http.StatusUnprocessableEntity, err.Error())\n     return\n  }\n  c.JSON(http.StatusOK, token)\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7a468718551-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Invalid json provided\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//compare the user from the request, with the one we defined:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Please provide valid login details\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7a468718551-18\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7a468718551-19\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>We received the user’s request, then unmarshalled it into the <code>User</code> struct. We then compared the input user with the one we defined we defined in memory. If we were using a database, we would have compared it with a record in the database.</p>\n<p>So as not to make the <code>Login</code> function bloated, the logic to generate a JWT is handled by <code>CreateToken</code>. Observe that the user id is passed to this function. It is used as a <strong>claim</strong> when generating the JWT.</p>\n<p>The <code>CreateToken</code> function makes use of the  <code>dgrijalva/jwt-go</code> package, we can install this using:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad7b888136371\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ngo get github.com/dgrijalva/jwt-go\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7b888136371-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7b888136371-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7b888136371-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dgrijalva</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">go</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7b888136371-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Let’s define the <code>CreateToken</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad7c946530824\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc CreateToken(userid uint64) (string, error) {\n  var err error\n  //Creating Access Token\n  os.Setenv(\"ACCESS_SECRET\", \"jdnfksdmfksd\") //this should be in an env file\n  atClaims := jwt.MapClaims{}\n  atClaims[\"authorized\"] = true\n  atClaims[\"user_id\"] = userid\n  atClaims[\"exp\"] = time.Now().Add(time.Minute * 15).Unix()\n  at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims)\n  token, err := at.SignedString([]byte(os.Getenv(\"ACCESS_SECRET\")))\n  if err != nil {\n     return \"\", err\n  }\n  return token, nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7c946530824-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userid </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">err </span><span class=\"crayon-v\">error</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Access Token</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"jdnfksdmfksd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"authorized\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-8\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Minute *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7c946530824-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7c946530824-16\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>We set the token to be valid only for 15 minutes, after which, it is invalid and cannot be used for any authenticated request. Also observe that we signed the JWT using  a <strong>secret</strong>(<code>ACCESS_SECRET</code>) obtained from our environmental variable. It is highly recommended that this secret is not exposed in your codebase, but rather called from the environment just like we did above. You can save it in a <code>.env</code>, <code>.yml</code> or whatever works for you.</p>\n<p>Thus far, our <code>main.go</code> file looks like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad7d807426920\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\npackage main\n\nimport (\n  \"github.com/dgrijalva/jwt-go\"\n  \"github.com/gin-gonic/gin\"\n  \"log\"\n  \"net/http\"\n  \"os\"\n  \"time\"\n)\n\nvar (\n  router = gin.Default()\n)\n\nfunc main() {\n  router.POST(\"/login\", Login)\n  log.Fatal(router.Run(\":8080\"))\n}\ntype User struct {\n  ID uint64            `json:\"id\"`\n  Username string `json:\"username\"`\n  Password string `json:\"password\"`\n  Phone string `json:\"phone\"`\n}\nvar user = User{\n  ID:            1,\n  Username: \"username\",\n  Password: \"password\",\n  Phone: \"49123454322\", //this is a random number\n}\nfunc Login(c *gin.Context) {\n  var u User\n  if err := c.ShouldBindJSON(&amp;u); err != nil {\n     c.JSON(http.StatusUnprocessableEntity, \"Invalid json provided\")\n     return\n  }\n  //compare the user from the request, with the one we defined:\n  if user.Username != u.Username || user.Password != u.Password {\n     c.JSON(http.StatusUnauthorized, \"Please provide valid login details\")\n     return\n  }\n  token, err := CreateToken(user.ID)\n  if err != nil {\n     c.JSON(http.StatusUnprocessableEntity, err.Error())\n     return\n  }\n  c.JSON(http.StatusOK, token)\n}\nfunc CreateToken(userId uint64) (string, error) {\n  var err error\n  //Creating Access Token\n  os.Setenv(\"ACCESS_SECRET\", \"jdnfksdmfksd\") //this should be in an env file\n  atClaims := jwt.MapClaims{}\n  atClaims[\"authorized\"] = true\n  atClaims[\"user_id\"] = userId\n  atClaims[\"exp\"] = time.Now().Add(time.Minute * 15).Unix()\n  at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims)\n  token, err := at.SignedString([]byte(os.Getenv(\"ACCESS_SECRET\")))\n  if err != nil {\n     return \"\", err\n  }\n  return token, nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7d807426920-65\">65</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/dgrijalva/jwt-go\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/gin-gonic/gin\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"log\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"net/http\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"os\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"time\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-10\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-12\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">Default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-14\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-16\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-19\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-20\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">ID </span><span class=\"crayon-i\">uint64</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Username </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Password </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Phone </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"phone\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-25\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-26\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Username</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Password</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Phone</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"49123454322\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this is a random number</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-31\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-32\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-34\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Invalid json provided\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-38\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//compare the user from the request, with the one we defined:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-39\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Please provide valid login details\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-42\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-43\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-44\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-47\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-48\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-49\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-50\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userId </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-51\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">err </span><span class=\"crayon-v\">error</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-52\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Access Token</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-53\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"jdnfksdmfksd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-54\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-55\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"authorized\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-56\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userId</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-57\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Minute *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-58\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-59\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-60\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-61\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-62\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-63\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7d807426920-64\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7d807426920-65\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<p>We can now run the application:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad7e710631636\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ngo run main.go\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad7e710631636-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad7e710631636-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad7e710631636-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">go</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad7e710631636-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>Now we can try it out and see what we get! Fire up your favorite API tool and hit the <code>login</code>endpoint:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image8.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image8.png\" alt=\"\" width=\"1999\" height=\"1145\" class=\"alignnone size-full wp-image-31628\" /></a></p>\n<p>As seen above, we have generated a JWT that will last for 15 minutes.</p>\n<h3>Implementation Loopholes</h3>\n<p>Yes we can login a user a generate a JWT, but there is a lot wrong with the above implementation:</p>\n<ol>\n<li>The JWT can only be invalidated when it expires. A major limitation to this is: a user can login, then decide to logout immediately, but the user’s JWT remains valid until the expiration time is reached. </li>\n<li>The JWT might be hijacked and used by a hacker without the user doing anything about it, until the token expires. </li>\n<li>The user will need to relogin after the token expires, thereby leading to poor user experience.</li>\n</ol>\n<p>We can address the problems stated above in two ways:</p>\n<ol>\n<li>Using a persistence storage layer to store JWT metadata. This will enable us to invalidate a JWT the very second a the user logs out, thereby improving security.</li>\n<li>Using the concept of <strong>refresh token</strong> to generate a new <strong>access token</strong>, in the event that the <strong>access token</strong> expired, thereby improving the user experience.</li>\n</ol>\n<h3>Using Redis to Store JWT Metadata</h3>\n<p>One of the solutions we proffered above is saving a JWT metadata in a persistence layer. This can be done in any persistence layer of choice, but <strong>redis</strong> is highly recommended. Since the JWTs we generate have expiry time, redis has a feature that automatically deletes data whose expiration time has reached. Redis can also handle a lot of writes and can scale horizontally.</p>\n<p>Since redis is a key-value storage, its keys need to be unique, to achieve this, we will use <code>uuid</code> as the key and use the user id as the value.</p>\n<p>So let&#8217;s install two packages to use:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad80287530048\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ngo get github.com/go-redis/redis/v7\ngo get github.com/twinj/uuid\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad80287530048-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad80287530048-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad80287530048-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad80287530048-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">go</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">v7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad80287530048-2\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">twinj</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">uuid</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad80287530048-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>We will also import those in the <code>main.go</code> file like so:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad81979482097\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nimport (\n  …\n  \"github.com/go-redis/redis/v7\"\n  \"github.com/twinj/uuid\"\n…\n)\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad81979482097-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad81979482097-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad81979482097-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad81979482097-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad81979482097-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad81979482097-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad81979482097-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad81979482097-1\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad81979482097-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span>…</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad81979482097-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/go-redis/redis/v7\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad81979482097-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/twinj/uuid\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad81979482097-5\">…</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad81979482097-6\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad81979482097-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<blockquote><p>\n  Note: It is expected that you have redis installed in your local machine. If not, you can pause and do that, before continuing.\n</p></blockquote>\n<p>Let’s now initialize redis:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad82122149484\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar  client *redis.Client\n\nfunc init() {\n  //Initializing redis\n  dsn := os.Getenv(\"REDIS_DSN\")\n  if len(dsn) == 0 {\n     dsn = \"localhost:6379\"\n  }\n  client = redis.NewClient(&amp;redis.Options{\n     Addr: dsn, //redis port\n  })\n  _, err := client.Ping().Result()\n  if err != nil {\n     panic(err)\n  }\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad82122149484-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e \">client *</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-3\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Initializing redis</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">dsn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REDIS_DSN\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dsn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">dsn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"localhost:6379\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Options</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Addr</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dsn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//redis port</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Ping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad82122149484-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad82122149484-17\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>The redis client is initialized in the <code>init()</code> function. This ensures that each time we run the <code>main.go</code> file,  redis is automatically connected.</p>\n<p>When we create a token from this point forward, we will generate a <code>uuid</code> that will be used as one of the token claims, just as we used the user id as a claim in the previous implementation.</p>\n<h3>Define the Metadata=</h3>\n<p>In our proposed solution, instead of just creating one token, we will need to create two JWTs:</p>\n<ol>\n<li>The Access Token</li>\n<li>The Refresh Token</li>\n</ol>\n<p>To achieve this, we will need to define a struct that house these tokens definitions, their expiration periods and uuids:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad83603294868\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ntype TokenDetails struct {\n  AccessToken  string\n  RefreshToken string\n  AccessUuid   string\n  RefreshUuid  string\n  AtExpires    int64\n  RtExpires    int64\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad83603294868-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad83603294868-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenDetails</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad83603294868-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">AccessToken&nbsp;&nbsp;</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad83603294868-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">RefreshToken </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad83603294868-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">AccessUuid&nbsp;&nbsp; </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad83603294868-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">RefreshUuid&nbsp;&nbsp;</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad83603294868-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">AtExpires&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">int64</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad83603294868-7\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">RtExpires&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">int64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad83603294868-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad83603294868-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The expiration period and the uuids are very handy because they will be used when saving token metadata in redis.</p>\n<p>Now, let’s update the <code>CreateToken</code> function to look like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad84317400646\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc CreateToken(userid uint64) (*TokenDetails, error) {\n  td := &amp;TokenDetails{}\n  td.AtExpires = time.Now().Add(time.Minute * 15).Unix()\n  td.AccessUuid = uuid.NewV4().String()\n\n  td.RtExpires = time.Now().Add(time.Hour * 24 * 7).Unix()\n  td.RefreshUuid = uuid.NewV4().String()\n\n  var err error\n  //Creating Access Token\n  os.Setenv(\"ACCESS_SECRET\", \"jdnfksdmfksd\") //this should be in an env file\n  atClaims := jwt.MapClaims{}\n  atClaims[\"authorized\"] = true\n  atClaims[\"access_uuid\"] = td.AccessUuid\n  atClaims[\"user_id\"] = userid\n  atClaims[\"exp\"] = td.AtExpires\n  at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims)\n  td.AccessToken, err = at.SignedString([]byte(os.Getenv(\"ACCESS_SECRET\")))\n  if err != nil {\n     return nil, err\n  }\n  //Creating Refresh Token\n  os.Setenv(\"REFRESH_SECRET\", \"mcmvmkmsdnfsdmfdsjf\") //this should be in an env file\n  rtClaims := jwt.MapClaims{}\n  rtClaims[\"refresh_uuid\"] = td.RefreshUuid\n  rtClaims[\"user_id\"] = userid\n  rtClaims[\"exp\"] = td.RtExpires\n  rt := jwt.NewWithClaims(jwt.SigningMethodHS256, rtClaims)\n  td.RefreshToken, err = rt.SignedString([]byte(os.Getenv(\"REFRESH_SECRET\")))\n  if err != nil {\n     return nil, err\n  }\n  return td, nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad84317400646-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userid </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">TokenDetails</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-e\">TokenDetails</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AtExpires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Minute *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uuid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewV4</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RtExpires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Hour *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshUuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uuid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewV4</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">err </span><span class=\"crayon-v\">error</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Access Token</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"jdnfksdmfksd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"authorized\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"access_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AccessUuid</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-15\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-16\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AtExpires</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-17\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Refresh Token</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mcmvmkmsdnfsdmfdsjf\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"refresh_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">RefreshUuid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-26\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userid</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-27\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">RtExpires</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-28\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad84317400646-34\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad84317400646-35\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<p>In the above function, the <strong>Access Token</strong> expires after 15 minutes and the <strong>Refresh Token</strong> expires after 7 days. You can also observe we added a uuid as a claim to each token.<br />\nSince the uuid is unique each time it is created, a user can create more than one token. This happens when a user is logged in on different devices. The user can also logout from any of the devices without them being logged out from all devices. How cool!</p>\n<h3>Saving JWTs metadata</h3>\n<p>Let’s now wire up the function that will be used to save the JWTs metadata:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad85746200981\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc CreateAuth(userid uint64, td *TokenDetails) error {\n    at := time.Unix(td.AtExpires, 0) //converting Unix to UTC(to Time object)\n    rt := time.Unix(td.RtExpires, 0)\n    now := time.Now()\n\n    errAccess := client.Set(td.AccessUuid, strconv.Itoa(int(userid)), at.Sub(now)).Err()\n    if errAccess != nil {\n        return errAccess\n    }\n    errRefresh := client.Set(td.RefreshUuid, strconv.Itoa(int(userid)), rt.Sub(now)).Err()\n    if errRefresh != nil {\n        return errRefresh\n    }\n    return nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad85746200981-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userid </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">td *</span><span class=\"crayon-v\">TokenDetails</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AtExpires</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//converting Unix to UTC(to Time object)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">rt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RtExpires</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">errAccess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Itoa</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Err</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">errAccess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">errAccess</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">errRefresh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Itoa</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Err</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">errRefresh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">errRefresh</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad85746200981-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad85746200981-16\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>We passed in the <code>TokenDetails</code> which have information about the expiration time of the JWTs and the uuids used when creating the JWTs. If the expiration time is reached for either the <strong>refresh token</strong> or the <strong>access token</strong>, the JWT is automatically deleted from redis.</p>\n<p>I personally use <a href=\"https://www.redily.app\">Redily</a>, a redis GUI. Is a nice tool. You can take a look below to see how JWT metadata is stored in key-value pair.</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image2.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image2.png\" alt=\"\" width=\"1030\" height=\"764\" class=\"alignnone size-full wp-image-31622\" /></a></p>\n<p>Before we test login again, we will need to call the <code>CreateAuth()</code> function in the <code>Login()</code> function. Update the Login function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad86218434904\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc Login(c *gin.Context) {\n  var u User\n  if err := c.ShouldBindJSON(&amp;u); err != nil {\n     c.JSON(http.StatusUnprocessableEntity, \"Invalid json provided\")\n     return\n  }\n  //compare the user from the request, with the one we defined:\n  if user.Username != u.Username || user.Password != u.Password {\n     c.JSON(http.StatusUnauthorized, \"Please provide valid login details\")\n     return\n  }\n  ts, err := CreateToken(user.ID)\n if err != nil {\n c.JSON(http.StatusUnprocessableEntity, err.Error())\n   return\n}\n saveErr := CreateAuth(user.ID, ts)\n  if saveErr != nil {\n     c.JSON(http.StatusUnprocessableEntity, saveErr.Error())\n  }\n  tokens := map[string]string{\n     \"access_token\":  ts.AccessToken,\n     \"refresh_token\": ts.RefreshToken,\n  }\n  c.JSON(http.StatusOK, tokens)\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad86218434904-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Invalid json provided\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//compare the user from the request, with the one we defined:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Please provide valid login details\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-15\"><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokens</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-s\">\"access_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-s\">\"refresh_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tokens</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad86218434904-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad86218434904-27\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<p>We can try logging in again. Save the <code>main.g</code>o file and run it. When the login is hit from Postman, we should have:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image3.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image3.png\" alt=\"\" width=\"1999\" height=\"1190\" class=\"alignnone size-full wp-image-31623\" /></a></p>\n<p>Excellent! We have both the <strong>access_token</strong> and the <strong>refresh_token</strong>, and also have token metadata persisted in redis.</p>\n<h3>Creating a Todo</h3>\n<p>We can now proceed to make requests that require authentication using JWT.</p>\n<p>One of the unauthenticated requests in this API is the creation of <strong>todo</strong> request.</p>\n<p>First let’s define a <code>Todo</code> struct:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad88296876200\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ntype Todo struct {\n  UserID uint64 `json:\"user_id\"`\n  Title string `json:\"title\"`\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad88296876200-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad88296876200-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad88296876200-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad88296876200-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad88296876200-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad88296876200-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Todo</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad88296876200-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">UserID </span><span class=\"crayon-i\">uint64</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad88296876200-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Title </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad88296876200-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad88296876200-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>When performing any authenticated request, we need to validate the token passed in the authentication header to see if it is valid. We need to define some helper functions that help with these.</p>\n<p>First we will need to extract the token from the request header using the <code>ExtractToken</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad89593470737\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc ExtractToken(r *http.Request) string {\n  bearToken := r.Header.Get(\"Authorization\")\n  //normally Authorization the_token_xxx\n  strArr := strings.Split(bearToken, \" \")\n  if len(strArr) == 2 {\n     return strArr[1]\n  }\n  return \"\"\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad89593470737-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad89593470737-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">ExtractToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad89593470737-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">bearToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Authorization\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad89593470737-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//normally Authorization the_token_xxx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad89593470737-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">strArr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bearToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad89593470737-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strArr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad89593470737-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad89593470737-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad89593470737-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad89593470737-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad89593470737-10\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Then we will verify the token:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad8a726220574\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc VerifyToken(r *http.Request) (*jwt.Token, error) {\n  tokenString := ExtractToken(r)\n  token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {\n     //Make sure that the token method conform to \"SigningMethodHMAC\"\n     if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {\n        return nil, fmt.Errorf(\"unexpected signing method: %v\", token.Header[\"alg\"])\n     }\n     return []byte(os.Getenv(\"ACCESS_SECRET\")), nil\n  })\n  if err != nil {\n     return nil, err\n  }\n  return token, nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8a726220574-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">VerifyToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8a726220574-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokenString</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tokenString</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">token *</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">interface</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8a726220574-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">//Make sure that the token method conform to \"SigningMethodHMAC\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHMAC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8a726220574-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Errorf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unexpected signing method: %v\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"alg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8a726220574-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8a726220574-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8a726220574-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8a726220574-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8a726220574-15\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>We called <code>ExtractToken</code> inside the <code>VerifyToken</code> function to get the token string, then proceeded to check the signing method.</p>\n<p>Then, we will check the validity of this token, whether it is still useful or it has expired, using the <code>TokenValid</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad8b993575445\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc TokenValid(r *http.Request) error {\n  token, err := VerifyToken(r)\n  if err != nil {\n     return err\n  }\n  if _, ok := token.Claims.(jwt.Claims); !ok &amp;&amp; !token.Valid {\n     return err\n  }\n  return nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8b993575445-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8b993575445-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">TokenValid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8b993575445-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VerifyToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8b993575445-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8b993575445-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8b993575445-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8b993575445-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8b993575445-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8b993575445-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8b993575445-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8b993575445-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8b993575445-11\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>We will also extract the token <strong>metadata</strong> that will lookup in our <strong>redis</strong> store we set up earlier. To extract the token, we define the <code>ExtractTokenMetadata</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad8c632607204\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc ExtractTokenMetadata(r *http.Request) (*AccessDetails, error) {\n  token, err := VerifyToken(r)\n  if err != nil {\n     return nil, err\n  }\n  claims, ok := token.Claims.(jwt.MapClaims)\n  if ok &amp;&amp; token.Valid {\n     accessUuid, ok := claims[\"access_uuid\"].(string)\n     if !ok {\n        return nil, err\n     }\n     userId, err := strconv.ParseUint(fmt.Sprintf(\"%.f\", claims[\"user_id\"]), 10, 64)\n     if err != nil {\n        return nil, err\n     }\n     return &amp;AccessDetails{\n        AccessUuid: accessUuid,\n        UserId:   userId,\n     }, nil\n  }\n  return nil, err\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8c632607204-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">AccessDetails</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VerifyToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">accessUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"access_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%.f\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-e\">AccessDetails</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">accessUuid</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">UserId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8c632607204-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8c632607204-23\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<p>The <code>ExtractTokenMetadata</code>  function returns an <code>AccessDetails</code> (which is a struct). This struct contains the metadata (<code>access_uuid</code> and <code>user_id</code>)  that we will need to make a lookup in <strong>redis</strong>. If there is any reason we could not get the metadata from this token, the request is halted with an error message.</p>\n<p>The <code>AccessDetails</code> struct mentioned above looks like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad8d700264912\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ntype AccessDetails struct {\n    AccessUuid string\n    UserId   uint64\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8d700264912-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8d700264912-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8d700264912-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8d700264912-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8d700264912-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8d700264912-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AccessDetails</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8d700264912-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">AccessUuid </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8d700264912-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">UserId&nbsp;&nbsp; </span><span class=\"crayon-i\">uint64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8d700264912-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8d700264912-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>We also mentioned looking up the token metadata in redis. Let’s define a function that will enable us to do that:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad8e440880772\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc FetchAuth(authD *AccessDetails) (uint64, error) {\n  userid, err := client.Get(authD.AccessUuid).Result()\n  if err != nil {\n     return 0, err\n  }\n  userID, _ := strconv.ParseUint(userid, 10, 64)\n  return userID, nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8e440880772-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8e440880772-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">FetchAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">authD *</span><span class=\"crayon-v\">AccessDetails</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8e440880772-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">authD</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8e440880772-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8e440880772-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8e440880772-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8e440880772-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">userID</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8e440880772-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userID</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8e440880772-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8e440880772-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p><code>FetchAuth()</code> accepts the <code>AccessDetails</code> from the <code>ExtractTokenMetadata</code> function, then looks it up in redis. If the record is not found, it may mean the token has expired, hence an error is thrown.</p>\n<p>Let’s finally wire up the <code>CreateTodo</code> function to better understand the implementation of the above functions:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad8f283399405\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc CreateTodo(c *gin.Context) {\n  var td *Todo\n  if err := c.ShouldBindJSON(&amp;td); err != nil {\n     c.JSON(http.StatusUnprocessableEntity, \"invalid json\")\n     return\n  }\n  tokenAuth, err := ExtractTokenMetadata(c.Request)\n  if err != nil {\n     c.JSON(http.StatusUnauthorized, \"unauthorized\")\n     return\n  }\n userId, err = FetchAuth(tokenAuth)\n  if err != nil {\n     c.JSON(http.StatusUnauthorized, \"unauthorized\")\n     return\n  }\ntd.UserID = userId\n\n//you can proceed to save the Todo to a database\n//but we will just return it to the caller here:\n  c.JSON(http.StatusCreated, td)\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad8f283399405-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateTodo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">td *</span><span class=\"crayon-e\">Todo</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"invalid json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FetchAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-17\"><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UserID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userId</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-19\"><span class=\"crayon-c\">//you can proceed to save the Todo to a database</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-20\"><span class=\"crayon-c\">//but we will just return it to the caller here:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCreated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad8f283399405-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad8f283399405-23\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>As seen, we called the <code>ExtractTokenMetadata</code> to extract the JWT <strong>metadata</strong> which is used in <code>FetchAuth</code> to check if the metadata still exists in our redis store. If everything is good, the Todo can then be saved to the database, but we chose to return it to the caller.</p>\n<p>Let’s update <code>main()</code> to include the <code>CreateTodo</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad91183809762\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc main() {\n  router.POST(\"/login\", Login)\n  router.POST(\"/todo\", CreateTodo)\n\n  log.Fatal(router.Run(\":8080\"))\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad91183809762-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad91183809762-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad91183809762-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad91183809762-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad91183809762-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad91183809762-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad91183809762-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad91183809762-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad91183809762-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad91183809762-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/todo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CreateTodo</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad91183809762-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad91183809762-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad91183809762-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad91183809762-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>To test <code>CreateTodo</code>, login and copy the <code>access_token</code> and add it to the <strong>Authorization Bearer Token</strong> field like this:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image6.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image6.png\" alt=\"\" width=\"1999\" height=\"768\" class=\"alignnone size-full wp-image-31626\" /></a></p>\n<p>Then add a title to the request body to create a todo and make a POST request to the <code>/todo</code> endpoint, as shown below:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image4.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image4.png\" alt=\"\" width=\"1999\" height=\"1050\" class=\"alignnone size-full wp-image-31624\" /></a></p>\n<p>Attempting to create a todo without an <code>access_token</code> will be unauthorized:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image5.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image5.png\" alt=\"\" width=\"1999\" height=\"1062\" class=\"alignnone size-full wp-image-31625\" /></a></p>\n<h3>Logout Request</h3>\n<p>Thus far, we have seen how a JWT is used to make an authenticated request. When a user logs out, we will instantly revoke/invalidate their JWT. This is achieved by deleting the JWT metadata from our redis store.</p>\n<p>We will now define a function that enables us delete a JWT metadata from redis:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad92007766194\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc DeleteAuth(givenUuid string) (int64,error) {\n  deleted, err := client.Del(givenUuid).Result()\n  if err != nil {\n     return 0, err\n  }\n  return deleted, nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad92007766194-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad92007766194-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">DeleteAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">givenUuid </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad92007766194-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Del</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">givenUuid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad92007766194-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad92007766194-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad92007766194-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad92007766194-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad92007766194-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad92007766194-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>The function above will delete the record in redis that corresponds with the <code>uuid</code> passed as a parameter.</p>\n<p>The <code>Logout</code> function looks like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad93955787386\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc Logout(c *gin.Context) {\n  au, err := ExtractTokenMetadata(c.Request)\n  if err != nil {\n     c.JSON(http.StatusUnauthorized, \"unauthorized\")\n     return\n  }\n  deleted, delErr := DeleteAuth(au.AccessUuid)\n  if delErr != nil || deleted == 0 { //if any goes wrong\n     c.JSON(http.StatusUnauthorized, \"unauthorized\")\n     return\n  }\n  c.JSON(http.StatusOK, \"Successfully logged out\")\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad93955787386-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad93955787386-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Logout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad93955787386-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">au</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad93955787386-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad93955787386-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad93955787386-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad93955787386-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad93955787386-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DeleteAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">au</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad93955787386-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//if any goes wrong</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad93955787386-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad93955787386-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad93955787386-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad93955787386-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Successfully logged out\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad93955787386-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad93955787386-14\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>In the <code>Logout</code> function, we first extracted the JWT metadata. If successful, we then proceed with deleting that metadata, thereby rendering the JWT invalid immediately.</p>\n<p>Before testing, update the <code>main.go</code> file to include the <code>logout</code> endpoint like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad94483149598\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc main() {\n  router.POST(\"/login\", Login)\n  router.POST(\"/todo\", CreateTodo)\n  router.POST(\"/logout\", Logout)\n\n  log.Fatal(router.Run(\":8080\"))\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad94483149598-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad94483149598-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad94483149598-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad94483149598-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/todo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CreateTodo</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad94483149598-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/logout\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Logout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad94483149598-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad94483149598-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad94483149598-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad94483149598-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Provide a valid <code>access_token</code> associated with a user, then logout the user. Remember to add the <code>access_token</code> to the <code>Authorization Bearer Token</code>, then hit the logout endpoint:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image1.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image1.png\" alt=\"\" width=\"1999\" height=\"1069\" class=\"alignnone size-full wp-image-31621\" /></a></p>\n<p>Now the user is logged out, and no further request can be performed with that JWT again as it is immediately invalidated. This implementation is more secure than waiting for a JWT to expire after a user logs out.</p>\n<h3>Securing Authenticated Routes</h3>\n<p>We have two routes that require authentication: <code>/login</code> and <code>/logout</code>.  Right now, with or without authentication, anybody can access these routes. Let’s change that.</p>\n<p>We will need to define the <code>TokenAuthMiddleware()</code> function to secure these routes:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad95102196988\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc TokenAuthMiddleware() gin.HandlerFunc {\n  return func(c *gin.Context) {\n     err := TokenValid(c.Request)\n     if err != nil {\n        c.JSON(http.StatusUnauthorized, err.Error())\n        c.Abort()\n        return\n     }\n     c.Next()\n  }\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad95102196988-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad95102196988-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">TokenAuthMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">HandlerFunc</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad95102196988-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad95102196988-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenValid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad95102196988-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad95102196988-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad95102196988-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad95102196988-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad95102196988-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad95102196988-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad95102196988-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad95102196988-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad95102196988-12\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>As seen above, we called the <code>TokenValid()</code> function (defined earlier) to check if the token is still valid or has expired. The function will be used in the authenticated routes to secure them.<br />\nLet’s now update <code>main.go</code> to include this middleware:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad96318874803\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc main() {\n  router.POST(\"/login\", Login)\n  router.POST(\"/todo\", TokenAuthMiddleware(), CreateTodo)\n  router.POST(\"/logout\", TokenAuthMiddleware(), Logout)\n\n  log.Fatal(router.Run(\":8080\"))\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad96318874803-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad96318874803-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad96318874803-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad96318874803-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/todo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenAuthMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CreateTodo</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad96318874803-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/logout\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenAuthMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Logout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad96318874803-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad96318874803-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad96318874803-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad96318874803-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<h3>Refreshing Tokens</h3>\n<p>Thus far, we can create, use and revoke JWTs. In an application that will involve a user interface, what happens if the <strong>access token</strong> expires and the user needs to make an authenticated request? Will the user be unauthorized, and be made to login again? Unfortunately, that will be the case. But this can be averted using the concept of a <strong>refresh token</strong>.  The user does not need to relogin.<br />\nThe <strong>refresh token</strong> created alongside the <strong>access token</strong> will be used to create new pairs of <strong>access and refresh tokens</strong>.</p>\n<p>Using JavaScript to consume our API endpoints, we can refresh the JWTs like a breeze using <a href=\"https://github.com/axios/axios\">axios interceptors</a>. In our API, we will need to send a POST request with a <code>refresh_token</code> as the body to the <code>/token/refresh</code> endpoint.</p>\n<p>Let’s first create the <code>Refresh()</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad97682249143\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc Refresh(c *gin.Context) {\n  mapToken := map[string]string{}\n  if err := c.ShouldBindJSON(&amp;mapToken); err != nil {\n     c.JSON(http.StatusUnprocessableEntity, err.Error())\n     return\n  }\n  refreshToken := mapToken[\"refresh_token\"]\n\n  //verify the token\n  os.Setenv(\"REFRESH_SECRET\", \"mcmvmkmsdnfsdmfdsjf\") //this should be in an env file\n  token, err := jwt.Parse(refreshToken, func(token *jwt.Token) (interface{}, error) {\n     //Make sure that the token method conform to \"SigningMethodHMAC\"\n     if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {\n        return nil, fmt.Errorf(\"unexpected signing method: %v\", token.Header[\"alg\"])\n     }\n     return []byte(os.Getenv(\"REFRESH_SECRET\")), nil\n  })\n  //if there is an error, the token must have expired\n  if err != nil {\n     c.JSON(http.StatusUnauthorized, \"Refresh token expired\")\n     return\n  }\n  //is token valid?\n  if _, ok := token.Claims.(jwt.Claims); !ok &amp;&amp; !token.Valid {\n     c.JSON(http.StatusUnauthorized, err)\n     return\n  }\n  //Since token is valid, get the uuid:\n  claims, ok := token.Claims.(jwt.MapClaims) //the token claims should conform to MapClaims\n  if ok &amp;&amp; token.Valid {\n     refreshUuid, ok := claims[\"refresh_uuid\"].(string) //convert the interface to string\n     if !ok {\n        c.JSON(http.StatusUnprocessableEntity, err)\n        return\n     }\n     userId, err := strconv.ParseUint(fmt.Sprintf(\"%.f\", claims[\"user_id\"]), 10, 64)\n     if err != nil {\n        c.JSON(http.StatusUnprocessableEntity, \"Error occurred\")\n        return\n     }\n     //Delete the previous Refresh Token\n     deleted, delErr := DeleteAuth(refreshUuid)\n     if delErr != nil || deleted == 0 { //if any goes wrong\n        c.JSON(http.StatusUnauthorized, \"unauthorized\")\n        return\n     }\n    //Create new pairs of refresh and access tokens\n     ts, createErr := CreateToken(userId)\n     if  createErr != nil {\n        c.JSON(http.StatusForbidden, createErr.Error())\n        return\n     }\n    //save the tokens metadata to redis\nsaveErr := CreateAuth(userId, ts)\n if saveErr != nil {\n        c.JSON(http.StatusForbidden, saveErr.Error())\n       return\n}\n tokens := map[string]string{\n       \"access_token\":  ts.AccessToken,\n  \"refresh_token\": ts.RefreshToken,\n}\n     c.JSON(http.StatusCreated, tokens)\n  } else {\n     c.JSON(http.StatusUnauthorized, \"refresh expired\")\n  }\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad97682249143-68\">68</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Refresh</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">mapToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">mapToken</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">refreshToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mapToken</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"refresh_token\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//verify the token</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mcmvmkmsdnfsdmfdsjf\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">refreshToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">token *</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">interface</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">//Make sure that the token method conform to \"SigningMethodHMAC\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHMAC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Errorf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unexpected signing method: %v\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"alg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//if there is an error, the token must have expired</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Refresh token expired\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//is token valid?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Since token is valid, get the uuid:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//the token claims should conform to MapClaims</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">refreshUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"refresh_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//convert the interface to string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%.f\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Error occurred\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">//Delete the previous Refresh Token</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DeleteAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">refreshUuid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//if any goes wrong</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">//Create new pairs of refresh and access tokens</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">createErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">createErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">createErr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-52\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">//save the tokens metadata to redis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-54\"><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-55\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-57\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-58\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-59\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tokens</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-60\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-s\">\"access_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-61\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"refresh_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-62\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-63\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCreated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tokens</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-64\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-65\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"refresh expired\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-66\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad97682249143-67\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad97682249143-68\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<p>While a lot is going on in that function, let’s try and understand the flow.<br />\n&#8211; We first took the <code>refresh_token</code> from the request body.<br />\n&#8211; We then verified the signing method of the token.<br />\n&#8211; Next, check if the token is still valid.<br />\n&#8211; The <code>refresh_uuid</code> and the <code>user_id</code> are then extracted, which are metadata used as claims when creating the refresh token.<br />\n&#8211; We then search for the metadata in redis store and delete it using the <code>refresh_uuid</code> as key.<br />\n&#8211; We then create a new pair of access and refresh tokens that will now be used for future requests.<br />\n&#8211; The metadata of the access and refresh tokens are saved in redis.<br />\n&#8211; The created tokens are returned to the caller.<br />\n&#8211; In the else statement, if the <strong>refresh token</strong> is not valid, the user will not be allowed to create a new pair of tokens. We will need to relogin to get new tokens.</p>\n<p>Next, add the refresh token route in the <code>main()</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad9e803031827\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n  router.POST(\"/token/refresh\", Refresh)\n\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad9e803031827-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad9e803031827-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad9e803031827-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad9e803031827-1\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/token/refresh\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Refresh</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad9e803031827-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad9e803031827-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Testing the endpoint with a valid <code>refresh_token</code>:</p>\n<p><a href=\"https://www.nexmo.com/wp-content/uploads/2020/03/image7.png\"><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/image7.png\" alt=\"\" width=\"1999\" height=\"1180\" class=\"alignnone size-full wp-image-31627\" /></a></p>\n<p>And we have successfully created new token pairs. Great😎.</p>\n<h3>Send Messages Using the Nexmo Messages API</h3>\n<p>Let&#8217;s notify users each time they create a Todo using the Nexmo Messages API. To send a message with the Nexmo Messages API, you need to <a href=\"https://dashboard.nexmo.com/sign-up\">signup</a> and obtain your API key and Secret. If you already have that, you can proceed.</p>\n<p>You can define your API key and Secret in an environmental variable then use them in this file like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ad9f673997157\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvar (\n  NEXMO_API_KEY   = os.Getenv( \"your_api_key\")\n  NEXMO_API_SECRET  = os.Getenv(\"your_secret\")\n)\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad9f673997157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad9f673997157-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad9f673997157-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ad9f673997157-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ad9f673997157-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad9f673997157-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad9f673997157-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"your_api_key\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad9f673997157-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"your_secret\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ad9f673997157-4\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ad9f673997157-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Then, we will define some structs that have information about the sender, the receiver, and the message content:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ada1845983396\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ntype Payload struct {\n  From    From    `json:\"from\"`\n  To      To      `json:\"to\"`\n  Message Message `json:\"message\"`\n}\ntype From struct {\n  Type   string `json:\"type\"`\n  Number string `json:\"number\"`\n}\ntype To struct {\n  Type   string `json:\"type\"`\n  Number string `json:\"number\"`\n}\ntype Content struct {\n  Type string `json:\"type\"`\n  Text string `json:\"text\"`\n}\ntype Message struct {\n  Content Content `json:\"content\"`\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada1845983396-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Payload</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">From&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">From</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"from\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">To</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">To</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"to\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Message </span><span class=\"crayon-i\">Message</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-6\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">From</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Type&nbsp;&nbsp; </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Number </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-10\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">To</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Type&nbsp;&nbsp; </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Number </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-14\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Content</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Type </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Text </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-18\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Message</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Content </span><span class=\"crayon-i\">Content</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada1845983396-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada1845983396-21\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>Then we define the function to send a message to a user below:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ada2262409282\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc SendMessage(username, phone string) (*http.Response, error) {\n  data := Payload{\n     From: From{\n        Type:   \"sms\",\n        Number: \"Nexmo\",\n     },\n     To: To{\n        Type:   \"sms\",\n        Number: phone,\n     },\n     Message: Message{\n        Content: Content{\n           Type: \"text\",\n           Text: \"Dear \" + username + \", a todo was created from your account just now.\",\n        },\n     },\n  }\n  payloadBytes, err := json.Marshal(data)\n  if err != nil {\n     return nil, err\n  }\n  body := bytes.NewReader(payloadBytes)\n\n  req, err := http.NewRequest(\"POST\", \"https://api.nexmo.com/v0.1/messages\", body)\n  if err != nil {\n     return nil, err\n  }\n  //Ensure headers\n  req.SetBasicAuth(NEXMO_API_KEY, NEXMO_API_SECRET)\n  req.Header.Set(\"Content-Type\", \"application/json\")\n  req.Header.Set(\"Accept\", \"application/json\")\n\n  resp, err := http.DefaultClient.Do(req)\n  if err != nil {\n     return nil, err\n  }\n  defer resp.Body.Close()\n\n  return resp, nil\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada2262409282-41\">41</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">SendMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">phone </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Payload</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">From</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">From</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-s\">\"sms\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Nexmo\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">To</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">To</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-s\">\"sms\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">phone</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Message</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Message</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Content</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Dear \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\", a todo was created from your account just now.\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">payloadBytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Marshal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">body</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">payloadBytes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-23\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://api.nexmo.com/v0.1/messages\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Ensure headers</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SetBasicAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Content-Type\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"application/json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Accept\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"application/json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-32\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DefaultClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">Do</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-34\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-36\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-38\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-39\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada2262409282-40\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada2262409282-41\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<p>In the above function, the <code>To</code> number is the number of the user, while the <code>From</code> number must be purchased via your <a href=\"https://dashboard.nexmo.com\">Nexmo Dashboard</a>.</p>\n<p>Ensure that you have your <code>NEXMO_API_KEY</code> and <code>NEXMO_API_SECRET</code> defined in your environment variable file.</p>\n<p>We then update the <code>CreateTodo</code> function to include the <code>SendMessage</code> function just defined, passing in the required parameters:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7ada3187190444\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nfunc CreateTodo(c *gin.Context) {\n  var td *Todo\n  if err := c.ShouldBindJSON(&amp;td); err != nil {\n     c.JSON(http.StatusUnprocessableEntity, \"invalid json\")\n     return\n  }\n  tokenAuth, err := ExtractTokenMetadata(c.Request)\n  if err != nil {\n     c.JSON(http.StatusUnauthorized, \"unauthorized\")\n     return\n  }\n userId, err = FetchAuth(tokenAuth)\n  if err != nil {\n     c.JSON(http.StatusUnauthorized, \"unauthorized\")\n     return\n  }\ntd.UserID = userId\n//you can proceed to save the Todo to a database\n//but we will just return it to the caller here:\n\n//Send the user a notification\n  msgResp, err := SendMessage(user.Username, user.Phone)\n  if err != nil {\n     c.JSON(http.StatusForbidden, \"error occurred sending message to user\")\n     return\n  }\n  if msgResp.StatusCode &gt; 299 {\n     c.JSON(http.StatusForbidden, \"cannot send message to user\")\n     return\n  }\n\n  c.JSON(http.StatusCreated, td)\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7ada3187190444-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateTodo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">td *</span><span class=\"crayon-e\">Todo</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"invalid json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FetchAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-17\"><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UserID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userId</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-18\"><span class=\"crayon-c\">//you can proceed to save the Todo to a database</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-19\"><span class=\"crayon-c\">//but we will just return it to the caller here:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-21\"><span class=\"crayon-c\">//Send the user a notification</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">msgResp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SendMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Phone</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"error occurred sending message to user\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msgResp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">299</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cannot send message to user\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCreated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7ada3187190444-33\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7ada3187190444-34\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<p>Ensure that a valid phone number is provided, so that you can get the message when you attempt to create a todo.</p>\n<h2>Conclusion</h2>\n<p>You have seen how you can create and invalidate a JWT. You also saw how you can integrate the Nexmo Messages API in your Golang application to send notifications. You can extend this application and use a real database to persist users and todos, and you can also use a React or VueJS to build a frontend. That is where you will really appreciate the Refresh Token feature with the help of Axios Interceptors.</p>\n"}