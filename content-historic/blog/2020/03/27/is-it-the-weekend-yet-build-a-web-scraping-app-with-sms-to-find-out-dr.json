{"_filedata":{"slug":"is-it-the-weekend-yet-build-a-web-scraping-app-with-sms-to-find-out-dr"},"title":"Scrape the Web for Updates and Send SMS Alerts with Ruby","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/Dev_Web-Scraping-App_1200x600.png","author":301,"published":true,"published_at":"2020-03-27T17:55:30","tags":[360,375,432,92,455],"body":"<p>We have all been there. You wake up and it is a new day, and you just need to know the answer to the most burning question. Is it the weekend yet? Your week has been so busy with professional and personal responsibilities. All you want to do is take a couple of days to sit back and relax.</p>\n<p>To answer the question you could, of course, open up your calendar app on your phone or ask your favorite personal digital home assistant. But, why do those things when you could build yourself an app that sends you a text message instead?</p>\n<p>We are going to create a Ruby on Rails application that does the following:</p>\n<ul>\n<li>Allows for both new subscribers and for the ability to unsubscribe from the list</li>\n<li>Scrapes the answer to our question from <a href=\"http://isittheweekend.com\">isittheweekend.com</a></li>\n<li>Sends the answer from our scraped data daily to all the subscribed recipients</li>\n</ul>\n<p>To wrap it all together, we will also be creating a Rake task that will run all these tasks at once, and designating its execution once every 24 hours.</p>\n<p>If you prefer, you can also find a fully working version of this application on <a href=\"https://github.com/nexmo-community/ruby-sms-weekend-checker\">GitHub</a>.</p>\n<p>Let&#8217;s get started!</p>\n<h2>Prerequisites</h2>\n<ul>\n<li><a href=\"https://rubyonrails.org/\">Ruby on Rails</a></li>\n<li><a href=\"https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&amp;utm_medium=github&amp;utm_campaign=ruby-sms-weekend-checker\">Nexmo Account</a></li>\n<li><a href=\"https://ngrok.io\">ngrok</a></li>\n</ul>\n<h2>Generate the Rails Application</h2>\n<p>The first thing we need to do is to create our new Rails application. From your command line execute the following:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a3d902513585\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n$ rails new weekend-checker-app --database=postgresql\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a3d902513585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a3d902513585-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a3d902513585-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weekend</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">checker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">database</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">postgresql</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a3d902513585-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>This creates the necessary file structure for our Rails application and sets the default database to PostgreSQL.</p>\n<p>Once that is done, <code>cd</code> into the directory that was created. Before we install our dependencies, we will add the additional gems our application will use.</p>\n<p>Open up the code in your preferred code editor and navigate to the <code>Gemfile</code>. Inside the <code>Gemfile</code> add the following gems:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a41787352202\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ngem 'nexmo'\ngem 'watir'\ngem 'webdrivers', '~&gt; 4.0'\ngem 'whenever', require: false\ngem 'dotenv-rails'\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a41787352202-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a41787352202-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a41787352202-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a41787352202-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a41787352202-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a41787352202-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a41787352202-1\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nexmo'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a41787352202-2\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'watir'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a41787352202-3\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'webdrivers'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'~&gt; 4.0'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a41787352202-4\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'whenever'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">require</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a41787352202-5\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dotenv-rails'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a41787352202-6\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>We are using the <code>nexmo</code> gem to send the SMS updates, the <code>watir</code> and <code>webdrivers</code> gems to make the HTTP request to a site with dynamic JavaScript content, the <code>whenever</code> gem to schedule the Rake task, and the <code>dotenv-rails</code> gem to manage the environment variables.</p>\n<p>After you have saved the <code>Gemfile</code>, you are ready to run <code>bundle install</code> from the command line.</p>\n<p>The next step is creating our database schema and models.</p>\n<h2>Create the Database Schema and Models</h2>\n<p>Now that our Rails application is created and has its dependencies installed, the next task is to create the correct database schema to house the data we will need to operate our application. We need to store the following types of information:</p>\n<ul>\n<li>Recipients: <em>The list of subscribers with their phone numbers</em></li>\n<li>DiffStorage: <em>Copies of the website data to compare against to determine if there was a change</em></li>\n</ul>\n<p>We will use the Rails generator tool to create the migration files and then subsequently edit each one.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a42472223905\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n$ rails generate model Recipient number:string subscribed:boolean\n$ rails generate model DiffStorage website_data:text\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a42472223905-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a42472223905-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a42472223905-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a42472223905-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-e\">Recipient </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">boolean</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a42472223905-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-e\">DiffStorage </span><span class=\"crayon-v\">website_data</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">text</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a42472223905-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Those commands will create both model files in <code>app/models</code> and migration files in <code>db/migrate</code>. Before committing those changes to your application, once the generator actions are done, inspect the files created in both directories to make sure they are correct.</p>\n<p>Specifically, in the migration files, you want to ensure that each migration includes <code>t.timestamps</code>, which adds a <code>created_at</code> and <code>updated_at</code> column to the table. You should also see the <code>number</code> and <code>subscribed</code> columns in the <code>Recipient</code> migration file, with types set to <code>string</code> and <code>boolean</code>, respectively. Similarly, you should see a column in the <code>DiffStorage</code> migration file for <code>website_data</code> with the type set to <code>text</code>.</p>\n<p>The model files inside <code>app/models</code> should be empty besides the class declarations and their inheritance from <code>ApplicationRecord</code>.</p>\n<p>When it looks satisfactory, it is time to run <code>rake db:migrate</code> from the command line. The command will output the results to your console, and if you inspect the <code>db/schema.rb</code> file you will be able to see the schema you created initialized inside the application.</p>\n<p>Lastly, we also need to create <code>Messenger</code> and <code>Scraper</code> models, but we do not need a migration for them. To do so, we run the Rails generator again and append a <code>--migration=false</code> flag to it:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a43189821947\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n$ rails generate model Messenger --migration=false\n$ rails generate model Scraper --migration=false\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a43189821947-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a43189821947-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a43189821947-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a43189821947-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-v\">Messenger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">migration</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a43189821947-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">model </span><span class=\"crayon-v\">Scraper</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">migration</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a43189821947-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Now has come the time to define the logic inside the models.</p>\n<h2>Defining the Models</h2>\n<p>As mentioned above, we have four models that are responsible for unique areas of the application:</p>\n<ul>\n<li><code>DiffStorage</code>: <em>Checks for any differences in the website data</em></li>\n<li><code>Recipient</code>: <em>Manages adding and removing subscribers</em></li>\n<li><code>Messenger</code>: <em>Manages the sending of SMS messages</em></li>\n<li><code>Scraper</code>: <em>Responsible for scraping the website for data</em></li>\n</ul>\n<h3>Defining the DiffStorage Model</h3>\n<p>The <code>DiffStorage</code> model will contain two class models. One will contain the URL that we are scraping. The second will check for any changes since the last time the website was scraped and invoke the next steps in the application when the conditions are met.</p>\n<p>First, let&#8217;s define the URL in its own method so that we create a single place where it exists and can be easily modified if we choose to do so later:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a45559023753\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef self.url\n  'http://isittheweekend.com'\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a45559023753-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a45559023753-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a45559023753-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a45559023753-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a45559023753-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">url</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a45559023753-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">'http://isittheweekend.com'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a45559023753-3\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a45559023753-4\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Next, the bulk of this model will live inside the <code>#check_last_record</code> class method:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a46505085241\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef self.check_last_record\n  today_answer = Scraper.call(self.url)\n  if DiffStorage.any?\n    yesterday_answer = DiffStorage.last\n  else\n    yesterday_answer = ''\n  end\n  Messenger.send_update_message(Recipient.all, yesterday_answer, today_answer)\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a46505085241-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a46505085241-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a46505085241-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a46505085241-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a46505085241-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a46505085241-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a46505085241-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a46505085241-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a46505085241-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a46505085241-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a46505085241-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_last_record</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a46505085241-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">today_answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a46505085241-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a46505085241-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">yesterday_answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">last</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a46505085241-5\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a46505085241-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">yesterday_answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a46505085241-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a46505085241-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Messenger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_update_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">all</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yesterday_answer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today_answer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a46505085241-9\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a46505085241-10\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>The above method first calls the method in the <code>Scraper</code> class that will begin the website scraping to obtain the most recent snapshot and assigns that data to <code>today_answer</code>. It then wraps the next step inside an <code>if</code> statement asking if there are any records in <code>DiffStorage</code>. If there are previous records stored there, then the method grabs the most recent one and assigns it to <code>yesterday_answer</code>. If there were no previous records then an empty string is assigned to <code>yesterday_answer</code>. Lastly, it sends the recipients and the two variables to the <code>Messenger</code> model to process for sending the message.</p>\n<h3>Defining the Scraper Model</h3>\n<p>The <code>Scraper</code> model will be responsible for doing the work of gathering the data from <a href=\"http://isittheweekend.com\">isittheweekend.com</a> to determine if it is indeed the weekend or not. The model will have four class methods and we will define each one here:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a47771104893\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nrequire 'nokogiri'\nrequire 'webdrivers/chromedriver'\nrequire 'watir'\n\nclass Scraper &lt; ApplicationRecord\n  def self.call(url)\n    self.get_url(url)\n  end\n\n  def self.get_url(url)\n    doc = HTTParty.get(url)\n    browser = Watir::Browser.new :chrome, headless: true\n    browser.goto(url)\n    parsed_page ||= Nokogiri::HTML.parse(browser.html)\n    answer = parsed_page.css('h1#isit').text\n    self.check_text(answer)\n  end\n\n  def self.check_text(data)\n    if data == '' || data == nil\n      puts \"There was no text received from the web scrape.\"\n      exit\n    else\n      puts \"There was data in the text received from the web scrape.\"\n      self.store_text(data)\n    end\n  end\n\n  def self.store_text(text)\n    record = DiffStorage.new\n    record.website_data = text\n    if record.save\n      puts \"Record Updated Successfully\"\n    end\n    return record\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a47771104893-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a47771104893-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-1\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nokogiri'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-2\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'webdrivers/chromedriver'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-3\"><span class=\"crayon-i\">require</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'watir'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Scraper</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplicationRecord</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-6\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-9\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTParty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">browser</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Watir</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Browser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">chrome</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headless</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">browser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">goto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">parsed_page</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nokogiri</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">HTML</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">browser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_page</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'h1#isit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-16\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">answer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-21\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"There was no text received from the web scrape.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">exit</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-23\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"There was data in the text received from the web scrape.\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">store_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-28\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">store_text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">record</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-31\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">record</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">website_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-32\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">record</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-33\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Record Updated Successfully\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">record</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-36\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a47771104893-37\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a47771104893-38\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<p>Each action within the act of scraping is defined into its own small method so as to keep our concerns separated. The <code>#call</code> method is the point of entry for the class. This is what gets invoked by other methods outside of itself. The <code>#get_url</code> method makes the HTTP request by simulating a Chome browser request using the <code>Watir</code> library and parses it with <code>Nokogiri</code>. The <code>#check_text</code> method checks if any data was obtained. The <code>#store_text</code> method saves that data to the database.</p>\n<h3>Defining the Messenger Model</h3>\n<p>Within the <code>Messenger</code> model will be all the code responsible for sending the daily SMS update to the subscribers. We will create a method that will send the message, a method that composes the weekend response text, a method that puts the whole message together, and a method that manages a confirmation message if a subscriber sends a removal request.</p>\n<p>First, the method to send the update message:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a49546516107\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef self.send_update_message(recipients, yesterday, today)\n  @client = Nexmo::Client.new(\n    api_key: ENV['NEXMO_API_KEY'],\n    api_secret: ENV['NEXMO_API_SECRET']\n  )\n  puts \"Sending Message to Each Recipient\"\n  recipients.each do |recipient|\n    if recipient.subscribed == true\n      client.sms.send(\n        from: ENV['FROM_NUMBER'],\n        to: recipient.number,\n        text: self.weekend_message(yesterday, today)\n      )\n      puts \"Sent message to #{recipient.number}\"\n    end\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a49546516107-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a49546516107-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_update_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">recipients</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yesterday</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXMO_API_KEY'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">api_secret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXMO_API_SECRET'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sending Message to Each Recipient\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">recipients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'FROM_NUMBER'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weekend_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">yesterday</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">puts</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sent message to #{recipient.number}\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a49546516107-17\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a49546516107-18\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>The value for the <code>text</code> parameter above refers to a class method called <code>#weekend_message</code>. This method will compose the string for the weekend update by checking if today is the same as yesterday or not:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a4a637859415\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef self.weekend_message(yesterday, today)\n  if today == yesterday\n    response = \"Today is the same as yesterday, and the answer is #{today}.\"\n  elsif today =! yesterday\n    response = \"Today is not the same as yesterday, the answer for today is #{today}.\"\n  else\n    response = 'Today and yesterday are both neither affirmative or positive. Are we in an alternative dimension of time and space?'\n  end\n  self.compose_message(response)\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4a637859415-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4a637859415-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weekend_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">yesterday</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4a637859415-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">today</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">yesterday</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4a637859415-3\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Today is the same as yesterday, and the answer is #{today}.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4a637859415-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">elsif </span><span class=\"crayon-v\">today</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">yesterday</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4a637859415-5\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Today is not the same as yesterday, the answer for today is #{today}.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4a637859415-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4a637859415-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Today and yesterday are both neither affirmative or positive. Are we in an alternative dimension of time and space?'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4a637859415-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4a637859415-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">compose_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4a637859415-10\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4a637859415-11\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Next, the method containing the <code>HEREDOC</code> string with the body of the message:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a4c708503661\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef self.compose_message(response)\n  &lt;&lt;~HEREDOC\n  Hello! \n  It is a new day, but is it a weekend day?\n  #{response} \n  To be removed from the list please respond with \"1\".\n  HEREDOC\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4c708503661-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4c708503661-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">compose_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4c708503661-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4c708503661-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Hello</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4c708503661-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">It </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">day</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">but</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekend</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">day</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4c708503661-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-p\">#{response} </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4c708503661-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">To</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-e\">removed </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">please </span><span class=\"crayon-e\">respond </span><span class=\"crayon-i\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4c708503661-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">HEREDOC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4c708503661-8\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4c708503661-9\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>Finally, the method to send a removal confirmation message:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a4d306508202\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ndef self.send_removal_message(to)\n  @client.sms.send(\n    from: ENV['FROM_NUMBER'],\n    to: to,\n    text: 'You have been successfully removed.'\n  )\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4d306508202-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4d306508202-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_removal_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">to</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4d306508202-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4d306508202-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'FROM_NUMBER'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4d306508202-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4d306508202-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'You have been successfully removed.'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4d306508202-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4d306508202-7\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4d306508202-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The last model we need to define before we continue to the next step is the <code>Recipient</code> model.</p>\n<h3>Defining the Recipient Model</h3>\n<p>This model does not contain any of its class methods. The only addition we will make to this model is adding two validations to the data for recipients. These validations will act as a safeguard when adding new phone numbers to the database. We will check that a) a number is indeed being provided in the data and b) the number is not a duplicate of an already existing record. To do these validations we add two lines under the class definition:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a4e936363486\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nclass Recipient &lt; ApplicationRecord\n  validates :number, presence: true\n  validates :number, uniqueness: true\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4e936363486-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4e936363486-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4e936363486-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a4e936363486-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a4e936363486-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4e936363486-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplicationRecord</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4e936363486-2\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">validates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">presence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4e936363486-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">validates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uniqueness</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a4e936363486-4\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a4e936363486-5\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h2>Create the Controller and Routes</h2>\n<p>We are getting close to finishing the construction of our app! The next step is defining the controller actions that will dictate the flow of the application. First, let&#8217;s generate the controller using the Rails generator from the command line:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a50190740788\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n$ rails generate controller WeekendChecker\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a50190740788-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a50190740788-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a50190740788-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">controller </span><span class=\"crayon-i\">WeekendChecker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a50190740788-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>This will create a new empty controller file in <code>app/controllers</code> called <code>weekend_checker_controller.rb</code> and complementary view files in <code>app/views/weekend_checker</code>. We will add an index view shortly. At this point, we&#8217;ll focus on the controller.</p>\n<p>The controller needs three actions to correspond to three routes: <code>#index</code>, <code>#create</code> and <code>#event</code>. The <code>#index</code> route will be the default and only view for our website. That will be the place where individuals can subscribe to the list. The <code>#create</code> route will be where new numbers get processed. Finally, the <code>#event</code> route will be where the application receives webhook data from the SMS API, including removal requests, and processes them.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a51376665494\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nclass WeekendCheckerController &lt; ApplicationController\n\n  def index\n  end\n\n  def create\n    @recipient = Recipient.new(recipient_params)\n    if @recipient.save\n      flash[:notice] = \"Phone number saved successfully.\"\n    else\n      flash[:alert] = \"Form did not save. Please fix and try again.\"\n    end\n    redirect_to '/'\n  end\n\n  def event\n    if params[:text] == '1'\n      recipient = Recipient.find_by(number: params[:msisdn])\n      if recipient\n        if recipient.update(subscribed: false)\n          Messenger.send_removal_message(params[:msisdn])\n        end\n      end\n    end\n    puts params\n\n    head :no_content\n  end\n\n  private\n\n  def recipient_params\n    params.permit(:number, :subscribed)\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a51376665494-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a51376665494-36\">36</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WeekendCheckerController</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplicationController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-4\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-i\">create</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">recipient_params</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-9\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">flash</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">notice</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Phone number saved successfully.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">flash</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">alert</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Form did not save. Please fix and try again.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">redirect</span><span class=\"crayon-sy\">_</span>to<span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">event</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-17\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">recipient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_by</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recipient</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-20\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Messenger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_removal_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">puts </span><span class=\"crayon-e\">params</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-27\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">no_content</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-28\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-29\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">private</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">recipient_params</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-33\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">permit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-34\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a51376665494-35\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a51376665494-36\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>These three controller actions need three corresponding routes defined in <code>config/routes.rb</code>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a52604347018\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nRails.application.routes.draw do\n  get '/', to: 'weekend_checker#index'\n  get '/webhooks/event', to: 'weekend_checker#event'\n  post '/recipient/new', to: 'weekend_checker#create'\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a52604347018-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a52604347018-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a52604347018-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a52604347018-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a52604347018-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a52604347018-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a52604347018-1\"><span class=\"crayon-v\">Rails</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">application</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">draw </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a52604347018-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'weekend_checker#index'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a52604347018-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/webhooks/event'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'weekend_checker#event'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a52604347018-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">post</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/recipient/new'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'weekend_checker#create'</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a52604347018-5\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a52604347018-6\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The penultimate item for our application code setup is creating a basic view for the <code>/</code> route.</p>\n<h3>Defining the View</h3>\n<p>In order to subscribe to the SMS list, we will create a view accessible at the top-level of the URL that will contain a sign-up form.</p>\n<p>Inside the <code>app/views/weekend_checker</code> folder add an <code>index.html.erb</code> file. It will contain the following code:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a53499229110\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-mixed-highlight\" title=\"Contains Mixed Languages\"></span><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n&lt;h2&gt;Is It The Weekend? Get a Daily Text to Find Out!&lt;/h2&gt;\n&lt;p&gt;\nThis is a free service that will analyze &lt;a href=\"http://isittheweekend.com\"&gt;isittheweekend.com&lt;/a&gt; and check for any updates once a day. If there is an update it will send you a text message at the number you provide. \n&lt;/p&gt;\n&lt;p&gt;\nTo remove yourself from the SMS list, reply to the text message you receive with the number \"1\".\n&lt;/p&gt;\n&lt;p&gt;\nSMS messages are sent using the &lt;a href=\"https://developer.nexmo.com\"&gt;Nexmo SMS API&lt;/a&gt;.\n&lt;/p&gt;\n\n&lt;% flash.each do |type, msg| %&gt;\n  &lt;div&gt;\n    &lt;%= msg %&gt;\n  &lt;/div&gt;\n&lt;% end %&gt;\n\n&lt;%= form_with model: @recipient, url: \"/recipient/new\" do |f| %&gt;\n  &lt;%= f.telephone_field :number, :placeholder =&gt; '12122222222' %&gt;\n  &lt;%= f.hidden_field :subscribed, value: true %&gt;\n  &lt;%= f.submit \"Add Number\" %&gt;\n&lt;% end %&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a53499229110-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a53499229110-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">h2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-st\">Is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">It </span><span class=\"crayon-e\">The </span><span class=\"crayon-v\">Weekend</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Get</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Daily </span><span class=\"crayon-e\">Text </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Find </span><span class=\"crayon-v\">Out</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h2</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-3\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free </span><span class=\"crayon-e\">service </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">will </span><span class=\"crayon-v\">analyze</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://isittheweekend.com\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">isittheweekend</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">any </span><span class=\"crayon-e\">updates </span><span class=\"crayon-i\">once</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">day</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">If</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">there </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">update </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">will </span><span class=\"crayon-e\">send </span><span class=\"crayon-i\">you</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">text </span><span class=\"crayon-e\">message </span><span class=\"crayon-e\">at </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">provide</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-6\"><span class=\"crayon-st\">To</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">remove </span><span class=\"crayon-e\">yourself </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">SMS </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reply </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">text </span><span class=\"crayon-e\">message </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">receive </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-9\"><span class=\"crayon-e\">SMS </span><span class=\"crayon-e\">messages </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">using </span><span class=\"crayon-v\">the</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://developer.nexmo.com\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Nexmo </span><span class=\"crayon-e\">SMS </span><span class=\"crayon-v\">API</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-10\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-12\"><span class=\"crayon-ta\">&lt;%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-16\"><span class=\"crayon-ta\">&lt;%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-18\"><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">_</span>with<span class=\"crayon-h\"> </span><span class=\"crayon-v\">model</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">@recipient</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/recipient/new\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">telephone_field</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">placeholder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'12122222222'</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hidden_field</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">subscribed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">true</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;%=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">submit</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Add Number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a53499229110-22\"><span class=\"crayon-ta\">&lt;%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-ta\">%&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a53499229110-23\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0556 seconds] -->\r\n<p></p>\n<p>The final coding task we have to do is to set up our new Rake task that will run all this code and configure the <code>whenever</code> gem to execute the Rake task once a day.</p>\n<h2>Create the Rake Task and Schedule It</h2>\n<p>Once again, we will use a Rails generator from the command line to create the file for our Rake task. From the command line run the following:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a55293002693\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n$ rails generate task scraper check_site_update\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a55293002693-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a55293002693-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a55293002693-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rails </span><span class=\"crayon-e\">generate </span><span class=\"crayon-e\">task </span><span class=\"crayon-e\">scraper </span><span class=\"crayon-v\">check_site</span><span class=\"crayon-sy\">_</span>update</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a55293002693-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The above task will create a file in <code>lib/tasks</code> called <code>scraper.rake</code>. When we open it inside our code editor it will look like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a56002032342\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnamespace :scraper do\n  desc \"TODO\"\n  task :check_site_update =&gt; :environment do\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a56002032342-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a56002032342-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a56002032342-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a56002032342-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a56002032342-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a56002032342-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a56002032342-1\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">scraper </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a56002032342-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">desc</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TODO\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a56002032342-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">check_site_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">environment </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a56002032342-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a56002032342-5\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a56002032342-6\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Let&#8217;s redefine the <code>desc</code> with a short string of what this task will do: <code>desc \"Check Website for Any Updates\"</code>. Next, inside the <code>task</code> block add the <code>DiffStorage#check_last_record</code> class method, which is the entry point for all the work we created previously:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a57321500458\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnamespace :scraper do\n  desc \"Check Website for Any Updates\"\n  task :check_site_update =&gt; :environment do\n    DiffStorage.check_last_record\n  end\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a57321500458-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a57321500458-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a57321500458-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a57321500458-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a57321500458-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a57321500458-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a57321500458-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a57321500458-1\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">scraper </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a57321500458-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">desc</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Check Website for Any Updates\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a57321500458-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">check_site_update</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">environment </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a57321500458-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">DiffStorage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">check_last_record</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a57321500458-5\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a57321500458-6\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a57321500458-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Now that our Rake task is defined, we lastly need to initialize the <code>whenever</code> gem and let it know that we want this task run once a day. To do that, first, we run the initializer command for the gem from the command line:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a58431559792\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n$ bundle exec wheneverize .\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a58431559792-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a58431559792-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a58431559792-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bundle </span><span class=\"crayon-e\">exec </span><span class=\"crayon-i\">wheneverize</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a58431559792-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The above command creates a <code>schedule.rb</code> file inside the <code>config/</code> folder. Add the following code to that file to run the <code>scraper:check_site_update</code> task daily:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a59620622866\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nevery 1.day do\n  rake \"scraper:check_site_update\"\nend\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a59620622866-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a59620622866-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a59620622866-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a59620622866-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a59620622866-1\"><span class=\"crayon-i\">every</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.day</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a59620622866-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">rake</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"scraper:check_site_update\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a59620622866-3\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a59620622866-4\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Now that the schedule is created, we need to update the crontab file on our machine to know about this new job. We do that by running <code>bundle exec whenever --update-crontab</code> from the command line. Once that is done, the task is fully initialized and configured to run once a day on our machine.</p>\n<p>The code for our application is all set. The only thing that is missing now is creating our Nexmo account, obtaining our Nexmo API credentials and provisioning a virtual phone number to send the daily text messages with. Once we have this information we will add it to our application as environment variables.</p>\n<h2>Nexmo API Credentials and Phone Number</h2>\n<p>To create an account navigate to the <a href=\"https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&amp;utm_medium=github&amp;utm_campaign=weekend-checker-sms-app\">Nexmo Dashboard</a> and complete the registration steps. Once you have finished registering, you will enter your Dashboard, which will look similar to this:</p>\n<p><img src=\"dashboard_screenshot.png\" alt=\"\" /></p>\n<p>If you have not done so previously, create a <code>.env</code> file in the top-level directory of your application and add your <code>NEXMO_API_KEY</code> and <code>NEXMO_API_SECRET</code> to it. The values for those are found at the top of the dashboard page under the <code>Your API credentials</code> header.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a5b973086215\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nNEXMO_API_KEY=\nNEXMO_API_SECRET=\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a5b973086215-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a5b973086215-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a5b973086215-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a5b973086215-1\"><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a5b973086215-2\"><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a5b973086215-3\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<p>The next task we need to do inside the dashboard is to provision a phone number. After you click on the <code>Numbers</code> link on the sidebar navigation, a drop-down menu will appear. Once you select the <code>Buy numbers</code> option and then click the <code>Search</code> button you will see a list of possible numbers to acquire:</p>\n<p><img src=\"buy_numbers.png\" alt=\"\" /></p>\n<p>When searching for numbers by feature, country, and type, it is recommended to select the country that your users will be based in, <code>SMS</code> for features and <code>Mobile</code> for type.</p>\n<p>After clicking the orange <code>Buy</code> button for the number you wish to purchase, you can add that number to your <code>.env</code> file as a new variable called <code>FROM_NUMBER</code>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a5c880623950\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nNEXMO_API_KEY=\nNEXMO_API_SECRET=\nFROM_NUMBER=\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a5c880623950-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a5c880623950-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a5c880623950-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a5c880623950-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a5c880623950-1\"><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a5c880623950-2\"><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a5c880623950-3\"><span class=\"crayon-v\">FROM_NUMBER</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a5c880623950-4\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>The last item we need to do inside our dashboard is to provide an externally accessible URL as the event webhook for the phone number. For development purposes, <a href=\"https://ngrok.io\">ngrok</a> is a good tool to use, and you can follow <a href=\"https://developer.nexmo.com/concepts/guides/testing-with-ngrok\">this guide</a> on how to get up and running with it.</p>\n<p>From the dashboard <code>Numbers</code> sidebar navigation drop-down, once you select <code>Your numbers</code> you will see your newly provisioned phone number in a list presentation. After clicking on the gear icon to manage its properties, a settings dialog menu will be shown to you:</p>\n<p><img src=\"number_settings.png\" alt=\"\" /></p>\n<p>In the above screenshot example, you would replace the <code>Inbound Webhook URL</code> text field with your own URL ending with <code>/webhooks/event</code>.</p>\n<p>That&#8217;s it! Our code is all finalized and our Nexmo credentials are all set. At this point, you face a choice for running your application. You can either run it locally or you could deploy it to an external hosting provider, like Heroku. In the final step, we will discuss how to run it locally.</p>\n<p>If you are interested in deploying it for a more long-term solution, you can visit the <a href=\"https://github.com/nexmo-community/weekend-checker-sms-app\">GitHub repository</a> and click on the <code>Deploy to Heroku</code> button at the top of the README to start that process.</p>\n<h2>Running the Application</h2>\n<p>We are now ready to run our brand new application! In order to run it locally, the Rails event webhook needs to be accessible to the outside world outside of your local environment. For example, if you are using ngrok after following <a href=\"https://developer.nexmo.com/concepts/guides/testing-with-ngrok\">this guide</a> then both the Rails application and ngrok need to be running simultaneously.</p>\n<p>To start the Rails application execute the following from your command line:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcb91a5d213229942\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n$ bundle exec rails server\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcb91a5d213229942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcb91a5d213229942-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcb91a5d213229942-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bundle </span><span class=\"crayon-e\">exec </span><span class=\"crayon-e\">rails </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcb91a5d213229942-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Then you can navigate in your browser of choice to <code>localhost:3000</code>. You will see the sign-up form you created. Go ahead and fill it out with your phone number and submit it. Now, once the Rake task is run, you should expect to receive an SMS letting you know if it is the weekend and whether today is different than yesterday!</p>\n<h2>Next Steps</h2>\n<p>The application we built while whimsical demonstrates the potential for leveraging web scraping and SMS to create an application that delivers updates to subscribers. There are countless potential use cases for an application like this. Whether you are interested in replicating this exact scenario or in porting the code for your own use case, there is, even more, to explore on this topic.</p>\n<p>For further exploration of other SMS possibilities check out the following resources:</p>\n<ul>\n<li><a href=\"https://www.nexmo.com/blog/2020/03/04/how-to-send-sms-reminders-of-google-calendar-events-with-zapier-dr\">Send SMS Reminders of Google Calendar Events with Zapier</a></li>\n<li><a href=\"https://www.nexmo.com/blog/2019/08/14/how-to-create-an-interactive-scavenger-hunt-with-nexmos-sms-and-voice-api-dr\">Create an Interactive Scavenger Hunt with Nexmo&#8217;s SMS and Voice API</a></li>\n<li><a href=\"https://www.nexmo.com/blog/2020/01/11/shipping-notifications-on-wordpress-woocommerce-with-nexmo-sms-dr\">Shipping Notifications on WordPress WooCommerce with SMS</a></li>\n</ul>\n"}