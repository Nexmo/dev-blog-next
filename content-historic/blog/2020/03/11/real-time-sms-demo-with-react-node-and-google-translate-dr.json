{"_filedata":{"slug":"real-time-sms-demo-with-react-node-and-google-translate-dr"},"title":"Real-time SMS Demo with React, Node, and Google Translate","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/E_SMS-Translations_1200x600.png","author":295,"published":true,"published_at":"2020-03-11T13:02:01","tags":[1701,793,92,616],"body":"<p>Last year I worked with the <a href=\"https://www.nexmo.com/blog/2019/10/24/extending-nexmo-google-cloud-translation-api-dr\">Google Translate API</a> to translate SMS messages. After showing the rest of the team, they wanted a demo they could show off to other developers at conferences we attended. Based on that, I set out to create a frontend with React that could display the translations in real-time.</p>\n<h2>Building the WebSocket</h2>\n<h3>What&#8217;s a WebSocket?</h3>\n<p>For this demo, I decided that using a WebSocket would be a great solution. If you haven&#8217;t used a WebSocket before, it&#8217;s a protocol that allows a client and server to communicate in real-time. WebSockets are bi-directional, meaning the client and server can both send and receive messages. When you first connect to a WebSocket, the connection is made by upgrading an HTTP protocol to the WebSocket protocol and is kept alive as long as it goes uninterrupted. Once established, it provides a continuous stream of content. Exactly what we need to receive incoming, translated SMS messages.</p>\n<h3>Create the WebSocket Server in Node</h3>\n<p>As an initial step to creating the WebSockets, the server requires a path to allow for client connections. Starting with the original server file from my <a href=\"https://github.com/nexmo-community/sms-google-translate-js\">previous post</a>, we can make a few minor changes to create the WebSocket server and the events and listeners required by the client.</p>\n<p>Using the <a href=\"https://github.com/websockets/ws\"><code>ws</code></a> package on NPM, we can quickly create what we need to get this working.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b68f137693312\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install ws\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b68f137693312-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b68f137693312-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b68f137693312-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">ws</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b68f137693312-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Once installed, include the package in your server file, and create the WebSocket server. <code>WS</code> allows a <code>path</code> option to set the route the client uses to connect.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b692497056447\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst express = require('express');\nconst WebSocket = require('ws');\n\nconst app = express();\nconst server = http.createServer(app);\nconst wss = new WebSocket.Server({ server, path: \"/socket\" });\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b692497056447-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b692497056447-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b692497056447-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b692497056447-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b692497056447-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b692497056447-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b692497056447-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b692497056447-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'express'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b692497056447-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WebSocket</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'ws'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b692497056447-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b692497056447-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">express</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b692497056447-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b692497056447-6\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WebSocket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Server</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/socket\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b692497056447-7\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<p>With this bit of code, the client now has a place to connect to the WebSocket route <code>/socket</code>. With the server ready to go, you need to now listen for a <code>connection</code> event. When the client connects, the server uses the following to set up the other listeners we need:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b694751935528\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nwss.on('connection', (ws) =&gt; {\n  ws.isAlive = true;\n  ws.translateTo = 'en';\n\n  ws.on('pong', () =&gt; {\n    ws.isAlive = true;\n  });\n\n  ws.on('message', (message) =&gt; {\n    translateTo = message;\n  });\n\n});\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b694751935528-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b694751935528-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b694751935528-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b694751935528-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b694751935528-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b694751935528-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b694751935528-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b694751935528-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b694751935528-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b694751935528-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b694751935528-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b694751935528-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b694751935528-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b694751935528-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b694751935528-1\"><span class=\"crayon-v\">wss</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'connection'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b694751935528-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b694751935528-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translateTo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'en'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b694751935528-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b694751935528-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'pong'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b694751935528-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b694751935528-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b694751935528-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b694751935528-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b694751935528-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">translateTo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b694751935528-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b694751935528-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b694751935528-13\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b694751935528-14\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>There are two main points to call out:</p>\n<ol>\n<li>On connection, we set the property <code>isAlive</code> to <code>true</code>, and listen for the <code>pong</code> event. This event is for the server to check and maintain a connection with the client. The server sends a <code>ping</code> and responds with <code>pong</code> to verify it&#8217;s still a live connection.</p>\n</li>\n<li>\n<p>Here I set up <code>translateTo</code> as a property to store. <code>translateTo</code> is set through each client using a dropdown. When someone using our booth demo app selects a different language, that action sets this to translate the SMS texts into the requested language.</p>\n</li>\n</ol>\n<h3>Keeping the Connection Alive</h3>\n<p>One essential item to be concerned with is checking for clients that disconnect. It&#8217;s possible that during the disconnection process, the server may not be aware, and problems may occur. With a good friend <code>setInterval()</code>, we can check if our clients are still there and reconnect them if needed.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b695258888907\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nsetInterval(() =&gt; {\n  wss.clients.forEach((ws) =&gt; {\n    if (!ws.isAlive) return ws.terminate();\n    ws.isAlive = false;\n    ws.ping(null, false, true);\n  });\n}, 10000);\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b695258888907-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b695258888907-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b695258888907-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b695258888907-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b695258888907-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b695258888907-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b695258888907-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b695258888907-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b695258888907-1\"><span class=\"crayon-e\">setInterval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b695258888907-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">wss</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b695258888907-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">terminate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b695258888907-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isAlive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b695258888907-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ws</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b695258888907-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b695258888907-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b695258888907-8\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0002 seconds] -->\r\n<p></p>\n<h3>Sending Messages to the Client</h3>\n<p>Now that the WebSocket is connected and monitored, we can handle the inbound messages from Nexmo, the translation, and the response to the client. The method <code>handleRoute</code> needs to be updated from its original state to add the response for each client.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b696420106832\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst handleRoute = (req, res) =&gt; {\n\n  let params = req.body;\n\n  if (req.method === \"GET\") {\n    params = req.query\n  }\n\n  if (!params.to || !params.msisdn) {\n    res.status(400).send({ 'error': 'This is not a valid inbound SMS message!' });\n  } else {\n    wss.clients.forEach(async (client) =&gt; {\n      let translation = await translateText(params, client.translateTo);\n      let response = {\n        from: obfuscateNumber(req.body.msisdn),\n        translation: translation.translatedText,\n        originalLanguage: translation.detectedSourceLanguage,\n        originalMessage: params.text,\n        translatedTo: client.translateTo\n      }\n\n      client.send(JSON.stringify(response));\n    });\n\n    res.status(200).end();\n  }\n\n};\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b696420106832-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b696420106832-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handleRoute</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"GET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">query</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'error'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'This is not a valid inbound SMS message!'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">wss</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">translation</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">translateText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translateTo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">obfuscateNumber</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">translation</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">translation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translatedText</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">originalLanguage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">translation</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">detectedSourceLanguage</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">originalMessage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">translatedTo</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">translateTo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-21\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stringify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-24\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-27\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b696420106832-28\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b696420106832-29\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<p>The <code>wss.clients.forEach</code> method iterates through each connection, and sends off the SMS parameters from Nexmo to the Google Translate API. Once the translation comes back, we can decide what data the front-end should have, and pass it back as a string as I&#8217;ve done here with <code>client.send(JSON.stringify(response))</code>.</p>\n<p>To recap what has happened here: Each client connects to the WebSocket server by calling the <code>/socket</code> route and establishing a connection. An SMS message goes from the sender&#8217;s phone to Nexmo, which then calls the <code>/inboundSMS</code> route. The app passes the text message to Google Translate API for each connected client, and then finally sends it back to the client UI.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/flow-diagram.png\" alt=\"Diagram of WebSocket Flow\" title=\"Diagram of WebSocket Flow\" /></p>\n<p>Next, let&#8217;s build the UI parts to display it on the screen.</p>\n<h2>WebSockets with React</h2>\n<p>With the WebSocket server running, we can move on to the display of the messages on screen. Since I enjoy using <a href=\"https://reactjs.org/\">React</a>, and more importantly, <a href=\"https://reactjs.org/docs/hooks-intro.html\">React Hooks</a>, I set out to locate something to help with connecting to WebSockets. Sure enough, I found one that fit my exact need.</p>\n<p>The demo app UI is built with <a href=\"https://github.com/facebook/create-react-app\"><code>create-react-app</code></a>, and I used the <a href=\"https://v2.grommet.io/\">Grommet</a> framework. These topics are out of scope for this post, but you can grab my <a href=\"https://github.com/nexmo-community/sms-translation-demo-app\">source code</a> and follow along.</p>\n<h3>Connecting to the WebSocket</h3>\n<p>The first step here is to establish a connection and begin two-way communication. The module I found is <a href=\"https://github.com/robtaussig/react-use-websocket\"><code>react-use-websocket</code></a>, and it made setting this up super simple.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b698846475596\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install react-use-websocket\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b698846475596-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b698846475596-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b698846475596-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">react</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">use</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">websocket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b698846475596-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>There are tons of these React hook libraries out there that help you create some impressive functionality in a short amount of time. In this instance, importing the module and setting up a couple of items for the configuration is all it took to get a connection.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b699000735064\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nimport useWebSocket from 'react-use-websocket';\n\nconst App = () =&gt; {\n  const STATIC_OPTIONS = useMemo(() =&gt; ({\n    shouldReconnect: (closeEvent) =&gt; true,\n  }), []);\n\n  const protocolPrefix = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n  let { host } = window.location;\n  const [sendMessage, lastMessage, readyState] = useWebSocket(`${protocolPrefix}//${host}/socket`, STATIC_OPTIONS);\n\n  //...\n}\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b699000735064-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b699000735064-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b699000735064-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b699000735064-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b699000735064-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b699000735064-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b699000735064-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b699000735064-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b699000735064-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b699000735064-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b699000735064-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b699000735064-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b699000735064-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b699000735064-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b699000735064-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">useWebSocket </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'react-use-websocket'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b699000735064-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b699000735064-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b699000735064-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">STATIC_OPTIONS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">useMemo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b699000735064-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">shouldReconnect</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">closeEvent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b699000735064-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b699000735064-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b699000735064-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">protocolPrefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'wss:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ws:'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b699000735064-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b699000735064-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sendMessage</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">readyState</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">useWebSocket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">protocolPrefix</span><span class=\"crayon-sy\">}</span><span class=\"crayon-c\">//${host}/socket`, STATIC_OPTIONS);</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b699000735064-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b699000735064-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b699000735064-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b699000735064-14\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>In the component, we import the <code>useWebSocket</code> method to pass the WebSocket URL and the object <code>STATIC_OPTIONS</code> as the second argument. The <code>useWebSocket</code> method is a custom hook that returns the <code>sendMessage</code> method, <code>lastMessage</code> object from the server (which is our translated messages), and the <code>readyState</code> which is an integer to give us the status of the connection.</p>\n<h3>Receiving Incoming Messages</h3>\n<p>Once <code>react-use-websocket</code> makes the connection to the server, we can now start listening for messages from the <code>lastMessage</code> property. When receiving incoming messages from the server, they populate here and update the component. If your server has multiple message types, you discern that information here. Since we only have one, it&#8217;s an easier implementation.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b69a138004310\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst [messageHistory, setMessageHistory] = useState([]);\n\nuseEffect(() =&gt; {\n  if (lastMessage !== null) {\n    setMessageHistory(prev =&gt; prev.concat(lastMessage))\n  }\n}, [lastMessage]);\n\nreturn (\n  &lt;Main&gt;\n    {messageHistory.map((message, idx) =&gt; {\n      let msg = JSON.parse(message.data);\n      return (\n        &lt;Box&gt;\n          &lt;Text&gt;From: {msg.from}&lt;/Text&gt;\n          &lt;Heading level={2}&gt;{msg.translation}&lt;/Heading&gt;\n        &lt;/Box&gt;\n      )\n    })}\n  &lt;/Main&gt;\n)\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69a138004310-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">messageHistory</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">setMessageHistory</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">useState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-3\"><span class=\"crayon-e\">useEffect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">setMessageHistory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prev</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">concat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">lastMessage</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-9\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Main</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">messageHistory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Box</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Text</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">From</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Text</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Heading </span><span class=\"crayon-v\">level</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">translation</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Heading</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Box</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Main</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69a138004310-21\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69a138004310-22\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<p>The built-in hook <code>useEffect</code> runs every time the state is updated. When <code>lastMessage</code> is not null, it adds the new message to the end of the previous message state array, and the UI updates using the <code>map</code> function to render all of the messages. It is in the <code>messageHistory</code> where all of the JSON strings we passed from the server are stored. The main functionality of our WebSocket is complete, but I still want to add a few more items.</p>\n<h3>Sending Messages to the Server</h3>\n<p>Since this is a translation demo, having more than one language is an excellent way to show the power of the Google Translate API in conjunction with Nexmo SMS messages. I created a dropdown with languages to pick. This dropdown is where bi-directional communication happens with the server, and the app sends the selected language from the client.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b69c118139714\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst languages = [\n  { label: \"English\", value: \"en\"},\n  { label: \"French\", value: \"fr\"},\n  { label: \"German\", value: \"de\"},\n  { label: \"Spanish\", value: \"es\"}\n];\n\n&lt;Select\n  labelKey=\"label\"\n  onChange={({ option }) =&gt; {\n    sendMessage(option.value)\n    setTranslateValue(option.label)\n  }}\n  options={languages}\n  value={translateValue}\n  valueKey=\"value\"\n/&gt;\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69c118139714-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">languages</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"English\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"en\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"French\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"fr\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"German\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"de\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Spanish\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"es\"</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-6\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Select</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-9\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">labelKey</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"label\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">onChange</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">option</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">sendMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">setTranslateValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">options</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">languages</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">translateValue</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">valueKey</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"value\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69c118139714-17\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69c118139714-18\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>Here, the <code>sendMessage</code> function from <code>react-use-websocket</code> is how we can send information back to our server and consume it. This process is where the event handler we set up comes in handy from earlier. It is this dropdown that determines what language the Google Translate API translates the message into and displays on the screen.</p>\n<h3>Connection Status Display</h3>\n<p>Since this is a demo in a conference environment, I thought having a connectivity indicator would be a good idea. As long as the front-end remains connected to the WebSocket, the light displays green.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7b69d578316924\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nconst CONNECTION_STATUS_CONNECTING = 0;\nconst CONNECTION_STATUS_OPEN = 1;\nconst CONNECTION_STATUS_CLOSING = 2;\n\nfunction Status({ status }) {\n  switch (status) {\n    case CONNECTION_STATUS_OPEN:\n      return &lt;&gt;Connected&lt;div className=\"led green\"&gt;&lt;/div&gt;&lt;/&gt;;\n    case CONNECTION_STATUS_CONNECTING:\n      return &lt;&gt;Connecting&lt;div className=\"led yellow\"&gt;&lt;/div&gt;&lt;/&gt;;\n    case CONNECTION_STATUS_CLOSING:\n      return &lt;&gt;Closing&lt;div className=\"led yellow\"&gt;&lt;/div&gt;&lt;/&gt;;\n    default:\n      return &lt;&gt;Disconnected&lt;div className=\"led grey\"&gt;&lt;/div&gt;&lt;/&gt;;;\n  }\n}\n\n//....\n&lt;Status status={readyState} /&gt;\n//...\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7b69d578316924-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CONNECTING</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_OPEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CLOSING</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-5\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_OPEN</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Connected</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led green\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CONNECTING</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Connecting</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led yellow\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CONNECTION_STATUS_CLOSING</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Closing</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led yellow\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">default</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-v\">Disconnected</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">className</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"led grey\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-18\"><span class=\"crayon-c\">//....</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-19\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Status </span><span class=\"crayon-v\">status</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">readyState</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7b69d578316924-20\"><span class=\"crayon-c\">//...</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7b69d578316924-21\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p>The <code>Status</code> component uses the <code>readyState</code> to switch between the various statuses and indicates that to the user. If it turns red, you know something is wrong with the WebSocket server, and you should check into it.</p>\n<p>Once everything is up and running, it looks something like this:</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/03/using_translation_app.gif\" alt=\"Animation of Working Demo App\" title=\"Animation of Working Demo App\" /></p>\n<h2>Try It Out</h2>\n<p>The <a href=\"https://github.com/nexmo-community/sms-translation-demo-app\">demo application code</a> is on our community GitHub organization, and you can try it out for yourself as well. I&#8217;ve created a README that should help you get through the setup and run it locally on your server or deploy it to Heroku. I&#8217;ve also provided a Dockerfile, if you&#8217;d prefer to go that route. Let me know what you think of it, and if you have any trouble, feel free to reach out and submit an issue on the repo.</p>\n"}