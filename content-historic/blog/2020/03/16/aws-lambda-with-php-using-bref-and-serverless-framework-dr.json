{"_filedata":{"slug":"aws-lambda-with-php-using-bref-and-serverless-framework-dr"},"title":"AWS Lambda With PHP Using Bref And Serverless Framework","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/E_AWS-Lambda_1200x600.png","author":340,"published":true,"published_at":"2020-03-16T13:12:07","tags":[499,416,1687,161,1686,200,1216],"body":"<p>Using PHP in serverless environments has previously been challenging due to the lack of default runtimes provided by the various cloud providers. However, this has changed recently with added libraries and functionality, making the use of PHP more approachable.</p>\n<p>This example will create an <a href=\"https://aws.amazon.com/lambda/\">AWS Lambda</a> Function for PHP using <a href=\"https://bref.sh/\">Bref</a>. The addition of <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/runtimes-api.html\">AWS Lambda Runtime API</a> and the ability to add <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html\">AWS Lambda Layers</a> has made it easier to create a PHP custom runtime. Therefore, packages like Bref have sprung up to make PHP developers&#8217; lives easier.</p>\n<h2>Prerequisites</h2>\n<p>Here are things you will need for this example:</p>\n<ul>\n<li>PHP installed locally (version 7.3+ preferred)</li>\n<li><a href=\"https://getcomposer.org/doc/00-intro.md#globally\">Composer installed globally</a></li>\n<li><a href=\"https://nodejs.org/en/\">Node.js</a></li>\n<li><a href=\"https://aws.amazon.com/\">AWS account</a> and <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html\">access keys</a> for a user with access to <a href=\"https://docs.aws.amazon.com/s3/\">AWS S3</a> as well as <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/welcome.html\">AWS Lambda</a></li>\n</ul>\n<h2>Serverless Framework</h2>\n<p>The <a href=\"https://bref.sh/\">Bref</a> tool leverages the <a href=\"https://serverless.com\">Serverless Framework</a> foundation, which is a &#8220;complete solution for building and operating serverless applications&#8221;. Thus, our first step is to get this framework installed on the development system you&#8217;re using. We recommend installing it globally, to allow usage from anywhere via CLI.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7aa62836473938\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nnpm install -g serverless\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa62836473938-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa62836473938-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa62836473938-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">serverless</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa62836473938-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h3>AWS Credentials</h3>\n<p>With Serverless installed, ensure you&#8217;ve also set up the AWS credentials needed for Serverless to interact with the various AWS services. (S3, Lambda, and potentially EC2 or databases as required) In this example, we will only be using S3 and Lambda. You can read more about this at <a href=\"https://serverless.com/framework/docs/providers/aws/guide/credentials/#using-aws-access-keys\">serverless.com</a> and <a href=\"https://bref.sh/docs/installation/aws-keys.html\">bref.sh</a> so that we won&#8217;t go into the details here.</p>\n<h2>Install Bref</h2>\n<p>You should also install Bref as a dependency within each given project using it. With that in mind, we will use Composer to install it using the CLI from within the project directory.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7aa65600711337\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\ncomposer require bref/bref\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa65600711337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa65600711337-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa65600711337-1\"><span class=\"crayon-e\">composer </span><span class=\"crayon-e\">require </span><span class=\"crayon-v\">bref</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">bref</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa65600711337-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<h3>Init Bref Project</h3>\n<p>After Composer has finalized the addition of Bref to the project, the best way to get started is to <code>init</code> Bref for usage. Doing the <code>init</code> will then prompt whether you desire a Function, HTTP, or Console function, resulting in the creation of <code>serverless.yml</code> and possibly <code>index.php</code> depending upon your selection, which you can edit to fit the needs of the application.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7aa67934578391\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nvendor/bin/bref init\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa67934578391-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa67934578391-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa67934578391-1\"><span class=\"crayon-v\">vendor</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">bref </span><span class=\"crayon-i\">init</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa67934578391-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<h4>Example YML File</h4>\n<p>As an example, below is a sample <code>serverless.yml</code> file:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7aa68313422641\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nservice: app\n\nprovider:\n    name: aws\n    region: us-east-1\n    runtime: provided\n\nplugins:\n    - ./vendor/bref/bref\n\nfunctions:\n    function:\n        handler: index.php\n        description: ''\n        layers:\n            - ${bref:layer.php-73}\n\n# Exclude files from deployment\npackage:\n    exclude:\n        - 'tests/**'\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa68313422641-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-1\"><span class=\"crayon-v\">service</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">app</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-3\"><span class=\"crayon-v\">provider</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aws</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-5\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">region</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">us</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">east</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">runtime</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">provided</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-8\"><span class=\"crayon-v\">plugins</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vendor</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bref</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">bref</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-11\"><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">function</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">handler</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-14\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">description</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">layers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">bref</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">layer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">73</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-18\"><span class=\"crayon-p\"># Exclude files from deployment</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-19\"><span class=\"crayon-t\">package</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">exclude</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa68313422641-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tests/**'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa68313422641-22\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p>In the file, observe the name of the service, which you can alter to fit the desired naming conventions of your functions. By default, it is named <code>app</code>.</p>\n<p>Following this, we can see the provider information for AWS Lambda.</p>\n<p>There is a section for any plugins and the inclusion of Bref.</p>\n<p>Then, there is the section outlining the details of the function. Included is the handler, desired description to be added to AWS, and any layers required, such as PHP. Note in the example above, <code>php-73</code> is specified. If you selected HTTP instead, it would specify <code>php-73-fpm</code> and provide a web server in the layer instead of a CLI only version of PHP. The image to be used is why the <code>init</code> process is essential to ensure Lambda creates the correct layer.</p>\n<h2>Deploying to AWS Lambda</h2>\n<p>For either Function or HTTP use cases, the default <code>init</code> provides enough of a skeleton to deploy straight to AWS Lambda and test using Serverless. Leveraging the AWS credentials configuration added prior, Serverless will deploy straight to Lambda using the contents of <code>serverless.yml</code> as criteria.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7aa69670623394\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nserverless deploy\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa69670623394-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa69670623394-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa69670623394-1\"><span class=\"crayon-e\">serverless </span><span class=\"crayon-i\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa69670623394-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0000 seconds] -->\r\n<p></p>\n<h2>Testing the Function</h2>\n<p>In the case of a function, there are two ways to test. One way is to use the AWS Console, while the second is using Serverless via CLI from the system used to deploy.</p>\n<h3>AWS Console</h3>\n<p>By navigating the AWS Console select the Lambda item from the list of Compute services.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/02/aws_console_compute_lambda.png\" alt=\"aws_console_compute_lambda\" title=\"AWS Console-Lambda Dashboard\" /></p>\n<p>On the Lambda dashboard, you can select the function created and create a new test by clicking <code>Configure test events</code>. Alternatively, you can click the <code>Test</code> button to receive the same prompt.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/02/lambda_function_create_test.png\" alt=\"lambda_function_create_test\" title=\"Lambda Create Test\" /></p>\n<p>For a test of the skeleton created, add a name and slightly alter the JSON in the body.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/02/configure_test_events.png\" alt=\"configure_test_events\" title=\"Configure Test Events\" /></p>\n<p>Upon clicking the <code>Create</code> button at the bottom of the dialog, you can then click the <code>Test</code> button to execute the test. Running should result in a green dialog area you can expand to show the results.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/02/lambda_test_results.png\" alt=\"lambda_test_results\" title=\"Lambda Test Results\" /></p>\n<h3>Serverless Function Execution</h3>\n<p>As stated above, you can also use the Serverless CLI to also test the function by using the following command from within the local application root:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bcd7aa6b552537305\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nserverless invoke -f function --data='{\"name\": \"Adam\"}'\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bcd7aa6b552537305-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bcd7aa6b552537305-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bcd7aa6b552537305-1\"><span class=\"crayon-e\">serverless </span><span class=\"crayon-v\">invoke</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'{\"name\": \"Adam\"}'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bcd7aa6b552537305-2\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0001 seconds] -->\r\n<p></p>\n<p>Example result:</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/02/serverless_lambda_function_execution.png\" alt=\"serverless_lambda_function_execution\" title=\"Serverless Lambda Function Execution\" /></p>\n<h3>Testing An HTTP Function</h3>\n<p>If you deployed an HTTP function instead, the two testing methods above would not work. Instead, you can use an HTTP client or a standard browser to test by using the URL provided by the deploy output results.</p>\n<h2>What Next</h2>\n<p>With an AWS Lambda function created, you can continue adding more code and creating more robust PHP apps leveraging the serverless technologies available today. Watch for future posts showing how to build useful functions to leverage Vonage APIs and services using AWS Lambda.</p>\n"}