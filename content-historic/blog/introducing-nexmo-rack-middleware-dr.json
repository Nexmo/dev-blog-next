{"_filedata":{"slug":"introducing-nexmo-rack-middleware-dr"},"title":"Introducing Nexmo Rack Middleware","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/11/Rack-Middleware_1200x600.png","author":301,"published":true,"published_at":"2019-12-04T09:00:56","tags":[360,125,1652,1653,375,92],"body":"Behind every great web framework is infrastructure that makes it all possible. Whether you are building with Ruby on Rails, Sinatra or other Ruby based web frameworks, you are most likely utilizing Rack.\n\nRack makes it possible to build a customizable interface between your favorite framework and your application server. This will allow you to introduce middleware into your program.\n\nRack middleware are succinct applications that are called upon during a web application’s request and response lifecycle.\n\nSo, whether you are looking to middleware for security, logging, serving static files or more, you can do so in a relatively straightforward process.\n\n## Introducing Nexmo Rack\n\nIf you are working on a Nexmo based application written in Ruby now you can take advantage of the newly released `nexmo_rack` to incorporate Nexmo API functionality into your middleware stack.\n\n[Nexmo Rack Middleware](https://github.com/Nexmo/nexmo-rack) is our latest offering in our growing Ruby toolkit, which already includes a [Ruby SDK](https://github.com/Nexmo/nexmo-ruby) and a [Rails initializer gem](https://github.com/Nexmo/nexmo-rails).\n\nWe released the Nexmo Rack middleware at RubyConf 2019 with its first use-case of verifying signed SMS messages. This is a very relevant area for Rack middleware. If you are working with SMS in your application, then this first feature of `nexmo_rack` is something that could benefit your development.\n\n[Signed SMS messages](https://developer.nexmo.com/concepts/guides/signing-messages) is a way to verify that the message originated from its claimed source, that it has not been tampered with and to protect against message interception.\n\nWith Nexmo you can use signatures for both outbound and inbound messaging. We support a variety of signing algorithms, including `MD5`, `SHA-256`, `SHA-512` and others. You must set and use a `SIGNATURE SECRET` to encrypt and decrypt signed SMS messages. Your `SIGNATURE SECRET` can be set in your [Nexmo Dashboard](https://dashboard.nexmo.com).\n\n## Get Started With Nexmo Rack\n\nTo use the Nexmo Rack middleware, you need to install the gem. If you are building a Rails application, you can include it in your project’s `Gemfile`:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">gem 'nexmo_rack'</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e06db2077978251-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e06db2077978251-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e06db2077978251-1\"><span class=\"crayon-i\">gem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nexmo_rack'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e06db2077978251-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nTo install the gem in a standalone Ruby application, you can simply install it on your system by running `gem install nexmo_rack` from the command line.\n\nAfter installing the gem, you must provide it your signature secret, and the desired signature hashing method.\n\n### Provide Your Credentials\n\nNexmo Rack supports both environment variables and Rails Credentials, and you are welcome to use whichever you prefer when providing the gem with your API credentials. Regardless of your chosen method, it is always advisable to not commit your credentials to version control.\n\nIf you are using environment variables, open up your `.env` file and add two new entries for your Nexmo signature secret and the desired signing algorithm:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_SIGNATURE_SECRET = 'your_secret_key' NEXMO_SIGNATURE_METHOD = 'md5hash'</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e06db5943775492-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e06db5943775492-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e06db5943775492-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e06db5943775492-1\"><span class=\"crayon-v\">NEXMO_SIGNATURE_SECRET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'your_secret_key'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e06db5943775492-2\"><span class=\"crayon-v\">NEXMO_SIGNATURE_METHOD</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'md5hash'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e06db5943775492-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nIf you are using the Rails Credentials system, you must first open up your decrypted Rails Credentials by executing `EDITOR=\"code --wait\" rails credentials:edit` from your command line. You can replace the value for the `EDITOR=` variable with your preferred code editor.\n\nOnce the credentials file is open, you can add the signature secret and signature method with the following namespacing:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">nexmo: signature_secret: your_secret_key signature_method: md5hash</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e06db7016034511-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e06db7016034511-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e06db7016034511-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e06db7016034511-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e06db7016034511-1\"><span class=\"crayon-v\">nexmo</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e06db7016034511-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">signature_secret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">your_secret_key</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e06db7016034511-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">signature_method</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">md5hash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e06db7016034511-4\">&nbsp;</div></div></td></tr></tbody></table>\n\n### Using The Middleware\n\nOnce Nexmo Rack is properly credentialed in your application you can go ahead and use it. One of the best features of Rack middleware is its usage simplicity.\n\nThe `VerifySignature` functionality will inspect every incoming request for a `sig` key, and will seek to verify the signature of those messages that have the `sig` key. If the message is verified it will pass it to the next item in your stack, and if the message is not verified it will return a `403 Forbidden` status. You can enable this functionality in either a standalone Ruby application or a Rails application.\n\n#### Mounted Into a Rails Application\n\nAdd the Nexmo Rack middleware into your `config/application.rb` file to initialize it within your application:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">config.middleware.use Nexmo::Rack::VerifySignature</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e06db8515585535-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e06db8515585535-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e06db8515585535-1\"><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">middleware</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Rack</span><span class=\"crayon-o\">::</span><span class=\"crayon-i\">VerifySignature</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e06db8515585535-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n#### As a Standalone Application\n\nAdd the Nexmo Rack middleware into your `config.ru` Rack configuration file:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">use Nexmo::Rack::VerifySignature</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e06db9213071901-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e06db9213071901-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e06db9213071901-1\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">Rack</span><span class=\"crayon-o\">::</span><span class=\"crayon-i\">VerifySignature</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e06db9213071901-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThat is all you have to do to start taking advantage of seamless signed SMS validations using Nexmo Rack!\n\nDo you have any questions or comments? We would love to hear what you are building with Nexmo Rack or any of our Ruby tooling. You can join the Nexmo Developer Relations team on [Slack](https://developer.nexmo.com/community/slack), send us an [email](mailto:devrel@nexmo.com) or connect with us on [Twitter](https://twitter.com/NexmoDev).\n\n## Further Reading\n\nInterested in discovering more?\n\n*   [Signed Messages Concept Overview](https://developer.nexmo.com/concepts/guides/signing-messages)\n*   [Nexmo Rack on GitHub](https://github.com/Nexmo/nexmo-rack)\n*   [Nexmo SDKs and Tools](https://developer.nexmo.com/tools)"}