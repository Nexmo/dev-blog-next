{"_filedata":{"slug":"send-and-receive-sms-messages-with-firebase-functions-dr"},"title":"Send and Receive SMS Messages with Firebase Functions","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/01/E_SMS-with-Firebase_1200x600.png","author":295,"published":true,"published_at":"2020-01-24T13:03:31","tags":[360,1111,92],"body":"The Firebase platform allows developers to build an application backend rapidly. It’s also enjoyable to use as well. For this tutorial, I wanted to start using it for some SMS messaging with [Nexmo](https://www.nexmo.com/). After this walk-through, you will be able to create an SMS message log, and a response to the sender using [Firebase Functions](https://firebase.google.com/docs/functions/get-started) and Firestore alongside the Nexmo SMS API.\n\n## Before You Get Started\n\nYou will need a few items to get going – so take a moment and make sure you have both of these ready to go.\n\n1.  [Firebase](https://firebase.google.com/)\n2.  [Nexmo](https://dashboard.nexmo.com/sign-in)\n\n## Setting up Firebase\n\nThe first step is to set up a Firebase project. The following will walk you through setting up a new project using the Firebase console.\n\n### Create the Firebase Project\n\n1.  Go to [Firebase console](https://console.firebase.google.com/)\n2.  Click add project\n    \n    ![Click Add Project](https://www.nexmo.com/wp-content/uploads/2020/01/create-project.png)\n    \n3.  Add a name and click continue\n    \n    ![Name Project](https://www.nexmo.com/wp-content/uploads/2020/01/name-project.png)\n    \n4.  Leave Google Analytics on and click continue (not required)\n    \n5.  Select a Google Analytics account and then click Create Project (if added)\n    \n    ![Add analytics](https://www.nexmo.com/wp-content/uploads/2020/01/add-analytics.png)\n    \n6.  Wait a bit for the project to be created – takes less than a minute\n    \n7.  Set the Billing type under _⚙️ -> Usage and Billing -> Details & Settings_ to Blaze. The Pay-as-you-go plan is required to use a third-party API. For more details regarding billing with Google, go [here](https://cloud.google.com/billing/docs/how-to/payment-methods).  \n    ![Change Billing](https://www.nexmo.com/wp-content/uploads/2020/01/update-billing.png)\n8.  Set the `Google Cloud Platform (GCP) resource location` in `⚙️ -> Project Settings`  \n    ![Update Location](https://www.nexmo.com/wp-content/uploads/2020/01/update-location.png)\n\n### Install Firebase Tools\n\nMost everything you will need to do with Firebase can be done directly from the command line with the toolset they provide.\n\n1.  Install the Firebase tools with npm  \n    `npm install -g firebase-tools`\n2.  Log in to Firebase using `firebase login`. The login process will open your browser for authentication.\n\n### Setup Local Environment\n\nWriting Firebase functions requires some initialization work to get started, but it’s mostly done for you using Firebase Tools commands.\n\n1.  Create a project folder `mkdir nexmo-project && cd nexmo-project`\n    \n2.  Initialize Firebase Functions `firebase init functions`\n    \n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">######## #### ######## ######## ######## ### ###### ######## ## ## ## ## ## ## ## ## ## ## ## ###### ## ######## ###### ######## ######### ###### ###### ## ## ## ## ## ## ## ## ## ## ## ## #### ## ## ######## ######## ## ## ###### ######## You're about to initialize a Firebase project in this directory: /your_folders/your-project-name === Project Setup First, let's associate this project directory with a Firebase project. You can create multiple project aliases by running firebase use --add, but for now, we'll just set up a default project. ? Please select an option: (Use arrow keys) ❯ Use an existing project Create a new project Add Firebase to an existing Google Cloud Platform project Don't set up a default project</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b6140665198-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b6140665198-23\">23</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-1\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-p\">######## #### ########&nbsp;&nbsp;######## ########&nbsp;&nbsp;&nbsp;&nbsp; ###&nbsp;&nbsp;&nbsp;&nbsp; ######&nbsp;&nbsp;########</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-p\">##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;&nbsp;##&nbsp;&nbsp;&nbsp;&nbsp; ## ##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ##&nbsp;&nbsp;&nbsp;&nbsp; ##&nbsp;&nbsp;##&nbsp;&nbsp; ##&nbsp;&nbsp;##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ##</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-p\">######&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;&nbsp;########&nbsp;&nbsp;######&nbsp;&nbsp; ########&nbsp;&nbsp;#########&nbsp;&nbsp;######&nbsp;&nbsp;######</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-p\">##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;&nbsp;##&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;&nbsp;##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ##&nbsp;&nbsp;&nbsp;&nbsp; ## ##&nbsp;&nbsp;&nbsp;&nbsp; ##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ## ##</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-p\">##&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #### ##&nbsp;&nbsp;&nbsp;&nbsp; ## ######## ########&nbsp;&nbsp;##&nbsp;&nbsp;&nbsp;&nbsp; ##&nbsp;&nbsp;######&nbsp;&nbsp;########</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-7\"><span class=\"crayon-i\">You</span><span class=\"crayon-s\">'re about to initialize a Firebase project in this directory:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-9\"><span class=\"crayon-s\">/your_folders/your-project-name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-12\"><span class=\"crayon-s\">=== Project Setup</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-13\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-14\"><span class=\"crayon-s\">First, let'</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">associate </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">project </span><span class=\"crayon-e\">directory </span><span class=\"crayon-i\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Firebase </span><span class=\"crayon-v\">project</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-15\"><span class=\"crayon-e\">You </span><span class=\"crayon-e\">can </span><span class=\"crayon-e\">create </span><span class=\"crayon-e\">multiple </span><span class=\"crayon-e\">project </span><span class=\"crayon-e\">aliases </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">firebase </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">add</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-16\"><span class=\"crayon-e\">but </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">we</span><span class=\"crayon-s\">'ll just set up a default project.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-17\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-18\"><span class=\"crayon-s\">? Please select an option: (Use arrow keys)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-19\"><span class=\"crayon-s\">❯ Use an existing project</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-20\"><span class=\"crayon-s\">Create a new project</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-21\"><span class=\"crayon-s\">Add Firebase to an existing Google Cloud Platform project</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b6140665198-22\"><span class=\"crayon-s\">Don'</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set </span><span class=\"crayon-i\">up</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">project</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b6140665198-23\">&nbsp;</div></div></td></tr></tbody></table>\n\nSince you already created a project in the dashboard, you can select `Use an existing project` which will prompt you to choose the desired project. If you haven’t done this, use `Create a new project` and give it a unique name to create one. You would still need to go to the console to update the location and billing, but it is another option to create Firebase projects.\n\n1.  Select the project name you created\n2.  Select JavaScript\n3.  Choose Y for ESLint if you desire (I recommend it)\n4.  Install all dependencies now\n\nThese steps will create the folders and files required to build Firebase Functions and installs all dependencies. Once NPM completes, switch to the `functions` directory and open `index.js` in your favorite editor to start adding code.\n\n### Create Your First Function\n\nThe first function you create will act as a webhook to capture and log incoming SMS messages from Nexmo.\n\nThe `index.js` file has some example code provided you won’t need. Delete everything and start at the top to add the following code.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const functions = require('firebase-functions'); const admin = require('firebase-admin'); // Initialize Firebase app for database access admin.initializeApp();</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b9108756110-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b9108756110-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b9108756110-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b9108756110-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11b9108756110-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11b9108756110-6\">6</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b9108756110-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'firebase-functions'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b9108756110-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'firebase-admin'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b9108756110-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b9108756110-4\"><span class=\"crayon-c\">// Initialize Firebase app for database access</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11b9108756110-5\"><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initializeApp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11b9108756110-6\">&nbsp;</div></div></td></tr></tbody></table>\n\nCalling `admin.initializeApp();` allows the functions to read and write to the Firebase Real-Time database. Next, use the following method to create your function.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// This function will serve as the webhook for incoming SMS messages, // and will log the message into the Firebase Realtime Database exports.inboundSMS = functions.https.onRequest(async (req, res) =&gt; { await admin.database().ref('/msgq').push(req.body); res.send(200); });</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bb363525264-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bb363525264-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bb363525264-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bb363525264-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bb363525264-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bb363525264-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bb363525264-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bb363525264-1\"><span class=\"crayon-c\">// This function will serve as the webhook for incoming SMS messages,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bb363525264-2\"><span class=\"crayon-c\">// and will log the message into the Firebase Realtime Database</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bb363525264-3\"><span class=\"crayon-v\">exports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">inboundSMS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">https</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">onRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bb363525264-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">database</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ref</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/msgq'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bb363525264-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bb363525264-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bb363525264-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe `inboundSMS` method listens for HTTPS requests – which is precisely what Nexmo webhook needs. The Firebase Function will capture the `req.body` and send it to the `/msgq` object in the Real-Time Database as a log.\n\nSince we are using `req.body`, the webhook will need to be a `POST Method`. If you’d prefer to (or you have to) use the `GET` method for Nexmo webhooks, just replace it with `req.query`, and the GET method will work the same way.\n\nNow that you have some code written be sure to save your file an deploy the function to Firebase:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">firebase deploy --only functions === Deploying to 'nexmo-project'... i deploying functions Running command: npm --prefix \"$RESOURCE_DIR\" run lint &gt; functions@ lint /Users/kellyjandrews/Google Drive/Apps/nexmo-project/functions &gt; eslint . ✔ functions: Finished running predeploy script. i functions: ensuring necessary APIs are enabled... ✔ functions: all necessary APIs are enabled i functions: preparing functions directory for uploading... i functions: packaged functions (38.78 KB) for uploading ✔ functions: functions folder uploaded successfully i functions: creating Node.js 8 function inboundSMS(us-central1)... ✔ functions[inboundSMS(us-central1)]: Successful create operation. Function URL (inboundSMS): https://us-central1-nexmo-project.cloudfunctions.net/inboundSMS ✔ Deploy complete! Project Console: https://console.firebase.google.com/project/nexmo-project/overview</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bc075338728-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bc075338728-24\">24</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-1\"><span class=\"crayon-e\">firebase </span><span class=\"crayon-v\">deploy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">only </span><span class=\"crayon-v\">functions</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-3\"><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Deploying </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nexmo-project'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-5\"><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploying </span><span class=\"crayon-e\">functions</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-6\"><span class=\"crayon-e\">Running </span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$RESOURCE_DIR\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">lint</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-8\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lint</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Users</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">kellyjandrews</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Google </span><span class=\"crayon-v\">Drive</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Apps</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">project</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">functions</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-9\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">eslint</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-11\">✔<span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Finished </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">predeploy </span><span class=\"crayon-v\">script</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-12\"><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ensuring </span><span class=\"crayon-e\">necessary </span><span class=\"crayon-e\">APIs </span><span class=\"crayon-e\">are </span><span class=\"crayon-v\">enabled</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-13\">✔<span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">necessary </span><span class=\"crayon-e\">APIs </span><span class=\"crayon-e\">are </span><span class=\"crayon-i\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-14\"><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preparing </span><span class=\"crayon-e\">functions </span><span class=\"crayon-e\">directory </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uploading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-15\"><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">packaged </span><span class=\"crayon-e\">functions</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">38.78</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KB</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">uploading</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-16\">✔<span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">functions </span><span class=\"crayon-e\">folder </span><span class=\"crayon-e\">uploaded </span><span class=\"crayon-i\">successfully</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-17\"><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">creating </span><span class=\"crayon-v\">Node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">js</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inboundSMS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">us</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">central1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-18\">✔<span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">inboundSMS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">us</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">central1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Successful </span><span class=\"crayon-e\">create </span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-19\"><span class=\"crayon-t\">Function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inboundSMS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//us-central1-nexmo-project.cloudfunctions.net/inboundSMS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-21\">✔<span class=\"crayon-h\"> </span><span class=\"crayon-e\">Deploy </span><span class=\"crayon-v\">complete</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bc075338728-23\"><span class=\"crayon-e\">Project </span><span class=\"crayon-v\">Console</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//console.firebase.google.com/project/nexmo-project/overview</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bc075338728-24\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe vital piece from the output is `Function URL (inboundSMS)`. This URL is required to set up the webhook in Nexmo, which you will do next.\n\n## Setting up Nexmo\n\nThere are a few quick steps to setting up Nexmo – all done from the command line.\n\n1.  Install the CLI  \n    `npm install -g nexmo-cli`\n2.  Setup the CLI with your API key and secret from the dashboard https://dashboard.nexmo.com/getting-started-guide\n3.  Purchase a new phone number  \n    `nexmo number:buy --country_code US`\n    \n    1.  This command retrieves the first available phone number in the US. For more info on Nexmo numbers, you can view the \\[numbers documentation\\](https://developer.nexmo.com/numbers/overview\n    2.  Type confirm, then copy the number\n4.  Link the phone number to the webhook using this command  \n    `nexmo link:sms YOUR_NUMBER YOUR_FUNCTION_URL`\n\nGive the process a few seconds to completely provision, then test out the new function to make sure the message is getting logged.\n\nGrab your phone and send a message to the phone number. Open up the Firebase console and navigate to `database` page, and you should see something like this:\n\n![Real-time Database Nexmo Message Entry](https://www.nexmo.com/wp-content/uploads/2020/01/database-nexmo-object.png)\n\nNow that there is a way to log incoming messages, you can write a function to do something with the incoming message.\n\n## Create the Send Function\n\nSo far, you have created a Firebase Function linked to a Nexmo phone number for capturing inbound SMS messages. Firebase Functions can also react to database updates. Upon a new entry, the code sends an echo of the original text.\n\nStart by adding Nexmo to the dependency list – make sure you do this in the `functions` directory:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">npm i nexmo --save</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11be315565486-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11be315565486-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11be315565486-1\"><span class=\"crayon-i\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">save</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11be315565486-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nAdd the following environment variables to the Firebase config\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">firebase functions:config:set nexmo.api_key=\"YOUR_KEY\" nexmo.api_secret=\"YOUR_SECRET\"</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11bf498551619-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11bf498551619-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11bf498551619-1\"><span class=\"crayon-e\">firebase </span><span class=\"crayon-v\">functions</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">config</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">set </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"YOUR_KEY\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">api_secret</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"YOUR_SECRET\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11bf498551619-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nNext, open `index.js` add `nexmo` to the requirements at the top, and import the environment variables to initialize Nexmo:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">const functions = require('firebase-functions'); const admin = require('firebase-admin'); const Nexmo = require('nexmo'); // Initialize Firebase app for database access admin.initializeApp(); // get Firebase environment variables for Nexmo const { api_key, api_secret } = functions.config().nexmo; // Initialize Nexmo with application credentials const nexmo = new Nexmo({ apiKey: api_key, apiSecret: api_secret });</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c1094663150-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c1094663150-19\">19</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'firebase-functions'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'firebase-admin'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'nexmo'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-5\"><span class=\"crayon-c\">// Initialize Firebase app for database access</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-6\"><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">initializeApp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-8\"><span class=\"crayon-c\">// get Firebase environment variables for Nexmo</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-9\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">api_key</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">api</span><span class=\"crayon-sy\">_</span>secret</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-12\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-13\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-14\"><span class=\"crayon-c\">// Initialize Nexmo with application credentials</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-15\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Nexmo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">apiKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">api_key</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">apiSecret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">api</span><span class=\"crayon-sy\">_</span>secret</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c1094663150-18\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c1094663150-19\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow you can create the new function for Firebase to send the response:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">// This function listens for updates to the Firebase Realtime Database // and sends a message back to the original sender exports.sendSMS = functions.database.ref('/msgq/{pushId}') .onCreate((message) =&gt; { const { msisdn, text, to } = message.val(); // the incoming object - 'msisdn' is the your phone number, and 'to' is the Nexmo number // nexmo.message.sendSms(to, msisdn, text); return nexmo.message.sendSms(to, msisdn, `You sent the following text: ${text}`, (err, res) =&gt; { if (err) { console.log(err); } else { if (res.messages[0]['status'] === \"0\") { console.log(\"Message sent successfully.\"); } else { console.log(`Message failed with error: ${res.messages[0]['error-text']}`); } } }) });</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c2831182567-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c2831182567-20\">20</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-1\"><span class=\"crayon-c\">// This function listens for updates to the Firebase Realtime Database</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-2\"><span class=\"crayon-c\">// and sends a message back to the original sender</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-3\"><span class=\"crayon-v\">exports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sendSMS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">database</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ref</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/msgq/{pushId}'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">onCreate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">val</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// the incoming object - 'msisdn' is the your phone number, and 'to' is the Nexmo number</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// nexmo.message.sendSms(to, msisdn, text);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendSms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">to</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">You </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">following </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Message sent successfully.\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">Message </span><span class=\"crayon-e\">failed </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'error-text'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c2831182567-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c2831182567-20\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe new function will watch for new messages added to the `/msgq` database object. When triggered, the full Nexmo object gets passed as `message` . This object includes `msisdn`, which is the originating phone number – yours in this case, and the `to` number, which is the Nexmo virtual number you purchased.\n\nWith the phone numbers in hand, as well as the text message, you can now do any number of things. You can create a lookup table to respond with specific data based on the keyword, forward to another system, or in our case, send the original message.\n\nDeploy the Firebase Functions again from the command line:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">firebase deploy --only functions</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1be11c3193199296-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1be11c3193199296-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1be11c3193199296-1\"><span class=\"crayon-e\">firebase </span><span class=\"crayon-v\">deploy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">only </span><span class=\"crayon-i\">functions</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1be11c3193199296-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nGrab your phone, send another message, and then you should get a response back that looks something like `You sent the following text: Test message`.\n\n## Wrap Up\n\nYou have now completed all the steps for this tutorial. You can see the full code on [Github](https://github.com/nexmo-community/firebase-functions-sms-example).\n\nNow that the initial steps to send and receive messages are complete, my next few posts will take this concept and expand it into controlling some of my home automation via text messages. I would love to hear what you plan to do as well so send me a message on [Twitter](https://twitter.com/kellyjandrews) and let me know.\n\n## Further Reading\n\n*   Check out the Developer Documentation at [https://developer.nexmo.com](https://developer.nexmo.com)\n*   Details about Nexmo SMS Functionality [https://developer.nexmo.com/messaging/sms/overview](https://developer.nexmo.com/messaging/sms/overview)\n*   Getting started with Firebase Functions [https://firebase.google.com/docs/functions/get-started](https://firebase.google.com/docs/functions/get-started)"}