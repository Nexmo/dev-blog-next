{"_filedata":{"slug":"build-voicemail-node-red-voice-api-dr"},"title":"Build Your Own Voicemail With Node-RED and the Nexmo Voice API","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-featured-image.png","author":256,"published":true,"published_at":"2019-11-14T12:54:36","tags":[1645,1168,1625,1629,1646,1177],"body":"I have been avoiding voicemail for most of my life. Most of the time for one simple reason—I could never quite get 100% of the message.\n\nI would have considered myself lucky if they’d slurred out a number I could have called back, the voicemail had been empty-ish or they had gotten past their first name. In most cases though it would go something like this:\n\n_“Hi Julia, this is Ted, I’m with didn’t\\_really\\_get\\_the\\_name . I’m sorry we haven’t been able to get back together on this – if you’re like me I’m sure you’re being pulled in many different directions and are real busy. Do me a favour, though, and when you get this message, just call me back and leave a message with what you’ve decided to do about my proposal. Either way, it will be nice for me to know. Thanks in advance for that, and I’ll be waiting for your call..”_\n\nTed… Mosby? Crilly? Maybe, Cassidy? We’ll never know.\n\nLuckily, building your own voicemail in Node-RED is both faster and easier than deciphering those messages. Follow along to see how it works!\n\n## What You’re Going to Build\n\nThis tutorial is part of the [_“Getting Started with Nexmo and Node-RED”_](https://www.nexmo.com/blog/tag/node-red) series.\n\nThese articles show you how to get started with Nexmo APIs like SMS, Voice and Verify, so feel free to refer back to them as you go, or in case you’d like to add another functionality.\n\nIn this tutorial we’ll be building a simple voicemail service that allows callers to reach your Nexmo number and leave a message.\n\nThe recorded voice message will then be fetched from the Nexmo servers and sent to your email address.\n\n## Dependencies\n\n### Prerequisites\n\nBefore getting started, you’ll need a few things:\n\n*   [Node.js](https://nodejs.org/en/) and [Node-RED](https://nodered.org/docs/getting-started/installation) installed, if you’re developing locally\n*   A Nexmo account — [create one for free](https://dashboard.nexmo.com/sign-up) if you haven’t already\n*   A way to expose your server to the internet. This either means you’re running a hosted version of Node-RED, or using a tunneling service like [ngrok](https://flows.nodered.org/node/node-red-contrib-ngrok) – get up to speed with this [Getting Started with Ngrok in Node-RED](https://www.nexmo.com/blog/2019/07/03/ngrok-in-node-red-dr/) tutorial\n\n### Getting Your Credentials\n\nTo use the Nexmo nodes in Node-RED you’ll have to provide your credentials, so it’s best to keep them handy. Go to your [dashboard](https://dashboard.nexmo.com) to find your API key and secret and make a note of them.\n\nNext, you’ll need a _Voice-enabled_ virtual number. Go to Numbers > [Buy numbers](https://dashboard.nexmo.com/buy-numbers) to get one.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/04/buy-number-nexmo-dashboard.gif)\n\n### Setting Up Your Node-RED Editor\n\nAccess your Node-RED editor by pointing your browser at [http://localhost:1880](http://localhost:1880).\n\nOnce you have the editor open, you’ll need to install the [Nexmo nodes](https://flows.nodered.org/node/node-red-contrib-nexmo), the [Ngrok node](https://flows.nodered.org/node/node-red-contrib-ngrok)(if not using a hosted version of Node-RED) and the default [Email node](https://flows.nodered.org/node/node-red-node-email). You can do so under the _Manage palette_ menu, by searching for the corresponding packages and clicking install:\n\n*   Nexmo: `node-red-contrib-nexmo`\n*   Ngrok: `node-red-contrib-ngrok`\n*   Email: `node-red-node-email`\n\nAfter restarting Node-RED, you should see all of these nodes appear on the left side of your screen – in your node palette, among other default nodes.\n\n## Expose Your Local Server to the Internet\n\nIn case you’re not using a hosted version of Node-RED, the Nexmo Voice API will need another way to access your webhook endpoints, so let’s [make your local server accessible over the public internet](https://www.nexmo.com/blog/2019/07/03/ngrok-in-node-red-dr/). If you’re running Node-RED on a public web server instead of your local machine, you’re all set and ready to move on to the \\[_Create a Nexmo Voice Application_\\] step.\n\nA convenient way to do this is by using a tunneling service like [ngrok](https://ngrok.com), and there is a [node](https://flows.nodered.org/node/node-red-contrib-ngrok) for it that you’ve just added to your palette.\n\nIt takes the strings **on** and **off** as input to start/stop the tunnel, and outputs the ngrok host address as the _msg.payload_. Check out our tutorial on [Getting Started with Ngrok in Node-RED](https://www.nexmo.com/blog/2019/07/03/ngrok-in-node-red-dr/) to find out more.\n\n_Import_ from _Clipboard_ the snippet below, or have a stab at building this path yourself.\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">[ { \"id\": \"faed0f7.1e524f\", \"type\": \"inject\", \"z\": \"5b8bbfc3.1a9f18\", \"name\": \"\", \"topic\": \"\", \"payload\": \"on\", \"payloadType\": \"str\", \"repeat\": \"\", \"crontab\": \"\", \"once\": false, \"onceDelay\": 0.1, \"x\": 190, \"y\": 100, \"wires\": [ [ \"8a01baeb.6756d\" ] ] }, { \"id\": \"11051fa9.75bd1\", \"type\": \"inject\", \"z\": \"5b8bbfc3.1a9f18\", \"name\": \"\", \"topic\": \"\", \"payload\": \"off\", \"payloadType\": \"str\", \"repeat\": \"\", \"crontab\": \"\", \"once\": false, \"onceDelay\": 0.1, \"x\": 190, \"y\": 160, \"wires\": [ [ \"8a01baeb.6756d\" ] ] }, { \"id\": \"8a01baeb.6756d\", \"type\": \"ngrok\", \"z\": \"5b8bbfc3.1a9f18\", \"port\": \"1880\", \"creds\": \"5a9e2b8c.173a2c\", \"region\": \"ap\", \"subdomain\": \"\", \"name\": \"\", \"x\": 400, \"y\": 140, \"wires\": [ [ \"93fd5675.743c1\" ] ] }, { \"id\": \"93fd5675.743c1\", \"type\": \"debug\", \"z\": \"5b8bbfc3.1a9f18\", \"name\": \"\", \"active\": true, \"tosidebar\": true, \"console\": false, \"tostatus\": false, \"complete\": \"false\", \"x\": 620, \"y\": 140, \"wires\": [] }, { \"id\": \"5a9e2b8c.173a2c\", \"type\": \"ngrokauth\", \"z\": \"\" } ]</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1fef6b6866541789-79\">79</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-1\"><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"faed0f7.1e524f\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"inject\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"z\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5b8bbfc3.1a9f18\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"topic\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"payload\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"on\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"payloadType\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"str\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"repeat\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"crontab\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"once\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"onceDelay\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"x\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">190</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"y\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"wires\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"8a01baeb.6756d\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"11051fa9.75bd1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"inject\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"z\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5b8bbfc3.1a9f18\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"topic\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"payload\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"off\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"payloadType\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"str\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"repeat\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"crontab\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"once\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"onceDelay\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"x\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">190</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"y\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">160</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"wires\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"8a01baeb.6756d\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"8a01baeb.6756d\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ngrok\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"z\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5b8bbfc3.1a9f18\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"port\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1880\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"creds\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5a9e2b8c.173a2c\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"region\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ap\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"subdomain\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"x\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-52\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"y\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">140</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"wires\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-54\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-55\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"93fd5675.743c1\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-57\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-58\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-59\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-60\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"93fd5675.743c1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-61\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"debug\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-62\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"z\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5b8bbfc3.1a9f18\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-63\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-64\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"active\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-65\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"tosidebar\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-66\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"console\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-67\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"tostatus\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-68\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"complete\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"false\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-69\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"x\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">620</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-70\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"y\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">140</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-71\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"wires\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-72\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-73\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-74\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5a9e2b8c.173a2c\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-75\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ngrokauth\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-76\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"z\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-77\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1fef6b6866541789-78\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1fef6b6866541789-79\">&nbsp;</div></div></td></tr></tbody></table>\n\nAt this point, your editor should look similar to this:\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/ngrok-path.png)\n\nAs the last step before hitting **Deploy**, open up the _`ngrok`_ node properties and specify the port number (`1880` for Node-RED) and the Region.\n\nYou can also add your authtoken if you already have a ngrok account. Don’t worry if you don’t, just skip this step for now. The node will warn that it is not fully configured but this is not an issue.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/ngrok-properties.png)\n\nHit **Deploy** and click on the **on** _`inject`_ node’s button, then navigate to the URL displayed in the debug area (YOUR\\_URL for future reference) to find your Node-RED editor at a public address.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/ngrok-nodered.png)\n\n## Create a Nexmo Voice Application\n\nThe Nexmo Voice API uses Nexmo Applications to hold security and config information needed to connect to Nexmo endpoints.\n\nIn the Nexmo Node-RED palette, several nodes have the capability to create these applications: _`getrecording`_, _`earmuff`_, _`mute`_, _`hangup`_, _`transfer`_, _`createcall`_, _`playaudio`_, _`playtts`_ and _`playdtmf`_.\n\nDrag any of these nodes into your workspace, then double-click on it to open up the node properties.\n\nNext to the `Nexmo Credentials`, select “Add new nexmovoiceapp…” from the drop-down menu and click the edit button. Fill in the details below and click _Create New Application_.\n\n| KEY | DESCRIPTION |\n| --- | --- |\n| `Name` | Choose a name for your Voice Application, for example “Nexmo Voice Application”. |\n| `API Key` | Your Nexmo API key, shown in your [account overview](https://dashboard.nexmo.com/getting-started-guide). |\n| `API Secret` | Your Nexmo API secret, shown in your [account overview](https://dashboard.nexmo.com/getting-started-guide). |\n| `Answer URL` | YOUR\\_URL/answer, you’ll be hosting a Nexmo Call Control Object (NCCO) here. – more about this later on. |\n| `Event URL` | YOUR\\_URL/event, you’ll need to reference this when setting up the event handler. |\n\nNode-RED will then create a new Nexmo Application on your account and fill in the App ID and Private Key fields. After this step, feel free to delete the Nexmo node you used, as a `nexmovoiceapp` config node has been created, and that contains all the Nexmo credentials this flow needs.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/create-voiceapp.png)\n\n## Set Up a Number to Call\n\nNext, you’ll have to link your virtual number to this application.\n\nFind the Voice Application you’ve just created in your Nexmo Dashboard by navigating to _Voice_ > _[Your Applications](https://dashboard.nexmo.com/voice/your-applications)_.\n\nClick on the name of this application, then under the _Numbers_ tab click on the **Link** button next to the virtual number you’ve rented earlier.\n\nIn case the number you’d like to use is already linked to another app, click on **Manage number** and configure it to forward incoming calls to your app.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/link-number.png)\n\n_Bonus tip:_ Use a _`comment`_ node to take note of the Nexmo number linked to your application, this way you always have it handy.\n\n## Handle Inbound Calls\n\nWhen you receive an inbound call to your virtual number, the Nexmo Voice API makes a `GET` request to an endpoint you define, `YOUR_URL/answer`, and expects a set of instructions on how to handle the call.\n\nFirst, let’s implement this endpoint.\n\n### Define the Webhook Endpoint for Inbound Calls\n\nAdd a _`voice webhook`_ and a _`return ncco`_ node to your workspace, and wire them together to define a webhook endpoint.  \nNext, open up the _`voice webhook`_ node properties, select `GET` as a `Method` and type `/answer` in the `URL` field, then press _Deploy_.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/inbound-webhook.png)\n\nGreat! Now you have a webhook that returns an NCCO to Nexmo’s API. At this point it doesn’t contain any instructions, so let’s add some!\n\n### Build the Nexmo Call Control Object (NCCO)\n\nThe instructions expected by the Nexmo API come in the form of a _Nexmo Call Control Object_, also known as NCCO.\n\nThere are lots of different actions available, find the corresponding nodes under the Nexmo palette in your Node-RED editor or check out the [NCCO Reference](https://developer.nexmo.com/api/voice/ncco) to find out more about them.\n\nIn this case, you’ll probably want to greet the caller then start recording the message. To do this, you’ll need to add a _`talk`_ node followed by a _`record`_ node.\n\nAdd them to your workspace, then connect them in between the _`voice webhook`_ and _`return ncco`_ nodes.\n\n#### _`talk`_\n\nNext, open up the _`talk`_ node editor and set the `Text{}` field to the message you’d like to be read out to the caller. Eg. “Hi! You’ve reached X, please leave a message.”\n\nIf you’re feeling nostalgic about old school voicemails, you’re all set. On the other hand, you could also personalize the experience by selecting a [`Voice Name`](https://developer.nexmo.com/voice/voice-api/guides/text-to-speech#voice-names) or by making use of [SSML tags](https://developer.nexmo.com/voice/voice-api/guides/customizing-tts), so that it sounds more like a person and less like a robot.\n\n#### _`record`_\n\nIn the _`record`_ node properties fill in the `URL {}` field with `YOUR_URL/record`. This is going to be the eventURL that Nexmo will return a set of parameters to, once the recording has completed.\n\nIf you glance over at the [NCCO Reference](https://developer.nexmo.com/voice/voice-api/ncco-reference#record) you’ll soon realize that the calling number is not one of them.\n\nFortunately, we can grab the caller’s phone number from the answerURL and pass it as a query parameter.\n\nUpdate the `URL {}` field to `YOUR_URL/record?from={{msg.call.from}}`. This way we’ll be able to access the `from` value through the record eventURL by referencing `msg.req.query.from`.\n\nBefore moving on to the next step, make sure you’ve selected `POST` as a `Method`, `MP3` as a `Format` and that you’ve set a value for `End On Silence` (eg. 3).\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-record.png)\n\nIf you’d like to see the generated NCCO, go to `YOUR_URL/answer`. You’ll see a set of actions, or “instructions”, in JSON format that Nexmo will use to control the call flow.\n\nReady to take it a step further? Dial your Nexmo number to see it in action!\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-ncco.png)\n\n## Fetch Recording\n\nAt this point, the caller is greeted by a TTS message followed by a beep tone and their message gets recorded. The next step is to fetch the recording from the Nexmo servers.\n\n### Record eventURL\n\nFirst, let’s define the record eventURL where we’re expecting the recording parameters to be sent upon completion.\n\nAdd a _`http in`_ node to your workspace, then connect a _`http response`_ node, as well as to a _`debug`_ node to it. This way you can start logging events in the debug area and gain a bit more insight into what is really going on.\n\nOpen up the _`http in`_ node properties, select `POST` as a `Method` and fill in the `URL` field with `/record`.\n\nThe _`http response`_ node should have `200` set as `Status code`, but don’t worry about it, this is the default value as well.\n\nAlthough the recording data is coming through as `msg.payload`, we still have the `from` value stored in `msg.req.query.from`. Make sure you select `complete msg object` in the _`debug`_ node’s editor as `Output`.\n\n### Get Recording\n\nTo actually retrieve the recording, we’ll be using the _`getrecording`_ Nexmo node.  \nAdd one to your canvas, connect it to the `/record` _`http in`_ node and open up its node editor.\n\nYou’ll see two fields:\n\n1.  `Nexmo Credentials` – select the voice application you created earlier from the drop-down menu.\n2.  `Filename {}` – Notice the `{}` sign in the label, which means that this field supports [Mustache templating](https://mustache.github.io/) and the value can be set dynamically. This gives us the perfect opportunity to include the caller’s number and a timestamp in the filename, so let’s set it to `recordings/{{msg.req.query.from}}_{{msg.payload.timestamp}}.mp3`.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-getrecording.png)\n\nNote, this node does not write the audio to disk, the filename field is there to set the value of msg.filename. Next, there are a couple different routes you can take: upload the audio to your own server, follow with a _`file`_ node and download it to your computer, or use an _`e-mail`_ node and send it to yourself.\n\n## Send Recording to an Email Address\n\nFor this example we’ll use the default Node-RED _`e-mail`_ node, which sends the `msg.payload` as an email, with a subject of `msg.topic`.\n\nIn our case, `msg.payload` is a binary buffer (the recording) and it will be converted to an attachment. If you wish to add a body to your email set it as `msg.description` using a _`change`_ node in the flow before the _`e-mail`_ node.\n\nThe filename will be `msg.filename`, which we’ve already specified.\n\nConnect a _`change`_ node into _`getrecording`_, followed by an _`e-mail`_ node. You’ll find both in your node palette, _`change`_ under _function_ and _`e-mail`_ under _social_.  \nNext, let’s see how to configure them.\n\n### _`change`_\n\nOpen up the _`change`_ node properties and define two rules using the _set_ operation.\n\nFirst, let’s set `msg.topic`, the subject of the email.\n\nIn the upper field replace `payload` with `topic`, then select `expression` type from the `to` drop-down, which uses the [JSONata](http://jsonata.org/) query and expression language. To include the caller’s number in the email subject, fill in this field with something like `'Voicemail from ' & msg.req.query.from`.\n\nClick on the **add** button to define a second rule. This time we’ll be setting the value of `msg.description`, the email body. You could use an expression again, or just go with a simple string like “Hey, you’ve got voicemail!”.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-change.png)\n\nPress **Done** once you’re finished, and let’s move on to the _`e-mail`_ node!\n\n### _`e-mail`_\n\nIn the _`e-mail`_ node editor there are three fields you need to fill in: `To` – the recipient email address, `Userid` and `Password` – your email login details.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-email.png)\n\nOnce you’re done, hit **Done** and **Deploy**. Your Voicemail is up and running!\n\n## Log Call Events\n\nOne more thing before you go! It’s quite useful to see your call events in the debug area and have a better understanding of what’s really going on, so let’s add an event webhook!\n\nConnect an _`http in`_ node to an _`http response`_ node, as well as to a _`debug`_ node, so that you can view your call events in the debug area.\n\nIn the _`http in`_ node, select `POST` as a `Method` and fill in the `URL` field with `/event`.\n\nThe _`http response`_ node should have `200` set as `Status code`, but don’t worry about it, this is the default value as well.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-flow.png)\n\nNow call your Nexmo number and follow your call events in the debug sidebar!\n\n## Try it Out!\n\nEt voilà! You’ve built your own voicemail service and, hopefully, you’ll never have to put up with another pesky voicemail again. Call your Nexmo number and an email will be headed your way shortly.\n\n![](https://www.nexmo.com/wp-content/uploads/2019/11/voicemail-email-in.png)\n\n## Where Next?\n\n### Further Reading\n\n*   [Voice API Reference](https://developer.nexmo.com/voice/voice-api/overview)\n*   [Record NCCO Reference](https://developer.nexmo.com/voice/voice-api/ncco-reference#record)\n*   [TTS Voice Names](https://developer.nexmo.com/voice/voice-api/guides/text-to-speech#voice-names)\n*   [Using SSML Tags](https://developer.nexmo.com/voice/voice-api/guides/customizing-tts)\n*   [Get Started with ngrok in Node-RED](https://www.nexmo.com/blog/2019/07/03/ngrok-in-node-red-dr/)\n\n### Try Another Tutorial\n\n*   [Forward a Call via a Voice Proxy with Node-RED](https://www.nexmo.com/blog/2019/10/17/forward-call-via-voice-proxy-node-red-dr)\n*   [Build a Conference Call with Node-RED](https://www.nexmo.com/blog/2019/10/07/conference-call-node-red-dr)\n*   [Verify Phone Numbers with Node-RED](https://www.nexmo.com/blog/2019/09/25/verify-phone-numbers-with-node-red-dr)\n*   [How to Stream Audio into a Call with Node-RED](https://www.nexmo.com/blog/2019/07/15/stream-audio-node-red-dr)\n*   [How to Make Text-to-Speech Phone Calls with Node-RED](https://www.nexmo.com/blog/2019/06/14/make-text-to-speech-phone-calls-node-red-dr/)\n*   [How to Receive Phone Calls with Node-RED](https://www.nexmo.com/blog/2019/05/09/receive-phone-calls-node-red-dr/)\n*   [How to Send SMS Messages with Node-RED](https://www.nexmo.com/blog/2019/04/17/send-sms-messages-node-red-dr/)\n*   [How to Receive SMS Messages with Node-RED](https://www.nexmo.com/blog/2019/04/24/receive-sms-messages-node-red-dr/)\n\nwindow.addEventListener('DOMContentLoaded', (event) => { document.querySelectorAll(\".gif-player\").forEach(image => { image.src = image.src.replace(/\\\\.gif$/g, \".png\") image.addEventListener(\"click\", (event) => { if (event.target.src.indexOf(\".gif\") > 0) { image.src = image.src.replace(/\\\\.gif$/g, \".png\") } else { image.src = image.src.replace(/\\\\.png$/g, \".gif\") } }) }) });\n\n.gif-player { cursor: pointer; } img.alignnone { border-width: 0px !important; } .crayon-syntax { height: 400px !important; overflow: scroll !important; }"}