{"_filedata":{"slug":"use-python-and-flask-to-manage-queues-via-sms-dr"},"title":"Use Python and Flask to Manage Queues via SMS","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/01/manage-queues_1200x600.png","author":357,"published":true,"published_at":"2020-01-03T18:44:28","tags":[119,1543,410,92],"body":"While many human experiences can be improved with the application of technology, there is one clearly ripe for a modern solution: **waiting in line**. Whether you plan to renew your driver’s license or get a seat at a popular brunch spot, time spent crammed into waiting rooms with strangers is something you’d likely be happy to avoid. Fortunately, the ubiquity of cell phones means new text and web-based queue systems are becoming more common—send a text to reserve your place in line, check in for status updates, and get notified when you’ve reached the front of the line.\n\nIn this tutorial, I’ll be showing you how to use [Python](https://www.python.org/) and the [Flask](http://flask.palletsprojects.com/en/1.1.x/) framework to build a simple SMS queue management system. There are three main components:\n\n*   A backend to respond to text messages and take appropriate action\n*   A status page that can be accessed via the web or displayed at a kiosk\n*   A management page that lists those in line and allows them to be notified or removed\n\nTo keep things simple, this application will only handle the most basic functions, but the skeleton it provides should make it easy to build out a robust system to fit your needs.\n\n## Prerequisites\n\n*   [Python](https://www.python.org/) (this code was tested with v3.8)\n*   A [Nexmo account](https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&utm_medium=github&utm_campaign=sms-queue-notify) with a phone number enabled for SMS\n*   [ngrok](https://ngrok.com/)\n\n## Set Up\n\nTo get started, create and navigate to a new directory for the project:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">mkdir sms-queue-notify cd sms-queue-notify</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b05198979754-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b05198979754-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b05198979754-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b05198979754-1\"><span class=\"crayon-e\">mkdir </span><span class=\"crayon-v\">sms</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">queue</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">notify</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b05198979754-2\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">sms</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">queue</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">notify</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b05198979754-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nIf you’d prefer to start with the final code, you can clone the [sample project](https://github.com/nexmo-community/sms-queue-notify) from the Nexmo Community GitHub:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">git clone https://github.com/nexmo-community/sms-queue-notify.git cd sms-queue-notify</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b09615873693-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b09615873693-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b09615873693-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b09615873693-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/nexmo-community/sms-queue-notify.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b09615873693-2\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">sms</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">queue</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">notify</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b09615873693-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nOnce you are in your project directory, create and activate a virtual environment:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">python3 -m venv venv source venv/bin/activate</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0a755743428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0a755743428-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0a755743428-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0a755743428-1\"><span class=\"crayon-v\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">venv </span><span class=\"crayon-e\">venv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0a755743428-2\"><span class=\"crayon-e\">source </span><span class=\"crayon-v\">venv</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">activate</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0a755743428-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe virtual environment helps you manage and isolate your project dependencies. To install the necessary dependencies for this project, you’ll need to have a `requirements.txt` file. If you’ve cloned the sample repo you’re already set, but if you’re building from scratch your file should look like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">Flask==1.1.1 Flask-SQLAlchemy==2.4.1 nexmo==2.4.0</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0b075686109-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0b075686109-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0b075686109-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0b075686109-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0b075686109-1\"><span class=\"crayon-v\">Flask</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">1.1.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0b075686109-2\"><span class=\"crayon-v\">Flask</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">SQLAlchemy</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">2.4.1</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0b075686109-3\"><span class=\"crayon-v\">nexmo</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">2.4.0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0b075686109-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nTo install these dependencies, run the following in your project directory:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">pip install -r requirements.txt</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0c804297463-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0c804297463-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0c804297463-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requirements</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0c804297463-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n## Database Initialization\n\nBefore your application can run properly, you’ll need to set up a database to store information about the people waiting in line. Because the data storage requirements for this project are relatively simple, you’ll be using Python’s built-in database, SQLite. You’ll be managing your database with [Flask-SQLAlchemy](https://flask-sqlalchemy.palletsprojects.com/en/2.x/), which provides a layer on top of the database so you can make queries with simple functions rather than writing SQL.\n\nIf you haven’t downloaded the code from the sample repo, create a new file named `main.py`, containing the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">from flask import Flask, render_template, request, Response from flask_sqlalchemy import SQLAlchemy db_path = \"sqlite:///queue.db\" app = Flask(__name__) app.config[\"SQLALCHEMY_DATABASE_URI\"] = db_path db = SQLAlchemy(app) class User(db.Model): phone_number = db.Column(db.String, unique=True, nullable=False, primary_key=True) notified = db.Column(db.Integer) join_time = db.Column(db.DateTime) wait_time = db.Column(db.Integer) if __name__ == '__main__': app.run(debug=True, threaded=True)</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0e101434173-19\">19</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">flask </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">Flask</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">render_template</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Response</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">flask_sqlalchemy </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">SQLAlchemy</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-4\"><span class=\"crayon-v\">db_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sqlite:///queue.db\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-6\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-7\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"SQLALCHEMY_DATABASE_URI\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">db_path</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-9\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SQLAlchemy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Model</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">phone_number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Column</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unique</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nullable</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">primary_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Column</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">join_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Column</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DateTime</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Column</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-17\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0e101434173-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">debug</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threaded</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0e101434173-19\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis script sets up your Flask application and basic database configuration, including defining a name and location for the database, as well as defining the names and datatypes of the columns within the database. Once you have this or the sample `main.py`, start up Python in interactive mode:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">python</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b0f761517896-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b0f761517896-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b0f761517896-1\"><span class=\"crayon-i\">python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b0f761517896-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen run the following commands to set up your database:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&gt;&gt;&gt; from main import db &gt;&gt;&gt; db.create_all() &gt;&gt;&gt; quit()</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b10051095560-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b10051095560-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b10051095560-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b10051095560-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b10051095560-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">main </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">db</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b10051095560-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b10051095560-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">quit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b10051095560-4\">&nbsp;</div></div></td></tr></tbody></table>\n\n## ngrok and Nexmo Configuration\n\nNow that you have a database ready to go, you’ll need to do some basic setup to use Nexmo for sending and receiving text messages. As a first step, make sure you have ngrok installed and running on port 5000:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">ngrok http 5000</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b11612410400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b11612410400-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b11612410400-1\"><span class=\"crayon-e\">ngrok </span><span class=\"crayon-i\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b11612410400-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nWhen ngrok is running, you’ll be presented with a URL to use for forwarding to your local server. Make a note of this URL, as you will use it soon:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/01/ngrok.png)](https://www.nexmo.com/wp-content/uploads/2020/01/ngrok.png)\n\nOn the main page of your Nexmo Dashboard, locate your Key and Secret:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/01/dashboard-main.png)](https://www.nexmo.com/wp-content/uploads/2020/01/dashboard-main.png)\n\nCopy these and put them near the top of your `main.py` file as follows:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_KEY = \"&lt;Your Nexmo Key&gt;\" NEXMO_SECRET = \"&lt;Your Nexmo Secret&gt;\"</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b13228004230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b13228004230-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b13228004230-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b13228004230-1\"><span class=\"crayon-v\">NEXMO_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;Your Nexmo Key&gt;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b13228004230-2\"><span class=\"crayon-v\">NEXMO_SECRET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;Your Nexmo Secret&gt;\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b13228004230-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen, add this line:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">client = nexmo.Client(key=NEXMO_KEY, secret=NEXMO_SECRET)</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b14056898704-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b14056898704-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b14056898704-1\"><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Client</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">NEXMO_KEY</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">secret</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">NEXMO_SECRET</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b14056898704-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nBack at the dashboard, navigate to _Numbers_ -> _Your numbers_ (if don’t have a number yet, go to _Numbers_ -> _Buy numbers_ first). Hover over your number until you see the _Copy_ button. Click this, then paste the number in `main.py` like so:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">NEXMO_NUMBER = \"&lt;Your Nexmo Number&gt;\"</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b15693757729-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b15693757729-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b15693757729-1\"><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;Your Nexmo Number&gt;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b15693757729-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nWhile you’re here, click on the gear icon under the _Manage_ column:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/01/your-numbers.png)](https://www.nexmo.com/wp-content/uploads/2020/01/your-numbers.png)\n\nIn the _Inbound Webhook URL_ field, enter the following, using the ngrok URL you gathered earlier:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;Your ngrok URL&gt;/webhooks/inbound-sms</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b16277224071-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b16277224071-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b16277224071-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">ngrok </span><span class=\"crayon-v\">URL</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">webhooks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">inbound</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b16277224071-2\">&nbsp;</div></div></td></tr></tbody></table>\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/01/webhook-url.png)](https://www.nexmo.com/wp-content/uploads/2020/01/webhook-url.png)\n\nSave this setting.\n\nIf you are working from the sample repo, you now have everything you need to run the application. Enter the following in the terminal to kick off your development server:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">python main.py</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b17891638344-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b17891638344-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b17891638344-1\"><span class=\"crayon-e\">python </span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b17891638344-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn a browser, navigate to your ngrok URL to see the status view, or go to `<ngrok url>/list` to see the management view. Then text ‘Hi’ to the number you’ve configured to add yourself to the list!\n\nFor those building from scratch, let’s move on to creating your backend logic.\n\n## Backend\n\nThe backend structure for this application is relatively simple. You will create four routes—two associated with the frontend views, one webhook for receiving inbound SMS messages, and one stream to publish [server-sent events](https://pythonpedia.com/en/tutorial/9100/python-server-sent-events). In addition to the routes, you’ll need a set of functions that perform actions based on the messages received and other user input. Finally, you’ll have a few helper functions to manage database queries and format text.\n\nLet’s start with the routes for the views. Add the following to `main.py` after the section where you initialize the database and before `if __name__ == '__main__'`:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">@app.route('/') def index(): return render_template('index.html', length=query_length(), number=phone_format(NEXMO_NUMBER)) @app.route('/list', methods=('GET', 'POST')) def list(): if request.method == 'POST': if 'notify' in request.form: notify(request.form['notify']) elif 'remove' in request.form: remove(request.form['remove']) elif 'arrived' in request.form: remove(request.form['arrived']) users = query_users() return render_template('list.html', users=users)</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b18404778412-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b18404778412-16\">16</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render_template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'index.html'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">query_length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">phone_format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-5\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/list'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'notify'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'notify'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">elif</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'remove'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'remove'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">elif</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'arrived'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'arrived'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query_users</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b18404778412-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render_template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'list.html'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b18404778412-16\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe `index` route is straightforward—when someone visits the site, they will see the contents of the `index.html` page (yet to be created), which will include information about the line length and the phone number to be called (helped by functions you’ll be writing soon).\n\nThe `list` route has a little more information, as this page will allow for input. If the page is viewed (a GET request), the visitor will see the contents of `list.html`, complete with user information (phone numbers of people in line). If a POST request is made to this route via the form on the page, information from the request will be used to determine what button has been pressed. The `notify`, `remove`, and `query_users` functions will be defined shortly.\n\nNow that you have these routes defined, it’s time to add the webhook route:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">@app.route('/webhooks/inbound-sms', methods=('GET', 'POST')) def inbound_sms(): if request.is_json: message = request.get(json()) else: message = dict(request.form) or dict(request.args) num = message['msisdn'] text = message['text'].lower() map = { \"hi\": add, \"cancel\": remove, \"status\": status, \"help\": help } action = map.get(text) if action: action(num) else: send(num, \"Could not understand. Please try again\") return ('', 204)</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b19165825650-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b19165825650-21\">21</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/webhooks/inbound-sms'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">inbound_sms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">is_json</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msisdn'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'text'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"hi\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">add</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"cancel\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">remove</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"status\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"help\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">help</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">action</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Could not understand. Please try again\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b19165825650-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">204</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b19165825650-21\">&nbsp;</div></div></td></tr></tbody></table>\n\nYou may recognize this route from the configuration step earlier. When Nexmo gets an SMS message at the number you’ve configured with this webhook, you will get a request object containing the contents of the message and information about the sender. For our purposes, we pull out the sender’s phone number and the text of the message, mapping the text to the appropriate action functions. If we cannot parse the message, we let the sender know so they can try again.\n\nBefore you create the final route, let’s define our helper and action functions. Include the following in `main.py` after the route definitions:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def phone_format(num): return format(int(num[:-1]), \",\").replace(\",\", \"-\") + num[-1] def query_length(): return User.query.filter(User.notified == 0).count() def query_users(): users_waiting = [] users_notified = [] for result in User.query.all(): if result.notified == 0: time_diff = datetime.now() - result.join_time wait_time = divmod(time_diff.seconds, 60)[0] user = {\"phone_number\": str(result.phone_number), \"wait_time\": wait_time} users_waiting.append(user) else: wait_time = result.wait_time user = {\"phone_number\": str(result.phone_number), \"wait_time\": wait_time} users_notified.append(user) users = {\"waiting\": users_waiting, \"notified\": users_notified} return users def send(num, text): response = client.send_message({'from': NEXMO_NUMBER, 'to': num, 'text': text}) response = response['messages'][0] if response['status'] == '0': print('Sent message', response['message-id']) else: print('Error:', response['error-text']) return</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1b841682208-31\">31</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">phone_format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\",\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-4\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">query_length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">query_users</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users_waiting</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users_notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">result </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">time_diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join_time</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-13\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divmod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time_diff</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"phone_number\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">phone_number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"wait_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users_waiting</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait_time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-18\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"phone_number\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">phone_number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"wait_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users_notified</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"waiting\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users_waiting</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"notified\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users_notified</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">users</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-23\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'from'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NEXMO_NUMBER</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'messages'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Sent message'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'message-id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Error:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'error-text'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1b841682208-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1b841682208-31\">&nbsp;</div></div></td></tr></tbody></table>\n\nThese helper functions perform as follows:\n\n*   `phone_format`: Split the configured phone number with hyphens for display purposes.\n*   `query_length`: Query the database to see how many people are waiting in line.\n*   `query_users`: Query the database for all users, and format the result such that those waiting in line and those that have already been notified are grouped separately.\n*   `send`: Send an SMS message with the number and text provided.\n\nNext, add these action functions:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">def add(num): if User.query.get(num): send(num, \"Hello again!\") status(num) else: user = User(phone_number=num, notified=0, join_time=datetime.now()) db.session.add(user) db.session.commit() send(num, \"You've been added to the list\") help(num) return def remove(num): user = User.query.get(num) if user: db.session.delete(user) db.session.commit() send(num, \"You've been removed from the list\") else: print(\"User not found\") return def notify(num): user = User.query.get(num) if user.notified == 0: send(num, \"Your turn\") user.notified = 1 time_diff = datetime.now() - user.join_time user.wait_time = divmod(time_diff.seconds, 60)[0] db.session.commit() else: print(\"User already notified\") return def status(num): user = User.query.get(num) if not user: send(num, \"Not in line\") elif user.notified == 1: send(num, \"Notified\") else: users = query_users() users_sorted = sorted(users[\"waiting\"], key = lambda i: i['wait_time'], reverse = True) i = 0 while i &lt; len(users_sorted): if users_sorted[i][\"phone_number\"] == num: i += 1 break i += 1 send(num, \"Number \" + str(i) + \" of \" + str(len(users_sorted)) + \" in line\") return def help(num): send(num, \"For updates, text 'status'nTo remove yourself from the list, text 'cancel'\") return</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b1e336213146-56\">56</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello again!\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">phone_number</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">notified</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">join_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"You've been added to the list\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">help</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-13\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"You've been removed from the list\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"User not found\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-23\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Your turn\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">time_diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join_time</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-29\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divmod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time_diff</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"User already notified\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-34\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-35\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Not in line\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">elif </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Notified\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query_users</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users_sorted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"waiting\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wait_time'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reverse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">&nbsp;&nbsp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">users_sorted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users_sorted</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"phone_number\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Number \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" of \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">users_sorted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" in line\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-52\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-53\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">help</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-54\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"For updates, text 'status'nTo remove yourself from the list, text 'cancel'\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b1e336213146-55\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b1e336213146-56\">&nbsp;</div></div></td></tr></tbody></table>\n\nTo summarize:\n\n*   `add`: Adds a new user when ‘Hi’ is sent. Will also return the user’s status if they are already in line.\n*   `remove`: Removes a user from the list. Can be triggered from a button on the management page or if the user texts ‘cancel’.\n*   `notify`: Lets the user know it is their turn. Triggered from a button on the management page. Also calculates the total wait time for that user and stores in the database.\n*   `status`: Tells the user what place they are in line.\n*   `help`: Provides basic information about commands the user can send.\n\nWith those routes and functions defined, you have almost everything you need for a complete backend. The fourth and final route gives us a way to dynamically update the views based on messages from the server, which is useful when people are added and removed from the list via SMS:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">@app.route(\"/stream\") def stream(): def eventStream(): line_length = query_length() yield \"data: {}nn\".format(json.dumps(query_users())) while True: new_line_length = query_length() if new_line_length != line_length: line_length = new_line_length yield \"data: {}nn\".format(json.dumps(query_users())) time.sleep(1) return Response(eventStream(), mimetype=\"text/event-stream\")</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b20442341613-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b20442341613-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b20442341613-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b20442341613-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b20442341613-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b20442341613-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b20442341613-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b20442341613-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b20442341613-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b20442341613-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b20442341613-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b20442341613-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b20442341613-13\">13</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b20442341613-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/stream\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b20442341613-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b20442341613-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">eventStream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b20442341613-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">line_length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query_length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b20442341613-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"data: {}nn\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dumps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">query_users</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b20442341613-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b20442341613-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">new_line_length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query_length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b20442341613-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">new_line_length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">line_length</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b20442341613-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">line_length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_line_length</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b20442341613-10\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"data: {}nn\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dumps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">query_users</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b20442341613-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b20442341613-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">eventStream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text/event-stream\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b20442341613-13\">&nbsp;</div></div></td></tr></tbody></table>\n\nThis route functions differently than the previous ones. After it is initially called by the client, the function continues running until the server shuts down. This allows it to maintain a connection with the client, pushing updates whenever the number of people in line changes.\n\nNow that you have all the backend pieces, it’s time to create the views!\n\n## Frontend\n\nYou have two views to create: one for the status page and one for the management page. Start by creating a new directory, `templates`, and a new file within that directory, `index.html`. In that file put the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css\" integrity=\"sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu\" crossorigin=\"anonymous\"&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=\"container-fluid center-block text-center\"&gt; &lt;div class=\"row\"&gt; &lt;div class=\"col-lg-12\"&gt; &lt;p id=\"line_length\" style=\"font-size: 20vh\"&gt;{{ length }}&lt;/p&gt; &lt;p style=\"font-size: 5vh\"&gt;in line&lt;/p&gt; &lt;/div&gt; &lt;div class=\"row\"&gt; &lt;div class=\"col-lg-12\" style=\"height: 20vh\"&gt; &lt;/div&gt; &lt;div class=\"row\"&gt; &lt;div class=\"col-lg-12\"&gt; &lt;p class=\"lead\" style=\"font-size: 7vh\"&gt;Text &lt;b&gt;Hi&lt;/b&gt; to &lt;b&gt;{{ number }}&lt;/b&gt; to be added&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;script&gt; var targetContainer = document.getElementById(\"line_length\"); var eventSource = new EventSource(\"/stream\"); eventSource.onmessage = function(e) { var users = JSON.parse(e.data) targetContainer.innerHTML = users.waiting.length; }; &lt;/script&gt; &lt;noscript&gt; &lt;meta http-equiv=\"refresh\" content=\"30\"&gt; &lt;/noscript&gt; &lt;/html&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b21591808742-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b21591808742-38\">38</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">DOCTYPE </span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">integrity</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">crossorigin</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"anonymous\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-6\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"container-fluid center-block text-center\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"row\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"col-lg-12\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">&nbsp;&nbsp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"line_length\"</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"font-size: 20vh\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"font-size: 5vh\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">line</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"row\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"col-lg-12\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"height: 20vh\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"row\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"col-lg-12\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">&nbsp;&nbsp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"lead\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"font-size: 7vh\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">b</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Hi</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">b</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">b</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">b</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">added</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">&nbsp;&nbsp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-24\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-25\"><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">targetContainer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"line_length\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventSource</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EventSource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/stream\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">eventSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">onmessage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">targetContainer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">waiting</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-32\"><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-33\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">noscript</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">meta </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">equiv</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"refresh\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"30\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-35\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">noscript</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-36\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b21591808742-37\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b21591808742-38\">&nbsp;</div></div></td></tr></tbody></table>\n\nA few things to note here. First, you’ll see we’re using Bootstrap to provide some basic styling. You can read more about using Bootstrap in one of our [posts from a few weeks ago](https://www.nexmo.com/blog/2019/12/18/create-a-simple-messaging-ui-with-bootstrap-dr). Second, notice the `{{ length }}` and `{{ number }}` fields where we get input from the backend when the template is rendered. Finally, see the short Javascript snippet at the end—this connects to our `stream` endpoint and processes server-sent events, updating the number of users in line dynamically.\n\nThere’s also a short `noscript` section, which is set to refresh the page every thirty seconds if Javascript has been disabled. The way this application has been set up, it will still be able to function properly without Javascript, it just won’t update quite as instantly.\n\nFor the management page, create a new file `list.html` and include the following:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css\" integrity=\"sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu\" crossorigin=\"anonymous\"&gt; &lt;/head&gt; &lt;body&gt; &lt;form method=\"POST\" class=\"center-block text-center\" style=\"width: fit-content\"&gt; &lt;h3&gt;In Line&lt;/h3&gt; &lt;table id=\"notified\" class=\"table table-condensed\"&gt; {% for user in users.waiting %} &lt;tr&gt; &lt;td&gt;{{ user.phone_number }}&lt;/td&gt; &lt;td&gt;&lt;button name=\"notify\" value=\"{{ user.phone_number }}\" class=\"btn btn-primary btn-xs\" type=\"submit\"&gt;Notify&lt;/button&gt;&lt;/td&gt; &lt;td&gt;&lt;button name=\"remove\" value=\"{{ user.phone_number }}\" class=\"btn btn-default btn-xs\" type=\"submit\"&gt;Remove&lt;/button&gt;&lt;/td&gt; &lt;/tr&gt; {% endfor %} &lt;/table&gt; &lt;h3&gt;Notified&lt;/h3&gt; &lt;table class=\"table table-condensed\"&gt; {% for user in users.notified %} &lt;tr&gt; &lt;td&gt;{{ user.phone_number }}&lt;/td&gt; &lt;td&gt;&lt;button name=\"arrived\" value=\"{{ user.phone_number }}\" class=\"btn btn-primary btn-xs\" type=\"submit\"&gt;Arrived&lt;/button&gt;&lt;/td&gt; &lt;/tr&gt; {% endfor %} &lt;/table&gt; &lt;/form&gt; &lt;/body&gt; &lt;script&gt; var targetContainer = document.getElementById(\"notified\"); var eventSource = new EventSource(\"/stream\"); eventSource.onmessage = function(e) { var user; var users = JSON.parse(e.data); users = users.waiting.sort((a, b) =&gt; (a.wait_time &lt; b.wait_time) ? 1 : -1) var user_table = ''; for (user of users){ user_table = user_table + '&lt;tr&gt;' + '&lt;td&gt;' + user.phone_number + '&lt;/td&gt;' + '&lt;td&gt;&lt;button name=\"notify\" value=\"' + user.phone_number + '\" class=\"btn btn-primary btn-xs\" type=\"submit\"&gt;Notify&lt;/button&gt;&lt;/td&gt;' + '&lt;td&gt;&lt;button name=\"remove\" value=\"' + user.phone_number + '\" class=\"btn btn-default btn-xs\" type=\"submit\"&gt;Remove&lt;/button&gt;&lt;/td&gt;' + '&lt;/tr&gt;' } targetContainer.innerHTML = user_table; }; &lt;/script&gt; &lt;noscript&gt; &lt;meta http-equiv=\"refresh\" content=\"30\"&gt; &lt;/noscript&gt; &lt;/html&gt;</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b22198063707-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b22198063707-54\">54</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">DOCTYPE </span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">integrity</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">crossorigin</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"anonymous\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">form </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"center-block text-center\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"width: fit-content\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-st\">In</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Line</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">table </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"notified\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"table table-condensed\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">waiting</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">tr</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">td</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">phone</span><span class=\"crayon-sy\">_</span>number<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">td</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">td</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">button </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"notify\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"{{ user.phone_number }}\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"btn btn-primary btn-xs\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"submit\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">Notify</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">button</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">td</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">td</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">button </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"remove\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"{{ user.phone_number }}\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"btn btn-default btn-xs\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"submit\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Remove</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">button</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">td</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tr</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">endfor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">table</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">Notified</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">table </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"table table-condensed\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">notified</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">tr</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">td</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">phone</span><span class=\"crayon-sy\">_</span>number<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">td</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">td</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">button </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"arrived\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"{{ user.phone_number }}\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"btn btn-primary btn-xs\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"submit\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Arrived</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">button</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">td</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tr</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">endfor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">table</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">form</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-30\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">targetContainer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"notified\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eventSource</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EventSource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/stream\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">eventSource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">onmessage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JSON</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">users</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">waiting</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">wait_time</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">user_table</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">user </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">user_table</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_table</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;tr&gt;'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;td&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">phone_number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;/td&gt;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;td&gt;&lt;button name=\"notify\" value=\"'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">phone_number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\" class=\"btn btn-primary btn-xs\" type=\"submit\"&gt;Notify&lt;/button&gt;&lt;/td&gt;'</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;td&gt;&lt;button name=\"remove\" value=\"'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">phone_number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\" class=\"btn btn-default btn-xs\" type=\"submit\"&gt;Remove&lt;/button&gt;&lt;/td&gt;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;/tr&gt;'</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">targetContainer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">innerHTML</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_table</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">noscript</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">meta </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">equiv</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"refresh\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"30\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">noscript</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-52\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b22198063707-53\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b22198063707-54\">&nbsp;</div></div></td></tr></tbody></table>\n\nOn this page, you’ll notice there’s a form, which is used to submit data based on buttons being pressed. Also, like the status page, this one includes some Javascript for processing server-sent events, but will also continue to work properly if Javascript has been disabled.\n\n## Kicking Things Off\n\nWith the backend and frontend complete, you can now run your application! As mentioned earlier, this is done with:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">python main.py</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1e04b24110961283-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1e04b24110961283-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1e04b24110961283-1\"><span class=\"crayon-e\">python </span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1e04b24110961283-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn a browser, navigate to your ngrok URL to see the status view:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/01/status-view.png)](https://www.nexmo.com/wp-content/uploads/2020/01/status-view.png)\n\nGo to `<ngrok url>/list` to see the management view. Then text ‘Hi’ to the number you’ve configured to add yourself to the list!\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/01/list-view.png)](https://www.nexmo.com/wp-content/uploads/2020/01/list-view.png)\n\n## Next Steps\n\nThere are a number of ways this application could be enhanced to provide a more robust experience. The most obvious is to include an estimated wait time in the status updates. Wait times for those in line are already calculated and used to sort the list, so all you would need to do is settle on your preferred algorithm for making estimates. Another idea would be to support more options than SMS, such as Facebook Messenger or WhatsApp. If you’d like to take that route, be sure to check out Nexmo’s [Messages](https://developer.nexmo.com/messages/overview) API.\n\nIf you run into any issues or have questions, reach out to us on our [Community Slack](https://developer.nexmo.com/community/slack). Thanks for reading!"}