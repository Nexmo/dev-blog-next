{"_filedata":{"slug":"sending-gitlab-ci-pipeline-notifications-with-nexmo-messages-dr"},"title":"Sending GitLab CI Pipeline Notifications with Nexmo Messages","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2019/09/E_GitLab-CI-Pipeline_1200x600.jpg","author":348,"published":true,"published_at":"2019-09-30T08:00:36","tags":[119,1621,1333,1550],"body":"[![blog spotlight banner ](https://www.nexmo.com/wp-content/uploads/2019/08/blog-spotlight-banner.png)](https://developer.nexmo.com/spotlight)\n\nI operate my own blog, [The Polyglot Developer](https://www.thepolyglotdeveloper.com), which publishes as part of a continuous integration and continuous deployment pipeline. Essentially, the following series of events happens every time a `git push` is done:\n\n1.  The static site is pushed to GitLab\n2.  The build process of the pipeline starts\n3.  The deploy process of the pipeline starts\n4.  The static site is published and is ready for consumption\n\nIn more circumstances than I’d like to admit, the process fails because either my build failed or the deploy failed. The thing is, I don’t often know that these failures happen, which sometimes causes a lot of back-tracking.\n\nWe’re going to see how to improve the CI / CD process by including SMS notifications powered by Nexmo in the event of a failure.\n\n## Understanding the GitLab CI Configuration and Process\n\nIn case you’re unfamiliar with GitLab, you can make use of their CI services by including a **.gitlab-ci.yml** file at the root of your Git project. This file might look something like this:\n\nimage: \"node:alpine\" stages: - build - deploy build: stage: build script: - npm install - npx gulp build artifacts: paths: - dist deploy: stage: deploy script: - npm install - npx gulp deploy\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b15f784179257-21\">21</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-1\"><span class=\"crayon-v\">image</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"node:alpine\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-3\"><span class=\"crayon-v\">stages</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-7\"><span class=\"crayon-v\">build</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-9\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npx </span><span class=\"crayon-e\">gulp </span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-12\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">artifacts</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">paths</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dist</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-16\"><span class=\"crayon-v\">deploy</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-18\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b15f784179257-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npx </span><span class=\"crayon-e\">gulp </span><span class=\"crayon-i\">deploy</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b15f784179257-21\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe above configuration is fictional, but it follows a correctly formatted **.gitlab-ci.yml** file. In the above scenario, there is a `build` stage which runs the `build` gulp task and a `deploy` stage which runs the `deploy` gulp task.\n\nIf either of the two stages fails, what happens?\n\nWith GitLab CI you’re able to define when certain stages run which means you can design a stage to run when there is a failure. With this in mind, we could update our **.gitlab-ci.yml** to look something like the following:\n\nimage: \"node:alpine\" stages: - build - deploy - failure build: stage: build script: - npm install - npx gulp build artifacts: paths: - dist deploy: stage: deploy script: - npm install - npx gulp deploy failure: stage: failure script: - echo \"failure\" when: on\\_failure\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b162492490133-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b162492490133-28\">28</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-1\"><span class=\"crayon-v\">image</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"node:alpine\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-3\"><span class=\"crayon-v\">stages</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">failure</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-8\"><span class=\"crayon-v\">build</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-10\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npx </span><span class=\"crayon-e\">gulp </span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-13\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">artifacts</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">paths</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dist</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-17\"><span class=\"crayon-v\">deploy</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-19\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">install</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npx </span><span class=\"crayon-e\">gulp </span><span class=\"crayon-e\">deploy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-23\"><span class=\"crayon-v\">failure</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">failure</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-25\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"failure\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b162492490133-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">when</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">_</span>failure</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b162492490133-28\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe important piece of information is the `when` property that exists on the `failure` stage.\n\nSo now that we know how to create a GitLab CI configuration, how do we use that to our advantage for notifying us whenever there is a failure in the pipeline?\n\nThis is where Nexmo and the SMS service is valuable.\n\n## Using the Nexmo SMS API\n\nWhen our pipeline fails, we can make use of the SMS service from Nexmo to send us a text message which might include pipeline information, commit information, or really anything that might be valuable to us or the team responsible for the project.\n\nTo use the Nexmo SMS API, [you’ll need an account](https://developer.nexmo.com?utm_campaign=dev_spotlight&utm_content=gitlab_pipeline_raboy). Within the **Settings** section of your account, take note of the API key and the API secret.\n\n[![nexmo settings](https://www.nexmo.com/wp-content/uploads/2019/09/nexmo-settings.jpg)](https://www.nexmo.com/wp-content/uploads/2019/09/nexmo-settings.jpg)\n\nThe API information will be required when sending SMS messages automatically.\n\nIf we really wanted to, and we shouldn’t, we could create a cURL statement and hard-code all of our API and phone number information and add it directly into the GitLab CI configuration. We could, but we shouldn’t. Instead, we should create pipeline environment variables in GitLab.\n\nIn the **CI / CD -> Settings** tab of your GitLab project, expand the **Variables** section.\n\n[![gitlab-env-variables](https://www.nexmo.com/wp-content/uploads/2019/09/gitlab-env-variables.jpeg)](https://www.nexmo.com/wp-content/uploads/2019/09/gitlab-env-variables.jpeg)  \nThis is where you’re going to want to add your sensitive information so it isn’t exposed to everyone working on your project. Add the API key and API secret information as well as the destination phone number for the SMS. To protect it from the pipeline log output, make sure these variables are **Masked**, so they don’t show up.\n\nNow let’s revisit the **.gitlab-ci.yml** file. To make it easier to understand, let’s trim it down a bit and make it look like the following:\n\nimage: \"alpine:latest\" stages: - build - notify build: stage: build script: - exit 1 notify: stage: notify script: - apk add curl - curl -X \"POST\" \"https://rest.nexmo.com/sms/json\" -d \"from=15404161937\" -d \"text=${CI\\_PROJECT\\_NAME} ${CI\\_COMMIT\\_SHORT\\_SHA} Failed!\" -d \"to=${to}\" -d \"api\\_key=${api\\_key}\" -d \"api\\_secret=${api\\_secret}\" when: on\\_failure\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b164970730005-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b164970730005-18\">18</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-1\"><span class=\"crayon-v\">image</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"alpine:latest\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-3\"><span class=\"crayon-v\">stages</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">notify</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-7\"><span class=\"crayon-v\">build</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-9\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-12\"><span class=\"crayon-v\">notify</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">notify</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-14\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apk </span><span class=\"crayon-e\">add </span><span class=\"crayon-v\">curl</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://rest.nexmo.com/sms/json\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"from=15404161937\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text=${CI_PROJECT_NAME} ${CI_COMMIT_SHORT_SHA} Failed!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"to=${to}\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"api_key=${api_key}\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"api_secret=${api_secret}\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b164970730005-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">when</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">_</span>failure</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b164970730005-18\">&nbsp;</div></div></td></tr></tbody></table>\n\nNotice we have just two stages, one of which only happens when there is a failure. In the `build` stage we are forcing a failure for example purposes. This failure triggers the `notify` stage where the cURL application is downloaded and an HTTP request is made to the Nexmo SMS API.\n\nIn the cURL request, certain variables are used. The `${CI_PROJECT_NAME}` and `${CI_COMMIT_SHORT_SHA}` variables are [predefined by GitLab](https://docs.gitlab.com/ee/ci/variables/predefined_variables.html), but the `${to}`, `${api_key}`, and `${api_secret}` variables are what we had defined containing our Nexmo information.\n\nIf you push your Git project, it should send an SMS upon failure and that SMS should include the project that failed as well as the commit that failed.\n\n## Expanding the Messaging Options with the Nexmo Messages API\n\nThe Nexmo SMS API is great, but what if you want to reach other platforms beyond simple SMS? This is where the Nexmo Messages API comes into play, which offers SMS, Facebook Messenger, Viber, and WhatsApp support.\n\nThere is a little more setup involved, but you get a lot more features as a result.\n\nTo get started, you’re going to need some kind of backend service. Since Nexmo supports Node.js, it makes sense to use Node.js and JavaScript to avoid having to manufacture your own HTTP requests.\n\nCreate a new project directory, something that will be hosted outside your GitLab project. Within this directory, execute the following:\n\nnpm init -y npm install nexmo@beta express --save touch main.js\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b166714399354-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b166714399354-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b166714399354-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b166714399354-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b166714399354-1\"><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">init</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b166714399354-2\"><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">beta </span><span class=\"crayon-v\">express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">save</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b166714399354-3\"><span class=\"crayon-e\">touch </span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">js</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b166714399354-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe above commands will create a new **package.json** file, a **main.js** file for all of the application logic, and install each of the dependencies.\n\nThe point of this backend is to control webhooks that the Nexmo service will use. When working with the Nexmo Messages API, a **status** webhook and an **inbound** webhook are required as part of the message flow.\n\nOpen the **main.js** file and include the following:\n\nconst Express = require(\"express\"); const Nexmo = require('nexmo'); const server = Express(); server.use(Express.json()); server.use(Express.urlencoded({ extended: false })); const nexmo = new Nexmo({ apiKey: \"NEXMO\\_API\\_KEY\", apiSecret: \"NEXMO\\_API\\_SECRET\", applicationId: \"NEXMO\\_APPLICATION\\_ID\", privateKey: \"NEXMO\\_PATH\\_TO\\_PRIVATE\\_KEY\" }); server.post(\"/status\", (request, response, next) => { console.log(request.body); response.send(request.body); }); server.post(\"/inbound\", (request, response, next) => { console.log(request.body); response.send(request.body); }); server.listen(\"3000\", () => { console.log(\"Listening at :3000...\"); });\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b167031493946-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b167031493946-29\">29</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Express</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"express\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'nexmo'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Express</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-6\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-7\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlencoded</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">extended</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-9\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Nexmo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_API_KEY\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiSecret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_API_SECRET\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">applicationId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_APPLICATION_ID\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">privateKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_PATH_TO_PRIVATE_KEY\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-14\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-16\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/status\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-19\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-21\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/inbound\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-24\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-25\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-26\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"3000\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Listening at :3000...\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b167031493946-28\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b167031493946-29\">&nbsp;</div></div></td></tr></tbody></table>\n\nFor now, go ahead and ignore the tokens. We’ll worry about obtaining those in a moment.\n\nThe above code creates a simple Node.js server with two API endpoints which will represent the necessary webhooks. In our scenario, we’re only going to print out the requests that flow into the webhooks and bounce it back to the requestor.\n\nA request coming into the **status** webhook might look like this:\n\n{ message\\_uuid: 'UUID\\_STRING', to: { number: 'RECIPIENT\\_PHONE\\_NUMBER', type: 'sms' }, from: { number: 'SENDER\\_PHONE\\_NUMBER', type: 'sms' }, timestamp: '2019-09-09T23:18:25.308Z', usage: { price: '0.0062', currency: 'EUR' }, status: 'delivered' }\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b168138478038-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b168138478038-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b168138478038-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b168138478038-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b168138478038-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b168138478038-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b168138478038-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b168138478038-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b168138478038-9\">9</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b168138478038-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b168138478038-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">message_uuid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'UUID_STRING'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b168138478038-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'RECIPIENT_PHONE_NUMBER'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sms'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b168138478038-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SENDER_PHONE_NUMBER'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sms'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b168138478038-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">timestamp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2019-09-09T23:18:25.308Z'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b168138478038-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">price</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0.0062'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currency</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'EUR'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b168138478038-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">status</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'delivered'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b168138478038-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b168138478038-9\">&nbsp;</div></div></td></tr></tbody></table>\n\nBecause we won’t be receiving messages from users, the **inbound** webhook isn’t too relevant for us, even though it is required.\n\nSo let’s jump back into the token information:\n\nconst nexmo = new Nexmo({ apiKey: \"NEXMO\\_API\\_KEY\", apiSecret: \"NEXMO\\_API\\_SECRET\", applicationId: \"NEXMO\\_APPLICATION\\_ID\", privateKey: \"NEXMO\\_PATH\\_TO\\_PRIVATE\\_KEY\" });\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16a900326416-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16a900326416-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16a900326416-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16a900326416-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16a900326416-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16a900326416-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16a900326416-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16a900326416-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Nexmo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16a900326416-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_API_KEY\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16a900326416-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiSecret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_API_SECRET\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16a900326416-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">applicationId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_APPLICATION_ID\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16a900326416-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">privateKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"NEXMO_PATH_TO_PRIVATE_KEY\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16a900326416-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16a900326416-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nAs of now, you should already have the `apiKey` and `apiSecret` values from the previous example where the SMS API was used directly with cURL in the event of a failed deployment. What we don’t have is the `applicationId` and the `privateKey` which is actually a file.\n\nWithin the Nexmo Dashboard, click on **Messages and Dispatch** and proceed to creating a new application.\n\n[![nexmo-messages-application](https://www.nexmo.com/wp-content/uploads/2019/09/nexmo-messages-application.png)](https://www.nexmo.com/wp-content/uploads/2019/09/nexmo-messages-application.png)\n\nGive the application a name and provide the URL to each of the webhooks that you just created. If you’re still testing locally, consider using ngrok to tunnel into localhost so that you can continue to test without deploying your application. Choose to generate a new private and public key pair and move the private key that downloads into your Node.js project directory.\n\nWhen viewing the applications that you’ve created in the Nexmo Dashboard, you should have access to the application id of the application that we just created. Provide both the application id and the path to the private key in the `nexmo` variable that exists in our Node.js project.\n\nIn theory, as long as you’re serving the webhook application, you have two options for sending messages from GitLab:\n\n1.  You can create another endpoint that uses the JavaScript SDK to send.\n2.  You can use cURL, but also generate a JWT.\n\nThe easier of the two options is to just add another endpoint to the webhook application, something that GitLab can execute in the event of a failure because the JavaScript SDK handles JWT generation automatically.\n\nWithin the Node.js project, include the following:\n\nserver.post(\"/notify\", (request, response, next) => { nexmo.channel.send( { type: \"sms\", number: request.body.recipient }, { type: \"sms\", number: request.body.sender }, { content: { type: \"text\", text: request.body.message } }, (error, data) => { if(error) { return response.status(500).send(error); } response.send(data); }, { useBasicAuth: true }, ); });\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16b826056239-20\">20</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-1\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/notify\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sms\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">recipient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sms\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sender</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">message</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">useBasicAuth</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16b826056239-19\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16b826056239-20\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the above scenario, the recipient and sender information, as well as message information, is sent with the request. Then the application will send the message and the webhooks will be used in the process.\n\nIf we were to update our GitLab CI configuration, it might look like this:\n\nimage: \"alpine:latest\" stages: - build - notify build: stage: build script: - exit 1 notify: stage: notify script: - apk add curl - curl -X \"POST\" \"http://HOST/notify\" -H 'content-type: application/json' -d '{ \"sender\": \"15404161937\", \"recipient\": \"${to}\", \"message\": \"${CI\\_PROJECT\\_NAME} ${CI\\_COMMIT\\_SHORT\\_SHA} Failed!\" }' when: on\\_failure\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9dd0eb8b16d163017262-18\">18</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-1\"><span class=\"crayon-v\">image</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"alpine:latest\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-3\"><span class=\"crayon-v\">stages</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">notify</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-7\"><span class=\"crayon-v\">build</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-9\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-12\"><span class=\"crayon-v\">notify</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">stage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">notify</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-14\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apk </span><span class=\"crayon-e\">add </span><span class=\"crayon-v\">curl</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://HOST/notify\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">H</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'content-type: application/json'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{ \"sender\": \"15404161937\", \"recipient\": \"${to}\", \"message\": \"${CI_PROJECT_NAME} ${CI_COMMIT_SHORT_SHA} Failed!\" }'</span></div><div class=\"crayon-line\" id=\"crayon-5e9dd0eb8b16d163017262-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">when</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">_</span>failure</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9dd0eb8b16d163017262-18\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the above configuration, the Node.js application is used and a JSON payload is sent. The information in the payload is the data that was previously added as pipeline variables for the GitLab project.\n\nRemember, with the Messages API, you can use messaging techniques beyond SMS, even though SMS was the basis of this example.\n\n## Conclusion\n\nYou just saw how to include SMS notifications to your continuous integration and continuous deployment pipeline using Nexmo and GitLab. While we didn’t create a very extravagant project in this tutorial, the concepts that were used could easily be taken to a more complex project. The point here is that you can take your Nexmo information, create environment variables for your pipeline, and set up a failure stage to notify your team with SMS."}