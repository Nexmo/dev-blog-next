{"_filedata":{"slug":"using-jwt-for-authentication-in-a-golang-application-dr"},"title":"Using JWT for Authentication in a Golang Application","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/03/E_JWT_Golang-Application_1200x600.jpg","author":366,"published":true,"published_at":"2020-03-13T13:00:25","tags":[23,1601,1710,1306],"body":"[![blog spotlight banner ](https://www.nexmo.com/wp-content/uploads/2019/08/blog-spotlight-banner.png)](https://developer.nexmo.com/spotlight)\n\n## Introduction\n\nA JSON Web Token (JWT) is a compact and self-contained way for securely transmitting information between parties as a JSON object, and they are commonly used by developers in their APIs. JWTs are popular because:\n\n1.  A JWT is stateless. That is, it does not need to be stored in a database (persistence layer), unlike opaque tokens.\n2.  The signature of a JWT is never decoded once formed, thereby ensuring that the token is safe and secure.\n3.  A JWT can be set to be invalid after a certain period of time. This helps minimize or totally eliminate any damage that can be done by a hacker, in the event that the token is hijacked.\n\nIn this tutorial, I will demonstrate the creation, use, and invalidation of a JWT with a simple RESTful API using Golang and the Nexmo Messages API.\n\n### What Makes Up a JWT?\n\nA JWT is comprised of three parts:\n\n*   Header: the type of token and the signing algorithm used.  \n    The type of token can be “JWT” while the Signing Algorithm can either be HMAC or SHA256.\n*   Payload: the second part of the token which contains the claims. These claims include application specific data(e.g, user id, username), token expiration time(exp), issuer(iss), subject(sub), and so on.\n*   Signature: the encoded header, encoded payload, and a secret you provide are used to create the signature.\n\nLet’s use a simple token to understand the above concepts.\n\nToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdXRoX3V1aWQiOiIxZGQ5MDEwYy00MzI4LTRmZjMtYjllNi05NDRkODQ4ZTkzNzUiLCJhdXRob3JpemVkIjp0cnVlLCJ1c2VyX2lkIjo3fQ.Qy8l-9GUFsXQm4jqgswAYTAX9F4cngrl28WJVYNDwtM\n\nDon’t worry, the token is invalid, so it won’t work on any production application.\n\nYou can navigate to [jwt.to](https://jwt.io) and test the token signature if it is verified or not. Use “HS512” as the algorithm. You will get the message “Signature Verified”:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image9.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image9.png)\n\nTo make the signature, your application will need to provide a **key**. This key enables the signature to remain secure—even when the JWT is decoded the signature remains encrypted. It is highly recommended to always use a secret when creating a JWT.\n\n### Token Types\n\nSince a JWT can be set to expire (be invalidated) after a particular period of time, two tokens will be considered in this application:\n\n*   Access Token: An access token is used for requests that require authentication. It is normally added in the header of the request. It is recommended that an access token have a short lifespan, say 15 minutes. Giving an access token a short time span can prevent any serious damage if a user’s token is tampered with, in the event that the token is hijacked. The hacker only has 15 minutes or less to carry out his operations before the token is invalidated.\n*   Refresh Token: A refresh token has a longer lifespan, usually 7 days. This token is used to generate new access and refresh tokens. In the event that the access token expires, new sets of access and refresh tokens are created when the refresh token route is hit (from our application).\n\n### Where to Store a JWT\n\nFor a production grade application, it is highly recommended to store JWTs in an `HttpOnly` cookie. To achieve this, while sending the cookie generated from the backend to the frontend (client), a `HttpOnly` flag is sent along the cookie, instructing the browser not to display the cookie through the client-side scripts. Doing this can prevent XSS (Cross Site Scripting) attacks.  \nJWT can also be stored in browser local storage or session storage. Storing a JWT this way can expose it to several attacks such as XSS mentioned above, so it is generally less secure when compared to using \\`HttpOnly cookie technique.\n\n## The Application\n\nWe will consider a simple **todo** restful API.\n\nCreate a directory called `jwt-todo`, then initialize `go.mod` for dependency management. `go.mod` is initialized using:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">go mod init jwt-todo</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73488719773269-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73488719773269-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73488719773269-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">mod </span><span class=\"crayon-e\">init </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">todo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73488719773269-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow, create a `main.go` file inside the root directory(`/jwt-todo`), and add this to it:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">package main func main() {}</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348b830815866-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348b830815866-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348b830815866-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348b830815866-4\">4</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348b830815866-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348b830815866-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348b830815866-3\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348b830815866-4\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe will use [gin](https://github.com/gin-gonic) for routing and handling HTTP requests. The Gin Framework helps to reduce boilerplate code and is very efficient in building scalable APIs.\n\nYou can install gin, if you have not already, using:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">go get github.com/gin-gonic</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348d538087656-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348d538087656-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348d538087656-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gin</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">gonic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348d538087656-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen update the `main.go` file:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">package main Import ( \"github.com/gin-gonic/gin\" ) var ( router = gin.Default() ) func main() { router.POST(\"/login\", Login) log.Fatal(router.Run(\":8080\")) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348e241451523-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348e241451523-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348e241451523-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348e241451523-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348e241451523-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348e241451523-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348e241451523-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348e241451523-15\">15</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348e241451523-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-3\"><span class=\"crayon-e\">Import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348e241451523-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/gin-gonic/gin\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-5\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348e241451523-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-7\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348e241451523-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">Default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-9\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348e241451523-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-11\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348e241451523-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348e241451523-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348e241451523-15\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn an ideal situation, the `/login` route takes a user’s credentials, checks them against some database, and logs them in if the credentials are valid. But in this API, we will just use a sample user we will define in memory. Create a sample user in a struct. Add this to the `main.go` file:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">type User struct { ID uint64 `json:\"id\"` Username string `json:\"username\"` Password string `json:\"password\"` } //A sample use var user = User{ ID: 1, Username: \"username\", Password: \"password\", }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348f320912748-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348f320912748-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348f320912748-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348f320912748-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348f320912748-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348f320912748-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348f320912748-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348f320912748-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348f320912748-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348f320912748-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7348f320912748-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7348f320912748-12\">12</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348f320912748-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348f320912748-2\"><span class=\"crayon-e\">ID </span><span class=\"crayon-i\">uint64</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348f320912748-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">Username </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348f320912748-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">Password </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348f320912748-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348f320912748-6\"><span class=\"crayon-c\">//A sample use</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348f320912748-7\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348f320912748-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348f320912748-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Username</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348f320912748-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Password</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7348f320912748-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7348f320912748-12\">&nbsp;</div></div></td></tr></tbody></table>\n\n### Login Request\n\nWhen a user’s details have been verified, they are logged in and a JWT is generated on their behalf. We will achieve this in the `Login()` function defined below:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func Login(c *gin.Context) { var u User if err := c.ShouldBindJSON(&amp;u); err != nil { c.JSON(http.StatusUnprocessableEntity, \"Invalid json provided\") return } //compare the user from the request, with the one we defined: if user.Username != u.Username || user.Password != u.Password { c.JSON(http.StatusUnauthorized, \"Please provide valid login details\") return } token, err := CreateToken(user.ID) if err != nil { c.JSON(http.StatusUnprocessableEntity, err.Error()) return } c.JSON(http.StatusOK, token) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73490555199395-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73490555199395-19\">19</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Invalid json provided\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//compare the user from the request, with the one we defined:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Please provide valid login details\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73490555199395-18\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73490555199395-19\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe received the user’s request, then unmarshalled it into the `User` struct. We then compared the input user with the one we defined we defined in memory. If we were using a database, we would have compared it with a record in the database.\n\nSo as not to make the `Login` function bloated, the logic to generate a JWT is handled by `CreateToken`. Observe that the user id is passed to this function. It is used as a **claim** when generating the JWT.\n\nThe `CreateToken` function makes use of the `dgrijalva/jwt-go` package, we can install this using:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">go get github.com/dgrijalva/jwt-go</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73491587375640-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73491587375640-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73491587375640-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dgrijalva</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">go</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73491587375640-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nLet’s define the `CreateToken` function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func CreateToken(userid uint64) (string, error) { var err error //Creating Access Token os.Setenv(\"ACCESS_SECRET\", \"jdnfksdmfksd\") //this should be in an env file atClaims := jwt.MapClaims{} atClaims[\"authorized\"] = true atClaims[\"user_id\"] = userid atClaims[\"exp\"] = time.Now().Add(time.Minute * 15).Unix() at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims) token, err := at.SignedString([]byte(os.Getenv(\"ACCESS_SECRET\"))) if err != nil { return \"\", err } return token, nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73493773185758-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73493773185758-16\">16</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userid </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">err </span><span class=\"crayon-v\">error</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Access Token</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"jdnfksdmfksd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"authorized\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-8\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Minute *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73493773185758-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73493773185758-16\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe set the token to be valid only for 15 minutes, after which, it is invalid and cannot be used for any authenticated request. Also observe that we signed the JWT using a **secret**(`ACCESS_SECRET`) obtained from our environmental variable. It is highly recommended that this secret is not exposed in your codebase, but rather called from the environment just like we did above. You can save it in a `.env`, `.yml` or whatever works for you.\n\nThus far, our `main.go` file looks like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">package main import ( \"github.com/dgrijalva/jwt-go\" \"github.com/gin-gonic/gin\" \"log\" \"net/http\" \"os\" \"time\" ) var ( router = gin.Default() ) func main() { router.POST(\"/login\", Login) log.Fatal(router.Run(\":8080\")) } type User struct { ID uint64 `json:\"id\"` Username string `json:\"username\"` Password string `json:\"password\"` Phone string `json:\"phone\"` } var user = User{ ID: 1, Username: \"username\", Password: \"password\", Phone: \"49123454322\", //this is a random number } func Login(c *gin.Context) { var u User if err := c.ShouldBindJSON(&amp;u); err != nil { c.JSON(http.StatusUnprocessableEntity, \"Invalid json provided\") return } //compare the user from the request, with the one we defined: if user.Username != u.Username || user.Password != u.Password { c.JSON(http.StatusUnauthorized, \"Please provide valid login details\") return } token, err := CreateToken(user.ID) if err != nil { c.JSON(http.StatusUnprocessableEntity, err.Error()) return } c.JSON(http.StatusOK, token) } func CreateToken(userId uint64) (string, error) { var err error //Creating Access Token os.Setenv(\"ACCESS_SECRET\", \"jdnfksdmfksd\") //this should be in an env file atClaims := jwt.MapClaims{} atClaims[\"authorized\"] = true atClaims[\"user_id\"] = userId atClaims[\"exp\"] = time.Now().Add(time.Minute * 15).Unix() at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims) token, err := at.SignedString([]byte(os.Getenv(\"ACCESS_SECRET\"))) if err != nil { return \"\", err } return token, nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73494575866053-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73494575866053-65\">65</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/dgrijalva/jwt-go\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/gin-gonic/gin\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"log\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"net/http\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"os\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"time\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-10\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-11\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-12\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">Default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-14\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-15\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-16\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-19\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-20\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">ID </span><span class=\"crayon-i\">uint64</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Username </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Password </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Phone </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"phone\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-25\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-26\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Username</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"username\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Password</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"password\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">Phone</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"49123454322\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this is a random number</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-31\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-32\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-34\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Invalid json provided\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-38\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//compare the user from the request, with the one we defined:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-39\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Please provide valid login details\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-42\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-43\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-44\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-47\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-48\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-49\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-50\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userId </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-51\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">err </span><span class=\"crayon-v\">error</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-52\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Access Token</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-53\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"jdnfksdmfksd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-54\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-55\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"authorized\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-56\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userId</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-57\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Minute *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-58\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-59\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-60\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-61\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-62\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-63\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73494575866053-64\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73494575866053-65\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe can now run the application:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">go run main.go</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73495879635286-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73495879635286-2\">2</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73495879635286-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">go</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73495879635286-2\">&nbsp;</div></div></td></tr></tbody></table>\n\nNow we can try it out and see what we get! Fire up your favorite API tool and hit the `login`endpoint:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image8.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image8.png)\n\nAs seen above, we have generated a JWT that will last for 15 minutes.\n\n### Implementation Loopholes\n\nYes we can login a user a generate a JWT, but there is a lot wrong with the above implementation:\n\n1.  The JWT can only be invalidated when it expires. A major limitation to this is: a user can login, then decide to logout immediately, but the user’s JWT remains valid until the expiration time is reached.\n2.  The JWT might be hijacked and used by a hacker without the user doing anything about it, until the token expires.\n3.  The user will need to relogin after the token expires, thereby leading to poor user experience.\n\nWe can address the problems stated above in two ways:\n\n1.  Using a persistence storage layer to store JWT metadata. This will enable us to invalidate a JWT the very second a the user logs out, thereby improving security.\n2.  Using the concept of **refresh token** to generate a new **access token**, in the event that the **access token** expired, thereby improving the user experience.\n\n### Using Redis to Store JWT Metadata\n\nOne of the solutions we proffered above is saving a JWT metadata in a persistence layer. This can be done in any persistence layer of choice, but **redis** is highly recommended. Since the JWTs we generate have expiry time, redis has a feature that automatically deletes data whose expiration time has reached. Redis can also handle a lot of writes and can scale horizontally.\n\nSince redis is a key-value storage, its keys need to be unique, to achieve this, we will use `uuid` as the key and use the user id as the value.\n\nSo let’s install two packages to use:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">go get github.com/go-redis/redis/v7 go get github.com/twinj/uuid</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73497551266299-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73497551266299-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73497551266299-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73497551266299-1\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">go</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">v7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73497551266299-2\"><span class=\"crayon-e\">go </span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">twinj</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">uuid</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73497551266299-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe will also import those in the `main.go` file like so:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">import ( … \"github.com/go-redis/redis/v7\" \"github.com/twinj/uuid\" … )</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73498813965090-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73498813965090-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73498813965090-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73498813965090-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73498813965090-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73498813965090-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73498813965090-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73498813965090-1\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73498813965090-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span>…</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73498813965090-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/go-redis/redis/v7\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73498813965090-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"github.com/twinj/uuid\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73498813965090-5\">…</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73498813965090-6\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73498813965090-7\">&nbsp;</div></div></td></tr></tbody></table>\n\n> Note: It is expected that you have redis installed in your local machine. If not, you can pause and do that, before continuing.\n\nLet’s now initialize redis:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">var client *redis.Client func init() { //Initializing redis dsn := os.Getenv(\"REDIS_DSN\") if len(dsn) == 0 { dsn = \"localhost:6379\" } client = redis.NewClient(&amp;redis.Options{ Addr: dsn, //redis port }) _, err := client.Ping().Result() if err != nil { panic(err) } }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a73499659958112-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a73499659958112-17\">17</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e \">client *</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-3\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Initializing redis</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">dsn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REDIS_DSN\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dsn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">dsn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"localhost:6379\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Options</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Addr</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dsn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//redis port</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Ping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-e\">panic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a73499659958112-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a73499659958112-17\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe redis client is initialized in the `init()` function. This ensures that each time we run the `main.go` file, redis is automatically connected.\n\nWhen we create a token from this point forward, we will generate a `uuid` that will be used as one of the token claims, just as we used the user id as a claim in the previous implementation.\n\n### Define the Metadata=\n\nIn our proposed solution, instead of just creating one token, we will need to create two JWTs:\n\n1.  The Access Token\n2.  The Refresh Token\n\nTo achieve this, we will need to define a struct that house these tokens definitions, their expiration periods and uuids:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">type TokenDetails struct { AccessToken string RefreshToken string AccessUuid string RefreshUuid string AtExpires int64 RtExpires int64 }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349a159769687-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349a159769687-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349a159769687-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349a159769687-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349a159769687-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349a159769687-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349a159769687-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349a159769687-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349a159769687-9\">9</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349a159769687-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenDetails</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349a159769687-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">AccessToken&nbsp;&nbsp;</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349a159769687-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">RefreshToken </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349a159769687-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">AccessUuid&nbsp;&nbsp; </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349a159769687-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">RefreshUuid&nbsp;&nbsp;</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349a159769687-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">AtExpires&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">int64</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349a159769687-7\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-e\">RtExpires&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">int64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349a159769687-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349a159769687-9\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe expiration period and the uuids are very handy because they will be used when saving token metadata in redis.\n\nNow, let’s update the `CreateToken` function to look like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func CreateToken(userid uint64) (*TokenDetails, error) { td := &amp;TokenDetails{} td.AtExpires = time.Now().Add(time.Minute * 15).Unix() td.AccessUuid = uuid.NewV4().String() td.RtExpires = time.Now().Add(time.Hour * 24 * 7).Unix() td.RefreshUuid = uuid.NewV4().String() var err error //Creating Access Token os.Setenv(\"ACCESS_SECRET\", \"jdnfksdmfksd\") //this should be in an env file atClaims := jwt.MapClaims{} atClaims[\"authorized\"] = true atClaims[\"access_uuid\"] = td.AccessUuid atClaims[\"user_id\"] = userid atClaims[\"exp\"] = td.AtExpires at := jwt.NewWithClaims(jwt.SigningMethodHS256, atClaims) td.AccessToken, err = at.SignedString([]byte(os.Getenv(\"ACCESS_SECRET\"))) if err != nil { return nil, err } //Creating Refresh Token os.Setenv(\"REFRESH_SECRET\", \"mcmvmkmsdnfsdmfdsjf\") //this should be in an env file rtClaims := jwt.MapClaims{} rtClaims[\"refresh_uuid\"] = td.RefreshUuid rtClaims[\"user_id\"] = userid rtClaims[\"exp\"] = td.RtExpires rt := jwt.NewWithClaims(jwt.SigningMethodHS256, rtClaims) td.RefreshToken, err = rt.SignedString([]byte(os.Getenv(\"REFRESH_SECRET\"))) if err != nil { return nil, err } return td, nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349b603902245-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349b603902245-35\">35</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userid </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">TokenDetails</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-e\">TokenDetails</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AtExpires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Minute *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uuid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewV4</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RtExpires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Hour *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshUuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uuid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewV4</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">err </span><span class=\"crayon-v\">error</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Access Token</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"jdnfksdmfksd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"authorized\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"access_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AccessUuid</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-15\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-16\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AtExpires</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-17\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">atClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Creating Refresh Token</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mcmvmkmsdnfsdmfdsjf\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"refresh_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">RefreshUuid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-26\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userid</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-27\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">RtExpires</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-28\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-v\">rt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWithClaims</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHS256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rtClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SignedString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349b603902245-34\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349b603902245-35\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the above function, the **Access Token** expires after 15 minutes and the **Refresh Token** expires after 7 days. You can also observe we added a uuid as a claim to each token.  \nSince the uuid is unique each time it is created, a user can create more than one token. This happens when a user is logged in on different devices. The user can also logout from any of the devices without them being logged out from all devices. How cool!\n\n### Saving JWTs metadata\n\nLet’s now wire up the function that will be used to save the JWTs metadata:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func CreateAuth(userid uint64, td *TokenDetails) error { at := time.Unix(td.AtExpires, 0) //converting Unix to UTC(to Time object) rt := time.Unix(td.RtExpires, 0) now := time.Now() errAccess := client.Set(td.AccessUuid, strconv.Itoa(int(userid)), at.Sub(now)).Err() if errAccess != nil { return errAccess } errRefresh := client.Set(td.RefreshUuid, strconv.Itoa(int(userid)), rt.Sub(now)).Err() if errRefresh != nil { return errRefresh } return nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349d883486055-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349d883486055-16\">16</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">userid </span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">td *</span><span class=\"crayon-v\">TokenDetails</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AtExpires</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//converting Unix to UTC(to Time object)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">rt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Unix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RtExpires</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">errAccess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Itoa</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">at</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Err</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">errAccess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">errAccess</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">errRefresh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Itoa</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Err</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">errRefresh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">errRefresh</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349d883486055-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349d883486055-16\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe passed in the `TokenDetails` which have information about the expiration time of the JWTs and the uuids used when creating the JWTs. If the expiration time is reached for either the **refresh token** or the **access token**, the JWT is automatically deleted from redis.\n\nI personally use [Redily](https://www.redily.app), a redis GUI. Is a nice tool. You can take a look below to see how JWT metadata is stored in key-value pair.\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image2.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image2.png)\n\nBefore we test login again, we will need to call the `CreateAuth()` function in the `Login()` function. Update the Login function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func Login(c *gin.Context) { var u User if err := c.ShouldBindJSON(&amp;u); err != nil { c.JSON(http.StatusUnprocessableEntity, \"Invalid json provided\") return } //compare the user from the request, with the one we defined: if user.Username != u.Username || user.Password != u.Password { c.JSON(http.StatusUnauthorized, \"Please provide valid login details\") return } ts, err := CreateToken(user.ID) if err != nil { c.JSON(http.StatusUnprocessableEntity, err.Error()) return } saveErr := CreateAuth(user.ID, ts) if saveErr != nil { c.JSON(http.StatusUnprocessableEntity, saveErr.Error()) } tokens := map[string]string{ \"access_token\": ts.AccessToken, \"refresh_token\": ts.RefreshToken, } c.JSON(http.StatusOK, tokens) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349e081564626-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349e081564626-27\">27</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Invalid json provided\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//compare the user from the request, with the one we defined:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Password</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Please provide valid login details\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-13\"><span class=\"crayon-h\"></span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-14\"><span class=\"crayon-h\"></span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-15\"><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-17\"><span class=\"crayon-h\"></span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokens</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-s\">\"access_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-s\">\"refresh_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tokens</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349e081564626-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349e081564626-27\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe can try logging in again. Save the `main.g`o file and run it. When the login is hit from Postman, we should have:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image3.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image3.png)\n\nExcellent! We have both the **access\\_token** and the **refresh\\_token**, and also have token metadata persisted in redis.\n\n### Creating a Todo\n\nWe can now proceed to make requests that require authentication using JWT.\n\nOne of the unauthenticated requests in this API is the creation of **todo** request.\n\nFirst let’s define a `Todo` struct:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">type Todo struct { UserID uint64 `json:\"user_id\"` Title string `json:\"title\"` }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349f465941061-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349f465941061-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349f465941061-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a7349f465941061-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a7349f465941061-5\">5</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349f465941061-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Todo</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349f465941061-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">UserID </span><span class=\"crayon-i\">uint64</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349f465941061-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Title </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a7349f465941061-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a7349f465941061-5\">&nbsp;</div></div></td></tr></tbody></table>\n\nWhen performing any authenticated request, we need to validate the token passed in the authentication header to see if it is valid. We need to define some helper functions that help with these.\n\nFirst we will need to extract the token from the request header using the `ExtractToken` function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func ExtractToken(r *http.Request) string { bearToken := r.Header.Get(\"Authorization\") //normally Authorization the_token_xxx strArr := strings.Split(bearToken, \" \") if len(strArr) == 2 { return strArr[1] } return \"\" }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a0681553141-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a0681553141-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a0681553141-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a0681553141-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a0681553141-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a0681553141-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a0681553141-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a0681553141-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a0681553141-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a0681553141-10\">10</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a0681553141-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">ExtractToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a0681553141-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">bearToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Authorization\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a0681553141-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//normally Authorization the_token_xxx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a0681553141-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">strArr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bearToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a0681553141-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strArr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a0681553141-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a0681553141-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a0681553141-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a0681553141-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a0681553141-10\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen we will verify the token:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func VerifyToken(r *http.Request) (*jwt.Token, error) { tokenString := ExtractToken(r) token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) { //Make sure that the token method conform to \"SigningMethodHMAC\" if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok { return nil, fmt.Errorf(\"unexpected signing method: %v\", token.Header[\"alg\"]) } return []byte(os.Getenv(\"ACCESS_SECRET\")), nil }) if err != nil { return nil, err } return token, nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a1821517043-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a1821517043-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a1821517043-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a1821517043-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a1821517043-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a1821517043-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a1821517043-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a1821517043-15\">15</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">VerifyToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a1821517043-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokenString</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tokenString</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">token *</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">interface</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a1821517043-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">//Make sure that the token method conform to \"SigningMethodHMAC\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHMAC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a1821517043-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Errorf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unexpected signing method: %v\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"alg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a1821517043-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ACCESS_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a1821517043-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a1821517043-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a1821517043-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a1821517043-15\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe called `ExtractToken` inside the `VerifyToken` function to get the token string, then proceeded to check the signing method.\n\nThen, we will check the validity of this token, whether it is still useful or it has expired, using the `TokenValid` function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func TokenValid(r *http.Request) error { token, err := VerifyToken(r) if err != nil { return err } if _, ok := token.Claims.(jwt.Claims); !ok &amp;&amp; !token.Valid { return err } return nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a3646833936-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a3646833936-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a3646833936-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a3646833936-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a3646833936-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a3646833936-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a3646833936-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a3646833936-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a3646833936-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a3646833936-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a3646833936-11\">11</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a3646833936-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">TokenValid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a3646833936-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VerifyToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a3646833936-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a3646833936-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a3646833936-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a3646833936-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a3646833936-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a3646833936-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a3646833936-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a3646833936-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a3646833936-11\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe will also extract the token **metadata** that will lookup in our **redis** store we set up earlier. To extract the token, we define the `ExtractTokenMetadata` function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func ExtractTokenMetadata(r *http.Request) (*AccessDetails, error) { token, err := VerifyToken(r) if err != nil { return nil, err } claims, ok := token.Claims.(jwt.MapClaims) if ok &amp;&amp; token.Valid { accessUuid, ok := claims[\"access_uuid\"].(string) if !ok { return nil, err } userId, err := strconv.ParseUint(fmt.Sprintf(\"%.f\", claims[\"user_id\"]), 10, 64) if err != nil { return nil, err } return &amp;AccessDetails{ AccessUuid: accessUuid, UserId: userId, }, nil } return nil, err }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a4259446812-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a4259446812-23\">23</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">r *</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">AccessDetails</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VerifyToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">accessUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"access_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%.f\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-e\">AccessDetails</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">accessUuid</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">UserId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a4259446812-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a4259446812-23\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe `ExtractTokenMetadata` function returns an `AccessDetails` (which is a struct). This struct contains the metadata (`access_uuid` and `user_id`) that we will need to make a lookup in **redis**. If there is any reason we could not get the metadata from this token, the request is halted with an error message.\n\nThe `AccessDetails` struct mentioned above looks like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">type AccessDetails struct { AccessUuid string UserId uint64 }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a5950083115-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a5950083115-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a5950083115-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a5950083115-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a5950083115-5\">5</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a5950083115-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AccessDetails</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a5950083115-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">AccessUuid </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a5950083115-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">UserId&nbsp;&nbsp; </span><span class=\"crayon-i\">uint64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a5950083115-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a5950083115-5\">&nbsp;</div></div></td></tr></tbody></table>\n\nWe also mentioned looking up the token metadata in redis. Let’s define a function that will enable us to do that:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func FetchAuth(authD *AccessDetails) (uint64, error) { userid, err := client.Get(authD.AccessUuid).Result() if err != nil { return 0, err } userID, _ := strconv.ParseUint(userid, 10, 64) return userID, nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a6035468406-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a6035468406-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a6035468406-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a6035468406-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a6035468406-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a6035468406-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a6035468406-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a6035468406-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a6035468406-9\">9</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a6035468406-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">FetchAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">authD *</span><span class=\"crayon-v\">AccessDetails</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uint64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a6035468406-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">authD</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a6035468406-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a6035468406-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a6035468406-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a6035468406-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">userID</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a6035468406-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userID</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a6035468406-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a6035468406-9\">&nbsp;</div></div></td></tr></tbody></table>\n\n`FetchAuth()` accepts the `AccessDetails` from the `ExtractTokenMetadata` function, then looks it up in redis. If the record is not found, it may mean the token has expired, hence an error is thrown.\n\nLet’s finally wire up the `CreateTodo` function to better understand the implementation of the above functions:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func CreateTodo(c *gin.Context) { var td *Todo if err := c.ShouldBindJSON(&amp;td); err != nil { c.JSON(http.StatusUnprocessableEntity, \"invalid json\") return } tokenAuth, err := ExtractTokenMetadata(c.Request) if err != nil { c.JSON(http.StatusUnauthorized, \"unauthorized\") return } userId, err = FetchAuth(tokenAuth) if err != nil { c.JSON(http.StatusUnauthorized, \"unauthorized\") return } td.UserID = userId //you can proceed to save the Todo to a database //but we will just return it to the caller here: c.JSON(http.StatusCreated, td) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a7815577072-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a7815577072-23\">23</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateTodo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">td *</span><span class=\"crayon-e\">Todo</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"invalid json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-12\"><span class=\"crayon-h\"></span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FetchAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-17\"><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UserID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userId</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-19\"><span class=\"crayon-c\">//you can proceed to save the Todo to a database</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-20\"><span class=\"crayon-c\">//but we will just return it to the caller here:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCreated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a7815577072-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a7815577072-23\">&nbsp;</div></div></td></tr></tbody></table>\n\nAs seen, we called the `ExtractTokenMetadata` to extract the JWT **metadata** which is used in `FetchAuth` to check if the metadata still exists in our redis store. If everything is good, the Todo can then be saved to the database, but we chose to return it to the caller.\n\nLet’s update `main()` to include the `CreateTodo` function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func main() { router.POST(\"/login\", Login) router.POST(\"/todo\", CreateTodo) log.Fatal(router.Run(\":8080\")) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a8166872700-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a8166872700-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a8166872700-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a8166872700-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a8166872700-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734a8166872700-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734a8166872700-7\">7</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a8166872700-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a8166872700-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a8166872700-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/todo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CreateTodo</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a8166872700-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a8166872700-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734a8166872700-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734a8166872700-7\">&nbsp;</div></div></td></tr></tbody></table>\n\nTo test `CreateTodo`, login and copy the `access_token` and add it to the **Authorization Bearer Token** field like this:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image6.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image6.png)\n\nThen add a title to the request body to create a todo and make a POST request to the `/todo` endpoint, as shown below:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image4.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image4.png)\n\nAttempting to create a todo without an `access_token` will be unauthorized:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image5.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image5.png)\n\n### Logout Request\n\nThus far, we have seen how a JWT is used to make an authenticated request. When a user logs out, we will instantly revoke/invalidate their JWT. This is achieved by deleting the JWT metadata from our redis store.\n\nWe will now define a function that enables us delete a JWT metadata from redis:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func DeleteAuth(givenUuid string) (int64,error) { deleted, err := client.Del(givenUuid).Result() if err != nil { return 0, err } return deleted, nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734aa483359289-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734aa483359289-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734aa483359289-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734aa483359289-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734aa483359289-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734aa483359289-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734aa483359289-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734aa483359289-8\">8</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734aa483359289-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">DeleteAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">givenUuid </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">int64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734aa483359289-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Del</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">givenUuid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734aa483359289-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734aa483359289-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734aa483359289-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734aa483359289-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734aa483359289-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734aa483359289-8\">&nbsp;</div></div></td></tr></tbody></table>\n\nThe function above will delete the record in redis that corresponds with the `uuid` passed as a parameter.\n\nThe `Logout` function looks like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func Logout(c *gin.Context) { au, err := ExtractTokenMetadata(c.Request) if err != nil { c.JSON(http.StatusUnauthorized, \"unauthorized\") return } deleted, delErr := DeleteAuth(au.AccessUuid) if delErr != nil || deleted == 0 { //if any goes wrong c.JSON(http.StatusUnauthorized, \"unauthorized\") return } c.JSON(http.StatusOK, \"Successfully logged out\") }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ab366118362-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ab366118362-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ab366118362-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ab366118362-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ab366118362-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ab366118362-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ab366118362-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ab366118362-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ab366118362-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ab366118362-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ab366118362-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ab366118362-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ab366118362-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ab366118362-14\">14</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ab366118362-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Logout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ab366118362-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">au</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ab366118362-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ab366118362-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ab366118362-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ab366118362-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ab366118362-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DeleteAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">au</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessUuid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ab366118362-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//if any goes wrong</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ab366118362-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ab366118362-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ab366118362-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ab366118362-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusOK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Successfully logged out\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ab366118362-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ab366118362-14\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the `Logout` function, we first extracted the JWT metadata. If successful, we then proceed with deleting that metadata, thereby rendering the JWT invalid immediately.\n\nBefore testing, update the `main.go` file to include the `logout` endpoint like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func main() { router.POST(\"/login\", Login) router.POST(\"/todo\", CreateTodo) router.POST(\"/logout\", Logout) log.Fatal(router.Run(\":8080\")) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ac042200230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ac042200230-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ac042200230-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ac042200230-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ac042200230-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ac042200230-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ac042200230-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ac042200230-8\">8</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ac042200230-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ac042200230-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ac042200230-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/todo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CreateTodo</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ac042200230-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/logout\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Logout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ac042200230-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ac042200230-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ac042200230-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ac042200230-8\">&nbsp;</div></div></td></tr></tbody></table>\n\nProvide a valid `access_token` associated with a user, then logout the user. Remember to add the `access_token` to the `Authorization Bearer Token`, then hit the logout endpoint:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image1.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image1.png)\n\nNow the user is logged out, and no further request can be performed with that JWT again as it is immediately invalidated. This implementation is more secure than waiting for a JWT to expire after a user logs out.\n\n### Securing Authenticated Routes\n\nWe have two routes that require authentication: `/login` and `/logout`. Right now, with or without authentication, anybody can access these routes. Let’s change that.\n\nWe will need to define the `TokenAuthMiddleware()` function to secure these routes:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func TokenAuthMiddleware() gin.HandlerFunc { return func(c *gin.Context) { err := TokenValid(c.Request) if err != nil { c.JSON(http.StatusUnauthorized, err.Error()) c.Abort() return } c.Next() } }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ad519066135-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ad519066135-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ad519066135-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ad519066135-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ad519066135-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ad519066135-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ad519066135-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ad519066135-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ad519066135-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ad519066135-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ad519066135-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ad519066135-12\">12</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ad519066135-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">TokenAuthMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">HandlerFunc</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ad519066135-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ad519066135-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenValid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ad519066135-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ad519066135-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ad519066135-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ad519066135-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ad519066135-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ad519066135-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ad519066135-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ad519066135-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ad519066135-12\">&nbsp;</div></div></td></tr></tbody></table>\n\nAs seen above, we called the `TokenValid()` function (defined earlier) to check if the token is still valid or has expired. The function will be used in the authenticated routes to secure them.  \nLet’s now update `main.go` to include this middleware:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func main() { router.POST(\"/login\", Login) router.POST(\"/todo\", TokenAuthMiddleware(), CreateTodo) router.POST(\"/logout\", TokenAuthMiddleware(), Logout) log.Fatal(router.Run(\":8080\")) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ae642897230-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ae642897230-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ae642897230-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ae642897230-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ae642897230-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ae642897230-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ae642897230-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ae642897230-8\">8</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ae642897230-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ae642897230-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ae642897230-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/todo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenAuthMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CreateTodo</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ae642897230-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/logout\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TokenAuthMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Logout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ae642897230-5\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ae642897230-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Fatal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\":8080\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ae642897230-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ae642897230-8\">&nbsp;</div></div></td></tr></tbody></table>\n\n### Refreshing Tokens\n\nThus far, we can create, use and revoke JWTs. In an application that will involve a user interface, what happens if the **access token** expires and the user needs to make an authenticated request? Will the user be unauthorized, and be made to login again? Unfortunately, that will be the case. But this can be averted using the concept of a **refresh token**. The user does not need to relogin.  \nThe **refresh token** created alongside the **access token** will be used to create new pairs of **access and refresh tokens**.\n\nUsing JavaScript to consume our API endpoints, we can refresh the JWTs like a breeze using [axios interceptors](https://github.com/axios/axios). In our API, we will need to send a POST request with a `refresh_token` as the body to the `/token/refresh` endpoint.\n\nLet’s first create the `Refresh()` function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func Refresh(c *gin.Context) { mapToken := map[string]string{} if err := c.ShouldBindJSON(&amp;mapToken); err != nil { c.JSON(http.StatusUnprocessableEntity, err.Error()) return } refreshToken := mapToken[\"refresh_token\"] //verify the token os.Setenv(\"REFRESH_SECRET\", \"mcmvmkmsdnfsdmfdsjf\") //this should be in an env file token, err := jwt.Parse(refreshToken, func(token *jwt.Token) (interface{}, error) { //Make sure that the token method conform to \"SigningMethodHMAC\" if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok { return nil, fmt.Errorf(\"unexpected signing method: %v\", token.Header[\"alg\"]) } return []byte(os.Getenv(\"REFRESH_SECRET\")), nil }) //if there is an error, the token must have expired if err != nil { c.JSON(http.StatusUnauthorized, \"Refresh token expired\") return } //is token valid? if _, ok := token.Claims.(jwt.Claims); !ok &amp;&amp; !token.Valid { c.JSON(http.StatusUnauthorized, err) return } //Since token is valid, get the uuid: claims, ok := token.Claims.(jwt.MapClaims) //the token claims should conform to MapClaims if ok &amp;&amp; token.Valid { refreshUuid, ok := claims[\"refresh_uuid\"].(string) //convert the interface to string if !ok { c.JSON(http.StatusUnprocessableEntity, err) return } userId, err := strconv.ParseUint(fmt.Sprintf(\"%.f\", claims[\"user_id\"]), 10, 64) if err != nil { c.JSON(http.StatusUnprocessableEntity, \"Error occurred\") return } //Delete the previous Refresh Token deleted, delErr := DeleteAuth(refreshUuid) if delErr != nil || deleted == 0 { //if any goes wrong c.JSON(http.StatusUnauthorized, \"unauthorized\") return } //Create new pairs of refresh and access tokens ts, createErr := CreateToken(userId) if createErr != nil { c.JSON(http.StatusForbidden, createErr.Error()) return } //save the tokens metadata to redis saveErr := CreateAuth(userId, ts) if saveErr != nil { c.JSON(http.StatusForbidden, saveErr.Error()) return } tokens := map[string]string{ \"access_token\": ts.AccessToken, \"refresh_token\": ts.RefreshToken, } c.JSON(http.StatusCreated, tokens) } else { c.JSON(http.StatusUnauthorized, \"refresh expired\") } }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734af949447514-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734af949447514-68\">68</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">Refresh</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">mapToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">mapToken</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">refreshToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mapToken</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"refresh_token\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//verify the token</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Setenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mcmvmkmsdnfsdmfdsjf\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//this should be in an env file</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">refreshToken</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">token *</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">interface</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">//Make sure that the token method conform to \"SigningMethodHMAC\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SigningMethodHMAC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Errorf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unexpected signing method: %v\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"alg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"REFRESH_SECRET\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//if there is an error, the token must have expired</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Refresh token expired\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//is token valid?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Since token is valid, get the uuid:</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Claims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jwt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MapClaims</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//the token claims should conform to MapClaims</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Valid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">refreshUuid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"refresh_uuid\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//convert the interface to string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fmt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%.f\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">claims</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"user_id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Error occurred\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">//Delete the previous Refresh Token</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DeleteAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">refreshUuid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deleted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//if any goes wrong</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">//Create new pairs of refresh and access tokens</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">createErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateToken</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">createErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">createErr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-52\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">//save the tokens metadata to redis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-54\"><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CreateAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-55\"><span class=\"crayon-h\"></span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saveErr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-57\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-58\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-59\"><span class=\"crayon-h\"></span><span class=\"crayon-v\">tokens</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-60\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-s\">\"access_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AccessToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-61\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"refresh_token\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RefreshToken</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-62\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-63\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCreated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tokens</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-64\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-65\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"refresh expired\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-66\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734af949447514-67\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734af949447514-68\">&nbsp;</div></div></td></tr></tbody></table>\n\nWhile a lot is going on in that function, let’s try and understand the flow.  \n– We first took the `refresh_token` from the request body.  \n– We then verified the signing method of the token.  \n– Next, check if the token is still valid.  \n– The `refresh_uuid` and the `user_id` are then extracted, which are metadata used as claims when creating the refresh token.  \n– We then search for the metadata in redis store and delete it using the `refresh_uuid` as key.  \n– We then create a new pair of access and refresh tokens that will now be used for future requests.  \n– The metadata of the access and refresh tokens are saved in redis.  \n– The created tokens are returned to the caller.  \n– In the else statement, if the **refresh token** is not valid, the user will not be allowed to create a new pair of tokens. We will need to relogin to get new tokens.\n\nNext, add the refresh token route in the `main()` function:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">router.POST(\"/token/refresh\", Refresh)</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b6171178515-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b6171178515-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b6171178515-3\">3</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b6171178515-1\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">router</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">POST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/token/refresh\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Refresh</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b6171178515-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b6171178515-3\">&nbsp;</div></div></td></tr></tbody></table>\n\nTesting the endpoint with a valid `refresh_token`:\n\n[![](https://www.nexmo.com/wp-content/uploads/2020/03/image7.png)](https://www.nexmo.com/wp-content/uploads/2020/03/image7.png)\n\nAnd we have successfully created new token pairs. Great😎.\n\n### Send Messages Using the Nexmo Messages API\n\nLet’s notify users each time they create a Todo using the Nexmo Messages API. To send a message with the Nexmo Messages API, you need to [signup](https://dashboard.nexmo.com/sign-up) and obtain your API key and Secret. If you already have that, you can proceed.\n\nYou can define your API key and Secret in an environmental variable then use them in this file like this:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">var ( NEXMO_API_KEY = os.Getenv( \"your_api_key\") NEXMO_API_SECRET = os.Getenv(\"your_secret\") )</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b7138930981-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b7138930981-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b7138930981-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b7138930981-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b7138930981-5\">5</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b7138930981-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b7138930981-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"your_api_key\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b7138930981-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Getenv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"your_secret\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b7138930981-4\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b7138930981-5\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen, we will define some structs that have information about the sender, the receiver, and the message content:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">type Payload struct { From From `json:\"from\"` To To `json:\"to\"` Message Message `json:\"message\"` } type From struct { Type string `json:\"type\"` Number string `json:\"number\"` } type To struct { Type string `json:\"type\"` Number string `json:\"number\"` } type Content struct { Type string `json:\"type\"` Text string `json:\"text\"` } type Message struct { Content Content `json:\"content\"` }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734b8391545895-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734b8391545895-21\">21</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-1\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Payload</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">From&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">From</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"from\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">To</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">To</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"to\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Message </span><span class=\"crayon-i\">Message</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-6\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">From</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Type&nbsp;&nbsp; </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Number </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-10\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">To</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Type&nbsp;&nbsp; </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Number </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-14\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Content</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Type </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Text </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-18\"><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Message</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">Content </span><span class=\"crayon-i\">Content</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">json</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734b8391545895-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734b8391545895-21\">&nbsp;</div></div></td></tr></tbody></table>\n\nThen we define the function to send a message to a user below:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func SendMessage(username, phone string) (*http.Response, error) { data := Payload{ From: From{ Type: \"sms\", Number: \"Nexmo\", }, To: To{ Type: \"sms\", Number: phone, }, Message: Message{ Content: Content{ Type: \"text\", Text: \"Dear \" + username + \", a todo was created from your account just now.\", }, }, } payloadBytes, err := json.Marshal(data) if err != nil { return nil, err } body := bytes.NewReader(payloadBytes) req, err := http.NewRequest(\"POST\", \"https://api.nexmo.com/v0.1/messages\", body) if err != nil { return nil, err } //Ensure headers req.SetBasicAuth(NEXMO_API_KEY, NEXMO_API_SECRET) req.Header.Set(\"Content-Type\", \"application/json\") req.Header.Set(\"Accept\", \"application/json\") resp, err := http.DefaultClient.Do(req) if err != nil { return nil, err } defer resp.Body.Close() return resp, nil }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734ba141255533-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734ba141255533-41\">41</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">SendMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">phone </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Payload</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">From</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">From</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-s\">\"sms\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Nexmo\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">To</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">To</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-s\">\"sms\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Number</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">phone</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Message</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Message</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Content</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">Text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Dear \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\", a todo was created from your account just now.\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-18\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">payloadBytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Marshal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">body</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">payloadBytes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-23\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-24\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://api.nexmo.com/v0.1/messages\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">//Ensure headers</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SetBasicAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NEXMO_API_KEY</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NEXMO_API_SECRET</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Content-Type\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"application/json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Accept\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"application/json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-32\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-33\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DefaultClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">Do</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-34\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-36\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Body</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-38\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-39\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734ba141255533-40\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734ba141255533-41\">&nbsp;</div></div></td></tr></tbody></table>\n\nIn the above function, the `To` number is the number of the user, while the `From` number must be purchased via your [Nexmo Dashboard](https://dashboard.nexmo.com).\n\nEnsure that you have your `NEXMO_API_KEY` and `NEXMO_API_SECRET` defined in your environment variable file.\n\nWe then update the `CreateTodo` function to include the `SendMessage` function just defined, passing in the required parameters:\n\n<textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">func CreateTodo(c *gin.Context) { var td *Todo if err := c.ShouldBindJSON(&amp;td); err != nil { c.JSON(http.StatusUnprocessableEntity, \"invalid json\") return } tokenAuth, err := ExtractTokenMetadata(c.Request) if err != nil { c.JSON(http.StatusUnauthorized, \"unauthorized\") return } userId, err = FetchAuth(tokenAuth) if err != nil { c.JSON(http.StatusUnauthorized, \"unauthorized\") return } td.UserID = userId //you can proceed to save the Todo to a database //but we will just return it to the caller here: //Send the user a notification msgResp, err := SendMessage(user.Username, user.Phone) if err != nil { c.JSON(http.StatusForbidden, \"error occurred sending message to user\") return } if msgResp.StatusCode &gt; 299 { c.JSON(http.StatusForbidden, \"cannot send message to user\") return } c.JSON(http.StatusCreated, td) }</textarea>\n\n<table class=\"crayon-table\"><tbody><tr class=\"crayon-row\"><td class=\"crayon-nums \" data-settings=\"show\"><div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9ddc1a734bb685043281-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9ddc1a734bb685043281-34\">34</div></div></td><td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-1\"><span class=\"crayon-e\">func </span><span class=\"crayon-e\">CreateTodo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">c *</span><span class=\"crayon-v\">gin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">td *</span><span class=\"crayon-e\">Todo</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-3\"><span class=\"crayon-e\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ShouldBindJSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnprocessableEntity</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"invalid json\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractTokenMetadata</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-12\"><span class=\"crayon-h\"></span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FetchAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tokenAuth</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusUnauthorized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unauthorized\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-17\"><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UserID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userId</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-18\"><span class=\"crayon-c\">//you can proceed to save the Todo to a database</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-19\"><span class=\"crayon-c\">//but we will just return it to the caller here:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-21\"><span class=\"crayon-c\">//Send the user a notification</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">msgResp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SendMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Phone</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"error occurred sending message to user\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msgResp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">299</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusForbidden</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cannot send message to user\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-31\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">JSON</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StatusCreated</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5e9ddc1a734bb685043281-33\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9ddc1a734bb685043281-34\">&nbsp;</div></div></td></tr></tbody></table>\n\nEnsure that a valid phone number is provided, so that you can get the message when you attempt to create a todo.\n\n## Conclusion\n\nYou have seen how you can create and invalidate a JWT. You also saw how you can integrate the Nexmo Messages API in your Golang application to send notifications. You can extend this application and use a real database to persist users and todos, and you can also use a React or VueJS to build a frontend. That is where you will really appreciate the Refresh Token feature with the help of Axios Interceptors."}